<!DOCTYPE HTML>
<html lang="en" class="latte sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Common Data Structures - Higher-Kinded Types and Optics for Java</title>


        <!-- Custom HTML head -->


            <meta name="description" content="Explore Higher-Kinded Types (HKTs) and Optcs in Java with the Higher-Kinded-J library. Learn about Functors, Applicatives, Monads, Transformers, practical functional patterns, and how to write cleaner, more composable Java code for your projects using Optics.">


        <meta name="keywords" content="Higher-Kinded Types, Higher-Kinded-J, Higher-Kinded Java, Higher Kinded Java, HKT, Java, Optics, Lens, Prism, Traversal, Iso, Functional Programming, Monad, Functor, Applicative, Transformer, Monoid, Traverse, higherkindedj">
        
        <meta property="og:title" content="Common Data Structures - Higher-Kinded Types and Optics for Java"> 
            <meta property="og:description" content="Explore Higher-Kinded Types (HKTs) and Optcs in Java with the Higher-Kinded-J library. Learn about Functors, Applicatives, Monads, Transformers, practical functional patterns, and how to write cleaner, more composable Java code for your projects using Optics.">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://higher-kinded-j.github.io/"> 
        
        <meta property="og:image" content="https://higher-kinded-j.github.io/preview.png" />
        <meta property="og:site_name" content="Higher-Kinded-J Documentation" />
        
        
        <meta name="twitter:card" content="summary_large_image" /> <meta name="twitter:title" content="Common Data Structures - Higher-Kinded Types and Optics for Java - Higher-Kinded-J" />
        <meta name="twitter:description" content="Bringing Higher-Kinded Types and Optics to Java functional patterns" />
        <meta name="twitter:image" content="https://higher-kinded-j.github.io/preview.png" />
        <meta name="description" content="Explore Higher-Kinded Types (HKTs) and Optcs in Java with the Higher-Kinded-J library. Learn about Functors, Applicatives, Monads, Transformers, practical functional patterns, and how to write cleaner, more composable Java code for your projects using Optics.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">
        <meta name="google-site-verification" content="X-xsiAq2cKMLOzh9dexUrX8Onx2h_YMUFgp5lHHUwSg" />
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././mdbook-admonish.css">
        <link rel="stylesheet" href=".././theme/catppuccin.css">
        <link rel="stylesheet" href=".././theme/catppuccin-admonish.css">
        <link rel="stylesheet" href=".././theme/catppuccin-alerts.css">
        <link rel="stylesheet" href=".././theme/additional-hkj.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "latte";
            const default_dark_theme = "macchiato";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('latte')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="latte">Latte</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="frappe">Frapp√©</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="macchiato">Macchiato</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mocha">Mocha</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        <div class="version-selector-container">
                            <select id="version-selector" class="version-selector" aria-label="Select documentation version" title="Select documentation version">
                                <option value="">Loading versions...</option>
                            </select>
                        </div>
                    </div>

                    <h1 class="menu-title">Higher-Kinded Types and Optics for Java</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/higher-kinded-j/higher-kinded-j" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/higher-kinded-j/higher-kinded-j/edit/main/hkj-book/src/optics/common_data_structure_traversals.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="common-data-structure-traversals"><a class="header" href="#common-data-structure-traversals">Common Data Structure Traversals</a></h1>
<h2 id="extending-traversal-power-to-optional-map-and-tuple-types"><a class="header" href="#extending-traversal-power-to-optional-map-and-tuple-types"><em>Extending Traversal Power to Optional, Map, and Tuple Types</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>Traversing Optional values with affine traversals (0-1 cardinality)</li>
<li>Bulk transformations on Map values whilst preserving keys</li>
<li>Parallel operations on Tuple2 pairs when elements share a type</li>
<li>Composing structure traversals with lenses and filtered optics</li>
<li>Real-world patterns: configuration management, feature flags, coordinate transforms</li>
<li>When to use structure traversals vs direct access vs Stream API</li>
</ul>
</div>
</div>
<div id="admonition-example-code" class="admonition admonish-note" role="note" aria-labelledby="admonition-example-code-title">
<div class="admonition-title">
<div id="admonition-example-code-title">
<p>Example Code</p>
</div>
<a class="admonition-anchor-link" href="#admonition-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/OptionalMapTraversalsExample.java">OptionalMapTraversalsExample</a></p>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/TupleTraversalsExample.java">TupleTraversalsExample</a></p>
</div>
</div>
<p>So far, we've explored traversals for collections: lists, sets, and arrays. But Java applications work with many other data structures that benefit from traversal operations: Optional values that might be empty, Map collections where we need to transform values whilst preserving keys, and Tuple pairs that represent related data.</p>
<p>These structures share a common need: <strong>apply a transformation uniformly across their contents whilst maintaining structural integrity</strong>. Higher-kinded-j's traversal combinators make this declarative, composable, and type-safe.</p>
<hr />
<h2 id="think-of-structure-traversals-like"><a class="header" href="#think-of-structure-traversals-like">Think of Structure Traversals Like...</a></h2>
<ul>
<li><strong>Java Stream's <code>Optional.map()</code></strong>: Like <code>optional.map(transform)</code> but composable with other optics</li>
<li><strong>Scala's for-comprehensions</strong>: Similar to <code>for { x &lt;- option } yield transform(x)</code>, but integrated into optic pipelines</li>
<li><strong>Database UPDATE statements</strong>: Like <code>UPDATE config SET value = transform(value)</code>, preserving structure</li>
<li><strong>Functional map operations</strong>: Like <code>fmap</code> in Haskell, lifting pure functions into wrapped contexts</li>
</ul>
<p>The key insight: these aren't special cases; they're <strong>traversals with specific cardinality</strong>:</p>
<ul>
<li><code>Optional&lt;A&gt;</code>: 0 or 1 element (affine traversal)</li>
<li><code>Map&lt;K, V&gt;</code>: 0 to N values, preserving keys</li>
<li><code>Tuple2&lt;A, A&gt;</code>: Exactly 2 elements (when same type)</li>
</ul>
<hr />
<h2 id="three-categories-of-structure-traversals"><a class="header" href="#three-categories-of-structure-traversals">Three Categories of Structure Traversals</a></h2>
<p>Higher-kinded-j provides factory methods in <code>Traversals</code> and dedicated utility classes:</p>
<div class="table-wrapper"><table><thead><tr><th>Structure</th><th>Method</th><th>Cardinality</th><th>Use Case</th></tr></thead><tbody>
<tr><td><strong>Optional</strong></td><td><code>Traversals.forOptional()</code></td><td>0 or 1</td><td>Nullable fields, configuration values</td></tr>
<tr><td><strong>Map Values</strong></td><td><code>Traversals.forMapValues()</code></td><td>0 to N</td><td>Bulk value transforms, preserving keys</td></tr>
<tr><td><strong>Tuple2 Pairs</strong></td><td><code>TupleTraversals.both()</code></td><td>Exactly 2</td><td>Coordinate systems, min/max pairs</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="optional-traversals-handling-absent-values-declaratively"><a class="header" href="#optional-traversals-handling-absent-values-declaratively">Optional Traversals: Handling Absent Values Declaratively</a></h2>
<h3 id="the-problem-with-nested-optionals"><a class="header" href="#the-problem-with-nested-optionals">The Problem with Nested Optionals</a></h3>
<p>Traditional Optional handling becomes verbose when working with nested structures:</p>
<pre><code class="language-java">@GenerateLenses
public record ServerConfig(
    String hostname,
    Optional&lt;Integer&gt; port,
    Optional&lt;String&gt; sslCertPath
) {}

@GenerateLenses
public record ApplicationConfig(
    String appName,
    Optional&lt;ServerConfig&gt; server
) {}

// Traditional: Nested map() calls
ApplicationConfig updated = config.server()
    .map(server -&gt; server.port()
        .map(p -&gt; server.withPort(Optional.of(p + 1000)))  // Offset ports
        .orElse(server)
    )
    .map(newServer -&gt; config.withServer(Optional.of(newServer)))
    .orElse(config);
</code></pre>
<p>This pattern doesn't compose with other optics and mixes traversal logic with transformation logic.</p>
<h3 id="the-solution-foroptional-traversal"><a class="header" href="#the-solution-foroptional-traversal">The Solution: <code>forOptional()</code> Traversal</a></h3>
<p>The <code>forOptional()</code> method creates an <strong>affine traversal</strong>, focusing on 0 or 1 element.</p>
<pre><code class="language-java">import org.higherkindedj.optics.util.Traversals;

// Create an Optional traversal
Traversal&lt;Optional&lt;Integer&gt;, Integer&gt; optTraversal = Traversals.forOptional();

// Modify the value if present
Optional&lt;Integer&gt; maybePort = Optional.of(8080);
Optional&lt;Integer&gt; offsetPort = Traversals.modify(optTraversal, p -&gt; p + 1000, maybePort);
// Result: Optional.of(9080)

// Empty Optional remains empty
Optional&lt;Integer&gt; empty = Optional.empty();
Optional&lt;Integer&gt; stillEmpty = Traversals.modify(optTraversal, p -&gt; p + 1000, empty);
// Result: Optional.empty()

// Extract value as a list
List&lt;Integer&gt; values = Traversals.getAll(optTraversal, maybePort);
// Result: [8080]  (or [] for empty)
</code></pre>
<h3 id="composing-with-lenses-for-nested-optionals"><a class="header" href="#composing-with-lenses-for-nested-optionals">Composing with Lenses for Nested Optionals</a></h3>
<pre><code class="language-java">// Compose Optional traversal with lens traversal
Traversal&lt;ApplicationConfig, Integer&gt; serverPorts =
    ApplicationConfigLenses.server().asTraversal()
        .andThen(Traversals.forOptional())
        .andThen(ServerConfigLenses.port().asTraversal())
        .andThen(Traversals.forOptional());

// Offset all server ports in one operation
ApplicationConfig updated = Traversals.modify(serverPorts, p -&gt; p + 1000, config);
// Works whether server and port are present or absent
</code></pre>
<h3 id="real-world-example-feature-flag-management"><a class="header" href="#real-world-example-feature-flag-management">Real-World Example: Feature Flag Management</a></h3>
<pre><code class="language-java">@GenerateLenses
public record FeatureFlags(Map&lt;String, Optional&lt;Boolean&gt;&gt; flags) {}

public class FeatureFlagService {

    // Enable all flags that are currently set (respect absent flags)
    public static FeatureFlags enableAllSet(FeatureFlags config) {
        Traversal&lt;Map&lt;String, Optional&lt;Boolean&gt;&gt;, Optional&lt;Boolean&gt;&gt; allFlagValues =
            Traversals.forMapValues();

        Traversal&lt;Map&lt;String, Optional&lt;Boolean&gt;&gt;, Boolean&gt; presentFlags =
            allFlagValues.andThen(Traversals.forOptional());

        Map&lt;String, Optional&lt;Boolean&gt;&gt; updated = Traversals.modify(
            presentFlags,
            flag -&gt; true,  // Enable all present flags
            config.flags()
        );

        return new FeatureFlags(updated);
    }
}
</code></pre>
<hr />
<h2 id="map-value-traversals-bulk-transformations-preserving-keys"><a class="header" href="#map-value-traversals-bulk-transformations-preserving-keys">Map Value Traversals: Bulk Transformations Preserving Keys</a></h2>
<h3 id="the-problem-with-map-streams"><a class="header" href="#the-problem-with-map-streams">The Problem with Map Streams</a></h3>
<p>Transforming Map values whilst preserving keys requires ceremony:</p>
<pre><code class="language-java">Map&lt;String, Double&gt; prices = Map.of(
    "widget", 10.0,
    "gadget", 25.0,
    "gizmo", 15.0
);

// Traditional: Stream + collect
Map&lt;String, Double&gt; inflated = prices.entrySet().stream()
    .collect(Collectors.toMap(
        Map.Entry::getKey,
        e -&gt; e.getValue() * 1.1  // 10% price increase
    ));
</code></pre>
<p>This pattern doesn't compose and requires reconstructing the entire map.</p>
<h3 id="the-solution-formapvalues-traversal"><a class="header" href="#the-solution-formapvalues-traversal">The Solution: <code>forMapValues()</code> Traversal</a></h3>
<p>The <code>forMapValues()</code> method creates a traversal focusing on <strong>all values</strong> whilst preserving key structure.</p>
<pre><code class="language-java">// Create a Map values traversal
Traversal&lt;Map&lt;String, Double&gt;, Double&gt; priceTraversal = Traversals.forMapValues();

// Apply 10% increase to all values
Map&lt;String, Double&gt; inflated = Traversals.modify(priceTraversal, price -&gt; price * 1.1, prices);
// Result: {widget=11.0, gadget=27.5, gizmo=16.5}

// Extract all values
List&lt;Double&gt; allPrices = Traversals.getAll(priceTraversal, prices);
// Result: [10.0, 25.0, 15.0]

// Compose with filtered for conditional updates
Traversal&lt;Map&lt;String, Double&gt;, Double&gt; expensiveItems =
    priceTraversal.filtered(price -&gt; price &gt; 20.0);

Map&lt;String, Double&gt; discounted = Traversals.modify(
    expensiveItems,
    price -&gt; price * 0.9,  // 10% discount on expensive items only
    prices
);
// Result: {widget=10.0, gadget=22.5, gizmo=15.0}
</code></pre>
<h3 id="real-world-example-configuration-value-normalisation"><a class="header" href="#real-world-example-configuration-value-normalisation">Real-World Example: Configuration Value Normalisation</a></h3>
<pre><code class="language-java">@GenerateLenses
public record DatabaseConfig(
    Map&lt;String, String&gt; connectionProperties
) {}

public class ConfigNormaliser {

    // Trim all connection property values
    public static DatabaseConfig normaliseProperties(DatabaseConfig config) {
        Traversal&lt;Map&lt;String, String&gt;, String&gt; allPropertyValues =
            Traversals.forMapValues();

        Map&lt;String, String&gt; trimmed = Traversals.modify(
            allPropertyValues,
            String::trim,
            config.connectionProperties()
        );

        return new DatabaseConfig(trimmed);
    }

    // Redact sensitive values (password, token)
    public static DatabaseConfig redactSensitive(DatabaseConfig config) {
        // Use an indexed traversal to access both key and value during modification
        IndexedTraversal&lt;String, Map&lt;String, String&gt;, String&gt; allProperties =
            IndexedTraversals.forMap();

        Map&lt;String, String&gt; redacted = IndexedTraversals.imodify(
            allProperties,
            (key, value) -&gt; {
                if (key.toLowerCase().contains("password") || key.toLowerCase().contains("token")) {
                    return "***REDACTED***";
                }
                return value;
            },
            config.connectionProperties()
        );

        return new DatabaseConfig(redacted);
    }
}
</code></pre>
<h3 id="composing-map-traversals-with-nested-structures"><a class="header" href="#composing-map-traversals-with-nested-structures">Composing Map Traversals with Nested Structures</a></h3>
<pre><code class="language-java">@GenerateLenses
public record ServiceRegistry(
    Map&lt;String, ServerConfig&gt; services
) {}

// Transform all server ports across all services
Traversal&lt;ServiceRegistry, Integer&gt; allServicePorts =
    ServiceRegistryLenses.services().asTraversal()
        .andThen(Traversals.forMapValues())
        .andThen(ServerConfigLenses.port().asTraversal())
        .andThen(Traversals.forOptional());

ServiceRegistry updated = Traversals.modify(
    allServicePorts,
    port -&gt; port + 1000,  // Offset all ports
    registry
);
</code></pre>
<hr />
<h2 id="tuple-traversals-parallel-transformations-on-pairs"><a class="header" href="#tuple-traversals-parallel-transformations-on-pairs">Tuple Traversals: Parallel Transformations on Pairs</a></h2>
<h3 id="the-problem-with-manual-tuple-updates"><a class="header" href="#the-problem-with-manual-tuple-updates">The Problem with Manual Tuple Updates</a></h3>
<p>Applying the same operation to both elements of a tuple requires duplication:</p>
<pre><code class="language-java">Tuple2&lt;Integer, Integer&gt; range = new Tuple2&lt;&gt;(10, 20);

// Traditional: Manual, repetitive
Tuple2&lt;Integer, Integer&gt; doubled = new Tuple2&lt;&gt;(
    range._1() * 2,
    range._2() * 2
);
</code></pre>
<p>When tuples represent related data (coordinates, ranges, min/max pairs), we want to express "apply this transformation to both elements" declaratively.</p>
<h3 id="the-solution-tupletraversalsboth"><a class="header" href="#the-solution-tupletraversalsboth">The Solution: <code>TupleTraversals.both()</code></a></h3>
<p>The <code>both()</code> method creates a traversal that focuses on <strong>both elements</strong> when they share a type.</p>
<pre><code class="language-java">import org.higherkindedj.optics.util.TupleTraversals;
import org.higherkindedj.hkt.tuple.Tuple2;

// Create a tuple traversal (when both elements are same type)
Traversal&lt;Tuple2&lt;Integer, Integer&gt;, Integer&gt; bothInts = TupleTraversals.both();

// Double both elements
Tuple2&lt;Integer, Integer&gt; range = new Tuple2&lt;&gt;(10, 20);
Tuple2&lt;Integer, Integer&gt; doubled = Traversals.modify(bothInts, x -&gt; x * 2, range);
// Result: Tuple2(20, 40)

// Extract both elements
List&lt;Integer&gt; values = Traversals.getAll(bothInts, range);
// Result: [10, 20]

// Works with any shared type
Traversal&lt;Tuple2&lt;String, String&gt;, String&gt; bothStrings = TupleTraversals.both();
Tuple2&lt;String, String&gt; names = new Tuple2&lt;&gt;("alice", "bob");
Tuple2&lt;String, String&gt; capitalised = Traversals.modify(
    bothStrings,
    s -&gt; s.substring(0, 1).toUpperCase() + s.substring(1),
    names
);
// Result: Tuple2("Alice", "Bob")
</code></pre>
<h3 id="real-world-example-geographic-coordinate-transformations"><a class="header" href="#real-world-example-geographic-coordinate-transformations">Real-World Example: Geographic Coordinate Transformations</a></h3>
<pre><code class="language-java">@GenerateLenses
public record Location(
    String name,
    Tuple2&lt;Double, Double&gt; coordinates  // (latitude, longitude)
) {}

public class CoordinateTransforms {

    // Apply precision rounding to both lat/lon
    public static Location roundCoordinates(Location location, int decimals) {
        Traversal&lt;Tuple2&lt;Double, Double&gt;, Double&gt; bothCoords = TupleTraversals.both();

        double factor = Math.pow(10, decimals);
        Tuple2&lt;Double, Double&gt; rounded = Traversals.modify(
            bothCoords,
            coord -&gt; Math.round(coord * factor) / factor,
            location.coordinates()
        );

        return new Location(location.name(), rounded);
    }

    // Offset coordinates by a fixed delta
    public static Location offsetCoordinates(Location location, double delta) {
        Traversal&lt;Tuple2&lt;Double, Double&gt;, Double&gt; bothCoords = TupleTraversals.both();

        Tuple2&lt;Double, Double&gt; offset = Traversals.modify(
            bothCoords,
            coord -&gt; coord + delta,
            location.coordinates()
        );

        return new Location(location.name(), offset);
    }
}
</code></pre>
<h3 id="composing-with-nested-structures"><a class="header" href="#composing-with-nested-structures">Composing with Nested Structures</a></h3>
<pre><code class="language-java">@GenerateLenses
public record BoundingBox(
    Tuple2&lt;Integer, Integer&gt; topLeft,
    Tuple2&lt;Integer, Integer&gt; bottomRight
) {}

// Scale coordinates in the top-left corner
Traversal&lt;BoundingBox, Integer&gt; topLeftCoords =
    BoundingBoxLenses.topLeft().asTraversal()
        .andThen(TupleTraversals.both());

BoundingBox scaled = Traversals.modify(topLeftCoords, coord -&gt; coord * 2, box);

// To scale all coordinates, you would compose traversals for each field separately
// or create a custom traversal that focuses on all four coordinates
</code></pre>
<hr />
<h2 id="when-to-use-structure-traversals-vs-other-approaches"><a class="header" href="#when-to-use-structure-traversals-vs-other-approaches">When to Use Structure Traversals vs Other Approaches</a></h2>
<h3 id="use-structure-traversals-when"><a class="header" href="#use-structure-traversals-when">Use Structure Traversals When:</a></h3>
<ul>
<li><strong>Reusable transformations</strong> - Define once, compose with other optics</li>
<li><strong>Nested optionals</strong> - Avoiding <code>.map().map().map()</code> chains</li>
<li><strong>Bulk map updates</strong> - Transforming all values whilst preserving keys</li>
<li><strong>Parallel tuple operations</strong> - Same transformation to both elements</li>
<li><strong>Immutable updates</strong> - Structure preserved, only focused elements transformed</li>
</ul>
<pre><code class="language-java">// Perfect: Declarative, composable, reusable
Traversal&lt;ServiceConfig, Integer&gt; allTimeouts =
    ServiceConfigLenses.endpoints().asTraversal()
        .andThen(Traversals.forMapValues())
        .andThen(EndpointLenses.timeout().asTraversal())
        .andThen(Traversals.forOptional());

ServiceConfig increased = Traversals.modify(allTimeouts, t -&gt; t + 1000, config);
</code></pre>
<h3 id="use-direct-access-when"><a class="header" href="#use-direct-access-when">Use Direct Access When:</a></h3>
<ul>
<li><strong>Single Optional</strong> - Simple <code>map()</code> or <code>orElse()</code> is clearer</li>
<li><strong>Specific Map key</strong> - <code>map.get(key)</code> is more direct</li>
<li><strong>Type-specific logic</strong> - Different transformations per tuple element</li>
</ul>
<pre><code class="language-java">// Better with direct access: Single Optional
Optional&lt;Integer&gt; port = config.port().map(p -&gt; p + 1000);

// Better with get: Specific key
Double price = prices.getOrDefault("widget", 0.0) * 1.1;

// Better with manual: Different operations per element
Tuple2&lt;Integer, String&gt; result = new Tuple2&lt;&gt;(
    tuple._1() * 2,        // Double the integer
    tuple._2().toUpperCase()  // Uppercase the string
);
</code></pre>
<h3 id="use-stream-api-when"><a class="header" href="#use-stream-api-when">Use Stream API When:</a></h3>
<ul>
<li><strong>Complex filtering</strong> - Multiple conditions</li>
<li><strong>Aggregations</strong> - Collecting to new structures</li>
<li><strong>No structural preservation</strong> - Extracting or transforming to different shape</li>
</ul>
<pre><code class="language-java">// Better with streams: Complex filtering
List&lt;Integer&gt; values = map.values().stream()
    .filter(v -&gt; v &gt; 10)
    .filter(v -&gt; v &lt; 100)
    .collect(toList());
</code></pre>
<hr />
<h2 id="common-pitfalls"><a class="header" href="#common-pitfalls">Common Pitfalls</a></h2>
<h3 id="dont-do-this"><a class="header" href="#dont-do-this">Don't Do This:</a></h3>
<pre><code class="language-java">// Inefficient: Creating traversals in loops
for (Map.Entry&lt;String, Double&gt; entry : prices.entrySet()) {
    Traversal&lt;Map&lt;String, Double&gt;, Double&gt; values = Traversals.forMapValues();
    // Process each value... inefficient!
}

// Over-engineering: Using traversals for simple cases
Traversal&lt;Optional&lt;String&gt;, String&gt; opt = Traversals.forOptional();
String result = optional.map(s -&gt; s.toUpperCase()).orElse("default");
// Just use: optional.map(String::toUpperCase).orElse("default")

// Type confusion: Trying to use both() with different types
Tuple2&lt;Integer, String&gt; mixed = new Tuple2&lt;&gt;(42, "hello");
// TupleTraversals.both() won't work here; types must match!
</code></pre>
<h3 id="do-this-instead"><a class="header" href="#do-this-instead">Do This Instead:</a></h3>
<pre><code class="language-java">// Efficient: Create traversal once, apply to entire structure
Traversal&lt;Map&lt;String, Double&gt;, Double&gt; priceTraversal = Traversals.forMapValues();
Map&lt;String, Double&gt; updated = Traversals.modify(priceTraversal, p -&gt; p * 1.1, prices);

// Right tool: Use direct methods for simple cases
String result = optional.map(String::toUpperCase).orElse("default");

// Correct types: Use separate lenses for mixed tuples
Lens&lt;Tuple2&lt;Integer, String&gt;, Integer&gt; first = Tuple2Lenses._1();
Lens&lt;Tuple2&lt;Integer, String&gt;, String&gt; second = Tuple2Lenses._2();
Tuple2&lt;Integer, String&gt; updated = new Tuple2&lt;&gt;(
    first.get(mixed) * 2,
    second.get(mixed).toUpperCase()
);
</code></pre>
<hr />
<h2 id="performance-notes"><a class="header" href="#performance-notes">Performance Notes</a></h2>
<p>Structure traversals are optimised for immutability:</p>
<ul>
<li><strong>Single pass</strong>: No intermediate collections</li>
<li><strong>Structural sharing</strong>: Unchanged portions reuse original references</li>
<li><strong>No boxing overhead</strong>: Direct map operations without streams</li>
<li><strong>Lazy evaluation</strong>: Short-circuits on empty optionals</li>
</ul>
<p><strong>Best Practice</strong>: Store commonly-used structure traversals as constants:</p>
<pre><code class="language-java">public class ConfigOptics {
    // Reusable structure traversals
    public static final Traversal&lt;Optional&lt;String&gt;, String&gt; OPTIONAL_STRING =
        Traversals.forOptional();

    public static final Traversal&lt;Map&lt;String, Integer&gt;, Integer&gt; MAP_INT_VALUES =
        Traversals.forMapValues();

    public static final Traversal&lt;Tuple2&lt;Double, Double&gt;, Double&gt; COORDINATE_PAIR =
        TupleTraversals.both();

    // Domain-specific compositions
    public static final Traversal&lt;ServerConfig, Integer&gt; ALL_PORTS =
        ServerConfigLenses.endpoints().asTraversal()
            .andThen(MAP_INT_VALUES);
}
</code></pre>
<hr />
<h2 id="related-resources"><a class="header" href="#related-resources">Related Resources</a></h2>
<p><strong>Functional Java Libraries</strong>:</p>
<ul>
<li><a href="https://github.com/aol/cyclops">Cyclops</a> - Functional control structures</li>
<li><a href="https://github.com/functionaljava/functionaljava">Functional Java</a> - Classic FP utilities</li>
</ul>
<p><strong>Further Reading</strong>:</p>
<ul>
<li><em>Functional Programming in Java</em> by Venkat Subramaniam - Optional and immutable patterns</li>
<li><em>Modern Java in Action</em> by Raoul-Gabriel Urma - Functional data processing</li>
<li><a href="https://leanpub.com/optics-by-example">Optics By Example</a> - Comprehensive optics guide (Haskell)</li>
</ul>
<p><strong>Type Theory Background</strong>:</p>
<ul>
<li><strong>Affine Traversals</strong>: Focusing on 0 or 1 element (Optional)</li>
<li><strong>Bitraversable</strong>: Traversing structures with two type parameters (Tuple2, Either)</li>
<li><a href="https://arxiv.org/abs/1703.10857">Profunctor Optics: Modular Data Accessors</a> - Theoretical foundation</li>
</ul>
<hr />
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>Structure traversals extend the traversal pattern to common Java data types:</p>
<div class="table-wrapper"><table><thead><tr><th>Structure</th><th>Traversal</th><th>Key Benefit</th></tr></thead><tbody>
<tr><td><strong>Optional</strong></td><td><code>forOptional()</code></td><td>Null-safe composition without <code>.map()</code> chains</td></tr>
<tr><td><strong>Map Values</strong></td><td><code>forMapValues()</code></td><td>Bulk value transformation preserving keys</td></tr>
<tr><td><strong>Tuple2 Pairs</strong></td><td><code>both()</code></td><td>Parallel operations on homogeneous pairs</td></tr>
</tbody></table>
</div>
<p>These tools transform how you work with wrapped and paired values:</p>
<p><strong>Before</strong> (Imperative):</p>
<ul>
<li>Manual Optional chaining</li>
<li>Stream + collect for Maps</li>
<li>Repetitive tuple updates</li>
</ul>
<p><strong>After</strong> (Declarative):</p>
<ul>
<li>Composable Optional traversals</li>
<li>Direct map value transformations</li>
<li>Unified tuple operations</li>
</ul>
<p>By incorporating structure traversals into your optics toolkit, you gain the ability to express complex transformations declaratively, compose them seamlessly with other optics, and maintain type safety throughout, all whilst preserving the immutability and referential transparency that make functional programming powerful.</p>
<hr />
<p><strong>Previous:</strong> <a href="string_traversals.html">String Traversals: Declarative Text Processing</a>
<strong>Next:</strong> <a href="indexed_optics.html">Indexed Optics: Position-Aware Operations</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../optics/setters.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../optics/limiting_traversals.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../optics/setters.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../optics/limiting_traversals.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../version-switcher.js"></script>
        <script src=".././theme/version-switcher.js"></script>
        <script src=".././theme/sidebar-nav-link.js"></script>


    </div>
    </body>
</html>
