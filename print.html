<!DOCTYPE HTML>
<html lang="en" class="latte sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Higher-Kinded Types and Optics for Java</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->


            <meta name="description" content="Explore Higher-Kinded Types (HKTs) and Optcs in Java with the Higher-Kinded-J library. Learn about Functors, Applicatives, Monads, Transformers, practical functional patterns, and how to write cleaner, more composable Java code for your projects using Optics.">


        <meta name="keywords" content="Higher-Kinded Types, Higher-Kinded-J, Higher-Kinded Java, Higher Kinded Java, HKT, Java, Optics, Lens, Prism, Traversal, Iso, Functional Programming, Monad, Functor, Applicative, Transformer, Monoid, Traverse, higherkindedj">
        
        <meta property="og:title" content="Higher-Kinded Types and Optics for Java"> 
            <meta property="og:description" content="Explore Higher-Kinded Types (HKTs) and Optcs in Java with the Higher-Kinded-J library. Learn about Functors, Applicatives, Monads, Transformers, practical functional patterns, and how to write cleaner, more composable Java code for your projects using Optics.">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://higher-kinded-j.github.io/"> 
        
        <meta property="og:image" content="https://higher-kinded-j.github.io/preview.png" />
        <meta property="og:site_name" content="Higher-Kinded-J Documentation" />
        
        
        <meta name="twitter:card" content="summary_large_image" /> <meta name="twitter:title" content="Higher-Kinded Types and Optics for Java - Higher-Kinded-J" />
        <meta name="twitter:description" content="Bringing Higher-Kinded Types and Optics to Java functional patterns" />
        <meta name="twitter:image" content="https://higher-kinded-j.github.io/preview.png" />
        <meta name="description" content="Explore Higher-Kinded Types (HKTs) and Optcs in Java with the Higher-Kinded-J library. Learn about Functors, Applicatives, Monads, Transformers, practical functional patterns, and how to write cleaner, more composable Java code for your projects using Optics.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">
        <meta name="google-site-verification" content="X-xsiAq2cKMLOzh9dexUrX8Onx2h_YMUFgp5lHHUwSg" />
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="./mdbook-admonish.css">
        <link rel="stylesheet" href="./theme/catppuccin.css">
        <link rel="stylesheet" href="./theme/catppuccin-admonish.css">
        <link rel="stylesheet" href="./theme/catppuccin-alerts.css">
        <link rel="stylesheet" href="./theme/additional-hkj.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "latte";
            const default_dark_theme = "macchiato";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('latte')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="latte">Latte</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="frappe">Frapp√©</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="macchiato">Macchiato</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mocha">Mocha</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Higher-Kinded Types and Optics for Java</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/higher-kinded-j/higher-kinded-j" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<pre><code> _   _ _       _                      _   ___           _          _        ___ 
| | | (_)     | |                    | | / (_)         | |        | |      |_  |
| |_| |_  __ _| |__   ___ _ __ ______| |/ / _ _ __   __| | ___  __| |______  | |
|  _  | |/ _` | '_ \ / _ \ '__|______|    \| | '_ \ / _` |/ _ \/ _` |______| | |
| | | | | (_| | | | |  __/ |         | |\  \ | | | | (_| |  __/ (_| |    /\__/ /
\_| |_/_|\__, |_| |_|\___|_|         \_| \_/_|_| |_|\__,_|\___|\__,_|    \____/ 
          __/ |                                                           
         |___/                                                            
</code></pre>
<h2 id="bringing-higher-kinded-types-and-optics-to-java-functional-patterns"><a class="header" href="#bringing-higher-kinded-types-and-optics-to-java-functional-patterns"><a href="https://github.com/higher-kinded-j/higher-kinded-j"><em>Bringing Higher-Kinded Types and Optics to Java functional patterns</em></a></a></h2>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j"><img src="https://img.shields.io/badge/code-blue?logo=github" alt="Static Badge" />
</a>
<a href="https://codecov.io/gh/higher-kinded-j/higher-kinded-j"><img src="https://img.shields.io/codecov/c/github/higher-kinded-j/higher-kinded-j?token=VR0K0ZEDHD" alt="Codecov" /></a> <a href="https://central.sonatype.com/artifact/io.github.higher-kinded-j/hkj-core"><img src="https://img.shields.io/maven-central/v/io.github.higher-kinded-j/hkj-core" alt="Maven Central Version" /></a> <a href="https://github.com/higher-kinded-j/higher-kinded-j/discussions"><img src="https://img.shields.io/github/discussions/higher-kinded-j/higher-kinded-j" alt="GitHub Discussions" /></a> <a href="https://techhub.social/@ultramagnetic"><img src="https://img.shields.io/mastodon/follow/109367467120571209?domain=techhub.social&amp;style=plastic&amp;logoSize=auto" alt="Mastodon Follow" /></a></p>
<p>Higher-Kinded-J brings two powerful functional programming toolsets to Java, enabling developers to write more abstract, composable, and robust code:</p>
<ol>
<li>A <strong>Higher-Kinded Types (HKT) Simulation</strong> to abstract over computational contexts like <code>Optional</code>, <code>List</code>, or <code>CompletableFuture</code>.</li>
<li>A powerful <strong>Optics Library</strong> to abstract over immutable data structures, with boilerplate-free code generation.</li>
</ol>
<p>These work together to solve common Java pain points in a functional, type-safe way.</p>
<h2 id="two-pillars-of-functional-programming"><a class="header" href="#two-pillars-of-functional-programming"><em>Two Pillars of Functional Programming</em></a></h2>
<h2 id="1-higher-kinded-types-simulation-"><a class="header" href="#1-higher-kinded-types-simulation-">1: <a href="hkts/hkt_introduction.html">Higher-Kinded Types</a> Simulation ‚öôÔ∏è</a></h2>
<p>Java's type system lacks native support for Higher-Kinded Types, making it difficult to write code that abstracts over "container" types. We can't easily define a generic function that works identically for <code>List&lt;A&gt;</code>, <code>Optional&lt;A&gt;</code>, and <code>CompletableFuture&lt;A&gt;</code>.</p>
<p>Higher-Kinded-J <strong>simulates HKTs in Java</strong> using a technique inspired by defunctionalisation. This unlocks the ability to use common functional abstractions like <code>Functor</code>, <code>Applicative</code>, and <code>Monad</code> generically across different data types.</p>
<p><strong>With HKTs, you can:</strong></p>
<ul>
<li><strong>Abstract Over Context:</strong> Write logic that works polymorphically over different computational contexts (optionality, asynchrony, error handling, collections).</li>
<li><strong>Leverage Typeclasses:</strong> Consistently apply powerful patterns like <code>map</code>, <code>flatMap</code>, <code>sequence</code>, and <code>traverse</code> across diverse data types.</li>
<li><strong>Build Adaptable Pipelines:</strong> Use profunctors to create flexible data transformation pipelines that adapt to different input and output formats.</li>
<li><strong>Manage Effects:</strong> Use provided monads like <code>IO</code>, <code>Either</code>, <code>Validated</code>, and <code>State</code> to build robust, composable workflows.</li>
</ul>
<h2 id="2-a-powerful-optics-library-"><a class="header" href="#2-a-powerful-optics-library-">2: A Powerful <a href="optics/optics_intro.html">Optics</a> Library üîé</a></h2>
<p>Working with immutable data structures, like Java records, is great for safety but leads to verbose "copy-and-update" logic for nested data.</p>
<p>Higher-Kinded-J provides a full-featured <strong>Optics library</strong> that treats data access as a first-class value. An optic is a <strong>composable, functional getter/setter</strong> that lets you "zoom in" on a piece of data within a larger structure.</p>
<p><strong>With Optics, you can:</strong></p>
<ul>
<li><strong>Eliminate Boilerplate:</strong> An annotation processor <strong>generates</strong><code>Lens</code>, <code>Prism</code>, and <code>Traversal</code> optics for your records and sealed interfaces automatically.</li>
<li><strong>Perform Deep Updates Effortlessly:</strong> Compose optics to create a path deep into a nested structure and perform immutable updates in a single, readable line.</li>
<li><strong>Decouple Data and Operations:</strong> Model your data cleanly as immutable records, while defining complex, reusable operations separately as optics.</li>
<li><strong>Perform Effectful Updates:</strong> The Optics library is built on top of the HKT simulation, allowing you to perform failable, asynchronous, or stateful updates using the powerful <code>modifyF</code> method.</li>
<li><strong>Adapt to Different Data Types:</strong> Every optic is a profunctor, meaning it can be adapted to work with different source and target types using <code>contramap</code>, <code>map</code>, and <code>dimap</code> operations. This provides incredible flexibility for API integration, legacy system support, and data format transformations.</li>
</ul>
<h2 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h2>
<div class="mdbook-alerts mdbook-alerts-note">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  note
</p>
<p>Before diving in, ensure you have the following:
<strong>Java Development Kit (JDK): Version 24</strong> or later. The library makes use of features available in this version.</p>
</div>
<p>The project is modular. To use it, add the relevant dependencies to your <code>build.gradle</code> or <code>pom.xml</code>. The use of an annotation processor helps to automatically generate the required boilerplate for Optics and other patterns.</p>
<p><strong>For HKTs:</strong></p>
<pre><code class="language-gradle">    // build.gradle.kts
    implementation("io.github.higher-kinded-j:hkj-core:LATEST_VERSION")
</code></pre>
<p><strong>For Optics:</strong></p>
<pre><code class="language-gradle">    // build.gradle.kts
    implementation("io.github.higher-kinded-j:hkj-core:LATEST_VERSION")
    annotationProcessor("io.github.higher-kinded-j:hkj-processor:LATEST_VERSION")
    annotationProcessor("io.github.higher-kinded-j:hkj-processor-plugins:LATEST_VERSION")
</code></pre>
<p><strong>For SNAPSHOTS:</strong></p>
<pre><code class="language-gradle">repositories {
    mavenCentral()
    maven {
        url= uri("https://central.sonatype.com/repository/maven-snapshots/")
    }
}
</code></pre>
<h2 id="documentation"><a class="header" href="#documentation">Documentation</a></h2>
<p>We recommend following the documentation to get a full understanding of the library's capabilities.</p>
<h4 id="hkt-core-concepts"><a class="header" href="#hkt-core-concepts">HKT Core Concepts</a></h4>
<p>For users who want to understand the underlying HKT simulation that powers the optics library or use monads directly.</p>
<ol>
<li><strong><a href="hkts/hkt_introduction.html">An Introduction to HKTs</a>:</strong> Learn what HKTs are and the problems they solve.</li>
<li><strong><a href="hkts/core-concepts.html">Core Concepts</a>:</strong> Understand <code>Kind</code>, Witness Types, and Type Classes (<code>Functor</code>, <code>Monad</code>).</li>
<li><strong><a href="monads/supported-types.html">Supported Types</a>:</strong> See which types are simulated and have typeclass instances.</li>
<li><strong><a href="hkts/usage-guide.html">Usage Guide</a>:</strong> Learn the practical steps for using the HKT simulation directly.</li>
<li><strong><a href="hkts/hkt_basic_examples.html">Examples of how to use HKTs</a></strong>: Practical Examples of how to use the Monads.</li>
<li><strong><a href="hkts/order-walkthrough.html">Order Example Walkthrough</a>:</strong> A detailed example of building a robust workflow with monad transformers.</li>
<li><strong><a href="hkts/extending-simulation.html">Extending Higher-Kinded-J</a>:</strong> Learn how to add HKT support for your own custom types.</li>
</ol>
<h4 id="optics-guides"><a class="header" href="#optics-guides">Optics Guides</a></h4>
<p>This series provides a practical, step-by-step introduction to solving real-world problems with optics.</p>
<ol>
<li><strong><a href="optics/optics_intro.html">An Introduction to Optics</a>:</strong> Learn what optics are and the problems they solve.</li>
<li><strong><a href="optics/lenses.html">Practical Guide: Lenses</a>:</strong> A deep dive into using <code>Lens</code> for nested immutable updates.</li>
<li><strong><a href="optics/prisms.html">Practical Guide: Prisms</a>:</strong> Learn how to use <code>Prism</code> to safely work with <code>sealed interface</code> (sum types).</li>
<li><strong><a href="optics/iso.html">Practical Guide: Isos</a>:</strong> Understand how <code>Iso</code> provides a bridge between equivalent data types.</li>
<li><strong><a href="optics/traversals.html">Practical Guide: Traversals</a>:</strong> Master the <code>Traversal</code> for performing bulk updates on collections.</li>
<li><strong><a href="optics/profunctor_optics.html">Profunctor Optics</a>:</strong> Discover how to adapt optics to work with different data types and structures.</li>
<li><strong><a href="optics/composing_optics.html">Capstone Example: Deep Validation</a>:</strong> A complete example that composes multiple optics to solve a complex problem.</li>
</ol>
<h4 id="history"><a class="header" href="#history">History</a></h4>
<p><strong>Higher-Kinded-J evolved from a simulation</strong> that was originally created for the blog post <a href="https://blog.scottlogic.com/2025/04/11/higher-kinded-types-with-java-and-scala.html">Higher Kinded Types with Java and Scala</a> that explored Higher-Kinded types and their lack of support in Java. The blog post discussed a process called defuctionalisation that could be used to simulate Higher-Kinded types in Java. Since then Higher-Kinded-J has grown into something altogether more useful supporting more functional patterns.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="introduction-to-higher-kinded-types"><a class="header" href="#introduction-to-higher-kinded-types">Introduction to Higher-Kinded Types</a></h1>
<p><img src="hkts/../images/rubiks1932.jpg" alt="rubiks1932.jpg" /></p>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="hkts/hkt_introduction.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>The analogy between higher-order functions and higher-kinded types</li>
<li>Why Java's type system limitations necessitate HKT simulation</li>
<li>How abstractions over "container" types enable more reusable code</li>
<li>The difference between first-order types, generic types, and higher-kinded types</li>
<li>Real-world benefits: less boilerplate, more abstraction, better composition</li>
</ul>
</div>
</div>
<p>We can think about Higher-Kinded Types (HKT) by making an analogy with Higher-Order Functions (HOF).</p>
<p><em>higher-kinded types are to types what higher-order functions are to functions.</em></p>
<p>They both represent a powerful form of abstraction, just at different levels.</p>
<h3 id="the-meaning-of-regular-and-higher-order"><a class="header" href="#the-meaning-of-regular-and-higher-order">The Meaning of "Regular" and "Higher-Order"</a></h3>
<p><strong>Functions</strong> model Behaviour</p>
<ul>
<li><strong>First-Order (Regular) Function:</strong> This kind of function operates on simple values. It takes a value(s) like a <code>int</code> and returns a value.</li>
</ul>
<pre><code class="language-java">// Take a value and return a value
int square(int num) {
    return num * num;
}    
</code></pre>
<ul>
<li><strong>Higher-Order Function:</strong> This kind of function operates on <em>other functions</em>.  It can take functions as arguments and or return a new function as the result.  It abstracts over the <strong>behaviour</strong>.</li>
</ul>
<pre><code class="language-java">// Takes a Set of type A and a function fn that maps types of A to B,
//  returns a new Set of type B
&lt;A, B&gt; Set&lt;B&gt; mapper(Set&lt;A&gt; list, Function&lt;A, B&gt; fn) {
    // ... applies fn to each element of the set
}
</code></pre>
<p><code>mapper</code> is a higher-order function because it takes the function <code>fn</code> as an argument.</p>
<p><strong>Types</strong> model Structure</p>
<ul>
<li><strong>First-Order (Regular) Type:</strong> A simple, concrete type like <code>int</code>, or <code>Set&lt;Double&gt;</code> represents a specific kind of data.</li>
<li><strong>Higher-Kinded Type (HKT):</strong> This is a "type that operates on types." More accurately, it's a generic type constructor that can itself be treated as a type parameter. It abstracts over structure or computational context.</li>
</ul>
<p>Let us consider <code>Set&lt;T&gt;</code>. <code>Set</code> itself without the <code>T</code>, is a type constructor.  Think of it as a "function" for types: Supply it a type (like <code>Integer</code>), and it produces a new concrete type <code>Set&lt;Integer&gt;</code>.</p>
<p>A higher-kinded type allows us to write code that is generic over <code>Set</code>itself, or <code>List</code> or <code>CompletableFuture</code>.</p>
<h3 id="generic-code-in-practice"><a class="header" href="#generic-code-in-practice">Generic code in Practice</a></h3>
<p><strong>Functions</strong></p>
<p><em>Without Higher-Order Functions:</em></p>
<p>To apply different operations to a list, we would need to write separate loops for each one.</p>
<pre><code class="language-java">List&lt;String&gt; results = new ArrayList&lt;&gt;();
for (int i : numbers) {
    results.add(intToString(i)); // Behavior is hardcoded
}
</code></pre>
<p><em>With Higher-Order Functions:</em></p>
<p>We abstract the behaviour into a function and pass it in. This is much more flexible.</p>
<pre><code class="language-java">
// A map for List
&lt;A, B&gt; List&lt;B&gt; mapList(List&lt;A&gt; list, Function&lt;A, B&gt; f);

// A map for Optional
&lt;A, B&gt; Optional&lt;B&gt; mapOptional(Optional&lt;A&gt; opt, Function&lt;A, B&gt; f);

// A map for CompletableFuture
&lt;A, B&gt; CompletableFuture&lt;B&gt; mapFuture(CompletableFuture&lt;A&gt; future, Function&lt;A, B&gt; f);

</code></pre>
<p>Notice the repeated pattern. The core logic is the same, but the "container" is different.</p>
<p><em>With Higher-Kinded Types:</em></p>
<p>With Higher-Kinded-J we can abstract over the container <code>F</code> itself. This allows us to write one single, generic map function that works for any container structure or computational context that can be mapped over (i.e., any <code>Functor</code>). This is precisely what the <code>GenericExample.java</code> demonstrates.</p>
<pre><code class="language-java">// F is a "type variable" that stands for List, Optional, etc.
// This is a function generic over the container F.
public static &lt;F, A, B&gt; Kind&lt;F, B&gt; map(
    Functor&lt;F&gt; functorInstance, // The implementation for F
    Kind&lt;F, A&gt; kindBox,         // The container with a value
    Function&lt;A, B&gt; f) {         // The behaviour to apply
    return functorInstance.map(f, kindBox);
}

</code></pre>
<p>Here, <code>Kind&lt;F, A&gt;</code> is the higher-kinded type that represents "some container F holding a value of type A."</p>
<p>Both concepts allow you to write more generic and reusable code by parametrising things that are normally fixed. <strong>Higher-order functions parametrise behaviour, while higher-kinded types parametrise the structure that contains the behaviour.</strong></p>
<p>We will discuss the <code>GenericExample.java</code> in detail later, but you can take a peek at the code here</p>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/GenericExample.java">GenericExample.java</a></li>
</ul>
<h2 id="the-core-idea-abstraction-over-containers"><a class="header" href="#the-core-idea-abstraction-over-containers">The Core Idea: Abstraction over Containers</a></h2>
<p>In short: a higher-kinded type is a way to be generic over the container type itself.
Think about the different "container" types you use every day in Java: <code>List&lt;T&gt;</code>, <code>Optional&lt;T&gt;</code>, <code>Future&lt;T&gt;</code>, <code>Set&lt;T&gt;</code>. All of these are generic containers that hold a value of type <code>T</code>.
The problem is, you can't write a single method in Java that accepts any of these containers and performs an action, because <code>List</code>, <code>Optional</code>, and <code>Future</code> don't share a useful common interface. A higher-kinded type solves this by letting you write code that works with <code>F&lt;T&gt;</code>, where <code>F</code> itself is a variable representing the container type (<code>List</code>, <code>Optional</code>, etc.).</p>
<h2 id="building-up-from-java-generics"><a class="header" href="#building-up-from-java-generics">Building Up from Java Generics</a></h2>
<h3 id="level-1-concrete-types-like-values"><a class="header" href="#level-1-concrete-types-like-values">Level 1: Concrete Types (like values)</a></h3>
<p>A normal, complete type is like a value. It's a "thing".</p>
<pre><code class="language-java">String myString;          // A concrete type
List&lt;Integer&gt; myIntList;  // Also a concrete type (a List of Integers)
</code></pre>
<h3 id="level-2-generic-types-like-functions"><a class="header" href="#level-2-generic-types-like-functions">Level 2: Generic Types (like functions)</a></h3>
<p>A generic type definition like <code>List&lt;T&gt;</code> is not a complete type. It's a type constructor. It's like a function at the type level: you give it a type (e.g., <code>String</code>), and it produces a concrete type (<code>List&lt;String&gt;</code>).</p>
<pre><code class="language-java">// List&lt;T&gt; is a "type function" that takes one parameter, T.
// We can call it a type of kind: * -&gt; *
// (It takes one concrete type to produce one concrete type)
</code></pre>
<p>You can't declare a variable of type <code>List</code>. You must provide the type parameter <code>T</code>.</p>
<h3 id="level-3-higher-kinded-types-like-functions-that-take-other-functions"><a class="header" href="#level-3-higher-kinded-types-like-functions-that-take-other-functions">Level 3: Higher-Kinded Types (like functions that take other functions)</a></h3>
<p>This is the part Java doesn't support directly. A higher-kinded type is a construct that is generic over the type constructor itself.
Imagine you want to write a single map function that works on any container. You want to write code that says: <em>"Given any container F holding type A, and a function to turn an A into a B, I will give you back a container F holding type B."</em>
In imaginary Java syntax, it would look like this:</p>
<pre><code class="language-java">// THIS IS NOT REAL JAVA SYNTAX
public &lt;F&lt;?&gt;, A, B&gt; F&lt;B&gt; map(F&lt;A&gt; container, Function&lt;A, B&gt; func);
</code></pre>
<p>Here, <code>F </code>is the higher-kinded type parameter. It's a variable that can stand for <code>List</code>, <code>Optional</code>, <code>Future</code>, or any other <code>* -&gt; *</code> type constructor.</p>
<h2 id="a-practical-analogy-the-shipping-company"><a class="header" href="#a-practical-analogy-the-shipping-company">A Practical Analogy: The Shipping Company</a></h2>
<p><img src="hkts/../images/containers.png" alt="containers.png" /></p>
<p>Think of it like working at a shipping company.
A concrete type <code>List&lt;String&gt;</code> is a "Cardboard Box full of Apples".
A generic type <code>List&lt;T&gt;</code> is a blueprint for a "Cardboard Box" that can hold anything (<code>T</code>).
Now, you want to write a single set of instructions (a function) for your robotic arm called addInsuranceLabel. You want these instructions to work on any kind of container.
Without HKTs (The Java Way): You have to write separate instructions for each container type.</p>
<pre><code class="language-java">addInsuranceToCardboardBox(CardboardBox&lt;T&gt; box, ...)
addInsuranceToPlasticCrate(PlasticCrate&lt;T&gt; crate, ...)
addInsuranceToMetalCase(MetalCase&lt;T&gt; case, ...)
</code></pre>
<p>With HKTs (The Abstract Way): You write one generic set of instructions.</p>
<pre><code class="language-java">addInsuranceToContainer(Container&lt;T&gt; container, ...)
</code></pre>
<p>A higher-kinded type is the concept of being able to write code that refers to <code>Container&lt;T&gt;</code> ‚Äî an abstraction over the container or "context" that holds the data.</p>
<p>Higher-Kinded-J <strong>simulates HKTs in Java</strong> using a technique inspired by defunctionalisation. It allows you to define and use common functional abstractions like <code>Functor</code>, <code>Applicative</code>, and <code>Monad</code> (including <code>MonadError</code>) in a way that works <em>generically</em> across different simulated type constructors.</p>
<p><strong>Why bother?</strong> Higher-Kinded-J unlocks several benefits:</p>
<ul>
<li><strong>Write Abstract Code:</strong> Define functions and logic that operate polymorphically over different computational contexts (e.g., handle optionality, asynchronous operations, error handling, side effects, or collections using the <em>same</em> core logic).</li>
<li><strong>Leverage Functional Patterns:</strong> Consistently apply powerful patterns like <code>map</code>, <code>flatMap</code>, <code>ap</code>, <code>sequence</code>, <code>traverse</code>, and monadic error handling (<code>raiseError</code>, <code>handleErrorWith</code>) across diverse data types.</li>
<li><strong>Build Composable Systems:</strong> Create complex workflows and abstractions by composing smaller, generic pieces, as demonstrated in the included <a href="hkts/order-walkthrough.html">Order Processing Example</a>.</li>
<li><strong>Understand HKT Concepts:</strong> Provides a practical, hands-on way to understand HKTs and type classes even within Java's limitations.</li>
<li><strong>Lay the Foundations:</strong> Building on HKTs opens the possibilities for Optics</li>
</ul>
<p>While Higher-Kinded-J introduces some boilerplate compared to languages with native HKT support, it offers a valuable way to explore these powerful functional programming concepts in Java.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="core-concepts-of-higher-kinded-j"><a class="header" href="#core-concepts-of-higher-kinded-j">Core Concepts of Higher-Kinded-J</a></h1>
<p><img src="hkts/../images/concepts.png" alt="concepts.png" /></p>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="hkts/core-concepts.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How the Kind&lt;F, A&gt; interface simulates higher-kinded types in Java</li>
<li>The role of witness types in representing type constructors</li>
<li>Understanding defunctionalisation and how it enables HKT simulation</li>
<li>The difference between internal library types and external Java types</li>
<li>How type classes provide generic operations across different container types</li>
</ul>
</div>
</div>
<p>Higher-Kinded-J employs several key components to emulate Higher-Kinded Types (HKTs) and associated functional type classes in Java. Understanding these is crucial for using and extending the library.</p>
<p><a href="hkts/hkt_basic_examples.html">Feel free to skip ahead to the examples and come back later for the theory</a></p>
<h2 id="1-the-hkt-problem-in-java"><a class="header" href="#1-the-hkt-problem-in-java">1. The HKT Problem in Java</a></h2>
<p>As we have already discussed, Java's type system lacks native Higher-Kinded Types. We can easily parametrise a type by another type (like <code>List&lt;String&gt;</code>), but we cannot easily parametrise a type or method by a <em>type constructor</em> itself (like <code>F&lt;_&gt;</code>). We can't write <code>void process&lt;F&lt;_&gt;&gt;(F&lt;Integer&gt; data)</code> to mean "process any container F of Integers".</p>
<div id="admonition-warning" class="admonition admonish-warning" role="note" aria-labelledby="admonition-warning-title">
<div class="admonition-title">
<div id="admonition-warning-title">
<p>Warning</p>
</div>
<a class="admonition-anchor-link" href="hkts/core-concepts.html#admonition-warning"></a>
</div>
<div>
<p>You will often see Higher-Kinded Types represented with an underscore, like <code>F&lt;_&gt;</code> (e.g., <code>List&lt;_&gt;</code>, <code>Optional&lt;_&gt;</code>). This notation, borrowed from languages like Scala, represents a "type constructor"‚Äîa type that is waiting for a type parameter. It's important to note that this underscore is a conceptual placeholder and is not the same as Java's <code>?</code> wildcard, which is used for instantiated types. Our library provides a way to simulate this <code>F&lt;_&gt;</code> concept in Java.</p>
</div>
</div>
<h2 id="2-the-kindf-a-bridge"><a class="header" href="#2-the-kindf-a-bridge">2. The <code>Kind&lt;F, A&gt;</code> Bridge</a></h2>
<p>At the very centre of the library are the <code>Kind</code> interfaces, which make higher-kinded types possible in Java.</p>
<ul>
<li>
<p><strong><code>Kind&lt;F, A&gt;</code></strong>: This is the foundational interface that emulates a higher-kinded type. It represents a type <code>F</code> that is generic over a type <code>A</code>. For example, <code>Kind&lt;ListKind.Witness, String&gt;</code> represents a <code>List&lt;String&gt;</code>. You will see this interface used everywhere as the common currency for all our functional abstractions.</p>
</li>
<li>
<p><strong><code>Kind2&lt;F, A, B&gt;</code></strong>: This interface extends the concept to types that take two type parameters, such as <code>Function&lt;A, B&gt;</code> or <code>Either&lt;L, R&gt;</code>. For example, <code>Kind2&lt;FunctionKind.Witness, String, Integer&gt;</code> represents a <code>Function&lt;String, Integer&gt;</code>. This is essential for working with profunctors and other dual-parameter abstractions.</p>
</li>
</ul>
<p><img src="hkts/../images/puml/defunctionalisation_internal.svg" alt="defunctionalisation_internal.svg" /></p>
<ul>
<li><strong>Purpose:</strong> To simulate the application of a type constructor <code>F</code> (like <code>List</code>, <code>Optional</code>, <code>IO</code>) to a type argument <code>A</code> (like <code>String</code>, <code>Integer</code>), representing the concept of <code>F&lt;A&gt;</code>.</li>
<li><strong><code>F</code> (Witness Type):</strong> This is the crucial part of the simulation. Since <code>F&lt;_&gt;</code> isn't a real Java type parameter, we use a <em>marker type</em> (often an empty interface specific to the constructor) as a "witness" or stand-in for <code>F</code>. Examples:
<ul>
<li><code>ListKind&lt;ListKind.Witness&gt;</code> represents the <code>List</code> type constructor.</li>
<li><code>OptionalKind&lt;OptionalKind.Witness&gt;</code> represents the <code>Optional</code> type constructor.</li>
<li><code>EitherKind.Witness&lt;L&gt;</code> represents the <code>Either&lt;L, _&gt;</code> type constructor (where <code>L</code> is fixed).</li>
<li><code>IOKind&lt;IOKind.Witness&gt;</code> represents the <code>IO</code> type constructor.</li>
</ul>
</li>
<li><strong><code>A</code> (Type Argument):</strong> The concrete type contained within or parametrised by the constructor (e.g., <code>Integer</code> in <code>List&lt;Integer&gt;</code>).</li>
<li><strong>How it Works:</strong> The library provides a seamless bridge between a standard java type, like a <code>java.util.List&lt;Integer&gt;</code>and its <code>Kind</code> representation <code>Kind&lt;ListKind.Witness, Integer&gt;</code>. Instead of requiring you to manually wrap objects, this conversion is handled by static helper methods, typically <code>widen</code> and <code>narrow</code>.
<ul>
<li>To treat a <code>List&lt;Integer&gt;</code> as a <code>Kind</code>, you use a helper function like <code>LIST.widen()</code>.</li>
<li>This <code>Kind</code> object can then be passed to generic functions (such as <code>map</code> or <code>flatMap</code> from a <code>Functor</code> or <code>Monad</code> instance) that expect <code>Kind&lt;F, A&gt;</code>.</li>
</ul>
</li>
<li><strong>Reference:</strong> <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-api/src/main/java/org/higherkindedj/hkt/Kind.java"><code>Kind.java</code></a></li>
</ul>
<h2 id="3-type-classes-functor-applicative-monad-monaderror"><a class="header" href="#3-type-classes-functor-applicative-monad-monaderror">3. Type Classes (<code>Functor</code>, <code>Applicative</code>, <code>Monad</code>, <code>MonadError</code>)</a></h2>
<p>These are interfaces that define standard functional operations that work <em>generically</em> over any simulated type constructor <code>F</code> (represented by its witness type) for which an instance of the type class exists. They operate on <code>Kind&lt;F, A&gt;</code> objects.</p>
<p><img src="hkts/../images/puml/core_typeclasses_high_level.svg" alt="core_typeclasses_high_level.svg" /></p>
<ul>
<li><strong><code>Functor&lt;F&gt;</code>:</strong>
<ul>
<li>Defines <code>map(Function&lt;A, B&gt; f, Kind&lt;F, A&gt; fa)</code>: Applies a function <code>f: A -&gt; B</code> to the value(s) inside the context <code>F</code> without changing the context's structure, resulting in a <code>Kind&lt;F, B&gt;</code>. Think <code>List.map</code>, <code>Optional.map</code>.</li>
<li>Laws: Identity (<code>map(id) == id</code>), Composition (<code>map(g.compose(f)) == map(g).compose(map(f))</code>).</li>
<li>Reference: <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-api/src/main/java/org/higherkindedj/hkt/Functor.java"><code>Functor.java</code></a></li>
</ul>
</li>
<li><strong><code>Applicative&lt;F&gt;</code>:</strong>
<ul>
<li>Extends <code>Functor&lt;F&gt;</code>.</li>
<li>Adds <code>of(A value)</code>: Lifts a pure value <code>A</code> into the context <code>F</code>, creating a <code>Kind&lt;F, A&gt;</code>. (e.g., <code>1</code> becomes <code>Optional.of(1)</code> wrapped in <code>Kind</code>).</li>
<li>Adds <code>ap(Kind&lt;F, Function&lt;A, B&gt;&gt; ff, Kind&lt;F, A&gt; fa)</code>: Applies a function wrapped in context <code>F</code> to a value wrapped in context <code>F</code>, returning a <code>Kind&lt;F, B&gt;</code>. This enables combining multiple independent values within the context.</li>
<li>Provides default <code>mapN</code> methods (e.g., <code>map2</code>, <code>map3</code>) built upon <code>ap</code> and <code>map</code>.</li>
<li>Laws: Identity, Homomorphism, Interchange, Composition.</li>
<li>Reference: <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-api/src/main/java/org/higherkindedj/hkt/Applicative.java"><code>Applicative.java</code></a></li>
</ul>
</li>
<li><strong><code>Monad&lt;F&gt;</code>:</strong>
<ul>
<li>Extends <code>Applicative&lt;F&gt;</code>.</li>
<li>Adds <code>flatMap(Function&lt;A, Kind&lt;F, B&gt;&gt; f, Kind&lt;F, A&gt; ma)</code>: Sequences operations within the context <code>F</code>. Takes a value <code>A</code> from context <code>F</code>, applies a function <code>f</code> that returns a <em>new context</em> <code>Kind&lt;F, B&gt;</code>, and returns the result flattened into a single <code>Kind&lt;F, B&gt;</code>. Essential for chaining dependent computations (e.g., chaining <code>Optional</code> calls, sequencing <code>CompletableFuture</code>s, combining <code>IO</code> actions). Also known in functional languages as <code>bind</code> or <code>&gt;&gt;=</code>.</li>
<li>Laws: Left Identity, Right Identity, Associativity.</li>
<li>Reference: <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-api/src/main/java/org/higherkindedj/hkt/Monad.java"><code>Monad.java</code></a></li>
</ul>
</li>
<li><strong><code>MonadError&lt;F, E&gt;</code>:</strong>
<ul>
<li>Extends <code>Monad&lt;F&gt;</code>.</li>
<li>Adds error handling capabilities for contexts <code>F</code> that have a defined error type <code>E</code>.</li>
<li>Adds <code>raiseError(E error)</code>: Lifts an error <code>E</code> into the context <code>F</code>, creating a <code>Kind&lt;F, A&gt;</code> representing the error state (e.g., <code>Either.Left</code>, <code>Try.Failure</code> or failed <code>CompletableFuture</code>).</li>
<li>Adds <code>handleErrorWith(Kind&lt;F, A&gt; ma, Function&lt;E, Kind&lt;F, A&gt;&gt; handler)</code>: Allows recovering from an error state <code>E</code> by providing a function that takes the error and returns a <em>new context</em> <code>Kind&lt;F, A&gt;</code>.</li>
<li>Provides default recovery methods like <code>handleError</code>, <code>recover</code>, <code>recoverWith</code>.</li>
<li>Reference: <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-api/src/main/java/org/higherkindedj/hkt/MonadError.java"><code>MonadError.java</code></a></li>
</ul>
</li>
</ul>
<h2 id="4-defunctionalisation-per-type-constructor"><a class="header" href="#4-defunctionalisation-per-type-constructor">4. Defunctionalisation (Per Type Constructor)</a></h2>
<p>For each Java type constructor (like <code>List</code>, <code>Optional</code>, <code>IO</code>) you want to simulate as a Higher-Kinded Type, a specific pattern involving several components is used. The exact implementation differs slightly depending on whether the type is defined <em>within</em> the Higher-Kinded-J library (e.g., <code>Id</code>, <code>Maybe</code>, <code>IO</code>, monad transformers) or if it's an <em>external type</em> (e.g., <code>java.util.List</code>, <code>java.util.Optional</code>, <code>java.util.concurrent.CompletableFuture</code>).</p>
<p><strong>Common Components:</strong></p>
<ul>
<li>
<p><strong>The <code>XxxKind</code> Interface:</strong> A specific marker interface, for example, <code>OptionalKind&lt;A&gt;</code>. This interface extends <code>Kind&lt;F, A&gt;</code>, where <code>F</code> is the witness type representing the type constructor.</p>
<ul>
<li><strong>Example:</strong> <code>public interface OptionalKind&lt;A&gt; extends Kind&lt;OptionalKind.Witness, A&gt; { /* ... Witness class ... */ }</code></li>
<li>The <code>Witness</code> (e.g., <code>OptionalKind.Witness</code>) is a static nested final class (or a separate accessible class) within <code>OptionalKind</code>. This <code>Witness</code> type is what's used as the <code>F</code> parameter in generic type classes like <code>Monad&lt;F&gt;</code>.</li>
</ul>
</li>
<li>
<p><strong>The <code>KindHelper</code> Class (e.g., <code>OptionalKindHelper</code>):</strong> A crucial utility <code>widen</code> and <code>narrow</code> methods:</p>
<ul>
<li><code>widen(...)</code>: Converts the standard Java type (e.g., <code>Optional&lt;String&gt;</code>) into its <code>Kind&lt;F, A&gt;</code> representation.</li>
<li><code>narrow(Kind&lt;F, A&gt; kind)</code>: Converts the <code>Kind&lt;F, A&gt;</code> representation back to the underlying Java type (e.g., <code>Optional&lt;String&gt;</code>).
<ul>
<li><strong>Crucially, this method throws <code>KindUnwrapException</code> if the input <code>kind</code> is structurally invalid</strong> (e.g., <code>null</code>, the wrong <code>Kind</code> type, or, where applicable, a <code>Holder</code> containing <code>null</code> where it shouldn't). This ensures robustness.</li>
</ul>
</li>
<li>May contain other convenience factory methods.</li>
</ul>
</li>
<li>
<p><strong>Type Class Instance(s):</strong> Concrete classes implementing <code>Functor&lt;F&gt;</code>, <code>Monad&lt;F&gt;</code>, etc., for the specific witness type <code>F</code> (e.g., <code>OptionalMonad implements Monad&lt;OptionalKind.Witness&gt;</code>). These instances use the <code>KindHelper</code>'s <code>widen</code> and <code>narrow</code> methods to operate on the underlying Java types.</p>
</li>
</ul>
<p><strong>External Types:</strong></p>
<p><img src="hkts/../images/puml/defunctionalisation_external.svg" alt="defunctionalisation_external.svg" /></p>
<ul>
<li><strong>For Types Defined Within Higher-Kinded-J (e.g., <code>Id</code>, <code>Maybe</code>, <code>IO</code>, Monad Transformers like <code>EitherT</code>):</strong>
<ul>
<li>These types are designed to directly participate in the HKT simulation.</li>
<li>The type itself (e.g., <code>Id&lt;A&gt;</code>, <code>MaybeT&lt;F, A&gt;</code>) will directly implement its corresponding <code>XxxKind</code> interface (e.g., <code>Id&lt;A&gt; implements IdKind&lt;A&gt;</code>, where <code>IdKind&lt;A&gt; extends Kind&lt;Id.Witness, A&gt;</code>).</li>
<li>In this case, a separate <code>Holder</code> record is <strong>not needed</strong> for the primary <code>wrap</code>/<code>unwrap</code> mechanism in the <code>KindHelper</code>.</li>
<li><code>XxxKindHelper.wrap(Id&lt;A&gt; id)</code> would effectively be a type cast (after null checks) to <code>Kind&lt;Id.Witness, A&gt;</code> because <code>Id&lt;A&gt;</code> <em>is already</em> an <code>IdKind&lt;A&gt;</code>.</li>
<li><code>XxxKindHelper.unwrap(Kind&lt;Id.Witness, A&gt; kind)</code> would check <code>instanceof Id</code> (or <code>instanceof MaybeT</code>, etc.) and perform a cast.</li>
</ul>
</li>
</ul>
<p>This distinction is important for understanding how <code>wrap</code> and <code>unwrap</code> function for different types. However, from the perspective of a user of a type class instance (like <code>OptionalMonad</code>), the interaction remains consistent: you provide a <code>Kind</code> object, and the type class instance handles the necessary operations.</p>
<h2 id="5-the-unit-type"><a class="header" href="#5-the-unit-type">5. The <code>Unit</code> Type</a></h2>
<p>In functional programming, it's common to have computations or functions that perform an action (often a side effect) but do not produce a specific, meaningful result value. In Java, methods that don't return a value use the <code>void</code> keyword. However, <code>void</code> is not a first-class type and cannot be used as a generic type parameter <code>A</code> in <code>Kind&lt;F, A&gt;</code>.</p>
<p>Higher-Kinded-J provides the <code>org.higherkindedj.hkt.unit.Unit</code> type to address this.</p>
<ul>
<li><strong>Purpose:</strong> <code>Unit</code> is a type that has exactly one value, <code>Unit.INSTANCE</code>. It is used to represent the successful completion of an operation that doesn't yield any other specific information. Think of it as a functional equivalent of <code>void</code>, but usable as a generic type.</li>
<li><strong>Usage in HKT:</strong>
<ul>
<li>When a monadic action <code>Kind&lt;F, A&gt;</code> completes successfully but has no specific value to return (e.g., an <code>IO</code> action that prints to the console), <code>A</code> can be <code>Unit</code>. The action would then be <code>Kind&lt;F, Unit&gt;</code>, and its successful result would conceptually be <code>Unit.INSTANCE</code>. For example, <code>IO&lt;Unit&gt;</code> for a print operation.</li>
<li>In <code>MonadError&lt;F, E&gt;</code>, if the error state <code>E</code> simply represents an absence or a failure without specific details (like <code>Optional.empty()</code> or <code>Maybe.Nothing()</code>), <code>Unit</code> can be used as the type for <code>E</code>. The <code>raiseError</code> method would then be called with <code>Unit.INSTANCE</code>. For instance, <code>OptionalMonad</code> implements <code>MonadError&lt;OptionalKind.Witness, Unit&gt;</code>, and <code>MaybeMonad</code> implements <code>MonadError&lt;MaybeKind.Witness, Unit&gt;</code>.</li>
</ul>
</li>
<li><strong>Example:</strong>
<pre><code class="language-java">// An IO action that just performs a side effect (printing)
Kind&lt;IOKind.Witness, Unit&gt; printAction = IOKindHelper.delay(() -&gt; {
    System.out.println("Effect executed!");
    return Unit.INSTANCE; // Explicitly return Unit.INSTANCE
});
IOKindHelper.unsafeRunSync(printAction); // Executes the print

// Optional treated as MonadError&lt;..., Unit&gt;
OptionalMonad optionalMonad = OptionalMonad.INSTANCE;
Kind&lt;OptionalKind.Witness, String&gt; emptyOptional = optionalMonad.raiseError(Unit.INSTANCE); // Creates Optional.empty()
</code></pre>
</li>
<li><strong>Reference:</strong> <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/unit/Unit.java"><code>Unit.java</code></a></li>
</ul>
<h2 id="6-error-handling-philosophy"><a class="header" href="#6-error-handling-philosophy">6. Error Handling Philosophy</a></h2>
<ul>
<li><strong>Domain Errors:</strong> These are expected business-level errors or alternative outcomes. They are represented <em>within</em> the structure of the simulated type (e.g., <code>Either.Left</code>, <code>Maybe.Nothing</code>, <code>Try.Failure</code>, a failed <code>CompletableFuture</code>, potentially a specific result type within <code>IO</code>). These are handled using the type's specific methods or <code>MonadError</code> capabilities (<code>handleErrorWith</code>, <code>recover</code>, <code>fold</code>, <code>orElse</code>, etc.) <em>after</em> successfully unwrapping the <code>Kind</code>.</li>
<li><strong>Simulation Errors (<code>KindUnwrapException</code>):</strong> These indicate a problem with the HKT simulation <em>itself</em> ‚Äì usually a programming error. Examples include passing <code>null</code> to <code>unwrap</code>, passing a <code>ListKind</code> to <code>OptionalKindHelper.unwrap</code>, or (if it were possible) having a <code>Holder</code> record contain a <code>null</code> reference to the underlying Java object it's supposed to hold. These are signalled by throwing the unchecked <code>KindUnwrapException</code> from <code>unwrap</code> methods to clearly distinguish infrastructure issues from domain errors. You typically shouldn't need to catch <code>KindUnwrapException</code> unless debugging the simulation usage itself.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="usage-guide-working-with-higher-kinded-j"><a class="header" href="#usage-guide-working-with-higher-kinded-j">Usage Guide: Working with Higher-Kinded-J</a></h1>
<p><img src="hkts/../images/oa-movements.png" alt="oa-movements.png" /></p>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="hkts/usage-guide.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>The five-step workflow for using Higher-Kinded-J effectively</li>
<li>How to identify the right context (witness type) for your use case</li>
<li>Using widen() and narrow() to convert between Java types and Kind representations</li>
<li>When and how to handle KindUnwrapException safely</li>
<li>Writing generic functions that work with any Functor or Monad</li>
</ul>
</div>
</div>
<p>This guide explains the step-by-step process of using Higher-Kinded-J's simulated Higher-Kinded Types (HKTs) and associated type classes like <code>Functor</code>, <code>Applicative</code>, <code>Monad</code>, and <code>MonadError</code>.</p>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/GenericExample.java">GenericExample.java</a></li>
</ul>
<h2 id="core-workflow"><a class="header" href="#core-workflow">Core Workflow</a></h2>
<p>The general process involves these steps:</p>
<div id="admonition-step-1-identify-the-context-_f_witness_" class="admonition admonish-note" role="note" aria-labelledby="admonition-step-1-identify-the-context-_f_witness_-title">
<div class="admonition-title">
<div id="admonition-step-1-identify-the-context-_f_witness_-title">
<p>Step 1: Identify the Context (<em>F_WITNESS</em>)</p>
</div>
<a class="admonition-anchor-link" href="hkts/usage-guide.html#admonition-step-1-identify-the-context-_f_witness_"></a>
</div>
<div>
<p>Determine which type constructor (computational context) you want to work with abstractly. This context is represented by its <em>witness type</em>.</p>
<p>Examples:</p>
<ul>
<li><code>ListKind.Witness</code> for <code>java.util.List</code></li>
<li><code>OptionalKind.Witness</code> for <code>java.util.Optional</code></li>
<li><code>MaybeKind.Witness</code> for the custom <code>Maybe</code> type</li>
<li><code>EitherKind.Witness&lt;L&gt;</code> for the custom <code>Either&lt;L, R&gt;</code> type (where <code>L</code> is fixed)</li>
<li><code>TryKind.Witness</code> for the custom <code>Try</code> type</li>
<li><code>CompletableFutureKind.Witness</code> for <code>java.util.concurrent.CompletableFuture</code></li>
<li><code>IOKind.Witness</code> for the custom <code>IO</code> type</li>
<li><code>LazyKind.Witness</code> for the custom <code>Lazy</code> type</li>
<li><code>ReaderKind.Witness&lt;R_ENV&gt;</code> for the custom <code>Reader&lt;R_ENV, A&gt;</code> type</li>
<li><code>StateKind.Witness&lt;S&gt;</code> for the custom <code>State&lt;S, A&gt;</code> type</li>
<li><code>WriterKind.Witness&lt;W&gt;</code> for the custom <code>Writer&lt;W, A&gt;</code> type</li>
<li>For transformers, e.g., <code>EitherTKind.Witness&lt;F_OUTER_WITNESS, L_ERROR&gt;</code></li>
</ul>
</div>
</div>
<div id="admonition-step-2-find-the-type-class-instance" class="admonition admonish-note" role="note" aria-labelledby="admonition-step-2-find-the-type-class-instance-title">
<div class="admonition-title">
<div id="admonition-step-2-find-the-type-class-instance-title">
<p>Step 2: Find the Type Class Instance</p>
</div>
<a class="admonition-anchor-link" href="hkts/usage-guide.html#admonition-step-2-find-the-type-class-instance"></a>
</div>
<div>
<p>Obtain an instance of the required type class (<code>Functor&lt;F_WITNESS&gt;</code>, <code>Applicative&lt;F_WITNESS&gt;</code>, <code>Monad&lt;F_WITNESS&gt;</code>, <code>MonadError&lt;F_WITNESS, E&gt;</code>) for your chosen context's witness type <code>F_WITNESS</code>.</p>
<p>These are concrete classes provided in the corresponding package.</p>
<p>Examples:</p>
<ul>
<li><strong><code>Optional</code></strong>:
<code>OptionalMonad optionalMonad = OptionalMonad.INSTANCE;</code> (This implements <code>MonadError&lt;OptionalKind.Witness, Unit&gt;</code>)</li>
<li><strong><code>List</code></strong>: <code>ListMonad listMonad = ListMonad.INSTANCE;</code> (This implements <code>Monad&lt;ListKind.Witness&gt;</code>)</li>
<li><strong><code>CompletableFuture</code></strong>: <code>CompletableFutureMonad futureMonad = CompletableFutureMonad.INSTANCE;</code> (This implements <code>MonadError&lt;CompletableFutureKind.Witness, Throwable&gt;</code>)</li>
<li><strong><code>Either&lt;String, ?&gt;</code></strong>: <code>EitherMonad&lt;String&gt; eitherMonad =  EitherMonad.instance();</code> (This implements <code>MonadError&lt;EitherKind.Witness&lt;String&gt;, String&gt;</code>)</li>
<li><strong><code>IO</code></strong>: <code>IOMonad ioMonad = IOMonad.INSTANCE;</code> (This implements <code>Monad&lt;IOKind.Witness&gt;</code>)</li>
<li><strong><code>Writer&lt;String, ?&gt;</code></strong>: <code>WriterMonad&lt;String&gt; writerMonad = new WriterMonad&lt;&gt;(new StringMonoid());</code> (This implements <code>Monad&lt;WriterKind.Witness&lt;String&gt;&gt;</code>)</li>
</ul>
</div>
</div>
<div id="admonition-step-3-wrap-your-value-_javatype_---_kind_" class="admonition admonish-note" role="note" aria-labelledby="admonition-step-3-wrap-your-value-_javatype_---_kind_-title">
<div class="admonition-title">
<div id="admonition-step-3-wrap-your-value-_javatype_---_kind_-title">
<p>Step 3: Wrap Your Value (<em>JavaType<A></em> -&gt; <em>Kind&lt;F_WITNESS, A&gt;</em>)</p>
</div>
<a class="admonition-anchor-link" href="hkts/usage-guide.html#admonition-step-3-wrap-your-value-_javatype_---_kind_"></a>
</div>
<div>
<p>Convert your standard Java object (e.g., a <code>List&lt;Integer&gt;</code>, an <code>Optional&lt;String&gt;</code>, an <code>IO&lt;String&gt;</code>) into Higher-Kinded-J's <code>Kind</code> representation using the <code>widen</code> instance method from the corresponding <code>XxxKindHelper</code> enum's singleton instance. You'll typically use a static import for the singleton instance for brevity.</p>
<pre><code class="language-java"> import static org.higherkindedj.hkt.optional.OptionalKindHelper.OPTIONAL; 
 // ...
 Optional&lt;String&gt; myOptional = Optional.of("test");
 // Widen it into the Higher-Kinded-J Kind type
 // F_WITNESS here is OptionalKind.Witness
 Kind&lt;OptionalKind.Witness, String&gt; optionalKind = OPTIONAL.widen(myOptional);
</code></pre>
<ul>
<li>Helper enums provide convenience factory methods that also return <code>Kind</code> instances, e.g., <code>MAYBE.just("value")</code>, <code>TRY.failure(ex)</code>, <code>IO_OP.delay(() -&gt; ...)</code>, <code>LAZY.defer(() -&gt; ...)</code>. Remember to import thes statically from the XxxKindHelper classes.</li>
<li><strong>Note on Widening</strong>:
<ul>
<li>For JDK types (like <code>List</code>, <code>Optional</code>), <code>widen</code> typically creates an internal <code>Holder</code> object that wraps the JDK type and implements the necessary <code>XxxKind</code> interface.</li>
<li>For library-defined types (<code>Id</code>, <code>Maybe</code>, <code>IO</code>, Transformers like <code>EitherT</code>) that directly implement their <code>XxxKind</code> interface (which in turn extends <code>Kind</code>), the <code>widen</code> method on the helper enum often performs a null check and then a direct (and safe) cast to the <code>Kind</code> type.</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="admonition-step-4-apply-type-class-methods" class="admonition admonish-note" role="note" aria-labelledby="admonition-step-4-apply-type-class-methods-title">
<div class="admonition-title">
<div id="admonition-step-4-apply-type-class-methods-title">
<p>Step 4: Apply Type Class Methods</p>
</div>
<a class="admonition-anchor-link" href="hkts/usage-guide.html#admonition-step-4-apply-type-class-methods"></a>
</div>
<div>
<p>Use the methods defined by the type class interface (<code>map</code>, <code>flatMap</code>, <code>of</code>, <code>ap</code>, <code>raiseError</code>, <code>handleErrorWith</code>, etc.) by calling them on the <strong>type class instance</strong> obtained in <em>Step 2</em>, passing your <code>Kind</code> value(s) as arguments. <strong>Do not call <code>map</code>/<code>flatMap</code> directly on the <code>Kind</code> object itself if it's just the <code>Kind</code> interface.</strong> (Some concrete <code>Kind</code> implementations like <code>Id</code> or <code>Maybe</code> might offer direct methods, but for generic programming, use the type class instance).</p>
<pre><code class="language-java"> import static org.higherkindedj.hkt.optional.OptionalKindHelper.OPTIONAL;
 // ...
 OptionalMonad optionalMonad = OptionalMonad.INSTANCE;
 Kind&lt;OptionalKind.Witness, String&gt; optionalKind = OPTIONAL.widen(Optional.of("test")); // from previous step

 // --- Using map ---
 Function&lt;String, Integer&gt; lengthFunc = String::length;
 // Apply map using the monad instance
 Kind&lt;OptionalKind.Witness, Integer&gt; lengthKind = optionalMonad.map(lengthFunc, optionalKind);
 // lengthKind now represents Kind&lt;OptionalKind.Witness, Integer&gt; containing Optional.of(4) if "test"

 // --- Using flatMap ---
 // Function A -&gt; Kind&lt;F_WITNESS, B&gt;
 Function&lt;Integer, Kind&lt;OptionalKind.Witness, String&gt;&gt; checkLength =
     len -&gt; OPTIONAL.widen(len &gt; 3 ? Optional.of("Long enough") : Optional.empty());
 // Apply flatMap using the monad instance
 Kind&lt;OptionalKind.Witness, String&gt; checkedKind = optionalMonad.flatMap(checkLength, lengthKind);
 // checkedKind now represents Kind&lt;OptionalKind.Witness, String&gt; containing Optional.of("Long enough")

 // --- Using MonadError (for Optional, error type is Unit) ---
 Kind&lt;OptionalKind.Witness, String&gt; emptyKind = optionalMonad.raiseError(Unit.INSTANCE); // Represents Optional.empty()
 // Handle the empty case (error state) using handleErrorWith (handleError was changed to handleErrorWith generally)
 Kind&lt;OptionalKind.Witness, String&gt; handledKind = optionalMonad.handleErrorWith(
     emptyKind,
     ignoredError -&gt; OPTIONAL.widen(Optional.of("Default Value")) // Ensure recovery function also returns a Kind
 );

</code></pre>
</div>
</div>
<div id="admonition-step-5-unwrapnarrow-the-result-_kind---javatype_" class="admonition admonish-note" role="note" aria-labelledby="admonition-step-5-unwrapnarrow-the-result-_kind---javatype_-title">
<div class="admonition-title">
<div id="admonition-step-5-unwrapnarrow-the-result-_kind---javatype_-title">
<p>Step 5: Unwrap/Narrow the Result (<em>Kind&lt;F_WITNESS, A&gt; -&gt; JavaType<A></em>)</p>
</div>
<a class="admonition-anchor-link" href="hkts/usage-guide.html#admonition-step-5-unwrapnarrow-the-result-_kind---javatype_"></a>
</div>
<div>
<p>When you need the underlying Java value back (e.g., to return from a method boundary, perform side effects like printing or running <code>IO</code>), use the <code>narrow</code> instance method from the corresponding <code>XxxKindHelper</code> enum's singleton instance.</p>
<pre><code>```java
import static org.higherkindedj.hkt.optional.OptionalKindHelper.OPTIONAL; 
import static org.higherkindedj.hkt.io.IOKindHelper.IO_OP; 

// ...
// Continuing the Optional example:
 Kind&lt;OptionalKind.Witness, String&gt; checkedKind = /* from previous step */;
 Kind&lt;OptionalKind.Witness, String&gt; handledKind = /* from previous step */;

 Optional&lt;String&gt; finalOptional = OPTIONAL.narrow(checkedKind);
 System.out.println("Final Optional: " + finalOptional); 
 // Output: Optional[Long enough]

 Optional&lt;String&gt; handledOptional = OPTIONAL.narrow(handledKind);
 System.out.println("Handled Optional: " + handledOptional); 
 // Output: Optional[Default Value]

 // Example for IO:
  IOMonad ioMonad = IOMonad.INSTANCE;
  Kind&lt;IOKind.Witness, String&gt; ioKind = IO_OP.delay(() -&gt; "Hello from IO!"); 
  // Use IO_OP.delay
  // unsafeRunSync is an instance method on IOKindHelper.IO_OP
  String ioResult = IO_OP.unsafeRunSync(ioKind);
  System.out.println(ioResult);
```
</code></pre>
</div>
</div>
<hr />
<div id="admonition-handling-_kindunwrapexception_" class="admonition admonish-note" role="note" aria-labelledby="admonition-handling-_kindunwrapexception_-title">
<div class="admonition-title">
<div id="admonition-handling-_kindunwrapexception_-title">
<p>Handling <em>KindUnwrapException</em></p>
</div>
<a class="admonition-anchor-link" href="hkts/usage-guide.html#admonition-handling-_kindunwrapexception_"></a>
</div>
<div>
<p>The <code>narrow</code> instance methods in all <code>KindHelper</code> enums are designed to be robust against <em>structural</em> errors within the HKT simulation layer.</p>
<ul>
<li><strong>When it's thrown</strong>: If you pass <code>null</code> to <code>narrow</code>. For external types using a <code>Holder</code> (like <code>Optional</code> with <code>OptionalHolder</code>), if the <code>Kind</code> instance is not the expected <code>Holder</code> type, an exception is also thrown. For types that directly implement their <code>XxxKind</code> interface, <code>narrow</code> will throw if the <code>Kind</code> is not an instance of that specific concrete type.</li>
<li><strong>What it means</strong>: This exception signals a problem with how you are using Higher-Kinded-J itself ‚Äì usually a programming error in creating or passing <code>Kind</code> objects.</li>
<li><strong>How to handle</strong>: You generally <strong>should not</strong> need to catch <code>KindUnwrapException</code> in typical application logic. Its occurrence points to a bug that needs fixing in the code using Higher-Kinded-J.</li>
</ul>
<pre><code class="language-java">  // import static org.higherkindedj.hkt.optional.OptionalKindHelper.OPTIONAL;
  public void handlingUnwrapExceptions() {
    try {
      // ERROR: Attempting to narrow null
      Optional&lt;String&gt; result = OPTIONAL.narrow(null);
    } catch(KindUnwrapException e) {
      System.err.println("Higher-Kinded-J Usage Error: " + e.getMessage());
      // Example Output (message from OptionalKindHelper.INVALID_KIND_NULL_MSG):
      // Usage Error: Cannot narrow null Kind for Optional
    }
  }
</code></pre>
<p><strong>Important Distinction:</strong></p>
<ul>
<li><strong><code>KindUnwrapException</code></strong>: Signals a problem with the Higher-Kinded-J structure itself (e.g., invalid <code>Kind</code> object passed to <code>narrow</code>). Fix the code using Higher-Kinded-J.</li>
<li><strong>Domain Errors / Absence</strong>: Represented <em>within</em> a valid <code>Kind</code> structure (e.g., <code>Optional.empty()</code> widened to <code>Kind&lt;OptionalKind.Witness, A&gt;</code>, <code>Either.Left</code> widened to <code>Kind&lt;EitherKind.Witness&lt;L&gt;, R&gt;</code>). These should be handled using the monad's specific methods (<code>orElse</code>, <code>fold</code>, <code>handleErrorWith</code>, etc.) or by using the <code>MonadError</code> methods <em>before</em> narrowing back to the final Java type.</li>
</ul>
</div>
</div>
<div id="admonition-example-generic-function" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-generic-function-title">
<div class="admonition-title">
<div id="admonition-example-generic-function-title">
<p>Example: Generic Function</p>
</div>
<a class="admonition-anchor-link" href="hkts/usage-guide.html#admonition-example-generic-function"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/GenericExample.java">GenericExample.java</a></li>
</ul>
<p>Higher-Kinded-J allows writing functions generic over the simulated type constructor (represented by its witness <code>F_WITNESS</code>).</p>
<pre><code class="language-java">// import static org.higherkindedj.hkt.list.ListKindHelper.LIST;
// import static org.higherkindedj.hkt.optional.OptionalKindHelper.OPTIONAL;
// ...

// Generic function: Applies a function within any Functor context F_WITNESS.
// Requires the specific Functor&lt;F_WITNESS&gt; instance to be passed in.
public static &lt;F_WITNESS, A, B&gt; Kind&lt;F_WITNESS, B&gt; mapWithFunctor(
    Functor&lt;F_WITNESS&gt; functorInstance, // Pass the type class instance for F_WITNESS
    Function&lt;A, B&gt; fn,
    Kind&lt;F_WITNESS, A&gt; kindABox) { 

  // Use the map method from the provided Functor instance
  return functorInstance.map(fn, kindABox);
}

public void genericExample() { 
  // Get instances of the type classes for the specific types (F_WITNESS) we want to use
  ListMonad listMonad = new ListMonad(); // Implements Functor&lt;ListKind.Witness&gt;
  OptionalMonad optionalMonad = OptionalMonad.INSTANCE; // Implements Functor&lt;OptionalKind.Witness&gt;

  Function&lt;Integer, Integer&gt; doubleFn = x -&gt; x * 2;

  // --- Use with List ---
  List&lt;Integer&gt; nums = List.of(1, 2, 3);
  // Widen the List. F_WITNESS is ListKind.Witness
  Kind&lt;ListKind.Witness, Integer&gt; listKind = LIST.widen(nums); 
  // Call the generic function, passing the ListMonad instance and the widened List
  Kind&lt;ListKind.Witness, Integer&gt; doubledListKind = mapWithFunctor(listMonad, doubleFn, listKind);
  System.out.println("Doubled List: " + LIST.narrow(doubledListKind)); // Output: [2, 4, 6]

  // --- Use with Optional (Present) ---
  Optional&lt;Integer&gt; optNum = Optional.of(10);
  // Widen the Optional. F_WITNESS is OptionalKind.Witness
  Kind&lt;OptionalKind.Witness, Integer&gt; optKind = OPTIONAL.widen(optNum); 
  // Call the generic function, passing the OptionalMonad instance and the widened Optional
  Kind&lt;OptionalKind.Witness, Integer&gt; doubledOptKind = mapWithFunctor(optionalMonad, doubleFn, optKind);
  System.out.println("Doubled Optional: " + OPTIONAL.narrow(doubledOptKind)); // Output: Optional[20]

  // --- Use with Optional (Empty) ---
  Optional&lt;Integer&gt; emptyOpt = Optional.empty();
  Kind&lt;OptionalKind.Witness, Integer&gt; emptyOptKind = OPTIONAL.widen(emptyOpt); 
  // Call the generic function, map does nothing on empty
  Kind&lt;OptionalKind.Witness, Integer&gt; doubledEmptyOptKind = mapWithFunctor(optionalMonad, doubleFn, emptyOptKind);
  System.out.println("Doubled Empty Optional: " + OPTIONAL.narrow(doubledEmptyOptKind)); // Output: Optional.empty
}

</code></pre>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="higher-kinded-types---basic-usage-examples"><a class="header" href="#higher-kinded-types---basic-usage-examples">Higher-Kinded Types - Basic Usage Examples</a></h1>
<blockquote>
<p>This document provides a brief summary of the example classes found in the <code>org.higherkindedj.example.basic</code> package in the <a href="https://github.com/higher-kinded-j/higher-kinded-j/tree/main/hkj-examples/src/main/java/org/higherkindedj/example/basic">HKJ-Examples</a>.</p>
</blockquote>
<p>These examples showcase how to use various monads and monad transformers to handle common programming tasks like managing optional values, asynchronous operations, and state in a functional way.</p>
<hr />
<h2 id="monads"><a class="header" href="#monads">Monads</a></h2>
<h3 id="eitherexamplejava"><a class="header" href="#eitherexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/either/EitherExample.java">EitherExample.java</a></a></h3>
<p>This example demonstrates the <strong>Either monad</strong>. <code>Either</code> is used to represent a value that can be one of two types, typically a success value (<code>Right</code>) or an error value (<code>Left</code>).</p>
<ul>
<li><strong>Key Concept</strong>: A <code>Either</code> provides a way to handle computations that can fail with a specific error type.</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Creating <code>Either</code> instances for success (<code>Right</code>) and failure (<code>Left</code>) cases.</li>
<li>Using <code>flatMap</code> to chain operations that return an <code>Either</code>, short-circuiting on failure.</li>
<li>Using <code>fold</code> to handle both the <code>Left</code> and <code>Right</code> cases.</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// Chain operations that can fail
Either&lt;String, Integer&gt; result = input.flatMap(parse).flatMap(checkPositive);

// Fold to handle both outcomes
String message = result.fold(
    leftValue -&gt; "Operation failed with: " + leftValue,
    rightValue -&gt; "Operation succeeded with: " + rightValue
);
</code></pre>
<h3 id="forcomprehensionexamplejava"><a class="header" href="#forcomprehensionexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/expression/ForComprehensionExample.java">ForComprehensionExample.java</a></a></h3>
<p>This example demonstrates how to use the <code>For</code> comprehension, a feature that provides a more readable, sequential syntax for composing monadic operations (equivalent to <code>flatMap</code> chains).</p>
<ul>
<li><strong>Key Concept</strong>: A <code>For</code> comprehension offers syntactic sugar for <code>flatMap</code> and <code>map</code> calls, making complex monadic workflows easier to write and understand.</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Using <code>For.from()</code> to start and chain monadic operations.</li>
<li>Applying comprehensions to different monads like <code>List</code>, <code>Maybe</code>, and the <code>StateT</code> monad transformer.</li>
<li>Filtering intermediate results with <code>.when()</code>.</li>
<li>Introducing intermediate values with <code>.let()</code>.</li>
<li>Producing a final result with <code>.yield()</code>.</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// A for-comprehension with List
final Kind&lt;ListKind.Witness, String&gt; result =
    For.from(listMonad, list1)
        .from(_ -&gt; list2)
        .when(t -&gt; (t._1() + t._2()) % 2 != 0) // Filter
        .let(t -&gt; "Sum: " + (t._1() + t._2())) // Introduce new value
        .yield((a, b, c) -&gt; a + " + " + b + " = " + c); // Final result
</code></pre>
<h3 id="completablefutureexamplejava"><a class="header" href="#completablefutureexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/future/CompletableFutureExample.java">CompletableFutureExample.java</a></a></h3>
<p>This example covers the <strong>CompletableFuture monad</strong>. It shows how to use <code>CompletableFuture</code> within the Higher-Kinded-J framework to manage asynchronous computations and handle potential errors.</p>
<ul>
<li><strong>Key Concept</strong>: The <code>CompletableFuture</code> monad is used to compose asynchronous operations in a non-blocking way.</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Creating <code>Kind</code>-wrapped <code>CompletableFuture</code> instances for success and failure.</li>
<li>Using <code>map</code> (which corresponds to <code>thenApply</code>).</li>
<li>Using <code>flatMap</code> (which corresponds to <code>thenCompose</code>) to chain dependent asynchronous steps.</li>
<li>Using <code>handleErrorWith</code> to recover from exceptions that occur within the future.</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// Using handleErrorWith to recover from a failed future
Function&lt;Throwable, Kind&lt;CompletableFutureKind.Witness, String&gt;&gt; recoveryHandler =
    error -&gt; {
      System.out.println("Handling error: " + error.getMessage());
      return futureMonad.of("Recovered from Error");
    };

Kind&lt;CompletableFutureKind.Witness, String&gt; recoveredFuture =
    futureMonad.handleErrorWith(failedFutureKind, recoveryHandler);
</code></pre>
<h3 id="idexamplejava"><a class="header" href="#idexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/id/IdExample.java">IdExample.java</a></a></h3>
<p>This example introduces the <strong>Identity (Id) monad</strong>. The <code>Id</code> monad is the simplest monad; it wraps a value without adding any computational context. It is primarily used to make generic code that works with any monad also work with simple, synchronous values.</p>
<ul>
<li><strong>Key Concept</strong>: The <code>Id</code> monad represents a direct, synchronous computation. It wraps a value, and its <code>flatMap</code> operation simply applies the function to the value.</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Wrapping a plain value into an <code>Id</code>.</li>
<li>Using <code>map</code> and <code>flatMap</code> on an <code>Id</code> value.</li>
<li>Its use as the underlying monad in a monad transformer stack, effectively turning <code>StateT&lt;S, Id.Witness, A&gt;</code> into <code>State&lt;S, A&gt;</code>.</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// flatMap on Id simply applies the function to the wrapped value.
Id&lt;String&gt; idFromOf = Id.of(42);
Id&lt;String&gt; directFlatMap = idFromOf.flatMap(i -&gt; Id.of("Direct FlatMap: " + i));
// directFlatMap.value() is "Direct FlatMap: 42"
</code></pre>
<h3 id="ioexamplejava"><a class="header" href="#ioexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/io/IOExample.java">IOExample.java</a></a></h3>
<p>This example introduces the <strong>IO monad</strong>, which is used to encapsulate side effects like reading from the console, writing to a file, or making a network request.</p>
<ul>
<li><strong>Key Concept</strong>: The <code>IO</code> monad describes a computation that can perform side effects. These effects are only executed when the <code>IO</code> action is explicitly run.</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Creating <code>IO</code> actions that describe side effects using <code>delay</code>.</li>
<li>Composing <code>IO</code> actions using <code>map</code> and <code>flatMap</code> to create more complex programs.</li>
<li>Executing <code>IO</code> actions to produce a result using <code>unsafeRunSync</code>.</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// Create an IO action to read a line from the console
Kind&lt;IOKind.Witness, String&gt; readLine = IO_OP.delay(() -&gt; {
    System.out.print("Enter your name: ");
    try (Scanner scanner = new Scanner(System.in)) {
        return scanner.nextLine();
    }
});

// Execute the action to get the result
String name = IO_OP.unsafeRunSync(readLine);
</code></pre>
<h3 id="lazyexamplejava"><a class="header" href="#lazyexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/lazy/LazyExample.java">LazyExample.java</a></a></h3>
<p>This example covers the <strong>Lazy monad</strong>. It's used to defer a computation until its result is explicitly requested. The result is then memoized (cached) so the computation is only executed once.</p>
<ul>
<li><strong>Key Concept</strong>: A <code>Lazy</code> computation is not executed when it is created, but only when <code>force()</code> is called. The result (or exception) is then stored for subsequent calls.</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Creating a deferred computation with <code>LAZY.defer()</code>.</li>
<li>Forcing evaluation with <code>LAZY.force()</code>.</li>
<li>How results are memoized, preventing re-computation.</li>
<li>Using <code>map</code> and <code>flatMap</code> to build chains of lazy operations.</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// Defer a computation
java.util.concurrent.atomic.AtomicInteger counter = new java.util.concurrent.atomic.AtomicInteger(0);
Kind&lt;LazyKind.Witness, String&gt; deferredLazy = LAZY.defer(() -&gt; {
    counter.incrementAndGet();
    return "Computed Value";
});

// The computation only runs when force() is called
System.out.println(LAZY.force(deferredLazy)); // counter becomes 1
System.out.println(LAZY.force(deferredLazy)); // result is from cache, counter remains 1
</code></pre>
<h3 id="listmonadexamplejava"><a class="header" href="#listmonadexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/list/ListMonadExample.java">ListMonadExample.java</a></a></h3>
<p>This example demonstrates the <strong>List monad</strong>. It shows how to perform monadic operations on a standard Java <code>List</code>, treating it as a context that can hold zero or more results.</p>
<ul>
<li><strong>Key Concept</strong>: The <code>List</code> monad represents non-deterministic computation, where an operation can produce multiple results.</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Wrapping a <code>List</code> into a <code>Kind&lt;ListKind.Witness, A&gt;</code>.</li>
<li>Using <code>map</code> to transform every element in the list.</li>
<li>Using <code>flatMap</code> to apply a function that returns a list to each element, and then flattening the result.</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// A function that returns multiple results for even numbers
Function&lt;Integer, Kind&lt;ListKind.Witness, Integer&gt;&gt; duplicateIfEven =
    n -&gt; {
      if (n % 2 == 0) {
        return LIST.widen(Arrays.asList(n, n * 10));
      } else {
        return LIST.widen(List.of()); // Empty list for odd numbers
      }
    };

// flatMap applies the function and flattens the resulting lists
Kind&lt;ListKind.Witness, Integer&gt; flatMappedKind = listMonad.flatMap(duplicateIfEven, numbersKind);
</code></pre>
<h3 id="maybeexamplejava"><a class="header" href="#maybeexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/maybe/MaybeExample.java">MaybeExample.java</a></a></h3>
<p>This example covers the <strong>Maybe monad</strong>. <code>Maybe</code> is a type that represents an optional value, similar to Java's <code>Optional</code>, but designed to be used as a monad within the Higher-Kinded-J ecosystem. It has two cases: <code>Just&lt;A&gt;</code> (a value is present) and <code>Nothing</code> (a value is absent).</p>
<ul>
<li><strong>Key Concept</strong>: The <code>Maybe</code> monad provides a way to represent computations that may or may not return a value, explicitly handling the absence of a value.</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Creating <code>Just</code> and <code>Nothing</code> instances.</li>
<li>Using <code>map</code> to transform a <code>Just</code> value.</li>
<li>Using <code>flatMap</code> to chain operations that return a <code>Maybe</code>.</li>
<li>Handling the <code>Nothing</code> case using <code>handleErrorWith</code>.</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// flatMap to parse a string, which can result in Nothing
Function&lt;String, Kind&lt;MaybeKind.Witness, Integer&gt;&gt; parseString =
    s -&gt; {
      try {
        return MAYBE.just(Integer.parseInt(s));
      } catch (NumberFormatException e) {
        return MAYBE.nothing();
      }
    };
</code></pre>
<h3 id="optionalexamplejava"><a class="header" href="#optionalexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/optional/OptionalExample.java">OptionalExample.java</a></a></h3>
<p>This example introduces the <strong>Optional monad</strong>. It demonstrates how to wrap Java's <code>Optional</code> in a <code>Kind</code> to work with it in a monadic way, allowing for chaining of operations and explicit error handling.</p>
<ul>
<li><strong>Key Concept</strong>: The <code>Optional</code> monad provides a way to represent computations that may or may not return a value.</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Wrapping <code>Optional</code> instances into a <code>Kind&lt;OptionalKind.Witness, A&gt;</code>.</li>
<li>Using <code>map</code> to transform the value inside a present <code>Optional</code>.</li>
<li>Using <code>flatMap</code> to chain operations that return <code>Optional</code>.</li>
<li>Using <code>handleErrorWith</code> to provide a default value when the <code>Optional</code> is empty.</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// Using flatMap to parse a string to an integer, which may fail
Function&lt;String, Kind&lt;OptionalKind.Witness, Integer&gt;&gt; parseToIntKind =
    s -&gt; {
      try {
        return OPTIONAL.widen(Optional.of(Integer.parseInt(s)));
      } catch (NumberFormatException e) {
        return OPTIONAL.widen(Optional.empty());
      }
    };

Kind&lt;OptionalKind.Witness, Integer&gt; parsedPresent =
    optionalMonad.flatMap(parseToIntKind, presentInput);
</code></pre>
<h3 id="readerexamplejava"><a class="header" href="#readerexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/reader/ReaderExample.java">ReaderExample.java</a></a></h3>
<p>This example introduces the <strong>Reader monad</strong>. The <code>Reader</code> monad is a pattern used for dependency injection. It represents a computation that depends on some configuration or environment of type <code>R</code>.</p>
<ul>
<li><strong>Key Concept</strong>: A <code>Reader&lt;R, A&gt;</code> represents a function <code>R -&gt; A</code>. It allows you to "read" from a configuration <code>R</code> to produce a value <code>A</code>, without explicitly passing the configuration object everywhere.</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Creating <code>Reader</code> computations that access parts of a configuration object.</li>
<li>Using <code>flatMap</code> to chain computations where one step depends on the result of a previous step and the shared configuration.</li>
<li>Running the final <code>Reader</code> computation by providing a concrete configuration object.</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// A Reader that depends on the AppConfig environment
Kind&lt;ReaderKind.Witness&lt;AppConfig&gt;, String&gt; connectionStringReader =
    readerMonad.flatMap(
        dbUrl -&gt; READER.reader(config -&gt; dbUrl + "?apiKey=" + config.apiKey()),
        getDbUrl // Another Reader that gets the DB URL
    );

// The computation is only run when a config is provided
String connectionString = READER.runReader(connectionStringReader, productionConfig);
</code></pre>
<h3 id="stateexample-bankaccountworkflowjava"><a class="header" href="#stateexample-bankaccountworkflowjava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/state/StateExample.java">StateExample</a>, <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/state/BankAccountWorkflow.java">BankAccountWorkflow.java</a></a></h3>
<p>These examples demonstrate the <strong>State monad</strong>. The <code>State</code> monad is used to manage state in a purely functional way, abstracting away the boilerplate of passing state from one function to the next.</p>
<ul>
<li><strong>Key Concept</strong>: A <code>State&lt;S, A&gt;</code> represents a function <code>S -&gt; (S, A)</code>, which takes an initial state and returns a new state and a computed value. The monad chains these functions together.</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Creating stateful actions like <code>push</code>, <code>pop</code>, <code>deposit</code>, and <code>withdraw</code>.</li>
<li>Using <code>State.modify</code> to update the state and <code>State.inspect</code> to read from it.</li>
<li>Composing these actions into a larger workflow using a <code>For</code> comprehension.</li>
<li>Running the final computation with an initial state to get the final state and result.</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// A stateful action to withdraw money, returning a boolean success flag
public static Function&lt;BigDecimal, Kind&lt;StateKind.Witness&lt;AccountState&gt;, Boolean&gt;&gt; withdraw(String description) {
    return amount -&gt; STATE.widen(
        State.of(currentState -&gt; {
            if (currentState.balance().compareTo(amount) &gt;= 0) {
                // ... update state and return success
                return new StateTuple&lt;&gt;(true, updatedState);
            } else {
                // ... update state with rejection and return failure
                return new StateTuple&lt;&gt;(false, updatedState);
            }
        })
    );
}
</code></pre>
<h3 id="tryexamplejava"><a class="header" href="#tryexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/trymonad/TryExample.java">TryExample.java</a></a></h3>
<p>This example introduces the <strong>Try monad</strong>. It's designed to encapsulate computations that can throw exceptions, making error handling more explicit and functional.</p>
<ul>
<li><strong>Key Concept</strong>: A <code>Try</code> represents a computation that results in either a <code>Success</code> containing a value or a <code>Failure</code> containing an exception.</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Creating <code>Try</code> instances for successful and failed computations.</li>
<li>Using <code>map</code> and <code>flatMap</code> to chain operations, where exceptions are caught and wrapped in a <code>Failure</code>.</li>
<li>Using <code>recover</code> and <code>recoverWith</code> to handle failures and provide alternative values or computations.</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// A function that returns a Try, succeeding or failing based on the input
Function&lt;Integer, Try&lt;Double&gt;&gt; safeDivide =
    value -&gt;
        (value == 0)
            ? Try.failure(new ArithmeticException("Div by zero"))
            : Try.success(10.0 / value);

// flatMap chains the operation, propagating failure
Try&lt;Double&gt; result = input.flatMap(safeDivide);
</code></pre>
<h3 id="validatedmonadexamplejava"><a class="header" href="#validatedmonadexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/validated/ValidatedMonadExample.java">ValidatedMonadExample.java</a></a></h3>
<p>This example showcases the <strong>Validated applicative functor</strong>. While it has a <code>Monad</code> instance, it's often used as an <code>Applicative</code> to accumulate errors. This example, however, focuses on its monadic (fail-fast) behaviour.</p>
<ul>
<li><strong>Key Concept</strong>: <code>Validated</code> is used for validation scenarios where you want to either get a valid result or a collection of validation errors.</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Creating <code>Valid</code> and <code>Invalid</code> instances.</li>
<li>Using <code>flatMap</code> to chain validation steps, where the first <code>Invalid</code> result short-circuits the computation.</li>
<li>Using <code>handleErrorWith</code> to recover from a validation failure.</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// A validation function that returns a Kind-wrapped Validated
Function&lt;String, Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt;&gt; parseToIntKind =
    s -&gt; {
      try {
        return validatedMonad.of(Integer.parseInt(s)); // Lifts to Valid
      } catch (NumberFormatException e) {
        return validatedMonad.raiseError(Collections.singletonList("'" + s + "' is not a number."));
      }
    };
</code></pre>
<h3 id="writerexamplejava"><a class="header" href="#writerexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/writer/WriterExample.java">WriterExample.java</a></a></h3>
<p>This example introduces the <strong>Writer monad</strong>. The <code>Writer</code> monad is used for computations that need to produce a log or accumulate a secondary value alongside their primary result.</p>
<ul>
<li><strong>Key Concept</strong>: A <code>Writer&lt;W, A&gt;</code> represents a computation that returns a primary result <code>A</code> and an accumulated value <code>W</code> (like a log), where <code>W</code> must have a <code>Monoid</code> instance to define how values are combined.</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Using <code>tell</code> to append to the log.</li>
<li>Using <code>flatMap</code> to sequence computations, where both the results and logs are combined automatically.</li>
<li>Running the final <code>Writer</code> to extract both the final value and the fully accumulated log.</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// An action that performs a calculation and logs what it did
Function&lt;Integer, Kind&lt;WriterKind.Witness&lt;String&gt;, Integer&gt;&gt; addAndLog =
    x -&gt; {
      int result = x + 10;
      String logMsg = "Added 10 to " + x + " -&gt; " + result + "; ";
      return WRITER.widen(new Writer&lt;&gt;(logMsg, result));
    };

// The monad combines the logs from each step automatically
Kind&lt;WriterKind.Witness&lt;String&gt;, String&gt; finalComputation = writerMonad.flatMap(
    intermediateValue -&gt; multiplyAndLogToString.apply(intermediateValue),
    addAndLog.apply(5)
);
</code></pre>
<h3 id="genericexamplejava"><a class="header" href="#genericexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/GenericExample.java">GenericExample.java</a></a></h3>
<p>This example showcases how to write <strong>generic functions</strong> that can operate on any <code>Functor</code> (or <code>Monad</code>) by accepting the type class instance as a parameter. This is a core concept of higher-kinded polymorphism.</p>
<ul>
<li><strong>Key Concept</strong>: By abstracting over the computational context (<code>F</code>), you can write code that works for <code>List</code>, <code>Optional</code>, <code>IO</code>, or any other type that has a <code>Functor</code> instance.</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Writing a generic <code>mapWithFunctor</code> function that takes a <code>Functor&lt;F&gt;</code> instance and a <code>Kind&lt;F, A&gt;</code>.</li>
<li>Calling this generic function with different monad instances (<code>ListMonad</code>, <code>OptionalMonad</code>) and their corresponding <code>Kind</code>-wrapped types.</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// A generic function that works for any Functor F
public static &lt;F, A, B&gt; Kind&lt;F, B&gt; mapWithFunctor(
    Functor&lt;F&gt; functorInstance, // The type class instance
    Function&lt;A, B&gt; fn,
    Kind&lt;F, A&gt; kindBox) { // The value in its context
    return functorInstance.map(fn, kindBox);
}

// Calling it with a List
Kind&lt;ListKind.Witness, Integer&gt; doubledList = mapWithFunctor(listMonad, doubleFn, listKind);

// Calling it with an Optional
Kind&lt;OptionalKind.Witness, Integer&gt; doubledOpt = mapWithFunctor(optionalMonad, doubleFn, optKind);
</code></pre>
<h3 id="profunctorexamplejava"><a class="header" href="#profunctorexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/profunctor/ProfunctorExample.java">ProfunctorExample.java</a></a></h3>
<p>This example demonstrates the <strong>Profunctor</strong> type class using <code>FunctionProfunctor</code>. It shows how to build flexible, adaptable data transformation pipelines.</p>
<ul>
<li><strong>Key Concept</strong>: A <code>Profunctor</code> is contravariant in its first parameter and covariant in its second, making it perfect for adapting both the input and output of functions.</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Using <code>lmap</code> to adapt function inputs (contravariant mapping)</li>
<li>Using <code>rmap</code> to adapt function outputs (covariant mapping)</li>
<li>Using <code>dimap</code> to adapt both input and output simultaneously</li>
<li>Building real-world API adapters and validation pipelines</li>
<li>Creating reusable transformation chains</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// Original function: String length calculator
Function&lt;String, Integer&gt; stringLength = String::length;

// Adapt the input: now works with integers!
Kind2&lt;FunctionKind.Witness, Integer, Integer&gt; intToLength =
    profunctor.lmap(Object::toString, lengthFunction);

// Adapt the output: now returns formatted strings!
Kind2&lt;FunctionKind.Witness, String, String&gt; lengthToString =
    profunctor.rmap(len -&gt; "Length: " + len, lengthFunction);

// Adapt both input and output in one operation
Kind2&lt;FunctionKind.Witness, Integer, String&gt; fullTransform =
    profunctor.dimap(Object::toString, len -&gt; "Result: " + len, lengthFunction);
</code></pre>
<hr />
<h2 id="monad-transformers"><a class="header" href="#monad-transformers">Monad Transformers</a></h2>
<p>These examples show how to use <strong>monad transformers</strong> (<code>EitherT</code>, <code>MaybeT</code>, <code>OptionalT</code>, <code>ReaderT</code>, <code>StateT</code>) to combine the capabilities of different monads.</p>
<h3 id="eithertexamplejava"><a class="header" href="#eithertexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/either_t/EitherTExample.java">EitherTExample.java</a></a></h3>
<ul>
<li><strong>Key Concept</strong>: <code>EitherT</code> stacks the <code>Either</code> monad on top of another monad <code>F</code>, creating a new monad <code>EitherT&lt;F, L, R&gt;</code> that handles both the effects of <code>F</code> and the failure logic of <code>Either</code>.</li>
<li><strong>Scenario</strong>: Composing synchronous validation (<code>Either</code>) with an asynchronous operation (<code>CompletableFuture</code>) in a single, clean workflow.</li>
</ul>
<h3 id="maybetexamplejava"><a class="header" href="#maybetexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/maybe_t/MaybeTExample.java">MaybeTExample.java</a></a></h3>
<ul>
<li><strong>Key Concept</strong>: <code>MaybeT</code> stacks the <code>Maybe</code> monad on top of another monad <code>F</code>. This is useful for asynchronous operations that may not return a value.</li>
<li><strong>Scenario</strong>: Fetching a user and their preferences from a database asynchronously, where each step might not find a result.</li>
</ul>
<h3 id="optionaltexamplejava"><a class="header" href="#optionaltexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/optional_t/OptionalTExample.java">OptionalTExample.java</a></a></h3>
<ul>
<li><strong>Key Concept</strong>: <code>OptionalT</code> stacks <code>Optional</code> on top of another monad <code>F</code>, creating <code>OptionalT&lt;F, A&gt;</code> to handle asynchronous operations that may return an empty result.</li>
<li><strong>Scenario</strong>: Fetching a user and their preferences from a database asynchronously, where each step might not find a result.</li>
</ul>
<h3 id="readertexamplejava-readertunitexamplejava--readertasyncunitexamplejava"><a class="header" href="#readertexamplejava-readertunitexamplejava--readertasyncunitexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/reader_t/ReaderTExample.java">ReaderTExample.java</a>, <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/reader_t/ReaderTAsyncExample.java">ReaderTUnitExample.java</a>,  <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/reader_t/ReaderTAsyncUnitExample.java">ReaderTAsyncUnitExample.java</a></a></h3>
<ul>
<li><strong>Key Concept</strong>: <code>ReaderT</code> combines the <code>Reader</code> monad (for dependency injection) with an outer monad <code>F</code>. This allows for computations that both read from a shared environment and have effects of type <code>F</code>.</li>
<li><strong>Scenario</strong>: An asynchronous workflow that depends on a configuration object (<code>AppConfig</code>) to fetch and process data.</li>
</ul>
<h3 id="statetexamplejava-statetstackexample"><a class="header" href="#statetexamplejava-statetstackexample"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/state_t/StateTExample.java">StateTExample.java</a>, <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/state_t/StateTStackExample.java">StateTStackExample</a></a></h3>
<ul>
<li><strong>Key Concept</strong>: <code>StateT</code> combines the <code>State</code> monad with an outer monad <code>F</code>. This is for stateful computations that also involve effects from <code>F</code>.</li>
<li><strong>Scenario</strong>: A stateful stack that can fail (using <code>Optional</code> as the outer monad), where popping from an empty stack results in <code>Optional.empty()</code>.</li>
</ul>
<pre><code></code></pre>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="quick-reference-guide"><a class="header" href="#quick-reference-guide">Quick Reference Guide</a></h1>
<p>This section provides at-a-glance summaries of all type classes in Higher-Kinded-J. Use this as a quick lookup while coding or to compare different type classes.</p>
<h2 id="core-type-classes"><a class="header" href="#core-type-classes">Core Type Classes</a></h2>
<h3 id="functor"><a class="header" href="#functor">Functor</a></h3>
<div id="admonition-functor-quick-reference" class="admonition admonish-tip" role="note" aria-labelledby="admonition-functor-quick-reference-title">
<div class="admonition-title">
<div id="admonition-functor-quick-reference-title">
<p>Functor Quick Reference</p>
</div>
<a class="admonition-anchor-link" href="hkts/quick_reference.html#admonition-functor-quick-reference"></a>
</div>
<div>
<p><strong>Core Method:</strong> <code>map(Function&lt;A,B&gt; f, Kind&lt;F,A&gt; fa) -&gt; Kind&lt;F,B&gt;</code></p>
<p><strong>Purpose:</strong> Transform values inside a context without changing the context structure</p>
<p><strong>Use When:</strong></p>
<ul>
<li>You have a simple transformation function <code>A -&gt; B</code></li>
<li>The context/container should remain unchanged</li>
<li>No dependency between input and output contexts</li>
</ul>
<p><strong>Laws:</strong></p>
<ul>
<li>Identity: <code>map(identity) == identity</code></li>
<li>Composition: <code>map(g ‚àò f) == map(g) ‚àò map(f)</code></li>
</ul>
<p><strong>Common Instances:</strong> List, Optional, Maybe, Either, IO, CompletableFuture</p>
<p><strong>Example:</strong></p>
<pre><code class="language-java">// Transform string to length, preserving Optional context
Kind&lt;OptionalKind.Witness, Integer&gt; lengths = 
    optionalFunctor.map(String::length, optionalString);
</code></pre>
<p><strong>Think Of It As:</strong> Applying a function "inside the box" without opening it</p>
</div>
</div>
<h3 id="applicative"><a class="header" href="#applicative">Applicative</a></h3>
<div id="admonition-applicative-quick-reference" class="admonition admonish-tip" role="note" aria-labelledby="admonition-applicative-quick-reference-title">
<div class="admonition-title">
<div id="admonition-applicative-quick-reference-title">
<p>Applicative Quick Reference</p>
</div>
<a class="admonition-anchor-link" href="hkts/quick_reference.html#admonition-applicative-quick-reference"></a>
</div>
<div>
<p><strong>Core Methods:</strong></p>
<ul>
<li><code>of(A value) -&gt; Kind&lt;F,A&gt;</code> (lift pure value)</li>
<li><code>ap(Kind&lt;F,Function&lt;A,B&gt;&gt; ff, Kind&lt;F,A&gt; fa) -&gt; Kind&lt;F,B&gt;</code> (apply wrapped function)</li>
</ul>
<p><strong>Purpose:</strong> Combine independent computations within a context</p>
<p><strong>Use When:</strong></p>
<ul>
<li>You need to combine multiple wrapped values</li>
<li>Operations are independent (don't depend on each other's results)</li>
<li>You want to accumulate errors from multiple validations</li>
</ul>
<p><strong>Key Insight:</strong> <code>map2</code>, <code>map3</code>, etc. are built on <code>ap</code> for combining 2, 3, or more values</p>
<p><strong>Laws:</strong> Identity, Composition, Homomorphism, Interchange</p>
<p><strong>Common Patterns:</strong></p>
<ul>
<li>Form validation (collect all errors)</li>
<li>Combining configuration values</li>
<li>Parallel computations</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-java">// Combine two independent validations
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, User&gt; user = 
    applicative.map2(
        validateUsername(input.username()),
        validatePassword(input.password()),
        User::new
    );
</code></pre>
<p><strong>Think Of It As:</strong> Combining multiple "boxes" when contents are independent</p>
</div>
</div>
<h3 id="monad"><a class="header" href="#monad">Monad</a></h3>
<div id="admonition-monad-quick-reference" class="admonition admonish-tip" role="note" aria-labelledby="admonition-monad-quick-reference-title">
<div class="admonition-title">
<div id="admonition-monad-quick-reference-title">
<p>Monad Quick Reference</p>
</div>
<a class="admonition-anchor-link" href="hkts/quick_reference.html#admonition-monad-quick-reference"></a>
</div>
<div>
<p><strong>Core Method:</strong> <code>flatMap(Function&lt;A,Kind&lt;F,B&gt;&gt; f, Kind&lt;F,A&gt; fa) -&gt; Kind&lt;F,B&gt;</code></p>
<p><strong>Purpose:</strong> Sequence dependent computations within a context</p>
<p><strong>Use When:</strong></p>
<ul>
<li>Each step depends on the result of the previous step</li>
<li>You need to chain operations that return wrapped values</li>
<li>You want short-circuiting behaviour on failure</li>
</ul>
<p><strong>Key Difference from Applicative:</strong> Operations are sequential and dependent</p>
<p><strong>Laws:</strong></p>
<ul>
<li>Left Identity: <code>flatMap(f, of(a)) == f(a)</code></li>
<li>Right Identity: <code>flatMap(of, m) == m</code></li>
<li>Associativity: <code>flatMap(g, flatMap(f, m)) == flatMap(x -&gt; flatMap(g, f(x)), m)</code></li>
</ul>
<p><strong>Utility Methods:</strong></p>
<ul>
<li><code>as(B value, Kind&lt;F,A&gt; fa)</code> - replace value, keep effect</li>
<li><code>peek(Consumer&lt;A&gt; action, Kind&lt;F,A&gt; fa)</code> - side effect without changing value</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-java">// Chain database operations where each depends on the previous
Kind&lt;OptionalKind.Witness, Account&gt; account = 
    monad.flatMap(user -&gt; 
        monad.flatMap(profile -&gt; 
            findAccount(profile.accountId()),
            findProfile(user.id())),
        findUser(userId));
</code></pre>
<p><strong>Think Of It As:</strong> Chaining operations where each "opens the box" and "puts result in new box"</p>
</div>
</div>
<h3 id="monaderror"><a class="header" href="#monaderror">MonadError</a></h3>
<div id="admonition-monaderror-quick-reference" class="admonition admonish-tip" role="note" aria-labelledby="admonition-monaderror-quick-reference-title">
<div class="admonition-title">
<div id="admonition-monaderror-quick-reference-title">
<p>MonadError Quick Reference</p>
</div>
<a class="admonition-anchor-link" href="hkts/quick_reference.html#admonition-monaderror-quick-reference"></a>
</div>
<div>
<p><strong>Core Methods:</strong></p>
<ul>
<li><code>raiseError(E error) -&gt; Kind&lt;F,A&gt;</code> (create error state)</li>
<li><code>handleErrorWith(Kind&lt;F,A&gt; fa, Function&lt;E,Kind&lt;F,A&gt;&gt; handler) -&gt; Kind&lt;F,A&gt;</code> (recover from error)</li>
</ul>
<p><strong>Purpose:</strong> Add explicit error handling to monadic computations</p>
<p><strong>Use When:</strong></p>
<ul>
<li>You need to handle specific error types</li>
<li>You want to recover from failures in a workflow</li>
<li>You need to distinguish between different kinds of failures</li>
</ul>
<p><strong>Key Insight:</strong> Error type <code>E</code> is fixed for each MonadError instance</p>
<p><strong>Common Error Types:</strong></p>
<ul>
<li><code>Throwable</code> for CompletableFuture</li>
<li><code>Unit</code> for Optional/Maybe (absence as error)</li>
<li>Custom domain error types for Either/Validated</li>
</ul>
<p><strong>Recovery Methods:</strong></p>
<ul>
<li><code>handleError(fa, Function&lt;E,A&gt; handler)</code> - recover to pure value</li>
<li><code>recover(fa, A defaultValue)</code> - provide default value</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-java">// Handle division by zero gracefully
Kind&lt;EitherKind.Witness&lt;String&gt;, Double&gt; result = 
    monadError.handleErrorWith(
        divideOperation,
        error -&gt; monadError.of(0.0) // recover with default
    );
</code></pre>
<p><strong>Think Of It As:</strong> try-catch for functional programming</p>
</div>
</div>
<h2 id="data-combination-type-classes"><a class="header" href="#data-combination-type-classes">Data Combination Type Classes</a></h2>
<h3 id="semigroup"><a class="header" href="#semigroup">Semigroup</a></h3>
<div id="admonition-semigroup-quick-reference" class="admonition admonish-tip" role="note" aria-labelledby="admonition-semigroup-quick-reference-title">
<div class="admonition-title">
<div id="admonition-semigroup-quick-reference-title">
<p>Semigroup Quick Reference</p>
</div>
<a class="admonition-anchor-link" href="hkts/quick_reference.html#admonition-semigroup-quick-reference"></a>
</div>
<div>
<p><strong>Core Method:</strong> <code>combine(A a1, A a2) -&gt; A</code></p>
<p><strong>Purpose:</strong> Types that can be combined associatively</p>
<p><strong>Key Property:</strong> Associativity - <code>combine(a, combine(b, c)) == combine(combine(a, b), c)</code></p>
<p><strong>Use When:</strong></p>
<ul>
<li>You need to combine/merge two values of the same type</li>
<li>Order of combination doesn't matter (due to associativity)</li>
<li>Building blocks for parallel processing</li>
</ul>
<p><strong>Common Instances:</strong></p>
<ul>
<li>String concatenation: <code>"a" + "b" + "c"</code></li>
<li>Integer addition: <code>1 + 2 + 3</code></li>
<li>List concatenation: <code>[1,2] + [3,4] + [5,6]</code></li>
<li>Set union: <code>{1,2} ‚à™ {2,3} ‚à™ {3,4}</code></li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-java">// Combine error messages
Semigroup&lt;String&gt; stringConcat = Semigroups.string("; ");
String combined = stringConcat.combine("Error 1", "Error 2");
// Result: "Error 1; Error 2"
</code></pre>
<p><strong>Think Of It As:</strong> The <code>+</code> operator generalised to any type</p>
</div>
</div>
<h3 id="monoid"><a class="header" href="#monoid">Monoid</a></h3>
<div id="admonition-monoid-quick-reference" class="admonition admonish-tip" role="note" aria-labelledby="admonition-monoid-quick-reference-title">
<div class="admonition-title">
<div id="admonition-monoid-quick-reference-title">
<p>Monoid Quick Reference</p>
</div>
<a class="admonition-anchor-link" href="hkts/quick_reference.html#admonition-monoid-quick-reference"></a>
</div>
<div>
<p><strong>Core Methods:</strong></p>
<ul>
<li><code>combine(A a1, A a2) -&gt; A</code> (from Semigroup)</li>
<li><code>empty() -&gt; A</code> (identity element)</li>
</ul>
<p><strong>Purpose:</strong> Semigroups with an identity/neutral element</p>
<p><strong>Key Properties:</strong></p>
<ul>
<li>Associativity (from Semigroup)</li>
<li>Identity: <code>combine(a, empty()) == combine(empty(), a) == a</code></li>
</ul>
<p><strong>Use When:</strong></p>
<ul>
<li>You need a starting value for reductions/folds</li>
<li>Implementing fold operations over data structures</li>
<li>You might be combining zero elements</li>
</ul>
<p><strong>Common Instances:</strong></p>
<ul>
<li>String: empty = <code>""</code>, combine = concatenation</li>
<li>Integer addition: empty = <code>0</code>, combine = <code>+</code></li>
<li>Integer multiplication: empty = <code>1</code>, combine = <code>*</code></li>
<li>List: empty = <code>[]</code>, combine = concatenation</li>
<li>Boolean AND: empty = <code>true</code>, combine = <code>&amp;&amp;</code></li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-java">// Sum a list using integer addition monoid
Integer sum = listFoldable.foldMap(
    Monoids.integerAddition(),
    Function.identity(),
    numbersList
);
</code></pre>
<p><strong>Think Of It As:</strong> Semigroup + a "starting point" for combinations</p>
</div>
</div>
<h2 id="structure-iterating-type-classes"><a class="header" href="#structure-iterating-type-classes">Structure-Iterating Type Classes</a></h2>
<h3 id="foldable"><a class="header" href="#foldable">Foldable</a></h3>
<div id="admonition-foldable-quick-reference" class="admonition admonish-tip" role="note" aria-labelledby="admonition-foldable-quick-reference-title">
<div class="admonition-title">
<div id="admonition-foldable-quick-reference-title">
<p>Foldable Quick Reference</p>
</div>
<a class="admonition-anchor-link" href="hkts/quick_reference.html#admonition-foldable-quick-reference"></a>
</div>
<div>
<p><strong>Core Method:</strong> <code>foldMap(Monoid&lt;M&gt; monoid, Function&lt;A,M&gt; f, Kind&lt;F,A&gt; fa) -&gt; M</code></p>
<p><strong>Purpose:</strong> Reduce a data structure to a single summary value</p>
<p><strong>Use When:</strong></p>
<ul>
<li>You want to aggregate/summarise data in a structure</li>
<li>You need different types of reductions (sum, concat, any/all, etc.)</li>
<li>You want to count, find totals, or collapse collections</li>
</ul>
<p><strong>Key Insight:</strong> Different Monoids give different aggregations from same data</p>
<p><strong>Common Operations:</strong></p>
<ul>
<li>Sum numbers: use integer addition monoid</li>
<li>Concatenate strings: use string monoid</li>
<li>Check all conditions: use boolean AND monoid</li>
<li>Count elements: map to 1, use integer addition monoid</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-java">// Multiple aggregations of the same list
List&lt;Integer&gt; numbers = List.of(1, 2, 3, 4, 5);

// Sum
Integer sum = foldable.foldMap(Monoids.integerAddition(), 
    Function.identity(), numbers); // 15

// Concatenate as strings  
String concat = foldable.foldMap(Monoids.string(), 
    String::valueOf, numbers); // "12345"

// Check all positive
Boolean allPositive = foldable.foldMap(Monoids.booleanAnd(), 
    n -&gt; n &gt; 0, numbers); // true
</code></pre>
<p><strong>Think Of It As:</strong> Swiss Army knife for data aggregation</p>
</div>
</div>
<h3 id="traverse"><a class="header" href="#traverse">Traverse</a></h3>
<div id="admonition-traverse-quick-reference" class="admonition admonish-tip" role="note" aria-labelledby="admonition-traverse-quick-reference-title">
<div class="admonition-title">
<div id="admonition-traverse-quick-reference-title">
<p>Traverse Quick Reference</p>
</div>
<a class="admonition-anchor-link" href="hkts/quick_reference.html#admonition-traverse-quick-reference"></a>
</div>
<div>
<p><strong>Core Method:</strong> <code>traverse(Applicative&lt;G&gt; app, Function&lt;A,Kind&lt;G,B&gt;&gt; f, Kind&lt;F,A&gt; fa) -&gt; Kind&lt;G,Kind&lt;F,B&gt;&gt;</code></p>
<p><strong>Purpose:</strong> Apply an effectful function to each element and "flip" the contexts</p>
<p><strong>Use When:</strong></p>
<ul>
<li>You have a collection and want to apply an effect to each element</li>
<li>You want to validate every item and collect all errors</li>
<li>You need to "turn inside-out": <code>F&lt;G&lt;A&gt;&gt;</code> becomes <code>G&lt;F&lt;A&gt;&gt;</code></li>
</ul>
<p><strong>Key Operations:</strong></p>
<ul>
<li><code>traverse</code>: apply function then flip</li>
<li><code>sequence</code>: just flip contexts (when you already have <code>F&lt;G&lt;A&gt;&gt;</code>)</li>
</ul>
<p><strong>Common Patterns:</strong></p>
<ul>
<li>Validate every item in a list</li>
<li>Make async calls for each element</li>
<li>Parse/process each item, collecting all failures</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-java">// Validate every string in a list, collect all errors
List&lt;String&gt; inputs = List.of("123", "abc", "456");

Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Kind&lt;ListKind.Witness, Integer&gt;&gt; result =
    listTraverse.traverse(
        validatedApplicative,
        this::parseInteger, // String -&gt; Validated&lt;List&lt;String&gt;, Integer&gt;
        LIST.widen(inputs)
    );

// Result: either Valid(List[123, 456]) or Invalid(["abc is not a number"])
</code></pre>
<p><strong>Think Of It As:</strong> Applying effects to collections while flipping the "nesting order"</p>
</div>
</div>
<h2 id="dual-parameter-type-classes"><a class="header" href="#dual-parameter-type-classes">Dual-Parameter Type Classes</a></h2>
<h3 id="profunctor"><a class="header" href="#profunctor">Profunctor</a></h3>
<div id="admonition-profunctor-quick-reference" class="admonition admonish-tip" role="note" aria-labelledby="admonition-profunctor-quick-reference-title">
<div class="admonition-title">
<div id="admonition-profunctor-quick-reference-title">
<p>Profunctor Quick Reference</p>
</div>
<a class="admonition-anchor-link" href="hkts/quick_reference.html#admonition-profunctor-quick-reference"></a>
</div>
<div>
<p><strong>Core Methods:</strong></p>
<ul>
<li><code>lmap(Function&lt;C,A&gt; f, Kind2&lt;P,A,B&gt; pab) -&gt; Kind2&lt;P,C,B&gt;</code> (contravariant on input)</li>
<li><code>rmap(Function&lt;B,D&gt; g, Kind2&lt;P,A,B&gt; pab) -&gt; Kind2&lt;P,A,D&gt;</code> (covariant on output)</li>
<li><code>dimap(Function&lt;C,A&gt; f, Function&lt;B,D&gt; g, Kind2&lt;P,A,B&gt; pab) -&gt; Kind2&lt;P,C,D&gt;</code> (both)</li>
</ul>
<p><strong>Purpose:</strong> Adapt inputs and outputs of two-parameter types (especially functions)</p>
<p><strong>Use When:</strong></p>
<ul>
<li>Building flexible data transformation pipelines</li>
<li>Creating API adapters that convert between different formats</li>
<li>You need to preprocess inputs or postprocess outputs</li>
<li>Building reusable validation or transformation logic</li>
</ul>
<p><strong>Key Insight:</strong></p>
<ul>
<li><code>lmap</code> = preprocess the input (contravariant)</li>
<li><code>rmap</code> = postprocess the output (covariant)</li>
<li><code>dimap</code> = do both transformations</li>
</ul>
<p><strong>Common Instance:</strong> <code>Function&lt;A,B&gt;</code> is the canonical Profunctor</p>
<p><strong>Example:</strong></p>
<pre><code class="language-java">// Adapt a string length function to work with integers and return formatted strings
Function&lt;String, Integer&gt; stringLength = String::length;

// Input adaptation: Integer -&gt; String  
Kind2&lt;FunctionKind.Witness, Integer, Integer&gt; intToLength = 
    profunctor.lmap(Object::toString, FUNCTION.widen(stringLength));

// Output adaptation: Integer -&gt; String
Kind2&lt;FunctionKind.Witness, String, String&gt; lengthToString = 
    profunctor.rmap(len -&gt; "Length: " + len, FUNCTION.widen(stringLength));

// Both adaptations
Kind2&lt;FunctionKind.Witness, Integer, String&gt; fullAdaptation = 
    profunctor.dimap(Object::toString, len -&gt; "Result: " + len, 
        FUNCTION.widen(stringLength));
</code></pre>
<p><strong>Think Of It As:</strong> The adapter pattern for functional programming</p>
</div>
</div>
<h2 id="decision-guide"><a class="header" href="#decision-guide">Decision Guide</a></h2>
<div id="admonition-choosing-the-right-type-class" class="admonition admonish-warning" role="note" aria-labelledby="admonition-choosing-the-right-type-class-title">
<div class="admonition-title">
<div id="admonition-choosing-the-right-type-class-title">
<p>Choosing the Right Type Class</p>
</div>
<a class="admonition-anchor-link" href="hkts/quick_reference.html#admonition-choosing-the-right-type-class"></a>
</div>
<div>
<p><strong>Start Simple, Go Complex:</strong></p>
<ol>
<li><strong>Functor</strong> - Simple transformations, context unchanged</li>
<li><strong>Applicative</strong> - Combine independent computations</li>
<li><strong>Monad</strong> - Chain dependent computations</li>
<li><strong>MonadError</strong> - Add error handling to Monad</li>
<li><strong>Traverse</strong> - Apply effects to collections</li>
<li><strong>Profunctor</strong> - Adapt inputs/outputs of functions</li>
</ol>
<p><strong>Decision Tree:</strong></p>
<ul>
<li>Need to transform values? ‚Üí <strong>Functor</strong></li>
<li>Need to combine independent operations? ‚Üí <strong>Applicative</strong></li>
<li>Need sequential dependent operations? ‚Üí <strong>Monad</strong></li>
<li>Need error recovery? ‚Üí <strong>MonadError</strong></li>
<li>Need to process collections with effects? ‚Üí <strong>Traverse</strong></li>
<li>Need to adapt function interfaces? ‚Üí <strong>Profunctor</strong></li>
<li>Need to aggregate/summarise data? ‚Üí <strong>Foldable</strong></li>
<li>Need to combine values? ‚Üí <strong>Semigroup/Monoid</strong></li>
</ul>
<p><strong>Common Patterns:</strong></p>
<ul>
<li><strong>Form validation:</strong> Applicative (independent fields) or Traverse (list of fields)</li>
<li><strong>Database operations:</strong> Monad (dependent queries) + MonadError (failure handling)</li>
<li><strong>API integration:</strong> Profunctor (adapt formats) + Monad (chain calls)</li>
<li><strong>Configuration:</strong> Applicative (combine settings) + Reader (dependency injection)</li>
<li><strong>Logging:</strong> Writer (accumulate logs) + Monad (sequence operations)</li>
<li><strong>State management:</strong> State/StateT (thread state) + Monad (sequence updates)</li>
</ul>
</div>
</div>
<h2 id="type-hierarchy"><a class="header" href="#type-hierarchy">Type Hierarchy</a></h2>
<div id="admonition-type-class-relationships" class="admonition admonish-info" role="note" aria-labelledby="admonition-type-class-relationships-title">
<div class="admonition-title">
<div id="admonition-type-class-relationships-title">
<p>Type Class Relationships</p>
</div>
<a class="admonition-anchor-link" href="hkts/quick_reference.html#admonition-type-class-relationships"></a>
</div>
<div>
<pre><code>Functor
    ‚Üë
Applicative ‚Üê Apply
    ‚Üë
   Monad
    ‚Üë
MonadError

Semigroup
    ‚Üë
  Monoid

Functor + Foldable
    ‚Üë
 Traverse

(Two-parameter types)
Profunctor
</code></pre>
<p><strong>Inheritance Meaning:</strong></p>
<ul>
<li>Every <strong>Applicative</strong> is also a <strong>Functor</strong></li>
<li>Every <strong>Monad</strong> is also an <strong>Applicative</strong> (and therefore a <strong>Functor</strong>)</li>
<li>Every <strong>MonadError</strong> is also a <strong>Monad</strong> (and therefore <strong>Applicative</strong> and <strong>Functor</strong>)</li>
<li>Every <strong>Monoid</strong> is also a <strong>Semigroup</strong></li>
<li>Every <strong>Traverse</strong> provides both <strong>Functor</strong> and <strong>Foldable</strong> capabilities</li>
</ul>
<p><strong>Practical Implication:</strong> If you have a <code>Monad&lt;F&gt;</code> instance, you can also use it as a <code>Functor&lt;F&gt;</code> or <code>Applicative&lt;F&gt;</code>.</p>
</div>
</div>
<h2 id="common-monoid-instances"><a class="header" href="#common-monoid-instances">Common Monoid Instances</a></h2>
<div id="admonition-ready-to-use-monoids" class="admonition admonish-note" role="note" aria-labelledby="admonition-ready-to-use-monoids-title">
<div class="admonition-title">
<div id="admonition-ready-to-use-monoids-title">
<p>Ready-to-Use Monoids</p>
</div>
<a class="admonition-anchor-link" href="hkts/quick_reference.html#admonition-ready-to-use-monoids"></a>
</div>
<div>
<p><strong>Numeric:</strong></p>
<ul>
<li><code>Monoids.integerAddition()</code> - sum integers (empty = 0)</li>
<li><code>Monoids.integerMultiplication()</code> - multiply integers (empty = 1)</li>
</ul>
<p><strong>Text:</strong></p>
<ul>
<li><code>Monoids.string()</code> - concatenate strings (empty = "")</li>
<li><code>Monoids.string(delimiter)</code> - join with delimiter</li>
</ul>
<p><strong>Boolean:</strong></p>
<ul>
<li><code>Monoids.booleanAnd()</code> - logical AND (empty = true)</li>
<li><code>Monoids.booleanOr()</code> - logical OR (empty = false)</li>
</ul>
<p><strong>Collections:</strong></p>
<ul>
<li><code>Monoids.list()</code> - concatenate lists (empty = [])</li>
</ul>
<p><strong>Custom:</strong></p>
<pre><code class="language-java">// Create your own monoid
Monoid&lt;MyType&gt; myMonoid = new Monoid&lt;MyType&gt;() {
    public MyType empty() { return MyType.defaultValue(); }
    public MyType combine(MyType a, MyType b) { return a.mergeWith(b); }
};
</code></pre>
</div>
</div>
<h2 id="performance-notes"><a class="header" href="#performance-notes">Performance Notes</a></h2>
<div id="admonition-performance-considerations" class="admonition admonish-warning" role="note" aria-labelledby="admonition-performance-considerations-title">
<div class="admonition-title">
<div id="admonition-performance-considerations-title">
<p>Performance Considerations</p>
</div>
<a class="admonition-anchor-link" href="hkts/quick_reference.html#admonition-performance-considerations"></a>
</div>
<div>
<p><strong>When to Use HKT vs Direct Methods:</strong></p>
<p><strong>Use HKT When:</strong></p>
<ul>
<li>Writing generic code that works with multiple container types</li>
<li>Building complex workflows with multiple type classes</li>
<li>You need the power of type class composition</li>
</ul>
<p><strong>Use Direct Methods When:</strong></p>
<ul>
<li>Simple, one-off transformations</li>
<li>Performance-critical hot paths</li>
<li>Working with a single, known container type</li>
</ul>
<p><strong>Examples:</strong></p>
<pre><code class="language-java">// Hot path - use direct method
Optional&lt;String&gt; result = optional.map(String::toUpperCase);

// Generic reusable code - use HKT
public static &lt;F&gt; Kind&lt;F, String&gt; normalise(Functor&lt;F&gt; functor, Kind&lt;F, String&gt; input) {
    return functor.map(String::toUpperCase, input);
}
</code></pre>
<p><strong>Memory:</strong> HKT simulation adds minimal overhead (single wrapper object per operation)
<strong>CPU:</strong> Direct method calls vs type class method calls are comparable in modern JVMs</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="extending-higher-kinded-type-simulation"><a class="header" href="#extending-higher-kinded-type-simulation">Extending Higher Kinded Type Simulation</a></h1>
<p><img src="hkts/../images/extending-crane.png" alt="extending-crane.png" /></p>
<p>You can add support for new Java types (type constructors) to the Higher-Kinded-J simulation framework, allowing them to be used with type classes like <code>Functor</code>, <code>Monad</code>, etc.</p>
<p>There are two main scenarios:</p>
<ol>
<li><strong>Adapting External Types</strong>: For types you don't own (e.g., JDK classes like <code>java.util.Set</code>, <code>java.util.Map</code>, or classes from other libraries).</li>
<li><strong>Integrating Custom Library Types</strong>: For types defined within your own project or a library you control, where you can modify the type itself.</li>
</ol>
<p>The core pattern involves creating:</p>
<ul>
<li>An <code>XxxKind</code> interface with a nested <code>Witness</code> type (this remains the same).</li>
<li>An <code>XxxConverterOps</code> interface defining the <code>widen</code> and <code>narrow</code> operations for the specific type.</li>
<li>An <code>XxxKindHelper</code><strong>enum</strong> that implements <code>XxxConverterOps</code> and provides a singleton instance (e.g., <code>SET</code>, <code>MY_TYPE</code>) for accessing these operations as instance methods.</li>
<li>Type class instances (e.g., for <code>Functor</code>, <code>Monad</code>).</li>
</ul>
<p>For external types, an additional <code>XxxHolder</code> record is typically used internally by the helper enum to wrap the external type.</p>
<h2 id="scenario-1-adapting-an-external-type-eg-javautilseta"><a class="header" href="#scenario-1-adapting-an-external-type-eg-javautilseta">Scenario 1: Adapting an External Type (e.g., <code>java.util.Set&lt;A&gt;</code>)</a></h2>
<p>Since we cannot modify <code>java.util.Set</code> to directly implement our <code>Kind</code> structure, we need a wrapper (a <code>Holder</code>).</p>
<p><strong>Goal:</strong> Simulate <code>java.util.Set&lt;A&gt;</code> as <code>Kind&lt;SetKind.Witness, A&gt;</code> and provide <code>Functor</code>, <code>Applicative</code>, and <code>Monad</code> instances for it.</p>
<div id="admonition-note" class="admonition admonish-note" role="note" aria-labelledby="admonition-note-title">
<div class="admonition-title">
<div id="admonition-note-title">
<p>Note</p>
</div>
<a class="admonition-anchor-link" href="hkts/extending-simulation.html#admonition-note"></a>
</div>
<div>
<ol>
<li>
<p><strong>Create the <code>Kind</code> Interface with Witness (<code>SetKind.java</code>)</strong>:</p>
<ul>
<li>Define a marker interface that extends <code>Kind&lt;SetKind.Witness, A&gt;</code>.</li>
<li>Inside this interface, define a <code>static final class Witness {}</code> which will serve as the phantom type <code>F</code> for <code>Set</code>.</li>
</ul>
<pre><code class="language-java">package org.higherkindedj.hkt.set; // Example package

import org.higherkindedj.hkt.Kind;
import org.jspecify.annotations.NullMarked;

/**
 * Kind interface marker for java.util.Set&lt;A&gt;.
 * The Witness type F = SetKind.Witness
 * The Value type A = A
 */
@NullMarked
public interface SetKind&lt;A&gt; extends Kind&lt;SetKind.Witness, A&gt; {
  /**
   * Witness type for {@link java.util.Set} to be used with {@link Kind}.
   */
  final class Witness {
    private Witness() {} 
  }
}
</code></pre>
</li>
<li>
<p><strong>Create the <code>ConverterOps</code> Interface (<code>SetConverterOps.java</code>)</strong>:</p>
<ul>
<li>Define an interface specifying the <code>widen</code> and <code>narrow</code> methods for <code>Set</code>.</li>
</ul>
<pre><code class="language-java">package org.higherkindedj.hkt.set;

import java.util.Set;
import org.higherkindedj.hkt.Kind;
import org.higherkindedj.hkt.exception.KindUnwrapException; // If narrow throws it
import org.jspecify.annotations.NonNull;
import org.jspecify.annotations.Nullable;

public interface SetConverterOps {
  &lt;A&gt; @NonNull Kind&lt;SetKind.Witness, A&gt; widen(@NonNull Set&lt;A&gt; set);
  &lt;A&gt; @NonNull Set&lt;A&gt; narrow(@Nullable Kind&lt;SetKind.Witness, A&gt; kind) throws KindUnwrapException;
}
</code></pre>
</li>
<li>
<p><strong>Create the <code>KindHelper</code> Enum with an Internal <code>Holder</code> (<code>SetKindHelper.java</code>)</strong>:</p>
<ul>
<li>Define an <code>enum</code> (e.g., <code>SetKindHelper</code>) that implements <code>SetConverterOps</code>.</li>
<li>Provide a singleton instance (e.g., <code>SET</code>).</li>
<li>Inside this helper, define a package-private <code>record SetHolder&lt;A&gt;(@NonNull Set&lt;A&gt; set) implements SetKind&lt;A&gt; {}</code>. This record wraps the actual <code>java.util.Set</code>.</li>
<li><strong><code>widen</code> method</strong>: Takes the Java type (e.g., <code>Set&lt;A&gt;</code>), performs null checks, and returns a new <code>SetHolder&lt;&gt;(set)</code> cast to <code>Kind&lt;SetKind.Witness, A&gt;</code>.</li>
<li><strong><code>narrow</code> method</strong>: Takes <code>Kind&lt;SetKind.Witness, A&gt; kind</code>, performs null checks, verifies <code>kind instanceof SetHolder</code>, extracts the underlying <code>Set&lt;A&gt;</code>, and returns it. It throws <code>KindUnwrapException</code> for any structural invalidity.</li>
</ul>
<pre><code class="language-java">package org.higherkindedj.hkt.set;

import java.util.Objects;
import java.util.Set;
import org.higherkindedj.hkt.Kind;
import org.higherkindedj.hkt.exception.KindUnwrapException;
import org.jspecify.annotations.NonNull;
import org.jspecify.annotations.Nullable;

public enum SetKindHelper implements SetConverterOps {
    SET; // Singleton instance

    // Error messages can be static final within the enum
    private static final String ERR_INVALID_KIND_NULL = "Cannot narrow null Kind for Set";
    private static final String ERR_INVALID_KIND_TYPE = "Kind instance is not a SetHolder: ";
    private static final String ERR_INVALID_KIND_TYPE_NULL = "Input Set cannot be null for widen";
  
    // Holder Record (package-private for testability if needed)
    record SetHolder&lt;AVal&gt;(@NonNull Set&lt;AVal&gt; set) implements SetKind&lt;AVal&gt; { }

    @Override
    public &lt;A&gt; @NonNull Kind&lt;SetKind.Witness, A&gt; widen(@NonNull Set&lt;A&gt; set) {
        Objects.requireNonNull(set, ERR_INVALID_KIND_TYPE_NULL);
        return  new SetHolder&lt;&gt;(set);
    }

    @Override
    public &lt;A&gt; @NonNull Set&lt;A&gt; narrow(@Nullable Kind&lt;SetKind.Witness, A&gt; kind) {
        if (kind == null) {
            throw new KindUnwrapException(ERR_INVALID_KIND_NULL);
        }
        if (kind instanceof SetHolder&lt;?&gt; holder) { 
            // SetHolder's 'set' component is @NonNull, so holder.set() is guaranteed non-null.
            return (Set&lt;A&gt;) holder.set();
        } else {
            throw new KindUnwrapException(ERR_INVALID_KIND_TYPE + kind.getClass().getName());
        }
    }
}
</code></pre>
</li>
</ol>
</div>
</div>
<h2 id="scenario-2-integrating-a-custom-library-type"><a class="header" href="#scenario-2-integrating-a-custom-library-type">Scenario 2: Integrating a Custom Library Type</a></h2>
<p>If you are defining a new type <em>within your library</em> (e.g., a custom <code>MyType&lt;A&gt;</code>), you can design it to directly participate in the HKT simulation. This approach typically doesn't require an explicit <code>Holder</code> record if your type can directly implement the <code>XxxKind</code> interface.</p>
<div id="admonition-note-1" class="admonition admonish-note" role="note" aria-labelledby="admonition-note-1-title">
<div class="admonition-title">
<div id="admonition-note-1-title">
<p>Note</p>
</div>
<a class="admonition-anchor-link" href="hkts/extending-simulation.html#admonition-note-1"></a>
</div>
<div>
<ol>
<li>
<p><strong>Define Your Type and its <code>Kind</code> Interface</strong>:</p>
<ul>
<li>Your custom type (e.g., <code>MyType&lt;A&gt;</code>) directly implements its corresponding <code>MyTypeKind&lt;A&gt;</code> interface.</li>
<li><code>MyTypeKind&lt;A&gt;</code> extends <code>Kind&lt;MyType.Witness, A&gt;</code> and defines the nested <code>Witness</code> class. (This part remains unchanged).</li>
</ul>
<pre><code class="language-java">package org.example.mytype;

import org.higherkindedj.hkt.Kind;
import org.jspecify.annotations.NullMarked;

// 1. The Kind Interface with Witness
@NullMarked
public interface MyTypeKind&lt;A&gt; extends Kind&lt;MyType.Witness, A&gt; {
  /** Witness type for MyType. */
  final class Witness { private Witness() {} }
}

// 2. Your Custom Type directly implements its Kind interface
public record MyType&lt;A&gt;(A value) implements MyTypeKind&lt;A&gt; {
    // ... constructors, methods for MyType ...
}
</code></pre>
</li>
<li>
<p><strong>Create the <code>ConverterOps</code> Interface (<code>MyTypeConverterOps.java</code>)</strong>:</p>
<ul>
<li>Define an interface specifying the <code>widen</code> and <code>narrow</code> methods for <code>MyType</code>.</li>
</ul>
<pre><code class="language-java">package org.example.mytype;

import org.higherkindedj.hkt.Kind;
import org.higherkindedj.hkt.exception.KindUnwrapException;
import org.jspecify.annotations.NonNull;
import org.jspecify.annotations.Nullable;

public interface MyTypeConverterOps {
    &lt;A&gt; @NonNull Kind&lt;MyType.Witness, A&gt; widen(@NonNull MyType&lt;A&gt; myTypeValue);
    &lt;A&gt; @NonNull MyType&lt;A&gt; narrow(@Nullable Kind&lt;MyType.Witness, A&gt; kind) throws KindUnwrapException;
}
</code></pre>
</li>
<li>
<p><strong>Create the <code>KindHelper</code> Enum (<code>MyTypeKindHelper.java</code>)</strong>:</p>
<ul>
<li>Define an <code>enum</code> (e.g., <code>MyTypeKindHelper</code>) that implements <code>MyTypeConverterOps</code>.</li>
<li>Provide a singleton instance (e.g., <code>MY_TYPE</code>).</li>
<li><strong><code>widen(MyType&lt;A&gt; myTypeValue)</code></strong>: Since <code>MyType&lt;A&gt;</code> <em>is</em> already a <code>MyTypeKind&lt;A&gt;</code> (and thus a <code>Kind</code>), this method performs a null check and then a direct cast.</li>
<li><strong><code>narrow(Kind&lt;MyType.Witness, A&gt; kind)</code></strong>: This method checks <code>if (kind instanceof MyType&lt;?&gt; myTypeInstance)</code> and then casts and returns <code>myTypeInstance</code>.</li>
</ul>
<pre><code class="language-java">package org.example.mytype;

import org.higherkindedj.hkt.Kind;
import org.higherkindedj.hkt.exception.KindUnwrapException;
import org.jspecify.annotations.NonNull;
import org.jspecify.annotations.Nullable;
import java.util.Objects;

public enum MyTypeKindHelper implements MyTypeConverterOps {
    MY_TYPE; // Singleton instance

    private static final String ERR_INVALID_KIND_NULL = "Cannot narrow null Kind for MyType";
    private static final String ERR_INVALID_KIND_TYPE = "Kind instance is not a MyType: ";

    @Override
    @SuppressWarnings("unchecked") // MyType&lt;A&gt; is MyTypeKind&lt;A&gt; is Kind&lt;MyType.Witness, A&gt;
    public &lt;A&gt; @NonNull Kind&lt;MyType.Witness, A&gt; widen(@NonNull MyType&lt;A&gt; myTypeValue) {
        Objects.requireNonNull(myTypeValue, "Input MyType cannot be null for widen");
        return (MyTypeKind&lt;A&gt;) myTypeValue; // Direct cast
    }

    @Override
    @SuppressWarnings("unchecked")
    public &lt;A&gt; @NonNull MyType&lt;A&gt; narrow(@Nullable Kind&lt;MyType.Witness, A&gt; kind) {
        if (kind == null) {
            throw new KindUnwrapException(ERR_INVALID_KIND_NULL);
        }
        // Check if it's an instance of your actual type
        if (kind instanceof MyType&lt;?&gt; myTypeInstance) { // Pattern match for MyType
            return (MyType&lt;A&gt;) myTypeInstance; // Direct cast
        } else {
            throw new KindUnwrapException(ERR_INVALID_KIND_TYPE + kind.getClass().getName());
        }
    }
}
</code></pre>
</li>
<li>
<p><strong>Implement Type Class Instances</strong>:</p>
<ul>
<li>These will be similar to the external type scenario (e.g., <code>MyTypeMonad implements Monad&lt;MyType.Witness&gt;</code>), using <code>MyTypeKindHelper.MY_TYPE.widen(...)</code> and <code>MyTypeKindHelper.MY_TYPE.narrow(...)</code> (or with static import <code>MY_TYPE.widen(...)</code>).</li>
</ul>
</li>
</ol>
</div>
</div>
<div id="admonition-note-2" class="admonition admonish-note" role="note" aria-labelledby="admonition-note-2-title">
<div class="admonition-title">
<div id="admonition-note-2-title">
<p>Note</p>
</div>
<a class="admonition-anchor-link" href="hkts/extending-simulation.html#admonition-note-2"></a>
</div>
<div>
<ul>
<li><strong>Immutability</strong>: Favor immutable data structures for your <code>Holder</code> or custom type if possible, as this aligns well with functional programming principles.</li>
<li><strong>Null Handling</strong>: Be very clear about null handling. Can the wrapped Java type be null? Can the value <code>A</code> inside be null? <code>KindHelper</code>'s <code>widen</code> method should typically reject a null container itself. <code>Monad.of(null)</code> behaviour depends on the specific monad (e.g., <code>OptionalMonad.OPTIONAL_MONAD.of(null)</code> is empty via <code>OPTIONAL.widen(Optional.empty())</code>, <code>ListMonad.LIST_MONAD.of(null)</code> might be an empty list or a list with a null element based on its definition).</li>
<li><strong>Testing</strong>: Thoroughly test your <code>XxxKindHelper</code> enum (especially <code>narrow</code> with invalid inputs) and your type class instances (Functor, Applicative, Monad laws).</li>
</ul>
<p>By following these patterns, you can integrate new or existing types into the Higher-Kinded-J framework, enabling them to be used with generic functional abstractions. The <code>KindHelper</code> enums, along with their corresponding <code>ConverterOps</code> interfaces, provide a standardized way to handle the <code>widen</code> and <code>narrow</code> conversions.</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="core-api-interfaces-the-building-blocks"><a class="header" href="#core-api-interfaces-the-building-blocks">Core API Interfaces: The Building Blocks</a></h1>
<p>The <code>hkj-api</code> module contains the heart of the <code>higher-kinded-j</code> library‚Äîa set of interfaces that define the core functional programming abstractions. These are the building blocks you will use to write powerful, generic, and type-safe code.</p>
<p>This document provides a high-level overview of the most important interfaces, which are often referred to as <strong>type classes</strong>.</p>
<hr />
<h2 id="core-hkt-abstraction"><a class="header" href="#core-hkt-abstraction">Core HKT Abstraction</a></h2>
<p>At the very centre of the library is the <code>Kind</code> interface, which makes higher-kinded types possible in Java.</p>
<ul>
<li><strong><code>Kind&lt;F, A&gt;</code></strong>: This is the foundational interface that emulates a higher-kinded type. It represents a type <code>F</code> that is generic over a type <code>A</code>. For example, <code>Kind&lt;ListKind.Witness, String&gt;</code> represents a <code>List&lt;String&gt;</code>. You will see this interface used everywhere as the common currency for all our functional abstractions.</li>
</ul>
<hr />
<h2 id="the-monad-hierarchy"><a class="header" href="#the-monad-hierarchy">The Monad Hierarchy</a></h2>
<p>The most commonly used type classes form a hierarchy of power and functionality, starting with <code>Functor</code> and building up to <code>Monad</code>.</p>
<h3 id="functorf"><a class="header" href="#functorf"><strong><code>Functor&lt;F&gt;</code></strong></a></h3>
<p>A <strong><code>Functor</code></strong> is a type class for any data structure that can be "mapped over". It provides a single operation, <code>map</code>, which applies a function to the value(s) inside the structure without changing the structure itself.</p>
<ul>
<li><strong>Key Method</strong>: <code>map(Function&lt;A, B&gt; f, Kind&lt;F, A&gt; fa)</code></li>
<li><strong>Intuition</strong>: If you have a <code>List&lt;A&gt;</code> and a function <code>A -&gt; B</code>, a <code>Functor</code> for <code>List</code> lets you produce a <code>List&lt;B&gt;</code>. The same logic applies to <code>Optional</code>, <code>Either</code>, <code>Try</code>, etc.</li>
</ul>
<h3 id="applicativef"><a class="header" href="#applicativef"><strong><code>Applicative&lt;F&gt;</code></strong></a></h3>
<p>An <strong><code>Applicative</code></strong> (or Applicative Functor) is a <code>Functor</code> with more power. It allows you to apply a function that is itself wrapped in the data structure. This is essential for combining multiple independent computations.</p>
<ul>
<li><strong>Key Methods</strong>:
<ul>
<li><code>of(A value)</code>: Lifts a normal value <code>A</code> into the applicative context <code>F&lt;A&gt;</code>.</li>
<li><code>ap(Kind&lt;F, Function&lt;A, B&gt;&gt; ff, Kind&lt;F, A&gt; fa)</code>: Applies a wrapped function to a wrapped value.</li>
</ul>
</li>
<li><strong>Intuition</strong>: If you have an <code>Optional&lt;Function&lt;A, B&gt;&gt;</code> and an <code>Optional&lt;A&gt;</code>, you can use the <code>Applicative</code> for <code>Optional</code> to get an <code>Optional&lt;B&gt;</code>. This is how <code>Validated</code> is able to accumulate errors from multiple independent validation steps.</li>
</ul>
<h3 id="monadf"><a class="header" href="#monadf"><strong><code>Monad&lt;F&gt;</code></strong></a></h3>
<p>A <strong><code>Monad</code></strong> is an <code>Applicative</code> that adds the power of sequencing dependent computations. It provides a way to chain operations together, where the result of one operation is fed into the next.</p>
<ul>
<li><strong>Key Method</strong>: <code>flatMap(Function&lt;A, Kind&lt;F, B&gt;&gt; f, Kind&lt;F, A&gt; fa)</code></li>
<li><strong>Intuition</strong>: <code>flatMap</code> is the powerhouse of monadic composition. It takes a value from a context (like an <code>Optional&lt;A&gt;</code>), applies a function that returns a <em>new</em> context (<code>A -&gt; Optional&lt;B&gt;</code>), and flattens the result into a single context (<code>Optional&lt;B&gt;</code>). This is what enables the elegant, chainable workflows you see in the examples.</li>
</ul>
<h3 id="monaderrorf-e"><a class="header" href="#monaderrorf-e"><strong><code>MonadError&lt;F, E&gt;</code></strong></a></h3>
<p>A <strong><code>MonadError</code></strong> is a specialised <code>Monad</code> that has a defined error type <code>E</code>. It provides explicit methods for raising and handling errors within a monadic workflow.</p>
<ul>
<li><strong>Key Methods</strong>:
<ul>
<li><code>raiseError(E error)</code>: Lifts an error <code>E</code> into the monadic context <code>F&lt;A&gt;</code>.</li>
<li><code>handleErrorWith(Kind&lt;F, A&gt; fa, Function&lt;E, Kind&lt;F, A&gt;&gt; f)</code>: Provides a way to recover from a failed computation.</li>
</ul>
</li>
</ul>
<hr />
<h2 id="data-aggregation-type-classes"><a class="header" href="#data-aggregation-type-classes">Data Aggregation Type Classes</a></h2>
<p>These type classes define how data can be combined and reduced.</p>
<h3 id="semigroupa"><a class="header" href="#semigroupa"><strong><code>Semigroup&lt;A&gt;</code></strong></a></h3>
<p>A <strong><code>Semigroup</code></strong> is a simple type class for any type <code>A</code> that has an associative <code>combine</code> operation. It's the foundation for any kind of data aggregation.</p>
<ul>
<li><strong>Key Method</strong>: <code>combine(A a1, A a2)</code></li>
<li><strong>Use Case</strong>: Its primary use in this library is to tell a <code>Validated``Applicative</code> how to accumulate errors.</li>
</ul>
<h3 id="monoida"><a class="header" href="#monoida"><strong><code>Monoid&lt;A&gt;</code></strong></a></h3>
<p>A <strong><code>Monoid</code></strong> is a <code>Semigroup</code> that also has an "empty" or "identity" element. This is a value that, when combined with any other value, does nothing.</p>
<ul>
<li><strong>Key Methods</strong>:
<ul>
<li><code>combine(A a1, A a2)</code> (from <code>Semigroup</code>)</li>
<li><code>empty()</code></li>
</ul>
</li>
<li><strong>Use Case</strong>: Essential for folding data structures, where <code>empty()</code> provides the starting value for the reduction.</li>
</ul>
<hr />
<h2 id="structure-iterating-type-classes-1"><a class="header" href="#structure-iterating-type-classes-1">Structure-Iterating Type Classes</a></h2>
<p>These type classes define how to iterate over and manipulate the contents of a data structure in a generic way.</p>
<h3 id="foldablef"><a class="header" href="#foldablef"><strong><code>Foldable&lt;F&gt;</code></strong></a></h3>
<p>A <strong><code>Foldable</code></strong> is a type class for any data structure <code>F</code> that can be reduced to a single summary value. It uses a <code>Monoid</code> to combine the elements.</p>
<ul>
<li><strong>Key Method</strong>: <code>foldMap(Monoid&lt;M&gt; monoid, Function&lt;A, M&gt; f, Kind&lt;F, A&gt; fa)</code></li>
<li><strong>Intuition</strong>: It abstracts the process of iterating over a collection and aggregating the results.</li>
</ul>
<h3 id="traversef"><a class="header" href="#traversef"><strong><code>Traverse&lt;F&gt;</code></strong></a></h3>
<p>A <strong><code>Traverse</code></strong> is a powerful type class that extends both <code>Functor</code> and <code>Foldable</code>. It allows you to iterate over a data structure <code>F&lt;A&gt;</code> and apply an effectful function <code>A -&gt; G&lt;B&gt;</code> at each step, collecting the results into a single effect <code>G&lt;F&lt;B&gt;&gt;</code>.</p>
<ul>
<li><strong>Key Method</strong>: <code>traverse(Applicative&lt;G&gt; applicative, Function&lt;A, Kind&lt;G, B&gt;&gt; f, Kind&lt;F, A&gt; fa)</code></li>
<li><strong>Use Case</strong>: This is incredibly useful for tasks like validating every item in a <code>List</code>, where the validation returns a <code>Validated</code>. The result is a single <code>Validated</code> containing either a <code>List</code> of all successful results or an accumulation of all errors.</li>
</ul>
<hr />
<h2 id="dual-parameter-type-classes-1"><a class="header" href="#dual-parameter-type-classes-1">Dual-Parameter Type Classes</a></h2>
<p>These type classes work with types that take two type parameters, such as functions, profunctors, and bifunctors.</p>
<h3 id="profunctorp"><a class="header" href="#profunctorp"><strong><code>Profunctor&lt;P&gt;</code></strong></a></h3>
<p>A <strong><code>Profunctor</code></strong> is a type class for any type constructor <code>P&lt;A, B&gt;</code> that is contravariant in its first parameter and covariant in its second. This is the abstraction behind functions and many data transformation patterns.</p>
<ul>
<li><strong>Key Methods</strong>:
<ul>
<li><code>lmap(Function&lt;C, A&gt; f, Kind2&lt;P, A, B&gt; pab)</code>: Pre-process the input (contravariant mapping)</li>
<li><code>rmap(Function&lt;B, C&gt; g, Kind2&lt;P, A, B&gt; pab)</code>: Post-process the output (covariant mapping)</li>
<li><code>dimap(Function&lt;C, A&gt; f, Function&lt;B, D&gt; g, Kind2&lt;P, A, B&gt; pab)</code>: Transform both input and output simultaneously</li>
</ul>
</li>
<li><strong>Use Case</strong>: Essential for building flexible data transformation pipelines, API adapters, and validation frameworks that can adapt to different input and output formats without changing core business logic.</li>
</ul>
<h3 id="profunctors-in-optics"><a class="header" href="#profunctors-in-optics"><strong>Profunctors in Optics</strong></a></h3>
<p>Importantly, every optic in higher-kinded-j is fundamentally a profunctor. This means that <code>Lens</code>, <code>Prism</code>, <code>Iso</code>, and <code>Traversal</code> all support profunctor operations through their <code>contramap</code>, <code>map</code>, and <code>dimap</code> methods. This provides incredible flexibility for adapting optics to work with different data types and structures, making them highly reusable across different contexts and API boundaries.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="functor-the-mappable-type-class-"><a class="header" href="#functor-the-mappable-type-class-">Functor: The "Mappable" Type Class üéÅ</a></h1>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="functional/functor.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to transform values inside containers without changing the container structure</li>
<li>The difference between regular functions and functorial mapping</li>
<li>Functor laws (identity and composition) and why they matter</li>
<li>How to use Functor instances with List, Optional, and other containers</li>
<li>When to choose Functor over direct method calls</li>
</ul>
</div>
</div>
<p>At the heart of functional programming is the ability to transform data within a container without having to open it. The <strong><code>Functor</code></strong> type class provides exactly this capability. It's the simplest and most common abstraction for any data structure that can be "mapped over."</p>
<p>If you've ever used <code>Optional.map()</code> or <code>Stream.map()</code>, you've already been using the Functor pattern! <code>higher-kinded-j</code> simply formalizes this concept so you can apply it to any data structure.</p>
<hr />
<h2 id="what-is-it"><a class="header" href="#what-is-it">What is it?</a></h2>
<p>A <strong><code>Functor</code></strong> is a type class for any data structure <code>F</code> that supports a <code>map</code> operation. This operation takes a function from <code>A -&gt; B</code> and applies it to the value(s) inside a container <code>F&lt;A&gt;</code>, producing a new container <code>F&lt;B&gt;</code> of the same shape.</p>
<p>Think of a <code>Functor</code> as a generic "box" that holds a value. The <code>map</code> function lets you transform the contents of the box without ever taking the value out. Whether the box is an <code>Optional</code> that might be empty, a <code>List</code> with many items, or a <code>Try</code> that might hold an error, the mapping logic remains the same.</p>
<p>The interface for <code>Functor</code> in <code>hkj-api</code> is simple and elegant:</p>
<pre><code class="language-java">public interface Functor&lt;F&gt; {
  &lt;A, B&gt; @NonNull Kind&lt;F, B&gt; map(final Function&lt;? super A, ? extends B&gt; f, final Kind&lt;F, A&gt; fa);
}
</code></pre>
<ul>
<li><code>f</code>: The function to apply to the value inside the Functor.</li>
<li><code>fa</code>: The higher-kinded <code>Functor</code> instance (e.g., a <code>Kind&lt;Optional.Witness, String&gt;</code>).</li>
</ul>
<hr />
<h3 id="the-functor-laws"><a class="header" href="#the-functor-laws">The Functor Laws</a></h3>
<p>For a <code>Functor</code> implementation to be lawful, it must obey two simple rules. These ensure that the <code>map</code> operation is predictable and doesn't have unexpected side effects.</p>
<ol>
<li>
<p><strong>Identity Law</strong>: Mapping with the identity function (<code>x -&gt; x</code>) should change nothing.</p>
<pre><code class="language-java">functor.map(x -&gt; x, fa); // This must be equivalent to fa
</code></pre>
</li>
<li>
<p><strong>Composition Law</strong>: Mapping with two functions composed together is the same as mapping with each function one after the other.</p>
<pre><code class="language-java">Function&lt;A, B&gt; f = ...;
Function&lt;B, C&gt; g = ...;

// This...
functor.map(g.compose(f), fa);

// ...must be equivalent to this:
functor.map(g, functor.map(f, fa));
</code></pre>
</li>
</ol>
<p>These laws ensure that <code>map</code> is only about transformation and preserves the structure of the data type.</p>
<hr />
<h3 id="why-is-it-useful"><a class="header" href="#why-is-it-useful">Why is it useful?</a></h3>
<p><code>Functor</code> allows you to write generic, reusable code that transforms values inside any "mappable" data structure. This is the first step toward abstracting away the boilerplate of dealing with different container types.</p>
<p><strong>Example: Mapping over an <code>Optional</code> and a <code>List</code></strong></p>
<p>Let's see how we can use the <code>Functor</code> instances for <code>Optional</code> and <code>List</code> to apply the same logic to different data structures.</p>
<pre><code class="language-java">import org.higherkindedj.hkt.Kind;
import org.higherkindedj.hkt.list.ListFunctor;
import org.higherkindedj.hkt.list.ListKind;
import org.higherkindedj.hkt.optional.OptionalFunctor;
import org.higherkindedj.hkt.optional.OptionalKind;
import java.util.List;
import java.util.Optional;
import static org.higherkindedj.hkt.list.ListKindHelper.LIST;
import static org.higherkindedj.hkt.optional.OptionalKindHelper.OPTIONAL;


// Our function that we want to apply
Function&lt;String, Integer&gt; stringLength = String::length;

// --- Scenario 1: Mapping over an Optional ---
Functor&lt;OptionalKind.Witness&gt; optionalFunctor = OptionalFunctor.INSTANCE;

// The data
Kind&lt;OptionalKind.Witness, String&gt; optionalWithValue = OPTIONAL.widen(Optional.of("Hello"));
Kind&lt;OptionalKind.Witness, String&gt; optionalEmpty = OPTIONAL.widen(Optional.empty());

// Apply the map
Kind&lt;OptionalKind.Witness, Integer&gt; lengthWithValue = optionalFunctor.map(stringLength, optionalWithValue);
Kind&lt;OptionalKind.Witness, Integer&gt; lengthEmpty = optionalFunctor.map(stringLength, optionalEmpty);

// Result: Optional[5]
System.out.println(OPTIONAL.narrow(lengthWithValue));
// Result: Optional.empty
System.out.println(OPTIONAL.narrow(lengthEmpty));


// --- Scenario 2: Mapping over a List ---
Functor&lt;ListKind.Witness&gt; listFunctor = ListFunctor.INSTANCE;

// The data
Kind&lt;ListKind.Witness, String&gt; listOfStrings = LIST.widen(List.of("one", "two", "three"));

// Apply the map
Kind&lt;ListKind.Witness, Integer&gt; listOfLengths = listFunctor.map(stringLength, listOfStrings);

// Result: [3, 3, 5]
System.out.println(LIST.narrow(listOfLengths));
</code></pre>
<p>As you can see, the <code>Functor</code> provides a consistent API for transformation, regardless of the underlying data structure. This is the first and most essential step on the path to more powerful abstractions like <code>Applicative</code> and <code>Monad</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="applicative-applying-wrapped-functions-"><a class="header" href="#applicative-applying-wrapped-functions-">Applicative: Applying Wrapped Functions ‚ú®</a></h1>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="functional/applicative.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to apply wrapped functions to wrapped values using <code>ap</code></li>
<li>The difference between independent computations (Applicative) and dependent ones (Monad)</li>
<li>How to combine multiple validation results and accumulate all errors</li>
<li>Using <code>map2</code>, <code>map3</code> and other convenience methods for combining values</li>
<li>Real-world validation scenarios with the Validated type</li>
</ul>
</div>
</div>
<p>While a <code>Functor</code> is great for applying a <em>simple</em> function to a value inside a context, what happens when the function you want to apply is <em>also</em> wrapped in a context? This is where the <strong><code>Applicative</code></strong> type class comes in. It's the next step up in power from a <code>Functor</code> and allows you to combine multiple computations within a context in a very powerful way.</p>
<hr />
<h2 id="what-is-it-1"><a class="header" href="#what-is-it-1">What is it?</a></h2>
<p>An <strong><code>Applicative</code></strong> (or Applicative Functor) is a <code>Functor</code> that also provides two key operations:</p>
<ol>
<li><strong><code>of</code></strong> (also known as <code>pure</code>): Lifts a regular value into the applicative context. For example, it can take a <code>String</code> and wrap it to become an <code>Optional&lt;String&gt;</code>.</li>
<li><strong><code>ap</code></strong>: Takes a function that is wrapped in the context (e.g., an <code>Optional&lt;Function&lt;A, B&gt;&gt;</code>) and applies it to a value that is also in the context (e.g., an <code>Optional&lt;A&gt;</code>).</li>
</ol>
<p>This ability to apply a <em>wrapped function</em> to a <em>wrapped value</em> is what makes <code>Applicative</code> so powerful. It's the foundation for combining independent computations.</p>
<p>The interface for <code>Applicative</code> in <code>hkj-api</code> extends <code>Functor</code>:</p>
<pre><code class="language-java">@NullMarked
public interface Applicative&lt;F&gt; extends Functor&lt;F&gt; {

  &lt;A&gt; @NonNull Kind&lt;F, A&gt; of(@Nullable A value);

  &lt;A, B&gt; @NonNull Kind&lt;F, B&gt; ap(
      Kind&lt;F, ? extends Function&lt;A, B&gt;&gt; ff,
      Kind&lt;F, A&gt; fa
  );

  // Default methods for map2, map3, etc. are also provided
  default &lt;A, B, C&gt; @NonNull Kind&lt;F, C&gt; map2(
      final Kind&lt;F, A&gt; fa,
      final Kind&lt;F, B&gt; fb,
      final BiFunction&lt;? super A, ? super B, ? extends C&gt; f) {
    return ap(map(a -&gt; b -&gt; f.apply(a, b), fa), fb);
  }
}
</code></pre>
<hr />
<h3 id="why-is-it-useful-1"><a class="header" href="#why-is-it-useful-1">Why is it useful?</a></h3>
<p>The primary use case for <code>Applicative</code> is to combine the results of several independent computations that are all inside the same context. The classic example is <strong>data validation</strong>, where you want to validate multiple fields and accumulate all the errors.</p>
<p>While a <code>Monad</code> (using <code>flatMap</code>) can also combine computations, it can't accumulate errors in the same way. When a monadic chain fails, it short-circuits, giving you only the <em>first</em> error. An <code>Applicative</code>, on the other hand, can process all computations independently and combine the results.</p>
<p><strong>Example: Validating a User Registration Form</strong></p>
<p>Imagine you have a registration form and you need to validate both the username and the password. Each validation can either succeed or return a list of error messages. We can use the <code>Applicative</code> for <code>Validated</code> to run both validations and get all the errors back at once.</p>
<pre><code class="language-java">import org.higherkindedj.hkt.Kind;
import org.higherkindedj.hkt.validated.Validated;
import org.higherkindedj.hkt.validated.ValidatedMonad;
import org.higherkindedj.hkt.Semigroups;

import java.util.List;
import static org.higherkindedj.hkt.validated.ValidatedKindHelper.VALIDATED;

// A simple User class
record User(String username, String password) {}

// Validation functions
public Validated&lt;List&lt;String&gt;, String&gt; validateUsername(String username) {
    if (username.length() &lt; 3) {
        return Validated.invalid(List.of("Username must be at least 3 characters"));
    }
    return Validated.valid(username);
}

public Validated&lt;List&lt;String&gt;, String&gt; validatePassword(String password) {
    if (!password.matches(".*\\d.*")) {
        return Validated.invalid(List.of("Password must contain a number"));
    }
    return Validated.valid(password);
}


// --- Get the Applicative instance for Validated ---
// We need a Semigroup to tell the Applicative how to combine errors (in this case, by concatenating lists)
Applicative&lt;Validated.Witness&lt;List&lt;String&gt;&gt;&gt; applicative =
    ValidatedMonad.instance(Semigroups.list());

// --- Scenario 1: All validations pass ---
Validated&lt;List&lt;String&gt;, String&gt; validUsername = validateUsername("test_user");
Validated&lt;List&lt;String&gt;, String&gt; validPassword = validatePassword("password123");

Kind&lt;Validated.Witness&lt;List&lt;String&gt;&gt;, User&gt; validResult =
    applicative.map2(
        VALIDATED.widen(validUsername),
        VALIDATED.widen(validPassword),
        User::new // If both are valid, create a new User
    );

// Result: Valid(User[username=test_user, password=password123])
System.out.println(VALIDATED.narrow(validResult));


// --- Scenario 2: Both validations fail ---
Validated&lt;List&lt;String&gt;, String&gt; invalidUsername = validateUsername("no");
Validated&lt;List&lt;String&gt;, String&gt; invalidPassword = validatePassword("bad");

Kind&lt;Validated.Witness&lt;List&lt;String&gt;&gt;, User&gt; invalidResult =
    applicative.map2(
        VALIDATED.widen(invalidUsername),
        VALIDATED.widen(invalidPassword),
        User::new
    );

// The errors from both validations are accumulated!
// Result: Invalid([Username must be at least 3 characters, Password must contain a number])
System.out.println(VALIDATED.narrow(invalidResult));
</code></pre>
<p>This error accumulation is impossible with <code>Functor</code> and is one of the key features that makes <code>Applicative</code> so indispensable for real-world functional programming.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="monad-sequencing-computations-"><a class="header" href="#monad-sequencing-computations-">Monad: Sequencing Computations üîó</a></h1>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="functional/monad.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to sequence computations where each step depends on previous results</li>
<li>The power of <code>flatMap</code> for chaining operations that return wrapped values</li>
<li>When to use Monad vs Applicative (dependent vs independent computations)</li>
<li>Essential utility methods: <code>as</code>, <code>peek</code>, and <code>flatMapIfOrElse</code></li>
<li>How monadic short-circuiting works in practice</li>
</ul>
</div>
</div>
<p>You've seen how <code>Functor</code> lets you <code>map</code> over a value in a context and how <code>Applicative</code> lets you combine independent computations within a context. Now, we'll introduce the most powerful of the trio: <strong><code>Monad</code></strong>.</p>
<p>A <code>Monad</code> builds on <code>Applicative</code> by adding one crucial ability: sequencing computations that <strong>depend on each other</strong>. If the result of the first operation is needed to determine the second operation, you need a <code>Monad</code>.</p>
<hr />
<h2 id="what-is-it-2"><a class="header" href="#what-is-it-2">What is it?</a></h2>
<p>A <strong><code>Monad</code></strong> is an <code>Applicative</code> that provides a new function called <strong><code>flatMap</code></strong> (also known as <code>bind</code> in some languages). This is the powerhouse of monadic composition.</p>
<p>While <code>map</code> takes a simple function <code>A -&gt; B</code>, <code>flatMap</code> takes a function that returns a new value <em>already wrapped in the monadic context</em>, i.e., <code>A -&gt; Kind&lt;F, B&gt;</code>. <code>flatMap</code> then intelligently flattens the nested result <code>Kind&lt;F, Kind&lt;F, B&gt;&gt;</code> into a simple <code>Kind&lt;F, B&gt;</code>.</p>
<p>This flattening behaviour is what allows you to chain operations together in a clean, readable sequence without creating deeply nested structures.</p>
<hr />
<h2 id="the-monad-interface"><a class="header" href="#the-monad-interface">The <code>Monad</code> Interface</a></h2>
<p>The interface for <code>Monad</code> in <code>hkj-api</code> extends <code>Applicative</code> and adds <code>flatMap</code> along with several useful default methods for common patterns.</p>
<pre><code class="language-java">@NullMarked
public interface Monad&lt;M&gt; extends Applicative&lt;M&gt; {
  // Core sequencing method
  &lt;A, B&gt; @NonNull Kind&lt;M, B&gt; flatMap(
      final Function&lt;? super A, ? extends Kind&lt;M, B&gt;&gt; f, final Kind&lt;M, A&gt; ma);

  // Type-safe conditional branching
  default &lt;A, B&gt; @NonNull Kind&lt;M, B&gt; flatMapIfOrElse(
      final Predicate&lt;? super A&gt; predicate,
      final Function&lt;? super A, ? extends Kind&lt;M, B&gt;&gt; ifTrue,
      final Function&lt;? super A, ? extends Kind&lt;M, B&gt;&gt; ifFalse,
      final Kind&lt;M, A&gt; ma) {
    return flatMap(a -&gt; predicate.test(a) ? ifTrue.apply(a) : ifFalse.apply(a), ma);
  }

  // Replace the value while preserving the effect
  default &lt;A, B&gt; @NonNull Kind&lt;M, B&gt; as(final B b, final Kind&lt;M, A&gt; ma) {
    return map(_ -&gt; b, ma);
  }

  // Perform a side-effect without changing the value
  default &lt;A&gt; @NonNull Kind&lt;M, A&gt; peek(final Consumer&lt;? super A&gt; action, final Kind&lt;M, A&gt; ma) {
    return map(a -&gt; {
      action.accept(a);
      return a;
    }, ma);
  }
}
</code></pre>
<h3 id="monad-vs-applicative"><a class="header" href="#monad-vs-applicative">Monad vs. Applicative</a></h3>
<p>The key difference is simple but profound:</p>
<ul>
<li><strong><code>Applicative</code></strong> is for combining <strong>independent</strong> computations. The shape and structure of all the computations are known upfront. This is why it can accumulate errors from multiple validations‚Äîit runs all of them.</li>
<li><strong><code>Monad</code></strong> is for sequencing <strong>dependent</strong> computations. The computation in the second step cannot be known until the first step has completed. This is why it short-circuits on failure‚Äîif the first step fails, there is no value to feed into the second step.</li>
</ul>
<hr />
<h3 id="why-is-it-useful-2"><a class="header" href="#why-is-it-useful-2">Why is it useful?</a></h3>
<p><code>Monad</code> is essential for building any kind of workflow where steps depend on the result of previous steps, especially when those steps might fail or be asynchronous. It allows you to write what looks like a simple sequence of operations while hiding the complexity of error handling, null checks, or concurrency.</p>
<p>This pattern is the foundation for the <strong>for-comprehension</strong> builder in <code>higher-kinded-j</code>, which transforms a chain of <code>flatMap</code> calls into clean, imperative-style code.</p>
<h4 id="core-method-flatmap"><a class="header" href="#core-method-flatmap">Core Method: <code>flatMap</code></a></h4>
<p>This is the primary method for chaining dependent operations.</p>
<p><strong>Example: A Safe Database Workflow</strong></p>
<p>Imagine a workflow where you need to fetch a user, then use their ID to fetch their account, and finally use the account details to get their balance. Any of these steps could fail (e.g., return an empty <code>Optional</code>). With <code>flatMap</code>, the chain becomes clean and safe.</p>
<pre><code class="language-java">import org.higherkindedj.hkt.Kind;
import org.higherkindedj.hkt.Monad;
import org.higherkindedj.hkt.optional.OptionalMonad;
import java.util.Optional;
import static org.higherkindedj.hkt.optional.OptionalKindHelper.OPTIONAL;

// Mock data records and repository functions from the previous example...
record User(int id, String name) {}
record Account(int userId, String accountId) {}

public Kind&lt;Optional.Witness, User&gt; findUser(int id) { /* ... */ }
public Kind&lt;Optional.Witness, Account&gt; findAccount(User user) { /* ... */ }
public Kind&lt;Optional.Witness, Double&gt; getBalance(Account account) { /* ... */ }

// --- Get the Monad instance for Optional ---
Monad&lt;Optional.Witness&gt; monad = OptionalMonad.INSTANCE;

// --- Scenario 1: Successful workflow ---
Kind&lt;Optional.Witness, Double&gt; balanceSuccess = monad.flatMap(user -&gt;
    monad.flatMap(account -&gt;
        getBalance(account),
        findAccount(user)),
    findUser(1));

// Result: Optional[1000.0]
System.out.println(OPTIONAL.narrow(balanceSuccess));

// --- Scenario 2: Failing workflow (user not found) ---
Kind&lt;Optional.Witness, Double&gt; balanceFailure = monad.flatMap(user -&gt;
    /* this part is never executed */
    monad.flatMap(account -&gt; getBalance(account), findAccount(user)),
    findUser(2)); // This returns Optional.empty()

// The chain short-circuits immediately.
// Result: Optional.empty
System.out.println(OPTIONAL.narrow(balanceFailure));
</code></pre>
<p>The <code>flatMap</code> chain elegantly handles the "happy path" while also providing robust, short-circuiting logic for the failure cases, all without a single null check.</p>
<hr />
<h2 id="utility-methods-"><a class="header" href="#utility-methods-">Utility Methods üõ†Ô∏è</a></h2>
<p><code>Monad</code> also provides default methods for common tasks like debugging, conditional logic, and transforming results.</p>
<h3 id="flatmapiforelse"><a class="header" href="#flatmapiforelse"><code>flatMapIfOrElse</code></a></h3>
<p>This is the type-safe way to perform conditional branching in a monadic chain. It applies one of two functions based on a predicate, ensuring that both paths result in the same final type and avoiding runtime errors.</p>
<p>Let's imagine we only want to fetch accounts for "standard" users (ID &lt; 100).</p>
<pre><code class="language-java">// --- Get the Monad instance for Optional ---
Monad&lt;Optional.Witness&gt; monad = OptionalMonad.INSTANCE;

// A user who meets the condition
Kind&lt;Optional.Witness, User&gt; standardUser = OPTIONAL.widen(Optional.of(new User(1, "Alice")));
// A user who does not
Kind&lt;Optional.Witness, User&gt; premiumUser = OPTIONAL.widen(Optional.of(new User(101, "Bob")));

// --- Scenario 1: Predicate is true ---
Kind&lt;Optional.Witness, Account&gt; resultSuccess = monad.flatMapIfOrElse(
    user -&gt; user.id() &lt; 100,      // Predicate: user is standard
    user -&gt; findAccount(user),    // Action if true: find their account
    user -&gt; OPTIONAL.widen(Optional.empty()), // Action if false: return empty
    standardUser
);
// Result: Optional[Account[userId=1, accountId=acc-123]]
System.out.println(OPTIONAL.narrow(resultSuccess));


// --- Scenario 2: Predicate is false ---
Kind&lt;Optional.Witness, Account&gt; resultFailure = monad.flatMapIfOrElse(
    user -&gt; user.id() &lt; 100,
    user -&gt; findAccount(user),
    user -&gt; OPTIONAL.widen(Optional.empty()), // This path is taken
    premiumUser
);
// Result: Optional.empty
System.out.println(OPTIONAL.narrow(resultFailure));
</code></pre>
<h3 id="as"><a class="header" href="#as"><code>as</code></a></h3>
<p>Replaces the value inside a monad while preserving its effect (e.g., success or failure). This is useful when you only care <em>that</em> an operation succeeded, not what its result was.</p>
<pre><code class="language-java">// After finding a user, we just want a confirmation message.
Kind&lt;Optional.Witness, String&gt; successMessage = monad.as("User found successfully", findUser(1));

// Result: Optional["User found successfully"]
System.out.println(OPTIONAL.narrow(successMessage));

// If the user isn't found, the effect (empty Optional) is preserved.
Kind&lt;Optional.Witness, String&gt; failureMessage = monad.as("User found successfully", findUser(99));

// Result: Optional.empty
System.out.println(OPTIONAL.narrow(failureMessage));
</code></pre>
<h3 id="peek"><a class="header" href="#peek"><code>peek</code></a></h3>
<p>Allows you to perform a side-effect (like logging) on the value inside a monad without altering the flow. The original monadic value is always returned.</p>
<pre><code class="language-java">// Log the user's name if they are found
Kind&lt;Optional.Witness, User&gt; peekSuccess = monad.peek(
    user -&gt; System.out.println("LOG: Found user -&gt; " + user.name()),
    findUser(1)
);
// Console output: LOG: Found user -&gt; Alice
// Result: Optional[User[id=1, name=Alice]] (The original value is unchanged)
System.out.println("Return value: " + OPTIONAL.narrow(peekSuccess));


// If the user isn't found, the action is never executed.
Kind&lt;Optional.Witness, User&gt; peekFailure = monad.peek(
    user -&gt; System.out.println("LOG: Found user -&gt; " + user.name()),
    findUser(99)
);
// Console output: (nothing)
// Result: Optional.empty
System.out.println("Return value: " + OPTIONAL.narrow(peekFailure));
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="monaderror-handling-errors-gracefully-"><a class="header" href="#monaderror-handling-errors-gracefully-">MonadError: Handling Errors Gracefully üö®</a></h1>
<p>While a <code>Monad</code> is excellent for sequencing operations that might fail (like with <code>Optional</code> or <code>Either</code>), it doesn't provide a standardized way to <em>inspect</em> or <em>recover</em> from those failures. The <strong><code>MonadError</code></strong> type class fills this gap.</p>
<p>It's a specialised <code>Monad</code> that has a defined error type <code>E</code>, giving you a powerful and abstract API for raising and handling errors within any monadic workflow.</p>
<hr />
<h2 id="what-is-it-3"><a class="header" href="#what-is-it-3">What is it?</a></h2>
<p>A <strong><code>MonadError</code></strong> is a <code>Monad</code> that provides two additional, fundamental operations for working with failures:</p>
<ol>
<li><strong><code>raiseError(E error)</code></strong>: This allows you to construct a failed computation by lifting an error value <code>E</code> directly into the monadic context.</li>
<li><strong><code>handleErrorWith(Kind&lt;F, A&gt; fa, ...)</code></strong>: This is the recovery mechanism. It allows you to inspect a potential failure and provide a fallback computation to rescue the workflow.</li>
</ol>
<p>By abstracting over a specific error type <code>E</code>, <code>MonadError</code> allows you to write generic, resilient code that can work with any data structure capable of representing failure, such as <code>Either&lt;E, A&gt;</code>, <code>Try&lt;A&gt;</code> (where <code>E</code> is <code>Throwable</code>), or even custom error-handling monads.</p>
<p>The interface for <code>MonadError</code> in <code>hkj-api</code> extends <code>Monad</code>:</p>
<pre><code class="language-java">@NullMarked
public interface MonadError&lt;F, E&gt; extends Monad&lt;F&gt; {

  &lt;A&gt; @NonNull Kind&lt;F, A&gt; raiseError(@Nullable final E error);

  &lt;A&gt; @NonNull Kind&lt;F, A&gt; handleErrorWith(
      final Kind&lt;F, A&gt; ma,
      final Function&lt;? super E, ? extends Kind&lt;F, A&gt;&gt; handler);

  // Default recovery methods like handleError, recover, etc. are also provided
  default &lt;A&gt; @NonNull Kind&lt;F, A&gt; handleError(
      final Kind&lt;F, A&gt; ma,
      final Function&lt;? super E, ? extends A&gt; handler) {
    return handleErrorWith(ma, error -&gt; of(handler.apply(error)));
  }
}
</code></pre>
<hr />
<h3 id="why-is-it-useful-3"><a class="header" href="#why-is-it-useful-3">Why is it useful?</a></h3>
<p><code>MonadError</code> formalizes the pattern of "try-catch" in a purely functional way. It lets you build complex workflows that need to handle specific types of errors without coupling your logic to a concrete implementation like <code>Either</code> or <code>Try</code>. You can write a function once, and it will work seamlessly with any data type that has a <code>MonadError</code> instance.</p>
<p>This is incredibly useful for building robust applications, separating business logic from error-handling logic, and providing sensible fallbacks when operations fail.</p>
<p><strong>Example: A Resilient Division Workflow</strong></p>
<p>Let's model a division operation that can fail with a specific error message. We'll use <code>Either&lt;String, A&gt;</code> as our data type, which is a perfect fit for <code>MonadError</code>.</p>
<pre><code class="language-java">import org.higherkindedj.hkt.Kind;
import org.higherkindedj.hkt.either.Either;
import org.higherkindedj.hkt.either.EitherMonad;
import static org.higherkindedj.hkt.either.EitherKindHelper.EITHER;

// --- Get the MonadError instance for Either&lt;String, ?&gt; ---
MonadError&lt;Either.Witness&lt;String&gt;, String&gt; monadError = EitherMonad.instance();

// A function that performs division, raising a specific error on failure
public Kind&lt;Either.Witness&lt;String&gt;, Integer&gt; safeDivide(int a, int b) {
    if (b == 0) {
        return monadError.raiseError("Cannot divide by zero!");
    }
    return monadError.of(a / b);
}

// --- Scenario 1: A successful division ---
Kind&lt;Either.Witness&lt;String&gt;, Integer&gt; success = safeDivide(10, 2);

// Result: Right(5)
System.out.println(EITHER.narrow(success));


// --- Scenario 2: A failed division ---
Kind&lt;Either.Witness&lt;String&gt;, Integer&gt; failure = safeDivide(10, 0);

// Result: Left(Cannot divide by zero!)
System.out.println(EITHER.narrow(failure));


// --- Scenario 3: Recovering from the failure ---
// We can use handleErrorWith to catch the error and return a fallback value.
Kind&lt;Either.Witness&lt;String&gt;, Integer&gt; recovered = monadError.handleErrorWith(
    failure,
    errorMessage -&gt; {
        System.out.println("Caught an error: " + errorMessage);
        return monadError.of(0); // Recover with a default value of 0
    }
);

// Result: Right(0)
System.out.println(EITHER.narrow(recovered));
</code></pre>
<p>In this example, <code>raiseError</code> allows us to create the failure case in a clean, declarative way, while <code>handleErrorWith</code> provides a powerful mechanism for recovery, making our code more resilient and predictable.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="semigroup-and-monoid"><a class="header" href="#semigroup-and-monoid">Semigroup and Monoid:</a></h1>
<h2 id="foundational-type-classes-"><a class="header" href="#foundational-type-classes-">Foundational Type Classes üßÆ</a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="functional/semigroup_and_monoid.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>The fundamental building blocks for combining data: Semigroup and Monoid</li>
<li>How associative operations enable parallel and sequential data processing</li>
<li>Using Monoids for error accumulation in validation scenarios</li>
<li>Practical applications with String concatenation, integer addition, and boolean operations</li>
<li>How these abstractions power Foldable operations and validation workflows</li>
</ul>
</div>
</div>
<p>In functional programming, we often use <strong>type classes</strong> to define common behaviours that can be applied to a wide range of data types. These act as interfaces that allow us to write more abstract and reusable code. In <code>higher-kinded-j</code>, we provide a number of these type classes to enable powerful functional patterns.</p>
<p>Here we will cover two foundational type classes: <code>Semigroup</code> and <code>Monoid</code>. Understanding these will give you a solid foundation for many of the more advanced concepts in the library.</p>
<hr />
<h2 id="semigroupa-1"><a class="header" href="#semigroupa-1"><strong><code>Semigroup&lt;A&gt;</code></strong></a></h2>
<p>A <strong><code>Semigroup</code></strong> is one of the simplest and most fundamental type classes. It provides a blueprint for types that have a single, associative way of being combined.</p>
<h3 id="what-is-it-4"><a class="header" href="#what-is-it-4">What is it?</a></h3>
<p>A <code>Semigroup</code> is a type class for any data type that has a <code>combine</code> operation. This operation takes two values of the same type and merges them into a single value of that type. The only rule is that this operation must be <strong>associative</strong>.</p>
<p>This means that for any values <code>a</code>, <code>b</code>, and <code>c</code>:</p>
<p><code>(a.combine(b)).combine(c)</code> must be equal to <code>a.combine(b.combine(c))</code></p>
<p>The interface for <code>Semigroup</code> in <code>hkj-api</code> is as follows:</p>
<pre><code class="language-java">public interface Semigroup&lt;A&gt; {
    A combine(A a1, A a2);
}
</code></pre>
<h3 id="common-instances-the-semigroups-utility"><a class="header" href="#common-instances-the-semigroups-utility">Common Instances: The <code>Semigroups</code> Utility</a></h3>
<p>To make working with <code>Semigroup</code> easier, <code>higher-kinded-j</code> provides a <code>Semigroups</code> utility interface with static factory methods for common instances.</p>
<pre><code class="language-java">// Get a Semigroup for concatenating Strings
Semigroup&lt;String&gt; stringConcat = Semigroups.string();

// Get a Semigroup for concatenating Strings with a delimiter
Semigroup&lt;String&gt; stringConcatDelimited = Semigroups.string(", ");

// Get a Semigroup for concatenating Lists
Semigroup&lt;List&lt;Integer&gt;&gt; listConcat = Semigroups.list();
</code></pre>
<h3 id="where-is-it-used-in-higher-kinded-j"><a class="header" href="#where-is-it-used-in-higher-kinded-j">Where is it used in <code>higher-kinded-j</code>?</a></h3>
<p>The primary and most powerful use case for <code>Semigroup</code> in this library is to enable <strong>error accumulation</strong> with the <strong><code>Validated</code></strong> data type.</p>
<p>When you use the <code>Applicative</code> instance for <code>Validated</code>, you must provide a <code>Semigroup</code> for the error type. This tells the applicative how to combine errors when multiple invalid computations occur.</p>
<p><strong>Example: Accumulating Validation Errors</strong></p>
<pre><code class="language-java">// Create an applicative for Validated that accumulates String errors by joining them.
Applicative&lt;Validated.Witness&lt;String&gt;&gt; applicative =
    ValidatedMonad.instance(Semigroups.string("; "));

// Two invalid results
Validated&lt;String, Integer&gt; invalid1 = Validated.invalid("Field A is empty");
Validated&lt;String, Integer&gt; invalid2 = Validated.invalid("Field B is not a number");

// Combine them using the applicative's map2 method
Kind&lt;Validated.Witness&lt;String&gt;, Integer&gt; result =
    applicative.map2(
        VALIDATED.widen(invalid1),
        VALIDATED.widen(invalid2),
        (val1, val2) -&gt; val1 + val2
    );

// The errors are combined using our Semigroup
// Result: Invalid("Field A is empty; Field B is not a number")
System.out.println(VALIDATED.narrow(result));
</code></pre>
<hr />
<h2 id="monoida-1"><a class="header" href="#monoida-1"><strong><code>Monoid&lt;A&gt;</code></strong></a></h2>
<p>A <strong><code>Monoid</code></strong> is a <code>Semigroup</code> with a special "identity" or "empty" element. This makes it even more powerful, as it provides a way to have a "starting" or "default" value.</p>
<h3 id="what-is-it-5"><a class="header" href="#what-is-it-5">What is it?</a></h3>
<p>A <code>Monoid</code> is a type class for any data type that has an associative <code>combine</code> operation (from <code>Semigroup</code>) and an <code>empty</code> value. This <code>empty</code> value is a special element that, when combined with any other value, returns that other value.</p>
<p>This is known as the <strong>identity law</strong>. For any value <code>a</code>:</p>
<p><code>a.combine(empty())</code> must be equal to <code>a``empty().combine(a)</code> must be equal to <code>a</code></p>
<p>The interface for <code>Monoid</code> in <code>hkj-api</code> extends <code>Semigroup</code>:</p>
<pre><code class="language-java">public interface Monoid&lt;A&gt; extends Semigroup&lt;A&gt; {
    A empty();
}
</code></pre>
<h3 id="common-instances-the-monoids-utility"><a class="header" href="#common-instances-the-monoids-utility">Common Instances: The <code>Monoids</code> Utility</a></h3>
<p>Similar to <code>Semigroups</code>, the library provides a <code>Monoids</code> utility interface for creating common instances.</p>
<pre><code class="language-java">// Get a Monoid for integer addition (empty = 0)
Monoid&lt;Integer&gt; intAddition = Monoids.integerAddition();

// Get a Monoid for String concatenation (empty = "")
Monoid&lt;String&gt; stringMonoid = Monoids.string();

// Get a Monoid for boolean AND (empty = true)
Monoid&lt;Boolean&gt; booleanAnd = Monoids.booleanAnd();
</code></pre>
<h3 id="where-it-is-used-in-higher-kinded-j"><a class="header" href="#where-it-is-used-in-higher-kinded-j">Where it is used in <code>higher-kinded-j</code></a></h3>
<p>A <code>Monoid</code> is essential for <strong>folding</strong> (or reducing) a data structure. The <code>empty</code> element provides a safe starting value, which means you can correctly fold a collection that might be empty.</p>
<p>This is formalised in the <strong><code>Foldable</code></strong> typeclass, which has a <code>foldMap</code> method. This method maps every element in a structure to a monoidal type and then combines all the results.</p>
<p><strong>Example: Using <code>foldMap</code> with different Monoids</strong></p>
<pre><code class="language-java">List&lt;Integer&gt; numbers = List.of(1, 2, 3, 4, 5);
Kind&lt;ListKind.Witness, Integer&gt; numbersKind = LIST.widen(numbers);

// 1. Sum the list using the integer addition monoid
Integer sum = ListTraverse.INSTANCE.foldMap(
    Monoids.integerAddition(),
    Function.identity(),
    numbersKind
); // Result: 15

// 2. Concatenate the numbers as strings
String concatenated = ListTraverse.INSTANCE.foldMap(
    Monoids.string(),
    String::valueOf,
    numbersKind
); // Result: "12345"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="foldable--traverse"><a class="header" href="#foldable--traverse">Foldable &amp; Traverse:</a></h1>
<h2 id="reducing-a-structure-to-a-summary"><a class="header" href="#reducing-a-structure-to-a-summary">Reducing a Structure to a Summary</a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="functional/foldable_and_traverse.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to reduce any data structure to a summary value using <code>foldMap</code></li>
<li>The power of swapping Monoids to get different aggregations from the same data</li>
<li>Turning effects "inside-out" with <code>traverse</code> operations</li>
<li>Validating entire collections and collecting all errors at once</li>
<li>The relationship between <code>sequence</code> and <code>traverse</code> for effectful operations</li>
</ul>
</div>
</div>
<p>The <strong><code>Foldable</code></strong> typeclass represents one of the most common and powerful patterns in functional programming: <strong>reducing a data structure to a single summary value</strong>. If you've ever calculated the sum of a list of numbers or concatenated a list of strings, you've performed a fold.</p>
<p><code>Foldable</code> abstracts this pattern, allowing you to write generic code that can aggregate any data structure that knows how to be folded.</p>
<hr />
<h2 id="what-is-it-6"><a class="header" href="#what-is-it-6">What is it?</a></h2>
<p>A typeclass is <code>Foldable</code> if it can be "folded up" from left to right into a summary value. The key to this process is the <strong><code>Monoid</code></strong>, which provides two essential things:</p>
<ol>
<li>An <strong><code>empty</code></strong> value to start with (e.g., <code>0</code> for addition).</li>
<li>A <strong><code>combine</code></strong> operation to accumulate the results (e.g., <code>+</code>).</li>
</ol>
<p>The core method of the <code>Foldable</code> typeclass is <strong><code>foldMap</code></strong>.</p>
<h3 id="the-foldmap-method"><a class="header" href="#the-foldmap-method">The <code>foldMap</code> Method</a></h3>
<p><code>foldMap</code> is a powerful operation that does two things in one step:</p>
<ol>
<li>It <strong>maps</strong> each element in the data structure to a value of a monoidal type.</li>
<li>It <strong>folds</strong> (combines) all of those monoidal values into a final result.</li>
</ol>
<p>The interface for <code>Foldable</code> in <code>hkj-api</code> is as follows:</p>
<pre><code class="language-java">public interface Foldable&lt;F&gt; {
  &lt;A, M&gt; M foldMap(
      Monoid&lt;M&gt; monoid,
      Function&lt;? super A, ? extends M&gt; f,
      Kind&lt;F, A&gt; fa
  );
}
</code></pre>
<hr />
<h3 id="why-is-it-useful-4"><a class="header" href="#why-is-it-useful-4">Why is it useful?</a></h3>
<p><code>Foldable</code> allows you to perform powerful aggregations on any data structure without needing to know its internal representation. By simply swapping out the <code>Monoid</code>, you can get completely different summaries from the same data.</p>
<p>Let's see this in action with <code>List</code>, which has a <code>Foldable</code> instance provided by <code>ListTraverse</code>.</p>
<p><strong>Example: Aggregating a List with Different Monoids</strong></p>
<pre><code class="language-java">// Our data
List&lt;Integer&gt; numbers = List.of(1, 2, 3, 4, 5);
Kind&lt;ListKind.Witness, Integer&gt; numbersKind = LIST.widen(numbers);

// Our Foldable instance for List
Foldable&lt;ListKind.Witness&gt; listFoldable = ListTraverse.INSTANCE;

// --- Scenario 1: Sum the numbers ---
// We use the integer addition monoid (empty = 0, combine = +)
Integer sum = listFoldable.foldMap(
    Monoids.integerAddition(),
    Function.identity(), // Map each number to itself
    numbersKind
);
// Result: 15

// --- Scenario 2: Check if all numbers are positive ---
// We map each number to a boolean and use the "AND" monoid (empty = true, combine = &amp;&amp;)
Boolean allPositive = listFoldable.foldMap(
    Monoids.booleanAnd(),
    num -&gt; num &gt; 0,
    numbersKind
);
// Result: true

// --- Scenario 3: Convert to strings and concatenate ---
// We map each number to a string and use the string monoid (empty = "", combine = +)
String asString = listFoldable.foldMap(
    Monoids.string(),
    String::valueOf,
    numbersKind
);
// Result: "12345"
</code></pre>
<p>As you can see, <code>foldMap</code> provides a single, abstract way to perform a wide variety of aggregations, making your code more declarative and reusable.</p>
<hr />
<h1 id="traverse-effectful-folding"><a class="header" href="#traverse-effectful-folding">Traverse: Effectful Folding</a></h1>
<p>The <strong><code>Traverse</code></strong> typeclass is a powerful extension of <code>Foldable</code> and <code>Functor</code>. It allows you to iterate over a data structure, but with a twist: at each step, you can perform an <strong>effectful</strong> action and then collect all the results back into a single effect.</p>
<p>This is one of the most useful typeclasses for real-world applications, as it elegantly handles scenarios like validating all items in a list, fetching data for each ID in a collection, and much more.</p>
<hr />
<h2 id="what-is-it-7"><a class="header" href="#what-is-it-7">What is it?</a></h2>
<p>A typeclass is <code>Traverse</code> if it can be "traversed" from left to right. The key to this process is the <strong><code>Applicative</code></strong>, which defines how to sequence the effects at each step.</p>
<p>The core method of the <code>Traverse</code> typeclass is <strong><code>traverse</code></strong>.</p>
<h3 id="the-traverse-method"><a class="header" href="#the-traverse-method">The <code>traverse</code> Method</a></h3>
<p>The <code>traverse</code> method takes a data structure and a function that maps each element to an effectful computation (wrapped in an <code>Applicative</code> like <code>Validated</code>, <code>Optional</code>, or <code>Either</code>). It then runs these effects in sequence and collects the results.</p>
<p>The true power of <code>traverse</code> is that it can turn a structure of effects "inside-out". For example, it can transform a <code>List&lt;Validated&lt;E, A&gt;&gt;</code> into a single <code>Validated&lt;E, List&lt;A&gt;&gt;</code>.</p>
<p>The interface for <code>Traverse</code> in <code>hkj-api</code> extends <code>Functor</code> and <code>Foldable</code>:</p>
<p><strong>Java</strong></p>
<pre><code>public interface Traverse&lt;T&gt; extends Functor&lt;T&gt;, Foldable&lt;T&gt; {
  &lt;F, A, B&gt; Kind&lt;F, Kind&lt;T, B&gt;&gt; traverse(
      Applicative&lt;F&gt; applicative,
      Function&lt;A, Kind&lt;F, B&gt;&gt; f,
      Kind&lt;T, A&gt; ta
  );
  //... sequenceA method also available
}
</code></pre>
<hr />
<h3 id="why-is-it-useful-5"><a class="header" href="#why-is-it-useful-5">Why is it useful?</a></h3>
<p><code>Traverse</code> abstracts away the boilerplate of iterating over a collection, performing a failable action on each element, and then correctly aggregating the results.</p>
<p><strong>Example: Validating a List of Promo Codes</strong></p>
<p>Imagine you have a list of promo codes, and you want to validate each one. Your validation function returns a <code>Validated&lt;String, PromoCode&gt;</code>. Without <code>traverse</code>, you'd have to write a manual loop, collect all the errors, and handle the logic yourself.</p>
<p>With <code>traverse</code>, this becomes a single, elegant expression.</p>
<p><strong>Java</strong></p>
<pre><code>// Our validation function
public Kind&lt;Validated.Witness&lt;String&gt;, String&gt; validateCode(String code) {
    if (code.startsWith("VALID")) {
        return VALIDATED.widen(Validated.valid(code));
    }
    return VALIDATED.widen(Validated.invalid("'" + code + "' is not a valid code"));
}

// Our data
List&lt;String&gt; codes = List.of("VALID-A", "EXPIRED", "VALID-B", "INVALID");
Kind&lt;ListKind.Witness, String&gt; codesKind = LIST.widen(codes);

// The Applicative for Validated, using a Semigroup to join errors
Applicative&lt;Validated.Witness&lt;String&gt;&gt; validatedApplicative =
    ValidatedMonad.instance(Semigroups.string("; "));

// --- Traverse the list ---
Kind&lt;Validated.Witness&lt;String&gt;, Kind&lt;ListKind.Witness, String&gt;&gt; result =
    ListTraverse.INSTANCE.traverse(
        validatedApplicative,
        this::validateCode,
        codesKind
    );

// The result is a single Validated instance with accumulated errors.
// Result: Invalid("'EXPIRED' is not a valid code; 'INVALID' is not a valid code")
System.out.println(VALIDATED.narrow(result));
</code></pre>
<h3 id="sequencea"><a class="header" href="#sequencea"><code>sequenceA</code></a></h3>
<p><code>Traverse</code> also provides <code>sequenceA</code>, which is a specialised version of <code>traverse</code>. It's used when you already have a data structure containing effects (e.g., a <code>List&lt;Optional&lt;A&gt;&gt;</code>) and you want to flip it into a single effect containing the data structure (<code>Optional&lt;List&lt;A&gt;&gt;</code>).</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="monadzero"><a class="header" href="#monadzero">MonadZero</a></h1>
<p>The <code>MonadZero</code> is a more advanced type class extends the <code>Monad</code> interface to include the concept of a "zero" or "empty" element. It is designed for monads that can represent failure, absence, or emptiness, allowing them to be used in filtering operations.</p>
<p>The interface for MonadZero in hkj-api extends Monad:</p>
<pre><code class="language-java">public interface MonadZero&lt;F&gt; extends Monad&lt;F&gt; {
    &lt;A&gt; Kind&lt;F, A&gt; zero();
}
</code></pre>
<h3 id="why-is-it-useful-6"><a class="header" href="#why-is-it-useful-6">Why is it useful?</a></h3>
<p>A <code>Monad</code> provides a way to sequence computations within a context (<code>flatMap</code>, <code>map</code>, <code>of</code>). A <code>MonadZero</code> adds one critical operation to this structure:</p>
<ul>
<li><code>zero()</code>: Returns the "empty" or "zero" element for the monad.</li>
</ul>
<p>This <code>zero</code> element acts as an absorbing element in a monadic sequence, similar to how multiplying by zero results in zero. If a computation results in a <code>zero</code>, subsequent operations in the chain are typically skipped.</p>
<p><code>MonadZero</code> is particularly useful for making for-comprehensions more powerful. When you are working with a monad that has a <code>MonadZero</code> instance, you can use a <code>when()</code> clause to filter results within the comprehension.</p>
<p><strong>Key Implementations in this Project:</strong></p>
<ul>
<li>For <strong>List</strong>, <code>zero()</code> returns an empty list <code>[]</code>.</li>
<li>For <strong>Maybe</strong>, <code>zero()</code> returns <code>Nothing</code>.</li>
<li>For <strong>Optional</strong>, <code>zero()</code> returns <code>Optional.empty()</code>.</li>
</ul>
<h3 id="primary-uses"><a class="header" href="#primary-uses">Primary Uses</a></h3>
<p>The main purpose of <code>MonadZero</code> is to enable filtering within monadic comprehensions. It allows you to discard results that don't meet a certain criterion.</p>
<h4 id="1-filtering-in-for-comprehensions"><a class="header" href="#1-filtering-in-for-comprehensions">1. Filtering in For-Comprehensions</a></h4>
<p>As already mentioned the most powerful application in this codebase is within the <strong><code>For</code> comprehension builder</strong>. The builder has two entry points:</p>
<ul>
<li><code>For.from(monad, ...)</code>: For any standard <code>Monad</code>.</li>
<li><code>For.from(monadZero, ...)</code>: An overloaded version specifically for a <code>MonadZero</code>.</li>
</ul>
<p>Only the version that accepts a <code>MonadZero</code> provides the <code>.when(predicate)</code> filtering step. When the predicate in a <code>.when()</code> clause evaluates to <code>false</code>, the builder internally calls <code>monad.zero()</code> to terminate that specific computational path.</p>
<h4 id="2-generic-functions"><a class="header" href="#2-generic-functions">2. Generic Functions</a></h4>
<p>It allows you to write generic functions that can operate over any monad that has a concept of "failure" or "emptiness," such as <code>List</code>, <code>Maybe</code>, or <code>Optional</code>.</p>
<h3 id="code-example-for-comprehension-with-listmonad"><a class="header" href="#code-example-for-comprehension-with-listmonad">Code Example: <code>For</code> Comprehension with <code>ListMonad</code></a></h3>
<p>The following example demonstrates how <code>MonadZero</code> enables filtering.</p>
<pre><code class="language-java">import org.higherkindedj.hkt.Kind;
import org.higherkindedj.hkt.expression.For;
import org.higherkindedj.hkt.list.ListKind;
import org.higherkindedj.hkt.list.ListMonad;
import java.util.Arrays;
import java.util.List;

import static org.higherkindedj.hkt.list.ListKindHelper.LIST;

// 1. Get the MonadZero instance for List
final ListMonad listMonad = ListMonad.INSTANCE;

// 2. Define the initial data sources
final Kind&lt;ListKind.Witness, Integer&gt; list1 = LIST.widen(Arrays.asList(1, 2, 3));
final Kind&lt;ListKind.Witness, Integer&gt; list2 = LIST.widen(Arrays.asList(10, 20));

// 3. Build the comprehension using the filterable 'For'
final Kind&lt;ListKind.Witness, String&gt; result =
    For.from(listMonad, list1)                       // Start with a MonadZero
        .from(a -&gt; list2)                            // Generator (flatMap)
        .when(t -&gt; (t._1() + t._2()) % 2 != 0)        // Filter: if the sum is odd
        .let(t -&gt; "Sum: " + (t._1() + t._2()))        // Binding (map)
        .yield((a, b, c) -&gt; a + " + " + b + " = " + c); // Final projection

// 4. Unwrap the result
final List&lt;String&gt; narrow = LIST.narrow(result);
System.out.println("Result of List comprehension: " + narrow);
</code></pre>
<p><strong>Explanation:</strong></p>
<ul>
<li>The comprehension iterates through all pairs of <code>(a, b)</code> from <code>list1</code> and <code>list2</code>.</li>
<li>The <code>.when(...)</code> clause checks if the sum <code>a + b</code> is odd.</li>
<li>If the sum is even, the <code>monad.zero()</code> method (which returns an empty list) is invoked for that path, effectively discarding it.</li>
<li>If the sum is odd, the computation continues to the <code>.let()</code> and <code>.yield()</code> steps.</li>
</ul>
<p><strong>Output:</strong></p>
<p><code>Result of List comprehension: [1 + 10 = Sum: 11, 1 + 20 = Sum: 21, 3 + 10 = Sum: 13, 3 + 20 = Sum: 23]</code></p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="profunctor-building-adaptable-data-pipelines-"><a class="header" href="#profunctor-building-adaptable-data-pipelines-">Profunctor: Building Adaptable Data Pipelines üîÑ</a></h1>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="functional/profunctor.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to build adaptable data transformation pipelines</li>
<li>The dual nature of Profunctors: contravariant inputs and covariant outputs</li>
<li>Using <code>lmap</code>, <code>rmap</code>, and <code>dimap</code> to adapt functions for different contexts</li>
<li>Creating flexible API adapters and validation pipelines</li>
<li>Real-world applications in data format transformation and system integration</li>
</ul>
</div>
</div>
<div id="admonition-note" class="admonition admonish-note" role="note" aria-labelledby="admonition-note-title">
<div class="admonition-title">
<div id="admonition-note-title">
<p>Note</p>
</div>
<a class="admonition-anchor-link" href="functional/profunctor.html#admonition-note"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/profunctor/ProfunctorExample.java">ProfunctorExample.java</a></p>
</div>
</div>
<p>So far, we've explored type classes that work with single type parameters‚Äî<code>Functor</code>, <code>Applicative</code>, and <code>Monad</code> all operate on types like <code>F&lt;A&gt;</code>. But what about types that take <em>two</em> parameters, like <code>Function&lt;A, B&gt;</code> or <code>Either&lt;L, R&gt;</code>? This is where <strong>Profunctors</strong> come in.</p>
<p>A <strong>Profunctor</strong> is a powerful abstraction for working with types that are <strong>contravariant</strong> in their first type parameter and <strong>covariant</strong> in their second. Think of it as a generalisation of how functions work: you can pre-process the input (contravariant) and post-process the output (covariant).</p>
<hr />
<h2 id="what-is-a-profunctor"><a class="header" href="#what-is-a-profunctor">What is a Profunctor?</a></h2>
<p>A <code>Profunctor</code> is a type class for any type constructor <code>P&lt;A, B&gt;</code> that supports three key operations:</p>
<ul>
<li><strong><code>lmap</code></strong>: Map over the first (input) type parameter contravariantly</li>
<li><strong><code>rmap</code></strong>: Map over the second (output) type parameter covariantly</li>
<li><strong><code>dimap</code></strong>: Map over both parameters simultaneously</li>
</ul>
<p>The interface for <code>Profunctor</code> in <code>hkj-api</code> works with <code>Kind2&lt;P, A, B&gt;</code>:</p>
<pre><code class="language-java">@NullMarked
public interface Profunctor&lt;P&gt; {
  
    // Map over the input (contravariant)
    default &lt;A, B, C&gt; Kind2&lt;P, C, B&gt; lmap(
        Function&lt;? super C, ? extends A&gt; f, 
        Kind2&lt;P, A, B&gt; pab) {
        return dimap(f, Function.identity(), pab);
    }

    // Map over the output (covariant)
    default &lt;A, B, C&gt; Kind2&lt;P, A, C&gt; rmap(
        Function&lt;? super B, ? extends C&gt; g, 
        Kind2&lt;P, A, B&gt; pab) {
        return dimap(Function.identity(), g, pab);
    }

    // Map over both input and output
    &lt;A, B, C, D&gt; Kind2&lt;P, C, D&gt; dimap(
        Function&lt;? super C, ? extends A&gt; f,
        Function&lt;? super B, ? extends D&gt; g,
        Kind2&lt;P, A, B&gt; pab);
}
</code></pre>
<hr />
<h2 id="the-canonical-example-functions"><a class="header" href="#the-canonical-example-functions">The Canonical Example: Functions</a></h2>
<p>The most intuitive example of a profunctor is the humble <code>Function&lt;A, B&gt;</code>. Functions are naturally:</p>
<ul>
<li><strong>Contravariant in their input</strong>: If you have a function <code>String -&gt; Integer</code>, you can adapt it to work with any type that can be converted <em>to</em> a <code>String</code></li>
<li><strong>Covariant in their output</strong>: You can adapt the same function to produce any type that an <code>Integer</code> can be converted <em>to</em></li>
</ul>
<p>Let's see this in action with <code>FunctionProfunctor</code>:</p>
<pre><code class="language-java">import static org.higherkindedj.hkt.func.FunctionKindHelper.FUNCTION;
import org.higherkindedj.hkt.func.FunctionProfunctor;

// Our original function: calculate string length
Function&lt;String, Integer&gt; stringLength = String::length;
Kind2&lt;FunctionKind.Witness, String, Integer&gt; lengthFunction = FUNCTION.widen(stringLength);

FunctionProfunctor profunctor = FunctionProfunctor.INSTANCE;

// LMAP: Adapt the input - now we can use integers!
Kind2&lt;FunctionKind.Witness, Integer, Integer&gt; intToLength =
    profunctor.lmap(Object::toString, lengthFunction);

Function&lt;Integer, Integer&gt; intLengthFunc = FUNCTION.getFunction(intToLength);
System.out.println(intLengthFunc.apply(12345)); // Output: 5

// RMAP: Adapt the output - now we get formatted strings!
Kind2&lt;FunctionKind.Witness, String, String&gt; lengthToString =
    profunctor.rmap(len -&gt; "Length: " + len, lengthFunction);

Function&lt;String, String&gt; lengthStringFunc = FUNCTION.getFunction(lengthToString);
System.out.println(lengthStringFunc.apply("Hello")); // Output: "Length: 5"

// DIMAP: Adapt both sides simultaneously
Kind2&lt;FunctionKind.Witness, Integer, String&gt; fullTransform =
    profunctor.dimap(
        Object::toString,           // int -&gt; string
        len -&gt; "Result: " + len,    // int -&gt; string
        lengthFunction);

Function&lt;Integer, String&gt; fullFunc = FUNCTION.getFunction(fullTransform);
System.out.println(fullFunc.apply(42)); // Output: "Result: 2"
</code></pre>
<hr />
<h2 id="why-profunctors-matter"><a class="header" href="#why-profunctors-matter">Why Profunctors Matter</a></h2>
<p>Profunctors excel at creating <strong>adaptable data transformation pipelines</strong>. They're particularly powerful for:</p>
<h3 id="1-api-adapters-"><a class="header" href="#1-api-adapters-">1. <strong>API Adapters</strong> üîå</a></h3>
<p>When you need to integrate with external systems that expect different data formats:</p>
<pre><code class="language-java">// Core business logic: validate a user
Function&lt;User, ValidationResult&gt; validateUser = user -&gt; {
    boolean isValid = user.email().contains("@") &amp;&amp; !user.name().isEmpty();
    return new ValidationResult(isValid, isValid ? "Valid user" : "Invalid user data");
};

// The API expects UserDto input and ApiResponse output
Kind2&lt;FunctionKind.Witness, UserDto, ApiResponse&lt;ValidationResult&gt;&gt; apiValidator =
    profunctor.dimap(
        // Convert UserDto -&gt; User (contravariant)
        dto -&gt; new User(dto.fullName(), dto.emailAddress(), 
                        LocalDate.parse(dto.birthDateString())),
        // Convert ValidationResult -&gt; ApiResponse (covariant)  
        result -&gt; new ApiResponse&lt;&gt;(result, "OK", result.isValid() ? 200 : 400),
        FUNCTION.widen(validateUser));

// Now our core logic works seamlessly with the external API format!
Function&lt;UserDto, ApiResponse&lt;ValidationResult&gt;&gt; apiFunc = FUNCTION.getFunction(apiValidator);
</code></pre>
<h3 id="2-validation-pipelines-"><a class="header" href="#2-validation-pipelines-">2. <strong>Validation Pipelines</strong> ‚úÖ</a></h3>
<p>Build reusable validation logic that adapts to different input and output formats:</p>
<pre><code class="language-java">// Core validation: check if a number is positive
Function&lt;Double, Boolean&gt; isPositive = x -&gt; x &gt; 0;

// Adapt for string input with detailed error messages
Kind2&lt;FunctionKind.Witness, String, String&gt; stringValidator =
    profunctor.dimap(
        // Parse string to double
        str -&gt; {
            try {
                return Double.parseDouble(str);
            } catch (NumberFormatException e) {
                return -1.0; // Invalid marker
            }
        },
        // Convert boolean to message
        isValid -&gt; isValid ? "‚úì Valid positive number" : "‚úó Not a positive number",
        FUNCTION.widen(isPositive));

Function&lt;String, String&gt; validator = FUNCTION.getFunction(stringValidator);
System.out.println(validator.apply("42.5"));  // "‚úì Valid positive number"
System.out.println(validator.apply("-10"));   // "‚úó Not a positive number"
</code></pre>
<h3 id="3-data-transformation-chains-"><a class="header" href="#3-data-transformation-chains-">3. <strong>Data Transformation Chains</strong> üîó</a></h3>
<p>Chain multiple adaptations to build complex data processing pipelines:</p>
<pre><code class="language-java">// Core transformation: User -&gt; UserDto  
Function&lt;User, UserDto&gt; userToDto = user -&gt;
    new UserDto(user.name(), user.email(), 
                user.birthDate().format(DateTimeFormatter.ISO_LOCAL_DATE));

// Build a CSV-to-JSON pipeline
Kind2&lt;FunctionKind.Witness, String, String&gt; csvToJsonTransform =
    profunctor.dimap(
        csvParser,    // String -&gt; User (parse CSV)
        dtoToJson,    // UserDto -&gt; String (serialise to JSON)
        FUNCTION.widen(userToDto));

// Add error handling with another rmap
Kind2&lt;FunctionKind.Witness, String, ApiResponse&lt;String&gt;&gt; safeTransform =
    profunctor.rmap(
        jsonString -&gt; {
            if (jsonString.contains("INVALID")) {
                return new ApiResponse&lt;&gt;("", "ERROR: Invalid input data", 400);
            }
            return new ApiResponse&lt;&gt;(jsonString, "SUCCESS", 200);
        },
        csvToJsonTransform);
</code></pre>
<hr />
<h2 id="profunctor-laws"><a class="header" href="#profunctor-laws">Profunctor Laws</a></h2>
<p>For a <code>Profunctor</code> to be lawful, it must satisfy two key properties:</p>
<ol>
<li><strong>Identity</strong>: <code>dimap(identity, identity, p) == p</code></li>
<li><strong>Composition</strong>: <code>dimap(f1 ‚àò f2, g1 ‚àò g2, p) == dimap(f2, g1, dimap(f1, g2, p))</code></li>
</ol>
<p>These laws ensure that profunctor operations are predictable and composable‚Äîyou can build complex transformations by combining simpler ones without unexpected behaviour.</p>
<hr />
<h2 id="when-to-use-profunctors"><a class="header" href="#when-to-use-profunctors">When to Use Profunctors</a></h2>
<p>Profunctors are ideal when you need to:</p>
<ul>
<li><strong>Adapt existing functions</strong> to work with different input/output types</li>
<li><strong>Build flexible APIs</strong> that can handle multiple data formats</li>
<li><strong>Create reusable transformation pipelines</strong> that can be configured for different use cases</li>
<li><strong>Integrate with external systems</strong> without changing your core business logic</li>
<li><strong>Handle both sides of a computation</strong> (input preprocessing and output postprocessing)</li>
</ul>
<p>The next time you find yourself writing similar functions that differ only in their input parsing or output formatting, consider whether a profunctor could help you write the logic once and adapt it as needed!</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="for-comprehensions"><a class="header" href="#for-comprehensions">For-Comprehensions</a></h1>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="functional/for_comprehension.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to transform nested <code>flatMap</code> chains into readable, sequential code</li>
<li>The four types of operations: generators (<code>.from()</code>), bindings (<code>.let()</code>), guards (<code>.when()</code>), and projections (<code>.yield()</code>)</li>
<li>Building complex workflows with StateT and other monad transformers</li>
<li>Converting "pyramid of doom" code into clean, imperative-style scripts</li>
<li>Real-world examples from simple Maybe operations to complex state management</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="functional/for_comprehension.html#admonition-see-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/expression/ForComprehensionExample.java">ForComprehensionExample.java</a></p>
</div>
</div>
<p>Endless nested callbacks and unreadable chains of flatMap calls can be tiresome. The <code>higher-kinded-j</code> library brings the elegance and power of Scala-style for-comprehensions to Java, allowing you to write complex asynchronous and sequential logic in a way that is clean, declarative, and easy to follow.</p>
<p>Let's see how to transform "callback hell" into a readable, sequential script.</p>
<h2 id="the-pyramid-of-doom-problem"><a class="header" href="#the-pyramid-of-doom-problem">The "Pyramid of Doom" Problem</a></h2>
<p>In functional programming, monads are a powerful tool for sequencing operations, especially those with a context like <code>Optional</code>, <code>List</code>, or <code>CompletableFuture</code>. However, chaining these operations with <code>flatMap</code> can quickly become hard to read.</p>
<p>Consider combining three <code>Maybe</code> values:</p>
<pre><code class="language-java">// The "nested" way
Kind&lt;MaybeKind.Witness, Integer&gt; result = maybeMonad.flatMap(a -&gt;
    maybeMonad.flatMap(b -&gt;
        maybeMonad.map(c -&gt; a + b + c, maybeC),
    maybeB),
maybeA);
</code></pre>
<p>This code works, but the logic is buried inside nested lambdas. The intent‚Äîto simply get values from <code>maybeA</code>, <code>maybeB</code>, and <code>maybeC</code> and add them‚Äîis obscured. This is often called the "pyramid of doom."</p>
<h2 id="for-a-fluent-sequential-builder"><a class="header" href="#for-a-fluent-sequential-builder"><em>For</em> A Fluent, Sequential Builder</a></h2>
<p>The <code>For</code> comprehension builder provides a much more intuitive way to write the same logic. It lets you express the sequence of operations as if they were simple, imperative steps.</p>
<p>Here‚Äôs the same example rewritten with the <code>For</code> builder:</p>
<pre><code class="language-java">import static org.higherkindedj.hkt.maybe.MaybeKindHelper.MAYBE;
import org.higherkindedj.hkt.expression.For;
// ... other imports

var maybeMonad = MaybeMonad.INSTANCE;
var maybeA = MAYBE.just(5);
var maybeB = MAYBE.just(10);
var maybeC = MAYBE.just(20);

// The clean, sequential way
var result = For.from(maybeMonad, maybeA)    // Get a from maybeA
    .from(a -&gt; maybeB)                       // Then, get b from maybeB
    .from(t -&gt; maybeC)                       // Then, get c from maybeC
    .yield((a, b, c) -&gt; a + b + c);          // Finally, combine them

System.out.println(MAYBE.narrow(result)); // Prints: Just(35)
</code></pre>
<p>This version is flat, readable, and directly expresses the intended sequence of operations. The <code>For</code> builder automatically handles the <code>flatMap</code> and <code>map</code> calls behind the scenes.</p>
<h2 id="core-operations-of-the-for-builder"><a class="header" href="#core-operations-of-the-for-builder">Core Operations of the <code>For</code> Builder</a></h2>
<p>A for-comprehension is built by chaining four types of operations:</p>
<h3 id="1-generators-from"><a class="header" href="#1-generators-from">1. Generators: <code>.from()</code></a></h3>
<p>A generator is the workhorse of the comprehension. It takes a value from a previous step, uses it to produce a new monadic value (like another <code>Maybe</code> or <code>List</code>), and extracts the result for the next step. This is a direct equivalent of <strong><code>flatMap</code></strong>.</p>
<p>Each <code>.from()</code> adds a new variable to the scope of the comprehension.</p>
<pre><code class="language-java">// Generates all combinations of user IDs and roles
var userRoles = For.from(listMonad, LIST.widen(List.of("user-1", "user-2"))) // a: "user-1", "user-2"
    .from(a -&gt; LIST.widen(List.of("viewer", "editor")))       // b: "viewer", "editor"
    .yield((a, b) -&gt; a + " is a " + b);

// Result: ["user-1 is a viewer", "user-1 is a editor", "user-2 is a viewer", "user-2 is a editor"]
</code></pre>
<h3 id="2-value-bindings-let"><a class="header" href="#2-value-bindings-let">2. Value Bindings: <code>.let()</code></a></h3>
<p>A <code>.let()</code> binding allows you to compute a pure, simple value from the results you've gathered so far and add it to the scope. It does <em>not</em> involve a monad. This is equivalent to a <strong><code>map</code></strong> operation that carries the new value forward.</p>
<pre><code class="language-java">var idMonad = IdentityMonad.instance();

var result = For.from(idMonad, Id.of(10))        // a = 10
    .let(a -&gt; a * 2)                          // b = 20 (a pure calculation)
    .yield((a, b) -&gt; "Value: " + a + ", Doubled: " + b);

// Result: "Value: 10, Doubled: 20"
System.out.println(ID.unwrap(result));
</code></pre>
<h3 id="3-guards-when"><a class="header" href="#3-guards-when">3. Guards: <code>.when()</code></a></h3>
<p>For monads that can represent failure or emptiness (like <code>List</code>, <code>Maybe</code>, or <code>Optional</code>), you can use <code>.when()</code> to <strong>filter</strong> results. If the condition is false, the current computational path is stopped by returning the monad's "zero" value (e.g., an empty list or <code>Maybe.nothing()</code>).</p>
<blockquote>
<p>This feature requires a <code>MonadZero</code> instance. See the <code>MonadZero</code> documentation for more details.</p>
</blockquote>
<pre><code class="language-java">var evens = For.from(listMonad, LIST.widen(List.of(1, 2, 3, 4, 5, 6)))
    .when(i -&gt; i % 2 == 0) // Guard: only keep even numbers
    .yield(i -&gt; i);

// Result: [2, 4, 6]
</code></pre>
<h3 id="4-projection-yield"><a class="header" href="#4-projection-yield">4. Projection: <code>.yield()</code></a></h3>
<p>Every comprehension ends with <code>.yield()</code>. This is the final <strong><code>map</code></strong> operation where you take all the values you've gathered from the generators and bindings and produce your final result. You can access the bound values as individual lambda parameters or as a single <code>Tuple</code>.</p>
<h2 id="turn-the-power-up-statet-example"><a class="header" href="#turn-the-power-up-statet-example">Turn the power up: <code>StateT</code> Example</a></h2>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/expression/ForComprehensionExample.java">ForComprehensionExample.java</a></li>
</ul>
<p>The true power of for-comprehensions becomes apparent when working with complex structures like monad transformers. A <code>StateT</code> over <code>Optional</code> represents a <strong>stateful computation that can fail</strong>. Writing this with nested <code>flatMap</code> calls would be extremely complex. With the <code>For</code> builder, it becomes a simple, readable script.</p>
<pre><code class="language-java">import static org.higherkindedj.hkt.optional.OptionalKindHelper.OPTIONAL;
import static org.higherkindedj.hkt.state_t.StateTKindHelper.STATE_T;
// ... other imports

private static void stateTExample() {
    final var optionalMonad = OptionalMonad.INSTANCE;
    final var stateTMonad = StateTMonad.&lt;Integer, OptionalKind.Witness&gt;instance(optionalMonad);

    // Helper: adds a value to the state (an integer)
    final Function&lt;Integer, Kind&lt;StateTKind.Witness&lt;Integer, OptionalKind.Witness&gt;, Unit&gt;&gt; add =
        n -&gt; StateT.create(s -&gt; optionalMonad.of(StateTuple.of(s + n, Unit.INSTANCE)), optionalMonad);

    // Helper: gets the current state as the value
    final var get = StateT.&lt;Integer, OptionalKind.Witness, Integer&gt;create(s -&gt; optionalMonad.of(StateTuple.of(s, s)), optionalMonad);

    // This workflow looks like a simple script, but it's a fully-typed, purely functional composition!
    final var statefulComputation =
        For.from(stateTMonad, add.apply(10))      // Add 10 to state
            .from(a -&gt; add.apply(5))              // Then, add 5 more
            .from(b -&gt; get)                       // Then, get the current state (15)
            .let(t -&gt; "The state is " + t._3())   // Compute a string from it
            .yield((a, b, c, d) -&gt; d + ", original value was " + c); // Produce the final string

    // Run the computation with an initial state of 0
    final var resultOptional = STATE_T.runStateT(statefulComputation, 0);
    final Optional&lt;StateTuple&lt;Integer, String&gt;&gt; result = OPTIONAL.narrow(resultOptional);

    result.ifPresent(res -&gt; {
        System.out.println("Final value: " + res.value());
        System.out.println("Final state: " + res.state());
    });
    // Expected Output:
    // Final value: The state is 15, original value was 15
    // Final state: 15
}
</code></pre>
<p>In this example, Using the <code>For</code> comprehension really helps hide the complexity of threading the state (<code>Integer</code>) and handling potential failures (<code>Optional</code>), making the logic clear and maintainable.</p>
<p>For a more extensive example of using the full power of the For comprehension head over to the <a href="functional/../hkts/order-walkthrough.html">Order Workflow</a></p>
<h2 id="similarities-to-scala"><a class="header" href="#similarities-to-scala">Similarities to Scala</a></h2>
<p>If you're familiar with Scala, you'll recognise the pattern. In Scala, a for-comprehension looks like this:</p>
<pre><code class="language-scala">for {
 a &lt;- maybeA
 b &lt;- maybeB
 if (a + b &gt; 10)
 c = a + b
} yield c * 2
</code></pre>
<p>This is built in syntactic sugar that the compiler translates into a series of <code>flatMap</code>, <code>map</code>, and <code>withFilter</code> calls.
The <code>For</code> builder in <code>higher-kinded-j</code> provides the same expressive power through a method-chaining API.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="supported-types"><a class="header" href="#supported-types">Supported Types</a></h1>
<p><img src="monads/../images/monads_everywhere.webp" alt="monads_everywhere.webp" /></p>
<p>Higher-Kinded-J provides Higher-Kinded Type (HKT) simulation capabilities, allowing various Java types and custom types to be used with generic functional type classes like <code>Functor</code>, <code>Applicative</code>, <code>Monad</code>, and <code>MonadError</code>.</p>
<p>This is achieved by representing the application of a type constructor <code>F</code> to a type <code>A</code> as <code>Kind&lt;F_WITNESS, A&gt;</code>, where <code>F_WITNESS</code> is a special "witness" or phantom type unique to the type constructor <code>F</code>.</p>
<p><img src="monads/../images/puml/supported_types.svg" alt="supported_types.svg" /></p>
<hr />
<p><strong>Key for Understanding Entries:</strong></p>
<ul>
<li><strong>Type:</strong> The Java type or custom type being simulated.</li>
<li><strong><code>XxxKind&lt;A&gt;</code> Interface:</strong> The specific <code>Kind</code> interface for this type (e.g., <code>OptionalKind&lt;A&gt;</code>). It extends <code>Kind&lt;XxxKind.Witness, A&gt;</code> and usually contains the nested <code>final class Witness {}</code>.</li>
<li><strong>Witness Type <code>F_WITNESS</code>:</strong> The phantom type used as the first parameter to <code>Kind</code> (e.g., <code>OptionalKind.Witness</code>). This is what parameterizes the type classes (e.g., <code>Monad&lt;OptionalKind.Witness&gt;</code>).</li>
<li><strong><code>XxxKindHelper</code> Class:</strong> Provides <code>widen</code> and <code>narrow</code> methods.
<ul>
<li>For <strong>external types</strong> (like <code>java.util.List</code>, <code>java.util.Optional</code>), <code>widen</code> typically creates an internal <code>XxxHolder</code> record which implements <code>XxxKind&lt;A&gt;</code>, and <code>narrow</code> extracts the Java type from this holder.</li>
<li>For <strong>library-defined types</strong> (<code>Id</code>, <code>Maybe</code>, <code>IO</code>, <code>Try</code>, monad transformers), if the type itself directly implements <code>XxxKind&lt;A&gt;</code>, then <code>widen</code> often performs a (checked) cast, and <code>narrow</code> checks <code>instanceof</code> the actual type and casts.</li>
</ul>
</li>
<li><strong>Type Class Instances:</strong> Concrete implementations of <code>Functor&lt;F_WITNESS&gt;</code>, <code>Monad&lt;F_WITNESS&gt;</code>, etc.</li>
</ul>
<hr />
<h3 id="1-ida-identity"><a class="header" href="#1-ida-identity">1. <code>Id&lt;A&gt;</code> (Identity)</a></h3>
<ul>
<li><strong>Type Definition</strong>: A custom record (<a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/id/Id.java"><code>Id</code></a>) that directly wraps a value <code>A</code>. It's the simplest monad.</li>
<li><strong><code>IdKind&lt;A&gt;</code> Interface</strong>: <code>Id&lt;A&gt;</code> itself implements <code>IdKind&lt;A&gt;</code>, and <code>IdKind&lt;A&gt; extends Kind&lt;Id.Witness, A&gt;</code>.</li>
<li><strong>Witness Type <code>F_WITNESS</code></strong>: <code>Id.Witness</code></li>
<li><strong><code>IdKindHelper</code></strong>: <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/id/IdKindHelper.java"><code>IdKindHelper</code></a> (<code>wrap</code> casts <code>Id</code> to <code>Kind</code>, <code>unwrap</code> casts <code>Kind</code> to <code>Id</code>; <code>narrow</code> is a convenience for unwrap).</li>
<li><strong>Type Class Instances</strong>:
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/id/IdentityMonad.java"><code>IdentityMonad</code></a> (<code>Monad&lt;Id.Witness&gt;</code>)</li>
</ul>
</li>
<li><strong>Notes</strong>: <code>Id.of(a)</code> creates <code>Id(a)</code>. <code>map</code> and <code>flatMap</code> operate directly. Useful as a base for monad transformers and generic programming with no extra effects. <code>Id&lt;A&gt;</code> directly implements <code>IdKind&lt;A&gt;</code>.</li>
<li><strong>Usage</strong>: <a href="monads/./identity.html">How to use the Identity Monad</a></li>
</ul>
<hr />
<h3 id="2-javautillista"><a class="header" href="#2-javautillista">2. <code>java.util.List&lt;A&gt;</code></a></h3>
<ul>
<li><strong>Type Definition</strong>: Standard Java <code>java.util.List&lt;A&gt;</code>.</li>
<li><strong><code>ListKind&lt;A&gt;</code> Interface</strong>: <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/list/ListKind.java"><code>ListKind&lt;A&gt;</code></a> extends <code>Kind&lt;ListKind.Witness, A&gt;</code>.</li>
<li><strong>Witness Type <code>F_WITNESS</code></strong>: <code>ListKind.Witness</code></li>
<li><strong><code>ListKindHelper</code></strong>: Uses an internal <code>ListHolder&lt;A&gt;</code> record that implements <code>ListKind&lt;A&gt;</code> to wrap <code>java.util.List&lt;A&gt;</code>.</li>
<li><strong>Type Class Instances</strong>:
<ul>
<li><code>ListFunctor</code> (<code>Functor&lt;ListKind.Witness&gt;</code>)</li>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/list/ListMonad.java"><code>ListMonad</code></a> (<code>Monad&lt;ListKind.Witness&gt;</code>)</li>
</ul>
</li>
<li><strong>Notes</strong>: Standard list monad behaviour. <code>of(a)</code> creates a singleton list <code>List.of(a)</code>; <code>of(null)</code> results in an empty list.</li>
<li><strong>Usage</strong>: <a href="monads/./list_monad.html">How to use the List Monad</a></li>
</ul>
<hr />
<h3 id="3-javautiloptionala"><a class="header" href="#3-javautiloptionala">3. <code>java.util.Optional&lt;A&gt;</code></a></h3>
<ul>
<li><strong>Type Definition</strong>: Standard Java <code>java.util.Optional&lt;A&gt;</code>.</li>
<li><strong><code>OptionalKind&lt;A&gt;</code> Interface</strong>: <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/optional/OptionalKind.java"><code>OptionalKind&lt;A&gt;</code></a> extends <code>Kind&lt;OptionalKind.Witness, A&gt;</code>.</li>
<li><strong>Witness Type <code>F_WITNESS</code></strong>: <code>OptionalKind.Witness</code></li>
<li><strong><code>OptionalKindHelper</code></strong>: Uses an internal <code>OptionalHolder&lt;A&gt;</code> record that implements <code>OptionalKind&lt;A&gt;</code> to wrap <code>java.util.Optional&lt;A&gt;</code>.</li>
<li><strong>Type Class Instances</strong>:
<ul>
<li><code>OptionalFunctor</code> (<code>Functor&lt;OptionalKind.Witness&gt;</code>)</li>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/optional/OptionalMonad.java"><code>OptionalMonad</code></a> (<code>MonadError&lt;OptionalKind.Witness, Unit&gt;</code>)</li>
</ul>
</li>
<li><strong>Notes</strong>: <code>Optional.empty()</code> is the error state. <code>raiseError(Unit.INSTANCE)</code> creates <code>Optional.empty()</code>. <code>of(value)</code> uses <code>Optional.ofNullable(value)</code>.</li>
<li><strong>Usage</strong>: <a href="monads/./optional_monad.html">How to use the Optional Monad</a></li>
</ul>
<hr />
<h3 id="4-maybea"><a class="header" href="#4-maybea">4. <code>Maybe&lt;A&gt;</code></a></h3>
<ul>
<li><strong>Type Definition</strong>: Custom sealed interface (<a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/maybe/Maybe.java"><code>Maybe</code></a>) with <code>Just&lt;A&gt;</code> (non-null) and <code>Nothing&lt;A&gt;</code> implementations.</li>
<li><strong><code>MaybeKind&lt;A&gt;</code> Interface</strong>: <code>Maybe&lt;A&gt;</code> itself implements <code>MaybeKind&lt;A&gt;</code>, and <code>MaybeKind&lt;A&gt; extends Kind&lt;MaybeKind.Witness, A&gt;</code>.</li>
<li><strong>Witness Type <code>F_WITNESS</code></strong>: <code>MaybeKind.Witness</code></li>
<li><strong><code>MaybeKindHelper</code></strong>: <code>widen</code> casts <code>Maybe</code> to <code>Kind</code>; <code>unwrap</code> casts <code>Kind</code> to <code>Maybe</code>. Provides <code>just(value)</code>, <code>nothing()</code>, <code>fromNullable(value)</code>.</li>
<li><strong>Type Class Instances</strong>:
<ul>
<li><code>MaybeFunctor</code> (<code>Functor&lt;MaybeKind.Witness&gt;</code>)</li>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/maybe/MaybeMonad.java"><code>MaybeMonad</code></a> (<code>MonadError&lt;MaybeKind.Witness, Unit&gt;</code>)</li>
</ul>
</li>
<li><strong>Notes</strong>: <code>Nothing</code> is the error state; <code>raiseError(Unit.INSTANCE</code>) creates <code>Nothing</code>. <code>Maybe.just(value)</code> requires non-null. <code>MaybeMonad.of(value)</code> uses <code>Maybe.fromNullable()</code>.</li>
<li><strong>Usage</strong>: <a href="monads/./maybe_monad.html">How to use the Maybe Monad</a></li>
</ul>
<hr />
<h3 id="5-eitherl-r"><a class="header" href="#5-eitherl-r">5. <code>Either&lt;L, R&gt;</code></a></h3>
<ul>
<li><strong>Type Definition</strong>: Custom sealed interface (<a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/either/Either.java"><code>Either</code></a>) with <code>Left&lt;L,R&gt;</code> and <code>Right&lt;L,R&gt;</code> records.</li>
<li><strong><code>EitherKind&lt;L, R&gt;</code> Interface</strong>: <code>Either&lt;L,R&gt;</code> itself implements <code>EitherKind&lt;L,R&gt;</code>, and <code>EitherKind&lt;L,R&gt; extends Kind&lt;EitherKind.Witness&lt;L&gt;, R&gt;</code>.</li>
<li><strong>Witness Type <code>F_WITNESS</code></strong>: <code>EitherKind.Witness&lt;L&gt;</code> (Error type <code>L</code> is fixed for the witness).</li>
<li><strong><code>EitherKindHelper</code></strong>: <code>wrap</code> casts <code>Either</code> to <code>Kind</code>; <code>unwrap</code> casts <code>Kind</code> to <code>Either</code>. Provides <code>left(l)</code>, <code>right(r)</code>.</li>
<li><strong>Type Class Instances</strong>:
<ul>
<li><code>EitherFunctor&lt;L&gt;</code> (<code>Functor&lt;EitherKind.Witness&lt;L&gt;&gt;</code>)</li>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/either/EitherMonad.java"><code>EitherMonad&lt;L&gt;</code></a> (<code>MonadError&lt;EitherKind.Witness&lt;L&gt;, L&gt;</code>)</li>
</ul>
</li>
<li><strong>Notes</strong>: Right-biased. <code>Left(l)</code> is the error state. <code>of(r)</code> creates <code>Right(r)</code>.</li>
<li><strong>Usage</strong>: <a href="monads/./either_monad.html">How to use the Either Monad</a></li>
</ul>
<hr />
<h3 id="6-trya"><a class="header" href="#6-trya">6. <code>Try&lt;A&gt;</code></a></h3>
<ul>
<li><strong>Type Definition</strong>: Custom sealed interface (<a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/trymonad/Try.java"><code>Try</code></a>) with <code>Success&lt;A&gt;</code> and <code>Failure&lt;A&gt;</code> (wrapping <code>Throwable</code>).</li>
<li><strong><code>TryKind&lt;A&gt;</code> Interface</strong>: <code>Try&lt;A&gt;</code> itself implements <code>TryKind&lt;A&gt;</code>, and <code>TryKind&lt;A&gt; extends Kind&lt;TryKind.Witness, A&gt;</code>.</li>
<li><strong>Witness Type <code>F_WITNESS</code></strong>: <code>TryKind.Witness</code></li>
<li><strong><code>TryKindHelper</code></strong>: <code>wrap</code> casts <code>Try</code> to <code>Kind</code>; <code>unwrap</code> casts <code>Kind</code> to <code>Try</code>. Provides <code>success(value)</code>, <code>failure(throwable)</code>, <code>tryOf(supplier)</code>.</li>
<li><strong>Type Class Instances</strong>:
<ul>
<li><code>TryFunctor</code> (<code>Functor&lt;TryKind.Witness&gt;</code>)</li>
<li><code>TryApplicative</code> (<code>Applicative&lt;TryKind.Witness&gt;</code>)</li>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/trymonad/TryMonad.java"><code>TryMonad</code></a> (<code>MonadError&lt;TryKind.Witness, Throwable&gt;</code>)</li>
</ul>
</li>
<li><strong>Notes</strong>: <code>Failure(t)</code> is the error state. <code>of(v)</code> creates <code>Success(v)</code>.</li>
<li><strong>Usage</strong>: <a href="monads/./try_monad.html">How to use the Try Monad</a></li>
</ul>
<hr />
<h3 id="7-javautilconcurrentcompletablefuturea"><a class="header" href="#7-javautilconcurrentcompletablefuturea">7. <code>java.util.concurrent.CompletableFuture&lt;A&gt;</code></a></h3>
<ul>
<li><strong>Type Definition</strong>: Standard Java <code>java.util.concurrent.CompletableFuture&lt;A&gt;</code>.</li>
<li><strong><code>CompletableFutureKind&lt;A&gt;</code> Interface</strong>: <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/future/CompletableFutureKind.java"><code>CompletableFutureKind&lt;A&gt;</code></a> extends <code>Kind&lt;CompletableFutureKind.Witness, A&gt;</code>.</li>
<li><strong>Witness Type <code>F_WITNESS</code></strong>: <code>CompletableFutureKind.Witness</code></li>
<li><strong><code>CompletableFutureKindHelper</code></strong>: Uses an internal <code>CompletableFutureHolder&lt;A&gt;</code> record. Provides <code>wrap</code>, <code>unwrap</code>, <code>join</code>.</li>
<li><strong>Type Class Instances</strong>:
<ul>
<li><code>CompletableFutureFunctor</code> (<code>Functor&lt;CompletableFutureKind.Witness&gt;</code>)</li>
<li><code>CompletableFutureApplicative</code> (<code>Applicative&lt;CompletableFutureKind.Witness&gt;</code>)</li>
<li><code>CompletableFutureMonad</code> (<code>Monad&lt;CompletableFutureKind.Witness&gt;</code>)</li>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/future/CompletableFutureMonad.java"><code>CompletableFutureMonad</code></a> (<code>MonadError&lt;CompletableFutureKind.Witness, Throwable&gt;</code>)</li>
</ul>
</li>
<li><strong>Notes</strong>: Represents asynchronous computations. A failed future is the error state. <code>of(v)</code> creates <code>CompletableFuture.completedFuture(v)</code>.</li>
<li><strong>Usage</strong>: <a href="monads/./cf_monad.html">How to use the CompletableFuture Monad</a></li>
</ul>
<hr />
<h3 id="8-ioa"><a class="header" href="#8-ioa">8. <code>IO&lt;A&gt;</code></a></h3>
<ul>
<li><strong>Type Definition</strong>: Custom interface (<a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/io/IO.java"><code>IO</code></a>) representing a deferred, potentially side-effecting computation.</li>
<li><strong><code>IOKind&lt;A&gt;</code> Interface</strong>: <code>IO&lt;A&gt;</code> itself implements <code>IOKind&lt;A&gt;</code>, and <code>IOKind&lt;A&gt; extends Kind&lt;IOKind.Witness, A&gt;</code>.</li>
<li><strong>Witness Type <code>F_WITNESS</code></strong>: <code>IOKind.Witness</code></li>
<li><strong><code>IOKindHelper</code></strong>: <code>wrap</code> casts <code>IO</code> to <code>Kind</code>; <code>unwrap</code> casts <code>Kind</code> to <code>IO</code>. Provides <code>delay(supplier)</code>, <code>unsafeRunSync(kind)</code>.</li>
<li><strong>Type Class Instances</strong>:
<ul>
<li><code>IOFunctor</code> (<code>Functor&lt;IOKind.Witness&gt;</code>)</li>
<li><code>IOApplicative</code> (<code>Applicative&lt;IOKind.Witness&gt;</code>)</li>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/io/IOMonad.java"><code>IOMonad</code></a> (<code>Monad&lt;IOKind.Witness&gt;</code>)</li>
</ul>
</li>
<li><strong>Notes</strong>: Evaluation is deferred until <code>unsafeRunSync</code>. Exceptions during execution are generally unhandled by <code>IOMonad</code> itself unless caught within the IO's definition.</li>
<li><strong>Usage</strong>: <a href="monads/./io_monad.html">How to use the IO Monad</a></li>
</ul>
<hr />
<h3 id="9-lazya"><a class="header" href="#9-lazya">9. <code>Lazy&lt;A&gt;</code></a></h3>
<ul>
<li><strong>Type Definition</strong>: Custom class (<a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/lazy/Lazy.java"><code>Lazy</code></a>) for deferred computation with memoization.</li>
<li><strong><code>LazyKind&lt;A&gt;</code> Interface</strong>: <code>Lazy&lt;A&gt;</code> itself implements <code>LazyKind&lt;A&gt;</code>, and <code>LazyKind&lt;A&gt; extends Kind&lt;LazyKind.Witness, A&gt;</code>.</li>
<li><strong>Witness Type <code>F_WITNESS</code></strong>: <code>LazyKind.Witness</code></li>
<li><strong><code>LazyKindHelper</code></strong>: <code>wrap</code> casts <code>Lazy</code> to <code>Kind</code>; <code>unwrap</code> casts <code>Kind</code> to <code>Lazy</code>. Provides <code>defer(supplier)</code>, <code>now(value)</code>, <code>force(kind)</code>.</li>
<li><strong>Type Class Instances</strong>:
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/lazy/LazyMonad.java"><code>LazyMonad</code></a> (<code>Monad&lt;LazyKind.Witness&gt;</code>)</li>
</ul>
</li>
<li><strong>Notes</strong>: Result or exception is memoized. <code>of(a)</code> creates an already evaluated <code>Lazy.now(a)</code>.</li>
<li><strong>Usage</strong>: <a href="monads/./lazy_monad.html">How to use the Lazy Monad</a></li>
</ul>
<hr />
<h3 id="10-readerr_env-a"><a class="header" href="#10-readerr_env-a">10. <code>Reader&lt;R_ENV, A&gt;</code></a></h3>
<ul>
<li><strong>Type Definition</strong>: Custom functional interface (<a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/reader/Reader.java"><code>Reader</code></a>) wrapping <code>Function&lt;R_ENV, A&gt;</code>.</li>
<li><strong><code>ReaderKind&lt;R_ENV, A&gt;</code> Interface</strong>: <code>Reader&lt;R_ENV,A&gt;</code> itself implements <code>ReaderKind&lt;R_ENV,A&gt;</code>, and <code>ReaderKind&lt;R_ENV,A&gt; extends Kind&lt;ReaderKind.Witness&lt;R_ENV&gt;, A&gt;</code>.</li>
<li><strong>Witness Type <code>F_WITNESS</code></strong>: <code>ReaderKind.Witness&lt;R_ENV&gt;</code> (Environment type <code>R_ENV</code> is fixed).</li>
<li><strong><code>ReaderKindHelper</code></strong>: <code>wrap</code> casts <code>Reader</code> to <code>Kind</code>; <code>unwrap</code> casts <code>Kind</code> to <code>Reader</code>. Provides <code>reader(func)</code>, <code>ask()</code>, <code>constant(value)</code>, <code>runReader(kind, env)</code>.</li>
<li><strong>Type Class Instances</strong>:
<ul>
<li><code>ReaderFunctor&lt;R_ENV&gt;</code> (<code>Functor&lt;ReaderKind.Witness&lt;R_ENV&gt;&gt;</code>)</li>
<li><code>ReaderApplicative&lt;R_ENV&gt;</code> (<code>Applicative&lt;ReaderKind.Witness&lt;R_ENV&gt;&gt;</code>)</li>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/reader/ReaderMonad.java"><code>ReaderMonad&lt;R_ENV&gt;</code></a> (<code>Monad&lt;ReaderKind.Witness&lt;R_ENV&gt;&gt;</code>)</li>
</ul>
</li>
<li><strong>Notes</strong>: <code>of(a)</code> creates a <code>Reader</code> that ignores the environment and returns <code>a</code>.</li>
<li><strong>Usage</strong>: <a href="monads/./reader_monad.html">How to use the Reader Monad</a></li>
</ul>
<hr />
<h3 id="11-states-a"><a class="header" href="#11-states-a">11. <code>State&lt;S, A&gt;</code></a></h3>
<ul>
<li><strong>Type Definition</strong>: Custom functional interface (<a href="hhttps://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/state/State.java"><code>State</code></a>) wrapping <code>Function&lt;S, StateTuple&lt;S, A&gt;&gt;</code>.</li>
<li><strong><code>StateKind&lt;S,A&gt;</code> Interface</strong>: <code>State&lt;S,A&gt;</code> itself implements <code>StateKind&lt;S,A&gt;</code>, and <code>StateKind&lt;S,A&gt; extends Kind&lt;StateKind.Witness&lt;S&gt;, A&gt;</code>.</li>
<li><strong>Witness Type <code>F_WITNESS</code></strong>: <code>StateKind.Witness&lt;S&gt;</code> (State type <code>S</code> is fixed).</li>
<li><strong><code>StateKindHelper</code></strong>: <code>wrap</code> casts <code>State</code> to <code>Kind</code>; <code>unwrap</code> casts <code>Kind</code> to <code>State</code>. Provides <code>pure(value)</code>, <code>get()</code>, <code>set(state)</code>, <code>modify(func)</code>, <code>inspect(func)</code>, <code>runState(kind, initialState)</code>, etc.</li>
<li><strong>Type Class Instances</strong>:
<ul>
<li><code>StateFunctor&lt;S&gt;</code> (<code>Functor&lt;StateKind.Witness&lt;S&gt;&gt;</code>)</li>
<li><code>StateApplicative&lt;S&gt;</code> (<code>Applicative&lt;StateKind.Witness&lt;S&gt;&gt;</code>)</li>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/state/StateMonad.java"><code>StateMonad&lt;S&gt;</code></a> (<code>Monad&lt;StateKind.Witness&lt;S&gt;&gt;</code>)</li>
</ul>
</li>
<li><strong>Notes</strong>: <code>of(a)</code> (<code>pure</code>) returns <code>a</code> without changing state.</li>
<li><strong>Usage</strong>: <a href="monads/./state_monad.html">How to use the State Monad</a></li>
</ul>
<hr />
<h3 id="12-writerw-a"><a class="header" href="#12-writerw-a">12. <code>Writer&lt;W, A&gt;</code></a></h3>
<ul>
<li><strong>Type Definition</strong>: Custom record (<a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/writer/Writer.java"><code>Writer</code></a>) holding <code>(W log, A value)</code>. Requires <code>Monoid&lt;W&gt;</code>.</li>
<li><strong><code>WriterKind&lt;W, A&gt;</code> Interface</strong>: <code>Writer&lt;W,A&gt;</code> itself implements <code>WriterKind&lt;W,A&gt;</code>, and <code>WriterKind&lt;W,A&gt; extends Kind&lt;WriterKind.Witness&lt;W&gt;, A&gt;</code>.</li>
<li><strong>Witness Type <code>F_WITNESS</code></strong>: <code>WriterKind.Witness&lt;W&gt;</code> (Log type <code>W</code> and its <code>Monoid</code> are fixed).</li>
<li><strong><code>WriterKindHelper</code></strong>: <code>wrap</code> casts <code>Writer</code> to <code>Kind</code>; <code>unwrap</code> casts <code>Kind</code> to <code>Writer</code>. Provides <code>value(monoid, val)</code>, <code>tell(monoid, log)</code>, <code>runWriter(kind)</code>, etc.</li>
<li><strong>Type Class Instances</strong>: (Requires <code>Monoid&lt;W&gt;</code> for Applicative/Monad)
<ul>
<li><code>WriterFunctor&lt;W&gt;</code> (<code>Functor&lt;WriterKind.Witness&lt;W&gt;&gt;</code>)</li>
<li><code>WriterApplicative&lt;W&gt;</code> (<code>Applicative&lt;WriterKind.Witness&lt;W&gt;&gt;</code>)</li>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/writer/WriterMonad.java"><code>WriterMonad&lt;W&gt;</code></a> (<code>Monad&lt;WriterKind.Witness&lt;W&gt;&gt;</code>)</li>
</ul>
</li>
<li><strong>Notes</strong>: <code>of(a)</code> (<code>value</code>) produces <code>a</code> with an empty log (from <code>Monoid.empty()</code>).</li>
<li><strong>Usage</strong>: <a href="monads/./writer_monad.html">How to use the Writer Monad</a></li>
</ul>
<hr />
<h3 id="13-validatede-a"><a class="header" href="#13-validatede-a">13. <code>Validated&lt;E, A&gt;</code></a></h3>
<ul>
<li><strong>Type Definition</strong>: Custom sealed interface (<a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/validated/Validated.java"><code>Validated</code></a>) with <code>Valid&lt;E, A&gt;</code> (holding <code>A</code>) and <code>Invalid&lt;E, A&gt;</code> (holding <code>E</code>) implementations.</li>
<li><strong><code>ValidatedKind&lt;E, A&gt;</code> Interface</strong>: Defines the HKT structure (<a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/validated/ValidatedKind.java"><code>ValidatedKind</code></a>) for <code>Validated&lt;E,A&gt;</code>. It extends <code>Kind&lt;ValidatedKind.Witness&lt;E&gt;, A&gt;</code>. Concrete <code>Valid&lt;E,A&gt;</code> and <code>Invalid&lt;E,A&gt;</code> instances are cast to this kind by <code>ValidatedKindHelper</code>.</li>
<li><strong>Witness Type <code>F_WITNESS</code></strong>: <code>ValidatedKind.Witness&lt;E&gt;</code> (Error type <code>E</code> is fixed for the HKT witness).</li>
<li><strong><code>ValidatedKindHelper</code> Class</strong>: (<a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/validated/ValidatedKindHelper.java"><code>ValidatedKindHelper</code></a>). <code>widen</code> casts <code>Validated&lt;E,A&gt;</code> (specifically <code>Valid</code> or <code>Invalid</code> instances) to <code>Kind&lt;ValidatedKind.Witness&lt;E&gt;, A&gt;</code>. <code>narrow</code> casts <code>Kind</code> back to <code>Validated&lt;E,A&gt;</code>. Provides static factory methods <code>valid(value)</code> and <code>invalid(error)</code> that return the Kind-wrapped type.</li>
<li><strong>Type Class Instances</strong>: (Error type <code>E</code> is fixed for the monad instance)
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/validated/ValidatedMonad.java"><code>ValidatedMonad&lt;E&gt;</code></a> (<code>MonadError&lt;ValidatedKind.Witness&lt;E&gt;, E&gt;</code>). This also provides <code>Monad</code>, <code>Functor</code>, and <code>Applicative</code> behaviour.</li>
</ul>
</li>
<li><strong>Notes</strong>: <code>Validated</code> is right-biased, meaning operations like <code>map</code> and <code>flatMap</code> apply to the <code>Valid</code> case and propagate <code>Invalid</code> untouched. <code>ValidatedMonad.of(a)</code> creates a <code>Valid(a)</code>. As a <code>MonadError</code>, <code>ValidatedMonad</code> provides <code>raiseError(error)</code> to create an <code>Invalid(error)</code> and <code>handleErrorWith(kind, handler)</code> for standardized error recovery. The <code>ap</code> method is also right-biased and does not accumulate errors from multiple <code>Invalid</code>s in the typical applicative sense; it propagates the first <code>Invalid</code> encountered or an <code>Invalid</code> function.</li>
<li><strong>Usage</strong>: <a href="monads/./validated_monad.html">How to use the Validated Monad</a></li>
</ul>
<hr />
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="the-completablefuturemonad"><a class="header" href="#the-completablefuturemonad">The CompletableFutureMonad:</a></h1>
<h2 id="asynchronous-computations-with-completablefuture"><a class="header" href="#asynchronous-computations-with-completablefuture"><em>Asynchronous Computations with <code>CompletableFuture</code></em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="monads/cf_monad.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to compose asynchronous operations functionally</li>
<li>Using MonadError capabilities for async error handling and recovery</li>
<li>Building non-blocking workflows with <code>map</code>, <code>flatMap</code>, and <code>handleErrorWith</code></li>
<li>Integration with EitherT for combining async operations with typed errors</li>
<li>Real-world patterns for resilient microservice communication</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="monads/cf_monad.html#admonition-see-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/future/CompletableFutureExample.java">CompletableFutureExample.java</a></p>
</div>
</div>
<p>Java's <code>java.util.concurrent.CompletableFuture&lt;T&gt;</code> is a powerful tool for asynchronous programming. The <code>higher-kinded-j</code> library provides a way to treat <code>CompletableFuture</code> as a monadic context using the HKT simulation. This allows developers to compose asynchronous operations and handle their potential failures (<code>Throwable</code>) in a more functional and generic style, leveraging type classes like <code>Functor</code>, <code>Applicative</code>, <code>Monad</code>, and crucially, <code>MonadError</code>.</p>
<p><strong>Higher-Kinded Bridge for CompletableFuture</strong></p>
<p><img src="monads/../images/puml/cf_kind.svg" alt="cf_kind.svg" /></p>
<p><strong>TypeClasses</strong></p>
<p><img src="monads/../images/puml/cf_monad.svg" alt="cf_monad.svg" /></p>
<p>The simulation for <code>CompletableFuture</code> involves these components:</p>
<ol>
<li><strong><code>CompletableFuture&lt;A&gt;</code></strong>: The standard Java class representing an asynchronous computation that will eventually result in a value of type <code>A</code> or fail with an exception (a <code>Throwable</code>).</li>
<li><strong><code>CompletableFutureKind&lt;A&gt;</code></strong>: The HKT marker interface (<code>Kind&lt;CompletableFutureKind.Witness, A&gt;</code>) for <code>CompletableFuture</code>. This allows <code>CompletableFuture</code> to be used generically with type classes. The witness type is <code>CompletableFutureKind.Witness</code>.</li>
<li><strong><code>CompletableFutureKindHelper</code></strong>: The utility class for bridging between <code>CompletableFuture&lt;A&gt;</code> and <code>CompletableFutureKind&lt;A&gt;</code>. Key methods:
<ul>
<li><code>widen(CompletableFuture&lt;A&gt;)</code>: Wraps a standard <code>CompletableFuture</code> into its <code>Kind</code> representation.</li>
<li><code>narrow(Kind&lt;CompletableFutureKind.Witness, A&gt;)</code>: Unwraps the <code>Kind</code> back to the concrete <code>CompletableFuture</code>. Throws <code>KindUnwrapException</code> if the input Kind is invalid.</li>
<li><code>join(Kind&lt;CompletableFutureKind.Witness, A&gt;)</code>: A convenience method to unwrap the <code>Kind</code> and then block (<code>join()</code>) on the underlying <code>CompletableFuture</code> to get its result. It re-throws runtime exceptions and errors directly but wraps checked exceptions in <code>CompletionException</code>. <em>Use primarily for testing or at the very end of an application where blocking is acceptable.</em></li>
</ul>
</li>
<li><strong><code>CompletableFutureFunctor</code></strong>: Implements <code>Functor&lt;CompletableFutureKind.Witness&gt;</code>. Provides <code>map</code>, which corresponds to <code>CompletableFuture.thenApply()</code>.</li>
<li><strong><code>CompletableFutureApplicative</code></strong>: Extends <code>Functor</code>, implements <code>Applicative&lt;CompletableFutureKind.Witness&gt;</code>.
<ul>
<li><code>of(A value)</code>: Creates an already successfully completed <code>CompletableFutureKind</code> using <code>CompletableFuture.completedFuture(value)</code>.</li>
<li><code>ap(Kind&lt;F, Function&lt;A,B&gt;&gt;, Kind&lt;F, A&gt;)</code>: Corresponds to <code>CompletableFuture.thenCombine()</code>, applying a function from one future to the value of another when both complete.</li>
</ul>
</li>
<li><strong><code>CompletableFutureMonad</code></strong>: Extends <code>Applicative</code>, implements <code>Monad&lt;CompletableFutureKind.Witness&gt;</code>.
<ul>
<li><code>flatMap(Function&lt;A, Kind&lt;F, B&gt;&gt;, Kind&lt;F, A&gt;)</code>: Corresponds to <code>CompletableFuture.thenCompose()</code>, sequencing asynchronous operations where one depends on the result of the previous one.</li>
</ul>
</li>
<li><strong><code>CompletableFutureMonad</code></strong>: Extends <code>Monad</code>, implements <code>MonadError&lt;CompletableFutureKind.Witness, Throwable&gt;</code>. This is often the most useful instance to work with.
<ul>
<li><code>raiseError(Throwable error)</code>: Creates an already exceptionally completed <code>CompletableFutureKind</code> using <code>CompletableFuture.failedFuture(error)</code>.</li>
<li><code>handleErrorWith(Kind&lt;F, A&gt;, Function&lt;Throwable, Kind&lt;F, A&gt;&gt;)</code>: Corresponds to <code>CompletableFuture.exceptionallyCompose()</code>, allowing asynchronous recovery from failures.</li>
</ul>
</li>
</ol>
<h2 id="purpose-and-usage"><a class="header" href="#purpose-and-usage">Purpose and Usage</a></h2>
<ul>
<li><strong>Functional Composition of Async Ops</strong>: Use <code>map</code>, <code>ap</code>, and <code>flatMap</code> (via the type class instances) to build complex asynchronous workflows in a declarative style, similar to how you'd compose synchronous operations with <code>Optional</code> or <code>List</code>.</li>
<li><strong>Unified Error Handling</strong>: Treat asynchronous failures (<code>Throwable</code>) consistently using <code>MonadError</code> operations (<code>raiseError</code>, <code>handleErrorWith</code>). This allows integrating error handling directly into the composition chain.</li>
<li><strong>HKT Integration</strong>: Enables writing generic code that can operate on <code>CompletableFuture</code> alongside other simulated monadic types (like <code>Optional</code>, <code>Either</code>, <code>IO</code>) by programming against the <code>Kind&lt;F, A&gt;</code> interface and type classes. This is powerfully demonstrated when using <code>CompletableFutureKind</code> as the outer monad <code>F</code> in the <code>EitherT</code> transformer (see <a href="monads/../hkts/order-walkthrough.html">Order Example Walkthrough</a>).</li>
</ul>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<div id="admonition-example-1-creating-_completablefuturekind_-instances" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-1-creating-_completablefuturekind_-instances-title">
<div class="admonition-title">
<div id="admonition-example-1-creating-_completablefuturekind_-instances-title">
<p>Example 1: Creating <em>CompletableFutureKind</em> Instances</p>
</div>
<a class="admonition-anchor-link" href="monads/cf_monad.html#admonition-example-1-creating-_completablefuturekind_-instances"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/future/CompletableFutureExample.java">CompletableFutureExample.java</a></li>
</ul>
<pre><code class="language-java">public void createExample() {
   // Get the MonadError instance
   CompletableFutureMonad futureMonad = CompletableFutureMonad.INSTANCE;

   // --- Using of() ---
   // Creates a Kind wrapping an already completed future
   Kind&lt;CompletableFutureKind.Witness, String&gt; successKind = futureMonad.of("Success!");

   // --- Using raiseError() ---
   // Creates a Kind wrapping an already failed future
   RuntimeException error = new RuntimeException("Something went wrong");
   Kind&lt;CompletableFutureKind.Witness, String&gt; failureKind = futureMonad.raiseError(error);

   // --- Wrapping existing CompletableFutures ---
   CompletableFuture&lt;Integer&gt; existingFuture = CompletableFuture.supplyAsync(() -&gt; {
      try {
         TimeUnit.MILLISECONDS.sleep(20);
      } catch (InterruptedException e) { /* ignore */ }
      return 123;
   });
   Kind&lt;CompletableFutureKind.Witness, Integer&gt; wrappedExisting = FUTURE.widen(existingFuture);

   CompletableFuture&lt;Integer&gt; failedExisting = new CompletableFuture&lt;&gt;();
   failedExisting.completeExceptionally(new IllegalArgumentException("Bad input"));
   Kind&lt;CompletableFutureKind.Witness, Integer&gt; wrappedFailed = FUTURE.widen(failedExisting);

   // You typically don't interact with 'unwrap' unless needed at boundaries or for helper methods like 'join'.
   CompletableFuture&lt;String&gt; unwrappedSuccess = FUTURE.narrow(successKind);
   CompletableFuture&lt;String&gt; unwrappedFailure = FUTURE.narrow(failureKind);
}
</code></pre>
</div>
</div>
<div id="admonition-example-2-using-_map_-_flatmap_-_ap_" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-2-using-_map_-_flatmap_-_ap_-title">
<div class="admonition-title">
<div id="admonition-example-2-using-_map_-_flatmap_-_ap_-title">
<p>Example 2: Using <em>map</em>, <em>flatMap</em>, <em>ap</em></p>
</div>
<a class="admonition-anchor-link" href="monads/cf_monad.html#admonition-example-2-using-_map_-_flatmap_-_ap_"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/future/CompletableFutureExample.java">CompletableFutureExample.java</a></li>
</ul>
<p>These examples show how to use the type class instance (<code>futureMonad</code>) to apply operations.</p>
<pre><code class="language-java">public void monadExample() {
   // Get the MonadError instance
   CompletableFutureMonad futureMonad = CompletableFutureMonad.INSTANCE;

   // --- map (thenApply) ---
   Kind&lt;CompletableFutureKind.Witness, Integer&gt; initialValueKind = futureMonad.of(10);
   Kind&lt;CompletableFutureKind.Witness, String&gt; mappedKind = futureMonad.map(
           value -&gt; "Result: " + value,
           initialValueKind
   );
   // Join for testing/demonstration
   System.out.println("Map Result: " + FUTURE.join(mappedKind)); // Output: Result: 10

   // --- flatMap (thenCompose) ---
   // Function A -&gt; Kind&lt;F, B&gt;
   Function&lt;String, Kind&lt;CompletableFutureKind.Witness, String&gt;&gt; asyncStep2 =
           input -&gt; FUTURE.widen(
                   CompletableFuture.supplyAsync(() -&gt; input + " -&gt; Step2 Done")
           );

   Kind&lt;CompletableFutureKind.Witness, String&gt; flatMappedKind = futureMonad.flatMap(
           asyncStep2,
           mappedKind // Result from previous map step ("Result: 10")
   );
   System.out.println("FlatMap Result: " + FUTURE.join(flatMappedKind)); // Output: Result: 10 -&gt; Step2 Done

   // --- ap (thenCombine) ---
   Kind&lt;CompletableFutureKind.Witness, Function&lt;Integer, String&gt;&gt; funcKind = futureMonad.of(i -&gt; "FuncResult:" + i);
   Kind&lt;CompletableFutureKind.Witness, Integer&gt; valKind = futureMonad.of(25);

   Kind&lt;CompletableFutureKind.Witness, String&gt; apResult = futureMonad.ap(funcKind, valKind);
   System.out.println("Ap Result: " + FUTURE.join(apResult)); // Output: FuncResult:25

   // --- mapN ---
   Kind&lt;CompletableFutureKind.Witness, Integer&gt; f1 = futureMonad.of(5);
   Kind&lt;CompletableFutureKind.Witness, String&gt; f2 = futureMonad.of("abc");

   BiFunction&lt;Integer, String, String&gt; combine = (i, s) -&gt; s + i;
   Kind&lt;CompletableFutureKind.Witness, String&gt; map2Result = futureMonad.map2(f1, f2, combine);
   System.out.println("Map2 Result: " + FUTURE.join(map2Result)); // Output: abc5

}
</code></pre>
</div>
</div>
<div id="admonition-example-3-handling-errors-with-_handleerrorwith_" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-3-handling-errors-with-_handleerrorwith_-title">
<div class="admonition-title">
<div id="admonition-example-3-handling-errors-with-_handleerrorwith_-title">
<p>Example 3: Handling Errors with <em>handleErrorWith</em></p>
</div>
<a class="admonition-anchor-link" href="monads/cf_monad.html#admonition-example-3-handling-errors-with-_handleerrorwith_"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/future/CompletableFutureExample.java">CompletableFutureExample.java</a></li>
</ul>
<p>This is where <code>CompletableFutureMonad</code> shines, providing functional error recovery.</p>
<pre><code class="language-java"> public void errorHandlingExample(){
   // Get the MonadError instance
   CompletableFutureMonad futureMonad = CompletableFutureMonad.INSTANCE;
   RuntimeException runtimeEx = new IllegalStateException("Processing Failed");
   IOException checkedEx = new IOException("File Not Found");

   Kind&lt;CompletableFutureKind.Witness, String&gt; failedRuntimeKind = futureMonad.raiseError(runtimeEx);
   Kind&lt;CompletableFutureKind.Witness, String&gt; failedCheckedKind = futureMonad.raiseError(checkedEx);
   Kind&lt;CompletableFutureKind.Witness, String&gt; successKind = futureMonad.of("Original Success");

   // --- Handler Function ---
   // Function&lt;Throwable, Kind&lt;CompletableFutureKind.Witness, String&gt;&gt;
   Function&lt;Throwable, Kind&lt;CompletableFutureKind.Witness, String&gt;&gt; recoveryHandler =
           error -&gt; {
              System.out.println("Handling error: " + error.getMessage());
              if (error instanceof IOException) {
                 // Recover from specific checked exceptions
                 return futureMonad.of("Recovered from IO Error");
              } else if (error instanceof IllegalStateException) {
                 // Recover from specific runtime exceptions
                 return FUTURE.widen(CompletableFuture.supplyAsync(()-&gt;{
                    System.out.println("Async recovery..."); // Recovery can be async too!
                    return "Recovered from State Error (async)";
                 }));
              } else if (error instanceof ArithmeticException) { 
                 // Recover from ArithmeticException
                 return futureMonad.of("Recovered from Arithmetic Error: " + error.getMessage());
              }
              else {
                 // Re-raise unhandled errors
                 System.out.println("Unhandled error type: " + error.getClass().getSimpleName());
                 return futureMonad.raiseError(new RuntimeException("Recovery failed", error));
              }
           };

   // --- Applying Handler ---

   // Handle RuntimeException
   Kind&lt;CompletableFutureKind.Witness, String&gt; recoveredRuntime = futureMonad.handleErrorWith(
           failedRuntimeKind,
           recoveryHandler
   );
   System.out.println("Recovered (Runtime): " + FUTURE.join(recoveredRuntime));
   // Output:
   // Handling error: Processing Failed
   // Async recovery...
   // Recovered (Runtime): Recovered from State Error (async)


   // Handle CheckedException
   Kind&lt;CompletableFutureKind.Witness, String&gt; recoveredChecked = futureMonad.handleErrorWith(
           failedCheckedKind,
           recoveryHandler
   );
   System.out.println("Recovered (Checked): " + FUTURE.join(recoveredChecked));
   // Output:
   // Handling error: File Not Found
   // Recovered (Checked): Recovered from IO Error


   // Handler is ignored for success
   Kind&lt;CompletableFutureKind.Witness, String&gt; handledSuccess = futureMonad.handleErrorWith(
           successKind,
           recoveryHandler // This handler is never called
   );
   System.out.println("Handled (Success): " + FUTURE.join(handledSuccess));
   // Output: Handled (Success): Original Success


   // Example of re-raising an unhandled error
   ArithmeticException unhandledEx = new ArithmeticException("Bad Maths");
   Kind&lt;CompletableFutureKind.Witness, String&gt; failedUnhandledKind = futureMonad.raiseError(unhandledEx);
   Kind&lt;CompletableFutureKind.Witness, String&gt; failedRecovery = futureMonad.handleErrorWith(
           failedUnhandledKind,
           recoveryHandler
   );

   try {
      FUTURE.join(failedRecovery);
   } catch (CompletionException e) { // join wraps the "Recovery failed" exception
      System.err.println("Caught re-raised error: " + e.getCause());
      System.err.println("  Original cause: " + e.getCause().getCause());
   }
   // Output:
   // Handling error: Bad Maths
}
</code></pre>
<ul>
<li><code>handleErrorWith</code> allows you to inspect the <code>Throwable</code> and return a <em>new</em><code>CompletableFutureKind</code>, potentially recovering the flow.</li>
<li>The handler receives the <em>cause</em> of the failure (unwrapped from <code>CompletionException</code> if necessary).</li>
</ul>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<p>#The EitherMonad:</p>
<h2 id="typed-error-handling"><a class="header" href="#typed-error-handling"><em>Typed Error Handling</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="monads/either_monad.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to represent computations that can succeed (Right) or fail (Left) with specific error types</li>
<li>Building type-safe error handling without exceptions</li>
<li>Chaining operations with automatic Left propagation</li>
<li>Using fold to handle both success and failure cases</li>
<li>Integration with EitherT for combining with other effects</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="monads/either_monad.html#admonition-see-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/either/EitherExample.java">EitherExample.java</a></p>
</div>
</div>
<h2 id="purpose"><a class="header" href="#purpose">Purpose</a></h2>
<p>The <code>Either&lt;L, R&gt;</code> type represents a value that can be one of two possible types, conventionally denoted as <code>Left</code> and <code>Right</code>. Its primary purpose in functional programming and this library is to provide an explicit, type-safe way to handle computations that can result in either a successful outcome or a specific kind of failure.</p>
<ul>
<li><strong><code>Right&lt;L, R&gt;</code></strong>: By convention, represents the <strong>success</strong> case, holding a value of type <code>R</code>.</li>
<li><strong><code>Left&lt;L, R&gt;</code></strong>: By convention, represents the <strong>failure</strong> or alternative case, holding a value of type <code>L</code> (often an error type).</li>
</ul>
<p>Unlike throwing exceptions, <code>Either</code> makes the possibility of failure explicit in the return type of a function. Unlike <code>Optional</code> or <code>Maybe</code>, which simply signal the absence of a value, <code>Either</code> allows carrying specific information about <em>why</em> a computation failed in the <code>Left</code> value.</p>
<p>We can think of <code>Either</code> as an extension of <code>Maybe</code>. The <code>Right</code> is equivalent to <code>Maybe.Just</code>, and the <code>Left</code> is the equivalent of <code>Maybe.Nothing</code> <strong>but now we can allow it to carry a value.</strong></p>
<p>The implementation in this library is a <code>sealed interface Either&lt;L, R&gt;</code> with two <code>record</code> implementations: <code>Left&lt;L, R&gt;</code> and <code>Right&lt;L, R&gt;</code>. <code>Either&lt;L, R&gt;</code> directly implements <code>EitherKind&lt;L, R&gt;</code>, which in turn extends <code>Kind&lt;EitherKind.Witness&lt;L&gt;, R&gt;</code>.</p>
<h2 id="structure"><a class="header" href="#structure">Structure</a></h2>
<p><img src="monads/../images/puml/either_type.svg" alt="either_type.svg" /></p>
<h2 id="creating-instances"><a class="header" href="#creating-instances">Creating Instances</a></h2>
<p>You create <code>Either</code> instances using the static factory methods:</p>
<div id="admonition-creating-instances" class="admonition admonish-note" role="note" aria-labelledby="admonition-creating-instances-title">
<div class="admonition-title">
<div id="admonition-creating-instances-title">
<p>Creating Instances</p>
</div>
<a class="admonition-anchor-link" href="monads/either_monad.html#admonition-creating-instances"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/either/EitherExample.java">EitherExample.java</a></li>
</ul>
<pre><code class="language-java">
// Success case
Either&lt;String, Integer&gt; success = Either.right(123);

// Failure case
Either&lt;String, Integer&gt; failure = Either.left("File not found");

// Null values are permitted in Left or Right by default in this implementation
Either&lt;String, Integer&gt; rightNull = Either.right(null);
Either&lt;String, Integer&gt; leftNull = Either.left(null);
</code></pre>
</div>
</div>
<h2 id="working-with-either"><a class="header" href="#working-with-either">Working with <code>Either</code></a></h2>
<p>Several methods are available to interact with <code>Either</code> values:</p>
<div id="admonition-checking-state" class="admonition admonish-note" role="note" aria-labelledby="admonition-checking-state-title">
<div class="admonition-title">
<div id="admonition-checking-state-title">
<p>Checking State</p>
</div>
<a class="admonition-anchor-link" href="monads/either_monad.html#admonition-checking-state"></a>
</div>
<div>
<ul>
<li>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/either/EitherExample.java">EitherExample.java</a></p>
<ul>
<li><code>isLeft()</code>: Returns <code>true</code> if it's a <code>Left</code>, <code>false</code> otherwise.</li>
<li><code>isRight()</code>: Returns <code>true</code> if it's a <code>Right</code>, <code>false</code> otherwise.</li>
</ul>
<pre><code class="language-java">if (success.isRight()) {
    System.out.println("It's Right!");
}
if (failure.isLeft()) {
    System.out.println("It's Left!");
}
</code></pre>
</li>
</ul>
</div>
</div>
<div id="admonition-extracting-values-_use-with-caution_" class="admonition admonish-note" role="note" aria-labelledby="admonition-extracting-values-_use-with-caution_-title">
<div class="admonition-title">
<div id="admonition-extracting-values-_use-with-caution_-title">
<p>Extracting Values (<em>Use with Caution</em>)</p>
</div>
<a class="admonition-anchor-link" href="monads/either_monad.html#admonition-extracting-values-_use-with-caution_"></a>
</div>
<div>
<ul>
<li>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/either/EitherExample.java">EitherExample.java</a></p>
<ul>
<li><code>getLeft()</code>: Returns the <code>value</code> if it's a <code>Left</code>, otherwise throws <code>NoSuchElementException</code>.</li>
<li><code>getRight()</code>: Returns the <code>value</code> if it's a <code>Right</code>, otherwise throws <code>NoSuchElementException</code>.</li>
</ul>
<pre><code class="language-java">  try {
    Integer value = success.getRight(); // Returns 123
    String error = failure.getLeft();  // Returns "File not found"
    // String errorFromSuccess = success.getLeft(); // Throws NoSuchElementException
  } catch (NoSuchElementException e) {
    System.err.println("Attempted to get the wrong side: " + e.getMessage());
  }
</code></pre>
</li>
</ul>
</div>
</div>
<p><em>Note: Prefer <code>fold</code> or pattern matching over direct <code>getLeft</code>/<code>getRight</code> calls.</em></p>
<div id="admonition-pattern-matching--folding" class="admonition admonish-note" role="note" aria-labelledby="admonition-pattern-matching--folding-title">
<div class="admonition-title">
<div id="admonition-pattern-matching--folding-title">
<p>Pattern Matching / Folding</p>
</div>
<a class="admonition-anchor-link" href="monads/either_monad.html#admonition-pattern-matching--folding"></a>
</div>
<div>
<ul>
<li>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/either/EitherExample.java">EitherExample.java</a></p>
</li>
<li>
<p>The <code>fold</code> method is the safest way to handle both cases by providing two functions: one for the <code>Left</code> case and one for the <code>Right</code> case. It returns the result of whichever function is applied.</p>
<pre><code class="language-java">String resultMessage = failure.fold(
    leftValue -&gt; "Operation failed with: " + leftValue,  // Function for Left
    rightValue -&gt; "Operation succeeded with: " + rightValue // Function for Right
);
// resultMessage will be "Operation failed with: File not found"

String successMessage = success.fold(
    leftValue -&gt; "Error: " + leftValue,
    rightValue -&gt; "Success: " + rightValue
);
// successMessage will be "Success: 123"
</code></pre>
</li>
</ul>
</div>
</div>
<div id="admonition-_map_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_map_-title">
<div class="admonition-title">
<div id="admonition-_map_-title">
<p><em>Map</em></p>
</div>
<a class="admonition-anchor-link" href="monads/either_monad.html#admonition-_map_"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/either/EitherExample.java">EitherExample.java</a></li>
</ul>
<p>Applies a function only to the <code>Right</code> value, leaving a <code>Left</code> unchanged. This is known as being "right-biased".</p>
<pre><code class="language-java">  Function&lt;Integer, String&gt; intToString = Object::toString;

  Either&lt;String, String&gt; mappedSuccess = success.map(intToString); // Right(123) -&gt; Right("123")
  Either&lt;String, String&gt; mappedFailure = failure.map(intToString); // Left(...) -&gt; Left(...) unchanged

  System.out.println(mappedSuccess); // Output: Right(value=123)
  System.out.println(mappedFailure); // Output: Left(value=File not found)
</code></pre>
</div>
</div>
<div id="admonition-_flatmap_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_flatmap_-title">
<div class="admonition-title">
<div id="admonition-_flatmap_-title">
<p><em>flatMap</em></p>
</div>
<a class="admonition-anchor-link" href="monads/either_monad.html#admonition-_flatmap_"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/either/EitherExample.java">EitherExample.java</a></li>
</ul>
<p>Applies a function that <em>itself returns an <code>Either</code></em> to a <code>Right</code> value. If the initial <code>Either</code> is <code>Left</code>, it's returned unchanged. If the function applied to the <code>Right</code> value returns a <code>Left</code>, that <code>Left</code> becomes the result. This allows sequencing operations where each step can fail. The <code>Left</code> type acts as a functor that dismisses the mapped function <code>f</code> and returns itself (<code>map(f) -&gt; Left(Value)</code>). It preserves the value it holds. After a <code>Left</code> is encountered, subsequent transformations via <code>map</code> or <code>flatMap</code> are typically short-circuited.</p>
<pre><code class="language-java">public void basicFlatMap(){

  // Example: Parse string, then check if positive
  Function&lt;String, Either&lt;String, Integer&gt;&gt; parse = s -&gt; {
    try { return Either.right(Integer.parseInt(s.trim())); }
    catch (NumberFormatException e) { return Either.left("Invalid number"); }
  };
  Function&lt;Integer, Either&lt;String, Integer&gt;&gt; checkPositive = i -&gt;
      (i &gt; 0) ? Either.right(i) : Either.left("Number not positive");

  Either&lt;String, String&gt; input1 = Either.right(" 10 ");
  Either&lt;String, String&gt; input2 = Either.right(" -5 ");
  Either&lt;String, String&gt; input3 = Either.right(" abc ");
  Either&lt;String, String&gt; input4 = Either.left("Initial error");

  // Chain parse then checkPositive
  Either&lt;String, Integer&gt; result1 = input1.flatMap(parse).flatMap(checkPositive); // Right(10)
  Either&lt;String, Integer&gt; result2 = input2.flatMap(parse).flatMap(checkPositive); // Left("Number not positive")
  Either&lt;String, Integer&gt; result3 = input3.flatMap(parse).flatMap(checkPositive); // Left("Invalid number")
  Either&lt;String, Integer&gt; result4 = input4.flatMap(parse).flatMap(checkPositive); // Left("Initial error")

  System.out.println(result1);
  System.out.println(result2);
  System.out.println(result3);
  System.out.println(result4);
}
</code></pre>
</div>
</div>
<div id="admonition-using-_eithermonad_" class="admonition admonish-example" role="note" aria-labelledby="admonition-using-_eithermonad_-title">
<div class="admonition-title">
<div id="admonition-using-_eithermonad_-title">
<p>Using <em>EitherMonad</em></p>
</div>
<a class="admonition-anchor-link" href="monads/either_monad.html#admonition-using-_eithermonad_"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/either/EitherExample.java">EitherExample.java</a></li>
</ul>
<p>To use <code>Either</code> within Higher-Kinded-J framework:</p>
<ol>
<li>
<p><strong>Identify Context:</strong> You are working with <code>Either&lt;L, R&gt;</code> where <code>L</code> is your chosen error type. The HKT witness will be <code>EitherKind.Witness&lt;L&gt;</code>.</p>
</li>
<li>
<p><strong>Get Type Class Instance:</strong> Obtain an instance of <code>EitherMonad&lt;L&gt;</code> for your specific error type <code>L</code>. This instance implements <code>MonadError&lt;EitherKind.Witness&lt;L&gt;, L&gt;</code>.</p>
<pre><code class="language-java">// Assuming TestError is your error type
EitherMonad&lt;TestError&gt; eitherMonad = EitherMonad.instance()
// Now 'eitherMonad' can be used for operations on Kind&lt;EitherKind.Witness&lt;String&gt;, A&gt;
</code></pre>
</li>
<li>
<p><strong>Wrap</strong>: Convert your <code>Either&lt;L, R&gt;</code> instances to <code>Kind&lt;EitherKind.Witness&lt;L&gt;, R&gt;</code> using <code>EITHER.widen()</code>. Since <code>Either&lt;L,R&gt;</code> directly implements <code>EitherKind&lt;L,R&gt;</code>.</p>
<pre><code class="language-java"> EitherMonad&lt;String&gt; eitherMonad = EitherMonad.instance()

 Either&lt;String, Integer&gt; myEither = Either.right(10);
 // F_WITNESS is EitherKind.Witness&lt;String&gt;, A is Integer
 Kind&lt;EitherKind.Witness&lt;String&gt;, Integer&gt; eitherKind = EITHER.widen(myEither);
</code></pre>
</li>
<li>
<p><strong>Apply Operations:</strong>  Use the methods on the <code>eitherMonad</code> instance (<code>map</code>, <code>flatMap</code>, <code>ap</code>, <code>raiseError</code>, <code>handleErrorWith</code>, etc.).</p>
<pre><code class="language-java">// Using map via the Monad instance
 Kind&lt;EitherKind.Witness&lt;String&gt;, String&gt; mappedKind = eitherMonad.map(Object::toString, eitherKind);
 System.out.println("mappedKind: " + EITHER.narrow(mappedKind)); // Output: Right[value = 10]

 // Using flatMap via the Monad instance
 Function&lt;Integer, Kind&lt;EitherKind.Witness&lt;String&gt;, Double&gt;&gt; nextStep =
     i -&gt; EITHER.widen( (i &gt; 5) ? Either.right(i/2.0) : Either.left("TooSmall"));
 Kind&lt;EitherKind.Witness&lt;String&gt;, Double&gt; flatMappedKind = eitherMonad.flatMap(nextStep, eitherKind);

 // Creating a Left Kind using raiseError
 Kind&lt;EitherKind.Witness&lt;String&gt;, Integer&gt; errorKind = eitherMonad.raiseError("E101"); // L is String here

 // Handling an error
 Kind&lt;EitherKind.Witness&lt;String&gt;, Integer&gt; handledKind =
     eitherMonad.handleErrorWith(errorKind, error -&gt; { 
       System.out.println("Handling error: " + error);
       return eitherMonad.of(0); // Recover with Right(0)
     });
</code></pre>
</li>
<li>
<p><strong>Unwrap:</strong> Get the final <code>Either&lt;L, R&gt;</code> back using <code>EITHER.narrow()</code> when needed.</p>
<pre><code class="language-java"> Either&lt;String, Integer&gt; finalEither = EITHER.narrow(handledKind);
 System.out.println("Final unwrapped Either: " + finalEither); // Output: Right(0)
</code></pre>
</li>
</ol>
</div>
</div>
<div id="admonition-key-points" class="admonition admonish-tip" role="note" aria-labelledby="admonition-key-points-title">
<div class="admonition-title">
<div id="admonition-key-points-title">
<p>Key Points:</p>
</div>
<a class="admonition-anchor-link" href="monads/either_monad.html#admonition-key-points"></a>
</div>
<div>
<ul>
<li>Explicitly modeling and handling domain-specific errors (e.g., validation failures, resource not found, business rule violations).</li>
<li>Sequencing operations where any step might fail with a typed error, short-circuiting the remaining steps.</li>
<li>Serving as the inner type for monad transformers like <code>EitherT</code> to combine typed errors with other effects like asynchronicity (see the <a href="monads/../hkts/order-walkthrough.html">Order Example Walkthrough</a>).</li>
<li>Providing a more informative alternative to returning <code>null</code> or relying solely on exceptions for expected failure conditions.</li>
</ul>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="identity-monad-id"><a class="header" href="#identity-monad-id">Identity Monad (Id)</a></h1>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="monads/identity.html#admonition-see-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/id/IdExample.java">IdExample.java</a></p>
</div>
</div>
The Identity Monad, often referred to as `Id`, is the simplest possible monad. It represents a computation that doesn't add any additional context or effect beyond simply holding a value. It's a direct wrapper around a value.
<p>While it might seem trivial on its own, the Identity Monad plays a crucial role in a higher-kinded type library for several reasons:</p>
<ol>
<li>
<p><strong>Base Case for Monad Transformers</strong>: Many monad transformers (like <code>StateT</code>, <code>ReaderT</code>, <code>MaybeT</code>, etc.) can be specialised to their simpler, non-transformed monad counterparts by using <code>Id</code> as the underlying monad. For example:</p>
<ul>
<li><code>StateT&lt;S, Id.Witness, A&gt;</code> is conceptually equivalent to <code>State&lt;S, A&gt;</code>.</li>
<li><code>MaybeT&lt;Id.Witness, A&gt;</code> is conceptually equivalent to <code>Maybe&lt;A&gt;</code>.
This allows for a unified way to define transformers and derive base monads.</li>
</ul>
</li>
<li>
<p><strong>Generic Programming</strong>: When writing functions that are generic over any <code>Monad&lt;F&gt;</code>, <code>Id</code> can serve as the "no-effect" monad, allowing you to use these generic functions with pure values without introducing unnecessary complexity.</p>
</li>
<li>
<p><strong>Understanding Monads</strong>: It provides a clear example of the monadic structure (<code>of</code>, <code>flatMap</code>, <code>map</code>) without any distracting side effects or additional computational context.</p>
</li>
</ol>
<h2 id="what-is-id"><a class="header" href="#what-is-id">What is Id?</a></h2>
<p>An <code>Id&lt;A&gt;</code> is simply a container that holds a value of type <code>A</code>.</p>
<ul>
<li><code>Id.of(value)</code> creates an <code>Id</code> instance holding <code>value</code>.</li>
<li><code>idInstance.value()</code> retrieves the value from the <code>Id</code> instance.</li>
</ul>
<h2 id="key-classes-and-concepts"><a class="header" href="#key-classes-and-concepts">Key Classes and Concepts</a></h2>
<p><img src="monads/../images/puml/id_monad.svg" alt="id_monad.svg" /></p>
<ul>
<li><strong><code>Id&lt;A&gt;</code></strong>: The data type itself. It's a final class that wraps a value of type <code>A</code>. It implements <code>Kind&lt;Id.Witness, A&gt;</code>.</li>
<li><strong><code>Id.Witness</code></strong>: A static nested class (or interface) used as the first type parameter to <code>Kind</code> (i.e., <code>F</code> in <code>Kind&lt;F, A&gt;</code>) to represent the <code>Id</code> type constructor at the type level. This is part of the HKT emulation pattern.</li>
<li><strong><code>IdKindHelper</code></strong>: A utility class providing static helper methods:
<ul>
<li><code>narrow(Kind&lt;Id.Witness, A&gt; kind)</code>: Safely casts a <code>Kind</code> back to a concrete <code>Id&lt;A&gt;</code>.</li>
<li><code>widen(Id&lt;A&gt; id)</code>: widens an <code>Id&lt;A&gt;</code> to <code>Kind&lt;Id.Witness, A&gt;</code>. (Often an identity cast since <code>Id</code> implements <code>Kind</code>).</li>
<li><code>narrows(Kind&lt;Id.Witness, A&gt; kind)</code>: A convenience to narrow and then get the value.</li>
</ul>
</li>
<li><strong><code>IdentityMonad</code></strong>: The singleton class that implements <code>Monad&lt;Id.Witness&gt;</code>, providing the monadic operations for <code>Id</code>.</li>
</ul>
<h2 id="using-id-and-identitymonad"><a class="header" href="#using-id-and-identitymonad">Using <code>Id</code> and <code>IdentityMonad</code></a></h2>
<div id="admonition-example-1-creating-id-instances" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-1-creating-id-instances-title">
<div class="admonition-title">
<div id="admonition-example-1-creating-id-instances-title">
<p>Example 1: Creating Id Instances</p>
</div>
<a class="admonition-anchor-link" href="monads/identity.html#admonition-example-1-creating-id-instances"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/id/IdExample.java">IdExample.java</a></li>
</ul>
<pre><code class="language-java">public void createExample(){
  // Direct creation
  Id&lt;String&gt; idString = Id.of("Hello, Identity!");
  Id&lt;Integer&gt; idInt = Id.of(123);
  Id&lt;String&gt; idNull = Id.of(null); // Id can wrap null

  // Accessing the value
  String value = idString.value(); // "Hello, Identity!"
  Integer intValue = idInt.value();   // 123
  String nullValue = idNull.value(); // null
}
</code></pre>
</div>
</div>
<div id="admonition-example-2-using-with-identitymonad" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-2-using-with-identitymonad-title">
<div class="admonition-title">
<div id="admonition-example-2-using-with-identitymonad-title">
<p>Example 2: Using with IdentityMonad</p>
</div>
<a class="admonition-anchor-link" href="monads/identity.html#admonition-example-2-using-with-identitymonad"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/id/IdExample.java">IdExample.java</a></li>
</ul>
<p>The <code>IdentityMonad</code> provides the standard monadic operations.</p>
<pre><code class="language-java">public void monadExample(){
  IdentityMonad idMonad = IdentityMonad.instance();

  // 1. 'of' (lifting a value)
  Kind&lt;Id.Witness, Integer&gt; kindInt = idMonad.of(42);
  Id&lt;Integer&gt; idFromOf = ID.narrow(kindInt);
  System.out.println("From of: " + idFromOf.value()); // Output: From of: 42

  // 2. 'map' (applying a function to the wrapped value)
  Kind&lt;Id.Witness, String&gt; kindStringMapped = idMonad.map(
      i -&gt; "Value is " + i,
      kindInt
  );
  Id&lt;String&gt; idMapped = ID.narrow(kindStringMapped);
  System.out.println("Mapped: " + idMapped.value()); // Output: Mapped: Value is 42

  // 3. 'flatMap' (applying a function that returns an Id)
  Kind&lt;Id.Witness, String&gt; kindStringFlatMapped = idMonad.flatMap(
      i -&gt; Id.of("FlatMapped: " + (i * 2)), // Function returns Id&lt;String&gt;
      kindInt
  );
  Id&lt;String&gt; idFlatMapped = ID.narrow(kindStringFlatMapped);
  System.out.println("FlatMapped: " + idFlatMapped.value()); // Output: FlatMapped: 84

  // flatMap can also be called directly on Id if the function returns Id
  Id&lt;String&gt; directFlatMap = idFromOf.flatMap(i -&gt; Id.of("Direct FlatMap: " + i));
  System.out.println(directFlatMap.value()); // Output: Direct FlatMap: 42

  // 4. 'ap' (applicative apply)
  Kind&lt;Id.Witness, Function&lt;Integer, String&gt;&gt; kindFunction = idMonad.of(i -&gt; "Applied: " + i);
  Kind&lt;Id.Witness, String&gt; kindApplied = idMonad.ap(kindFunction, kindInt);
  Id&lt;String&gt; idApplied = ID.narrow(kindApplied);
  System.out.println("Applied: " + idApplied.value()); // Output: Applied: 42
}
</code></pre>
</div>
</div>
<div id="admonition-example-3-using-id-with-monad-transformers" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-3-using-id-with-monad-transformers-title">
<div class="admonition-title">
<div id="admonition-example-3-using-id-with-monad-transformers-title">
<p>Example 3: Using Id with Monad Transformers</p>
</div>
<a class="admonition-anchor-link" href="monads/identity.html#admonition-example-3-using-id-with-monad-transformers"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/id/IdExample.java">IdExample.java</a></li>
</ul>
<p>As mentioned in the <a href="monads/../transformers/statet_transformer.html">StateT Monad Transformer</a> documentation, <code>State&lt;S,A&gt;</code> can be thought of as <code>StateT&lt;S, Id.Witness, A&gt;</code>.</p>
<p>Let's illustrate how you might define a <code>State</code> monad type alias or use <code>StateT</code> with <code>IdentityMonad</code>:</p>
<pre><code class="language-java">  public void transformerExample(){
  // Conceptually, State&lt;S, A&gt; is StateT&lt;S, Id.Witness, A&gt;
  // We can create a StateTMonad instance using IdentityMonad as the underlying monad.
  StateTMonad&lt;Integer, Id.Witness&gt; stateMonadOverId =
      StateTMonad.instance(IdentityMonad.instance());

  // Example: A "State" computation that increments the state and returns the old state
  Function&lt;Integer, Kind&lt;Id.Witness, StateTuple&lt;Integer, Integer&gt;&gt;&gt; runStateFn =
      currentState -&gt; Id.of(StateTuple.of(currentState + 1, currentState));

  // Create the StateT (acting as State)
  Kind&lt;StateTKind.Witness&lt;Integer, Id.Witness&gt;, Integer&gt; incrementAndGet =
      StateTKindHelper.stateT(runStateFn, IdentityMonad.instance());

  // Run it
  Integer initialState = 10;
  Kind&lt;Id.Witness, StateTuple&lt;Integer, Integer&gt;&gt; resultIdTuple =
      StateTKindHelper.runStateT(incrementAndGet, initialState);

  // Unwrap the Id and then the StateTuple
  Id&lt;StateTuple&lt;Integer, Integer&gt;&gt; idTuple = ID.narrow(resultIdTuple);
  StateTuple&lt;Integer, Integer&gt; tuple = idTuple.value();

  System.out.println("Initial State: " + initialState);       // Output: Initial State: 10
  System.out.println("Returned Value (Old State): " + tuple.value()); // Output: Returned Value (Old State): 10
  System.out.println("Final State: " + tuple.state());         // Output: Final State: 11
}
</code></pre>
<p>This example shows that <code>StateT</code> with <code>Id</code> behaves just like a standard <code>State</code> monad, where the "effect" of the underlying monad is simply identity (no additional effect).</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<p>#The IOMonad:</p>
<h2 id="managing-side-effects-with-io"><a class="header" href="#managing-side-effects-with-io"><em>Managing Side Effects with <code>IO</code></em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="monads/io_monad.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to describe side effects without performing them immediately</li>
<li>Building pure functional programs with deferred execution</li>
<li>Composing complex side-effecting operations using <code>map</code> and <code>flatMap</code></li>
<li>The difference between describing effects and running them with <code>unsafeRunSync</code></li>
<li>Creating testable, composable programs that separate logic from execution</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="monads/io_monad.html#admonition-see-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/io/IOExample.java">IOExample.java</a></p>
</div>
</div>
<p>In functional programming, managing side effects (like printing to the console, reading files, making network calls, generating random numbers, or getting the current time) while maintaining purity is a common challenge.</p>
<p>The <code>IO&lt;A&gt;</code> monad in <code>higher-kinded-j</code> provides a way to encapsulate these side-effecting computations, making them first-class values that can be composed and manipulated functionally.</p>
<p>The key idea is that an <code>IO&lt;A&gt;</code> value doesn't <em>perform</em> the side effect immediately upon creation. Instead, it represents a <em>description</em> or <em>recipe</em> for a computation that, when executed, will perform the effect and potentially produce a value of type <code>A</code>. The actual execution is deferred until explicitly requested.</p>
<h2 id="core-components"><a class="header" href="#core-components">Core Components</a></h2>
<p><strong>The IO Type</strong></p>
<p><img src="monads/../images/puml/io_detail.svg" alt="io_detail.svg" /></p>
<p><strong>The HKT Bridge for IO</strong></p>
<p><img src="monads/../images/puml/io_kind.svg" alt="io_kind.svg" /></p>
<p><strong>Typeclasses for IO</strong></p>
<p><img src="monads/../images/puml/io_monad.svg" alt="io_monad.svg" /></p>
<p>The <code>IO</code> functionality is built upon several related components:</p>
<ol>
<li><strong><code>IO&lt;A&gt;</code></strong>: The core functional interface. An <code>IO&lt;A&gt;</code> instance essentially wraps a <code>Supplier&lt;A&gt;</code> (or similar function) that performs the side effect and returns a value <code>A</code>. The crucial method is <code>unsafeRunSync()</code>, which executes the encapsulated computation.</li>
<li><strong><code>IOKind&lt;A&gt;</code></strong>: The HKT marker interface (<code>Kind&lt;IOKind.Witness, A&gt;</code>) for <code>IO</code>. This allows <code>IO</code> to be treated as a generic type constructor <code>F</code> in type classes like <code>Functor</code>, <code>Applicative</code>, and <code>Monad</code>. The witness type is <code>IOKind.Witness</code>.</li>
<li><strong><code>IOKindHelper</code></strong>: The essential utility class for working with <code>IO</code> in the HKT simulation. It provides:
<ul>
<li><code>widen(IO&lt;A&gt;)</code>: Wraps a concrete <code>IO&lt;A&gt;</code> instance into its HKT representation <code>IOKind&lt;A&gt;</code>.</li>
<li><code>narrow(Kind&lt;IOKind.Witness, A&gt;)</code>: Unwraps an <code>IOKind&lt;A&gt;</code> back to the concrete <code>IO&lt;A&gt;</code>. Throws <code>KindUnwrapException</code> if the input Kind is invalid.</li>
<li><code>delay(Supplier&lt;A&gt;)</code>: The primary factory method to create an <code>IOKind&lt;A&gt;</code> by wrapping a side-effecting computation described by a <code>Supplier</code>.</li>
<li><code>unsafeRunSync(Kind&lt;IOKind.Witness, A&gt;)</code>: The method to <em>execute</em> the computation described by an <code>IOKind</code>. This is typically called at the "end of the world" in your application (e.g., in the <code>main</code> method) to run the composed IO program.</li>
</ul>
</li>
<li><strong><code>IOFunctor</code></strong>: Implements <code>Functor&lt;IOKind.Witness&gt;</code>. Provides the <code>map</code> operation to transform the result value <code>A</code> of an <code>IO</code> computation <em>without</em> executing the effect.</li>
<li><strong><code>IOApplicative</code></strong>: Extends <code>IOFunctor</code> and implements <code>Applicative&lt;IOKind.Witness&gt;</code>. Provides <code>of</code> (to lift a pure value into <code>IO</code> without side effects) and <code>ap</code> (to apply a function within <code>IO</code> to a value within <code>IO</code>).</li>
<li><strong><code>IOMonad</code></strong>: Extends <code>IOApplicative</code> and implements <code>Monad&lt;IOKind.Witness&gt;</code>. Provides <code>flatMap</code> to sequence <code>IO</code> computations, ensuring effects happen in the intended order.</li>
</ol>
<h2 id="purpose-and-usage-1"><a class="header" href="#purpose-and-usage-1">Purpose and Usage</a></h2>
<ul>
<li><strong>Encapsulating Side Effects</strong>: Describe effects (like printing, reading files, network calls) as <code>IO</code> values without executing them immediately.</li>
<li><strong>Maintaining Purity</strong>: Functions that create or combine <code>IO</code> values remain pure. They don't perform the effects themselves, they just build up a description of the effects to be performed later.</li>
<li><strong>Composition</strong>: Use <code>map</code> and <code>flatMap</code> (via <code>IOMonad</code>) to build complex sequences of side-effecting operations from smaller, reusable <code>IO</code> actions.</li>
<li><strong>Deferred Execution</strong>: Effects are only performed when <code>unsafeRunSync</code> is called on the final, composed <code>IO</code> value. This separates the description of the program from its execution.</li>
</ul>
<p><strong>Important Note:</strong><code>IO</code> in this library primarily deals with <em>deferring</em> execution. It does <em>not</em> automatically provide sophisticated error handling like <code>Either</code> or <code>Try</code>, nor does it manage asynchronicity like <code>CompletableFuture</code>. Exceptions thrown during <code>unsafeRunSync</code> will typically propagate unless explicitly handled <em>within</em> the <code>Supplier</code> provided to <code>IOKindHelper.delay</code>.</p>
<div id="admonition-example-1-creating-basic-io-actions" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-1-creating-basic-io-actions-title">
<div class="admonition-title">
<div id="admonition-example-1-creating-basic-io-actions-title">
<p>Example 1: Creating Basic IO Actions</p>
</div>
<a class="admonition-anchor-link" href="monads/io_monad.html#admonition-example-1-creating-basic-io-actions"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/io/IOExample.java">IOExample.java</a></li>
</ul>
<p>Use <code>IOKindHelper.delay</code> to capture side effects. Use <code>IOMonad.of</code> for pure values within IO.</p>
<pre><code class="language-java">import org.higherkindedj.hkt.Kind;
import org.higherkindedj.hkt.io.*; 
import org.higherkindedj.hkt.unit.Unit;
import java.util.function.Supplier;
import java.util.Scanner;

// Get the IOMonad instance
IOMonad ioMonad = IOMonad.INSTANCE;

// IO action to print a message
Kind&lt;IOKind.Witness, Unit&gt; printHello = IOKindHelper.delay(() -&gt; {
    System.out.println("Hello from IO!");
    return Unit.INSTANCE;
});

// IO action to read a line from the console
Kind&lt;IOKind.Witness, String&gt; readLine = IOKindHelper.delay(() -&gt; {
    System.out.print("Enter your name: ");
    // Scanner should ideally be managed more robustly in real apps
    try (Scanner scanner = new Scanner(System.in)) {
         return scanner.nextLine();
    }
});

// IO action that returns a pure value (no side effect description here)
Kind&lt;IOKind.Witness, Integer&gt; pureValueIO = ioMonad.of(42);

// IO action that simulates getting the current time (a side effect)
Kind&lt;IOKind.Witness, Long&gt; currentTime = IOKindHelper.delay(System::currentTimeMillis);

// Creating an IO action that might fail internally
Kind&lt;IOKind.Witness, String&gt; potentiallyFailingIO = IOKindHelper.delay(() -&gt; {
   if (Math.random() &lt; 0.5) {
       throw new RuntimeException("Simulated failure!");
   }
   return "Success!";
});


</code></pre>
</div>
</div>
<p><em>Nothing happens when you create these <code>IOKind</code> values. The <code>Supplier</code> inside <code>delay</code> is not executed.</em></p>
<div id="admonition-example-2-executing-io-actions" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-2-executing-io-actions-title">
<div class="admonition-title">
<div id="admonition-example-2-executing-io-actions-title">
<p>Example 2. Executing IO Actions</p>
</div>
<a class="admonition-anchor-link" href="monads/io_monad.html#admonition-example-2-executing-io-actions"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/io/IOExample.java">IOExample.java</a></li>
</ul>
<p>Use <code>IOKindHelper.unsafeRunSync</code> to run the computation.</p>
<pre><code class="language-java">// (Continuing from above examples)

// Execute printHello
System.out.println("Running printHello:");
IOKindHelper.unsafeRunSync(printHello); // Actually prints "Hello from IO!"

// Execute readLine (will block for user input)
// System.out.println("\nRunning readLine:");
// String name = IOKindHelper.unsafeRunSync(readLine);
// System.out.println("User entered: " + name);

// Execute pureValueIO
System.out.println("\nRunning pureValueIO:");
Integer fetchedValue = IOKindHelper.unsafeRunSync(pureValueIO);
System.out.println("Fetched pure value: " + fetchedValue); // Output: 42

// Execute potentiallyFailingIO
System.out.println("\nRunning potentiallyFailingIO:");
try {
String result = IOKindHelper.unsafeRunSync(potentiallyFailingIO);
   System.out.println("Succeeded: " + result);
} catch (RuntimeException e) {
   System.err.println("Caught expected failure: " + e.getMessage());
   }

// Notice that running the same IO action again executes the effect again
   System.out.println("\nRunning printHello again:");
IOKindHelper.unsafeRunSync(printHello); // Prints "Hello from IO!" again
</code></pre>
</div>
</div>
<div id="admonition-example-3-composing-io-actions-with-map-and-flatmap" class="admonition admonish-note" role="note" aria-labelledby="admonition-example-3-composing-io-actions-with-map-and-flatmap-title">
<div class="admonition-title">
<div id="admonition-example-3-composing-io-actions-with-map-and-flatmap-title">
<p>Example 3: Composing IO Actions with <code>map</code> and <code>flatMap</code></p>
</div>
<a class="admonition-anchor-link" href="monads/io_monad.html#admonition-example-3-composing-io-actions-with-map-and-flatmap"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/io/IOExample.java">IOExample.java</a></li>
</ul>
<p>Use <code>IOMonad</code> instance methods.</p>
<pre><code class="language-java">import org.higherkindedj.hkt.io.IOMonad;
import org.higherkindedj.hkt.unit.Unit;
import java.util.function.Function;

IOMonad ioMonad = IOMonad.INSTANCE;

// --- map example ---
Kind&lt;IOKind.Witness, String&gt; readLineAction = IOKindHelper.delay(() -&gt; "Test Input"); // Simulate input

// Map the result of readLineAction without executing readLine yet
Kind&lt;IOKind.Witness, String&gt; greetAction = ioMonad.map(
    name -&gt; "Hello, " + name + "!", // Function to apply to the result
    readLineAction
);

System.out.println("Greet action created, not executed yet.");
// Now execute the mapped action
String greeting = IOKindHelper.unsafeRunSync(greetAction);
System.out.println("Result of map: " + greeting); // Output: Hello, Test Input!

// --- flatMap example ---
// Action 1: Get name
Kind&lt;IOKind.Witness, String&gt; getName = IOKindHelper.delay(() -&gt; {
    System.out.println("Effect: Getting name...");
    return "Alice";
});

// Action 2 (depends on name): Print greeting
Function&lt;String, Kind&lt;IOKind.Witness, Unit&gt;&gt; printGreeting = name -&gt;
    IOKindHelper.delay(() -&gt; {
        System.out.println("Effect: Printing greeting for " + name);
        System.out.println("Welcome, " + name + "!");
        return Unit.INSTANCE;
    });

// Combine using flatMap
Kind&lt;IOKind.Witness, Void&gt; combinedAction = ioMonad.flatMap(printGreeting, getName);

System.out.println("\nCombined action created, not executed yet.");
// Execute the combined action
IOKindHelper.unsafeRunSync(combinedAction);
// Output:
// Effect: Getting name...
// Effect: Printing greeting for Alice
// Welcome, Alice!

// --- Full Program Example ---
Kind&lt;IOKind.Witness, Unit&gt; program = ioMonad.flatMap(
    ignored -&gt; ioMonad.flatMap( // Chain after printing hello
        name -&gt; ioMonad.map( // Map the result of printing the greeting
            ignored2 -&gt; { System.out.println("Program finished");
              return Unit.INSTANCE; },
              printGreeting.apply(name) // Action 3: Print greeting based on name
        ),
        readLine // Action 2: Read line
    ),
    printHello // Action 1: Print Hello
);

System.out.println("\nComplete IO Program defined. Executing...");
// IOKindHelper.unsafeRunSync(program); // Uncomment to run the full program
</code></pre>
<p><em>Notes:</em></p>
<ul>
<li><code>map</code> transforms the <em>result</em> of an <code>IO</code> action without changing the effect itself (though the transformation happens <em>after</em> the effect runs).</li>
<li><code>flatMap</code> sequences <code>IO</code> actions, ensuring the effect of the first action completes before the second action (which might depend on the first action's result) begins.</li>
</ul>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<p>#The Lazy Monad:</p>
<h2 id="lazy-evaluation-with-lazy"><a class="header" href="#lazy-evaluation-with-lazy"><em>Lazy Evaluation with <code>Lazy</code></em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="monads/lazy_monad.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to defer expensive computations until their results are actually needed</li>
<li>Understanding memoisation and how results are cached after first evaluation</li>
<li>Handling exceptions in lazy computations with ThrowableSupplier</li>
<li>Composing lazy operations while preserving laziness</li>
<li>Building efficient pipelines that avoid unnecessary work</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="monads/lazy_monad.html#admonition-see-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/lazy/LazyExample.java">LazyExample.java</a></p>
</div>
</div>
<p>This article introduces the <code>Lazy&lt;A&gt;</code> type and its associated components within the <code>higher-kinded-j</code> library. <code>Lazy</code> provides a mechanism for deferred computation, where a value is calculated only when needed and the result (or any exception thrown during calculation) is memoized (cached).</p>
<h2 id="core-components-1"><a class="header" href="#core-components-1">Core Components</a></h2>
<p><strong>The Lazy Type</strong></p>
<p><img src="monads/../images/puml/lazy_class.svg" alt="lazy_class.svg" /></p>
<p><strong>The HKT Bridge for Lazy</strong></p>
<p><img src="monads/../images/puml/lazy_kind.svg" alt="lazy_kind.svg" /></p>
<p><strong>Typeclasses for Lazy</strong></p>
<p><img src="monads/../images/puml/lazy_monad.svg" alt="lazy_monad.svg" /></p>
<p>The lazy evaluation feature revolves around these key types:</p>
<ol>
<li><strong><code>ThrowableSupplier&lt;T&gt;</code></strong>: A functional interface similar to <code>java.util.function.Supplier</code>, but its <code>get()</code> method is allowed to throw any <code>Throwable</code> (including checked exceptions). This is used as the underlying computation for <code>Lazy</code>.</li>
<li><strong><code>Lazy&lt;A&gt;</code></strong>: The core class representing a computation that produces a value of type <code>A</code> lazily. It takes a <code>ThrowableSupplier&lt;? extends A&gt;</code> during construction (<code>Lazy.defer</code>). Evaluation is triggered only by the <code>force()</code> method, and the result or exception is cached. <code>Lazy.now(value)</code> creates an already evaluated instance.</li>
<li><strong><code>LazyKind&lt;A&gt;</code></strong>: The HKT marker interface (<code>Kind&lt;LazyKind.Witness, A&gt;</code>) for <code>Lazy</code>, allowing it to be used generically with type classes like <code>Functor</code> and <code>Monad</code>.</li>
<li><strong><code>LazyKindHelper</code></strong>: A utility class providing static methods to bridge between the concrete <code>Lazy&lt;A&gt;</code> type and its HKT representation <code>LazyKind&lt;A&gt;</code>. It includes:
<ul>
<li><code>widen(Lazy&lt;A&gt;)</code>: Wraps a <code>Lazy</code> instance into <code>LazyKind</code>.</li>
<li><code>narrow(Kind&lt;LazyKind.Witness, A&gt;)</code>: Unwraps <code>LazyKind</code> back to <code>Lazy</code>. Throws <code>KindUnwrapException</code> if the input Kind is invalid.</li>
<li><code>defer(ThrowableSupplier&lt;A&gt;)</code>: Factory to create a <code>LazyKind</code> from a computation.</li>
<li><code>now(A value)</code>: Factory to create an already evaluated <code>LazyKind</code>.</li>
<li><code>force(Kind&lt;LazyKind.Witness, A&gt;)</code>: Convenience method to unwrap and force evaluation.</li>
</ul>
</li>
<li><strong><code>LazyMonad</code></strong>: The type class instance implementing <code>Monad&lt;LazyKind.Witness&gt;</code>, <code>Applicative&lt;LazyKind.Witness&gt;</code>, and <code>Functor&lt;LazyKind.Witness&gt;</code>. It provides standard monadic operations (<code>map</code>, <code>flatMap</code>, <code>of</code>, <code>ap</code>) for <code>LazyKind</code>, ensuring laziness is maintained during composition.</li>
</ol>
<h2 id="purpose-and-usage-2"><a class="header" href="#purpose-and-usage-2">Purpose and Usage</a></h2>
<ul>
<li><strong>Deferred Computation</strong>: Use <code>Lazy</code> when you have potentially expensive computations that should only execute if their result is actually needed.</li>
<li><strong>Memoization</strong>: The result (or exception) of the computation is stored after the first call to <code>force()</code>, subsequent calls return the cached result without re-computation.</li>
<li><strong>Exception Handling</strong>: Computations wrapped in <code>Lazy.defer</code> can throw any <code>Throwable</code>. This exception is caught, memoized, and re-thrown by <code>force()</code>.</li>
<li><strong>Functional Composition</strong>: <code>LazyMonad</code> allows chaining lazy computations using <code>map</code> and <code>flatMap</code> while preserving laziness. The composition itself doesn't trigger evaluation; only forcing the final <code>LazyKind</code> does.</li>
<li><strong>HKT Integration</strong>: <code>LazyKind</code> and <code>LazyMonad</code> enable using lazy computations within generic functional code expecting <code>Kind&lt;F, A&gt;</code> and <code>Monad&lt;F&gt;</code>.</li>
</ul>
<div id="admonition-example-creating-lazy-instances" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-creating-lazy-instances-title">
<div class="admonition-title">
<div id="admonition-example-creating-lazy-instances-title">
<p>Example: Creating Lazy Instances</p>
</div>
<a class="admonition-anchor-link" href="monads/lazy_monad.html#admonition-example-creating-lazy-instances"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/lazy/LazyExample.java">LazyExample.java</a></li>
</ul>
<pre><code class="language-java">
// 1. Deferring a computation (that might throw checked exception)
java.util.concurrent.atomic.AtomicInteger counter = new java.util.concurrent.atomic.AtomicInteger(0);
Kind&lt;LazyKind.Witness, String&gt; deferredLazy = LAZY.defer(() -&gt; {
    System.out.println("Executing expensive computation...");
    counter.incrementAndGet();
    // Simulate potential failure
    if (System.currentTimeMillis() % 2 == 0) {
         // Throwing a checked exception is allowed by ThrowableSupplier
         throw new java.io.IOException("Simulated IO failure");
    }
    Thread.sleep(50); // Simulate work
    return "Computed Value";
});

// 2. Creating an already evaluated Lazy
Kind&lt;LazyKind.Witness, String&gt; nowLazy = LAZY.now("Precomputed Value");

// 3. Using the underlying Lazy type directly (less common when using HKT)
Lazy&lt;String&gt; directLazy = Lazy.defer(() -&gt; { counter.incrementAndGet(); return "Direct Lazy"; });
</code></pre>
</div>
</div>
<div id="admonition-example-forcing-evaluation" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-forcing-evaluation-title">
<div class="admonition-title">
<div id="admonition-example-forcing-evaluation-title">
<p>Example: Forcing Evaluation</p>
</div>
<a class="admonition-anchor-link" href="monads/lazy_monad.html#admonition-example-forcing-evaluation"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/lazy/LazyExample.java">LazyExample.java</a></li>
</ul>
<p>Evaluation only happens when <code>force()</code> is called (directly or via the helper).</p>
<pre><code class="language-java">// (Continuing from above)
System.out.println("Lazy instances created. Counter: " + counter.get()); // Output: 0

try {
    // Force the deferred computation
    String result1 = LAZY.force(deferredLazy); // force() throws Throwable
    System.out.println("Result 1: " + result1);
    System.out.println("Counter after first force: " + counter.get()); // Output: 1

    // Force again - uses memoized result
    String result2 = LAZY.force(deferredLazy);
    System.out.println("Result 2: " + result2);
    System.out.println("Counter after second force: " + counter.get()); // Output: 1 (not re-computed)

    // Force the 'now' instance
    String resultNow = LAZY.force(nowLazy);
    System.out.println("Result Now: " + resultNow);
    System.out.println("Counter after forcing 'now': " + counter.get()); // Output: 1 (no computation ran for 'now')

} catch (Throwable t) { // Catch Throwable because force() can re-throw anything
    System.err.println("Caught exception during force: " + t);
    // Exception is also memoized:
    try {
        LAZY.force(deferredLazy);
    } catch (Throwable t2) {
        System.err.println("Caught memoized exception: " + t2);
        System.out.println("Counter after failed force: " + counter.get()); // Output: 1
    }
}
</code></pre>
</div>
</div>
<div id="admonition-example-using-_lazymonad_-_map_-and-_flatmap_" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-using-_lazymonad_-_map_-and-_flatmap_-title">
<div class="admonition-title">
<div id="admonition-example-using-_lazymonad_-_map_-and-_flatmap_-title">
<p>Example: Using <em>LazyMonad</em> (<em>map</em> and <em>flatMap</em>)</p>
</div>
<a class="admonition-anchor-link" href="monads/lazy_monad.html#admonition-example-using-_lazymonad_-_map_-and-_flatmap_"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/lazy/LazyExample.java">LazyExample.java</a></li>
</ul>
<pre><code class="language-java">
LazyMonad lazyMonad = LazyMonad.INSTANCE;
counter.set(0); // Reset counter for this example

Kind&lt;LazyKind.Witness, Integer&gt; initialLazy = LAZY.defer(() -&gt; { counter.incrementAndGet(); return 10; });

// --- map ---
// Apply a function lazily
Function&lt;Integer, String&gt; toStringMapper = i -&gt; "Value: " + i;
Kind&lt;LazyKind.Witness, String&gt; mappedLazy = lazyMonad.map(toStringMapper, initialLazy);

System.out.println("Mapped Lazy created. Counter: " + counter.get()); // Output: 0

try {
    System.out.println("Mapped Result: " + LAZY.force(mappedLazy)); // Triggers evaluation of initialLazy &amp; map
    // Output: Mapped Result: Value: 10
    System.out.println("Counter after forcing mapped: " + counter.get()); // Output: 1
} catch (Throwable t) { /* ... */ }


// --- flatMap ---
// Sequence lazy computations
Function&lt;Integer, Kind&lt;LazyKind.Witness, String&gt;&gt; multiplyAndStringifyLazy =
    i -&gt; LAZY.defer(() -&gt; { // Inner computation is also lazy
        int result = i * 5;
        return "Multiplied: " + result;
    });

Kind&lt;LazyKind.Witness, String&gt; flatMappedLazy = lazyMonad.flatMap(multiplyAndStringifyLazy, initialLazy);

System.out.println("FlatMapped Lazy created. Counter: " + counter.get()); // Output: 1 (map already forced initialLazy)

try {
    System.out.println("FlatMapped Result: " + force(flatMappedLazy)); // Triggers evaluation of inner lazy
    // Output: FlatMapped Result: Multiplied: 50
} catch (Throwable t) { /* ... */ }

// --- Chaining ---
Kind&lt;LazyKind.Witness, String&gt; chainedLazy = lazyMonad.flatMap(
    value1 -&gt; lazyMonad.map(
        value2 -&gt; "Combined: " + value1 + " &amp; " + value2, // Combine results
        LAZY.defer(()-&gt;value1 * 2) // Second lazy step, depends on result of first
    ),
    LAZY.defer(()-&gt;5) // First lazy step
);

try{
    System.out.println("Chained Result: "+force(chainedLazy)); // Output: Combined: 5 &amp; 10
}catch(Throwable t){/* ... */}
</code></pre>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<p>#The ListMonad:</p>
<h2 id="monadic-operations-on-java-lists"><a class="header" href="#monadic-operations-on-java-lists"><em>Monadic Operations on Java Lists</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="monads/list_monad.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to work with Lists as contexts representing multiple possible values</li>
<li>Using <code>flatMap</code> for non-deterministic computations and combinations</li>
<li>Generating Cartesian products and filtering results</li>
<li>Understanding how List models choice and branching computations</li>
<li>Building search algorithms and combinatorial problems with monadic operations</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="monads/list_monad.html#admonition-see-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/list/ListMonadExample.java">ListMonadExample.java</a></p>
</div>
</div>
<h2 id="purpose-1"><a class="header" href="#purpose-1">Purpose</a></h2>
<p>The <code>ListMonad</code> in the <code>Higher-Kinded-J</code> library provides a monadic interface for Java's standard <code>java.util.List</code>. It allows developers to work with lists in a more functional style, enabling operations like <code>map</code>, <code>flatMap</code>, and <code>ap</code> (apply) within the higher-kinded type system. This is particularly useful for sequencing operations that produce lists, transforming list elements, and applying functions within a list context, all while integrating with the generic <code>Kind&lt;F, A&gt;</code> abstractions.</p>
<p>Key benefits include:</p>
<ul>
<li><strong>Functional Composition:</strong> Easily chain operations on lists, where each operation might return a list itself.</li>
<li><strong>HKT Integration:</strong> <code>ListKind</code> (the higher-kinded wrapper for <code>List</code>) and <code>ListMonad</code> allow <code>List</code> to be used with generic functions and type classes expecting <code>Kind&lt;F, A&gt;</code>, <code>Functor&lt;F&gt;</code>, <code>Applicative&lt;F&gt;</code>, or <code>Monad&lt;F&gt;</code>.</li>
<li><strong>Standard List Behavior:</strong> Leverages the familiar behaviour of Java lists, such as non-uniqueness of elements and order preservation. <code>flatMap</code> corresponds to applying a function that returns a list to each element and then concatenating the results.</li>
</ul>
<p>It implements <code>Monad&lt;ListKind&lt;A&gt;&gt;</code>, inheriting from <code>Functor&lt;ListKind&lt;A&gt;&gt;</code> and <code>Applicative&lt;ListKind&lt;A&gt;&gt;</code>.</p>
<h2 id="structure-1"><a class="header" href="#structure-1">Structure</a></h2>
<p><img src="monads/../images/puml/list_monad.svg" alt="list_monad.svg" /></p>
<h2 id="how-to-use-listmonad-and-listkind"><a class="header" href="#how-to-use-listmonad-and-listkind">How to Use <code>ListMonad</code> and <code>ListKind</code></a></h2>
<h3 id="creating-instances-1"><a class="header" href="#creating-instances-1">Creating Instances</a></h3>
<p><code>ListKind&lt;A&gt;</code> is the higher-kinded type representation for <code>java.util.List&lt;A&gt;</code>. You typically create <code>ListKind</code> instances using the <code>ListKindHelper</code> utility class or the <code>of</code> method from <code>ListMonad</code>.</p>
<div id="admonition-_listwidenlist_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_listwidenlist_-title">
<div class="admonition-title">
<div id="admonition-_listwidenlist_-title">
<p><em>LIST.widen(List<A>)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/list_monad.html#admonition-_listwidenlist_"></a>
</div>
<div>
<p>Converts a standard <code>java.util.List&lt;A&gt;</code> into a <code>Kind&lt;ListKind.Witness, A&gt;</code>.</p>
<pre><code class="language-java">List&lt;String&gt; stringList = Arrays.asList("a", "b", "c");
Kind&lt;ListKind.Witness, String&gt; listKind1 = LIST.widen(stringList);

List&lt;Integer&gt; intList = Collections.singletonList(10);
Kind&lt;ListKind.Witness, Integer&gt; listKind2 = LIST.widen(intList);

List&lt;Object&gt; emptyList = Collections.emptyList();
Kind&lt;ListKind.Witness, Object&gt; listKindEmpty = LIST.widen(emptyList);

</code></pre>
</div>
</div>
<div id="admonition-_listmonadofa-value_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_listmonadofa-value_-title">
<div class="admonition-title">
<div id="admonition-_listmonadofa-value_-title">
<p><em>listMonad.of(A value)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/list_monad.html#admonition-_listmonadofa-value_"></a>
</div>
<div>
<p>Lifts a single value into the <code>ListKind</code> context, creating a singleton list. A <code>null</code> input value results in an empty <code>ListKind</code>.</p>
<pre><code class="language-java">ListMonad listMonad = ListMonad.INSTANCE;

Kind&lt;ListKind.Witness, String&gt; listKindOneItem = listMonad.of("hello"); // Contains a list with one element: "hello"
Kind&lt;ListKind.Witness, Integer&gt; listKindAnotherItem = listMonad.of(42);  // Contains a list with one element: 42
Kind&lt;ListKind.Witness, Object&gt; listKindFromNull = listMonad.of(null); // Contains an empty list
</code></pre>
</div>
</div>
<div id="admonition-_listnarrow_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_listnarrow_-title">
<div class="admonition-title">
<div id="admonition-_listnarrow_-title">
<p><em>LIST.narrow()</em></p>
</div>
<a class="admonition-anchor-link" href="monads/list_monad.html#admonition-_listnarrow_"></a>
</div>
<div>
<p>To get the underlying <code>java.util.List&lt;A&gt;</code> from a <code>Kind&lt;ListKind.Witness, A&gt;</code>, use <code>LIST.narrow()</code>:</p>
<pre><code class="language-java">Kind&lt;ListKind.Witness, A&gt; listKind = LIST.widen(List.of("example"));
List&lt;String&gt; unwrappedList = LIST.narrow(listKind); // Returns Arrays.asList("example")
System.out.println(unwrappedList);
</code></pre>
</div>
</div>
<h3 id="key-operations"><a class="header" href="#key-operations">Key Operations</a></h3>
<p>The <code>ListMonad</code> provides standard monadic operations:</p>
<div id="admonition-_mapfunction-f-kind-fa_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_mapfunction-f-kind-fa_-title">
<div class="admonition-title">
<div id="admonition-_mapfunction-f-kind-fa_-title">
<p><em>map(Function&lt;A, B&gt; f, Kind&lt;ListKind.Witness, A&gt; fa)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/list_monad.html#admonition-_mapfunction-f-kind-fa_"></a>
</div>
<div>
<p><strong><code>map(Function&lt;A, B&gt; f, Kind&lt;ListKind.Witness, A&gt; fa)</code>:</strong></p>
<p>Applies a function <code>f</code> to each element of the list within <code>fa</code>, returning a new <code>ListKind</code> containing the transformed elements.</p>
<pre><code class="language-java">
ListMonad listMonad = ListMonad.INSTANCE;
ListKind&lt;Integer&gt; numbers = LIST.widen(Arrays.asList(1, 2, 3));

Function&lt;Integer, String&gt; intToString = i -&gt; "Number: " + i;
ListKind&lt;String&gt; strings = listMonad.map(intToString, numbers);

// LIST.narrow(strings) would be: ["Number: 1", "Number: 2", "Number: 3"]
System.out.println(LIST.narrow(strings));
</code></pre>
</div>
</div>
<div id="admonition-_flatmapfunction-f-kind-ma_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_flatmapfunction-f-kind-ma_-title">
<div class="admonition-title">
<div id="admonition-_flatmapfunction-f-kind-ma_-title">
<p><em>flatMap(Function&lt;A, Kind&lt;ListKind.Witness, B&gt;&gt; f, Kind&lt;ListKind.Witness, A&gt; ma)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/list_monad.html#admonition-_flatmapfunction-f-kind-ma_"></a>
</div>
<div>
<p><strong><code>flatMap(Function&lt;A, Kind&lt;ListKind.Witness, B&gt;&gt; f, Kind&lt;ListKind.Witness, A&gt; ma)</code>:</strong></p>
<p>Applies a function <code>f</code> to each element of the list within <code>ma</code>. The function <code>f</code> itself returns a <code>ListKind&lt;B&gt;</code>. <code>flatMap</code> then concatenates (flattens) all these resulting lists into a single <code>ListKind&lt;B&gt;</code>.</p>
<pre><code class="language-java">
ListMonad listMonad = ListMonad.INSTANCE;
Kind&lt;ListKind.Witness, Integer&gt; initialValues = LIST.widen(Arrays.asList(1, 2, 3));

// Function that takes an integer and returns a list of itself and itself + 10
Function&lt;Integer, Kind&lt;ListKind.Witness, Integer&gt;&gt; replicateAndAddTen =
    i -&gt; LIST.widen(Arrays.asList(i, i + 10));

Kind&lt;ListKind.Witness, Integer&gt; flattenedList = listMonad.flatMap(replicateAndAddTen, initialValues);

// LIST.narrow(flattenedList) would be: [1, 11, 2, 12, 3, 13]
System.out.println(LIST.narrow(flattenedList));

// Example with empty list results
Function&lt;Integer, Kind&lt;ListKind.Witness, String&gt;&gt; toWordsIfEven =
    i -&gt; (i % 2 == 0) ?
         LIST.widen(Arrays.asList("even", String.valueOf(i))) :
         LIST.widen(new ArrayList&lt;&gt;()); // empty list for odd numbers

Kind&lt;ListKind.Witness, String&gt; wordsList = listMonad.flatMap(toWordsIfEven, initialValues);
// LIST.narrow(wordsList) would be: ["even", "2"]
 System.out.println(LIST.narrow(wordsList));
</code></pre>
</div>
</div>
<div id="admonition-_apkind-ff-kind-fa_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_apkind-ff-kind-fa_-title">
<div class="admonition-title">
<div id="admonition-_apkind-ff-kind-fa_-title">
<p><em>ap(Kind&lt;ListKind.Witness, Function&lt;A, B&gt;&gt; ff, Kind&lt;ListKind.Witness, A&gt; fa)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/list_monad.html#admonition-_apkind-ff-kind-fa_"></a>
</div>
<div>
<p><strong><code>ap(Kind&lt;ListKind.Witness, Function&lt;A, B&gt;&gt; ff, Kind&lt;ListKind.Witness, A&gt; fa)</code>:</strong></p>
<p>Applies a list of functions <code>ff</code> to a list of values <code>fa</code>. This results in a new list where each function from <code>ff</code> is applied to each value in <code>fa</code> (Cartesian product style).</p>
<pre><code class="language-java">
ListMonad listMonad = ListMonad.INSTANCE;

Function&lt;Integer, String&gt; addPrefix = i -&gt; "Val: " + i;
Function&lt;Integer, String&gt; multiplyAndString = i -&gt; "Mul: " + (i * 2);

Kind&lt;ListKind.Witness, Function&lt;Integer, String&gt;&gt; functions =
    LIST.widen(Arrays.asList(addPrefix, multiplyAndString));
Kind&lt;ListKind.Witness, Integer&gt; values = LIST.widen(Arrays.asList(10, 20));

Kind&lt;ListKind.Witness, String&gt; appliedResults = listMonad.ap(functions, values);

// LIST.narrow(appliedResults) would be:
// ["Val: 10", "Val: 20", "Mul: 20", "Mul: 40"]
System.out.println(LIST.narrow(appliedResults));
</code></pre>
</div>
</div>
<div id="admonition-example-using-listmonad" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-using-listmonad-title">
<div class="admonition-title">
<div id="admonition-example-using-listmonad-title">
<p>Example: Using ListMonad</p>
</div>
<a class="admonition-anchor-link" href="monads/list_monad.html#admonition-example-using-listmonad"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/list/ListMonadExample.java">ListMonadExample.java</a></li>
</ul>
<p>To use <code>ListMonad</code> in generic contexts that operate over <code>Kind&lt;F, A&gt;</code>:</p>
<ol>
<li><strong>Get an instance of <code>ListMonad</code>:</strong></li>
</ol>
<pre><code class="language-java">ListMonad listMonad = ListMonad.INSTANCE;
</code></pre>
<ol start="2">
<li><strong>Wrap your List into <code>Kind</code>:</strong></li>
</ol>
<pre><code class="language-java">List&lt;Integer&gt; myList = Arrays.asList(10, 20, 30);
Kind&lt;ListKind.Witness, Integer&gt; listKind = LIST.widen(myList);
</code></pre>
<ol start="3">
<li><strong>Use <code>ListMonad</code> methods:</strong></li>
</ol>
<pre><code class="language-java">import org.higherkindedj.hkt.Kind;
import org.higherkindedj.hkt.list.ListKind;
import org.higherkindedj.hkt.list.ListKindHelper;
import org.higherkindedj.hkt.list.ListMonad;

import java.util.Arrays;
import java.util.List;
import java.util.function.Function;
import java.util.stream.Collectors;

public class ListMonadExample {
   public static void main(String[] args) {
      ListMonad listMonad = ListMonad.INSTANCE;

      // 1. Create a ListKind
      Kind&lt;ListKind.Witness, Integer&gt; numbersKind = LIST.widen(Arrays.asList(1, 2, 3, 4));

      // 2. Use map
      Function&lt;Integer, String&gt; numberToDecoratedString = n -&gt; "*" + n + "*";
      Kind&lt;ListKind.Witness, String&gt; stringsKind = listMonad.map(numberToDecoratedString, numbersKind);
      System.out.println("Mapped: " + LIST.narrow(stringsKind));
      // Expected: Mapped: [*1*, *2*, *3*, *4*]

      // 3. Use flatMap
      // Function: integer -&gt; ListKind of [integer, integer*10] if even, else empty ListKind
      Function&lt;Integer, Kind&lt;ListKind.Witness, Integer&gt;&gt; duplicateIfEven = n -&gt; {
         if (n % 2 == 0) {
            return LIST.widen(Arrays.asList(n, n * 10));
         } else {
            return LIST.widen(List.of()); // Empty list
         }
      };
      Kind&lt;ListKind.Witness, Integer&gt; flatMappedKind = listMonad.flatMap(duplicateIfEven, numbersKind);
      System.out.println("FlatMapped: " + LIST.narrow(flatMappedKind));
      // Expected: FlatMapped: [2, 20, 4, 40]

      // 4. Use of
      Kind&lt;ListKind.Witness, String&gt; singleValueKind = listMonad.of("hello world");
      System.out.println("From 'of': " + LIST.narrow(singleValueKind));
      // Expected: From 'of': [hello world]

      Kind&lt;ListKind.Witness, String&gt; fromNullOf = listMonad.of(null);
      System.out.println("From 'of' with null: " + LIST.narrow(fromNullOf));
      // Expected: From 'of' with null: []


      // 5. Use ap
      Kind&lt;ListKind.Witness, Function&lt;Integer, String&gt;&gt; listOfFunctions =
              LIST.widen(Arrays.asList(
                      i -&gt; "F1:" + i,
                      i -&gt; "F2:" + (i * i)
              ));
      Kind&lt;ListKind.Witness, Integer&gt; inputNumbersForAp = LIST.widen(Arrays.asList(5, 6));

      Kind&lt;ListKind.Witness, String&gt; apResult = listMonad.ap(listOfFunctions, inputNumbersForAp);
      System.out.println("Ap result: " + LIST.narrow(apResult));
      // Expected: Ap result: [F1:5, F1:6, F2:25, F2:36]


      // Unwrap to get back the standard List
      List&lt;Integer&gt; finalFlatMappedList = LIST.narrow(flatMappedKind);
      System.out.println("Final unwrapped flatMapped list: " + finalFlatMappedList);
   }
}
</code></pre>
<p>This example demonstrates how to wrap Java Lists into <code>ListKind</code>, apply monadic operations using <code>ListMonad</code>, and then unwrap them back to standard Lists.</p>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<p>#The MaybeMonad:</p>
<h2 id="handling-optional-values-with-non-null-guarantee"><a class="header" href="#handling-optional-values-with-non-null-guarantee"><em>Handling Optional Values with Non-Null Guarantee</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="monads/maybe_monad.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How Maybe provides null-safe optional values with guaranteed non-null contents</li>
<li>The difference between Maybe and Optional (non-null guarantee in Just)</li>
<li>Using Maybe as a MonadError with Unit as the error type</li>
<li>Chaining operations with automatic Nothing propagation</li>
<li>Building robust pipelines that handle absence gracefully</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="monads/maybe_monad.html#admonition-see-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/maybe/MaybeExample.java">MaybeExample.java</a></p>
</div>
</div>
<h2 id="purpose-2"><a class="header" href="#purpose-2">Purpose</a></h2>
<p>The <code>Maybe&lt;T&gt;</code> type in <code>Higher-Kinded-J</code> represents a value that might be present (<code>Just&lt;T&gt;</code>) or absent (<code>Nothing&lt;T&gt;</code>). It is conceptually similar to <code>java.util.Optional&lt;T&gt;</code> but with a key distinction: a <code>Just&lt;T&gt;</code> is guaranteed to hold a <strong>non-null</strong> value. This strictness helps prevent <code>NullPointerExceptions</code> when a value is asserted to be present. <code>Maybe.fromNullable(T value)</code> or <code>MaybeMonad.of(T value)</code> should be used if the input value could be null, as these will correctly produce a <code>Nothing</code> in such cases.</p>
<p>The <code>MaybeMonad</code> provides a monadic interface for <code>Maybe</code>, allowing for functional composition and integration with the Higher-Kinded Type (HKT) system. This facilitates chaining operations that may or may not yield a value, propagating the <code>Nothing</code> state automatically.</p>
<div id="admonition-key-benefits-include" class="admonition admonish-info" role="note" aria-labelledby="admonition-key-benefits-include-title">
<div class="admonition-title">
<div id="admonition-key-benefits-include-title">
<p>Key benefits include:</p>
</div>
<a class="admonition-anchor-link" href="monads/maybe_monad.html#admonition-key-benefits-include"></a>
</div>
<div>
<ul>
<li><strong>Explicit Optionality with Non-Null Safety:</strong> <code>Just&lt;T&gt;</code> guarantees its contained value is not null. <code>Nothing&lt;T&gt;</code> clearly indicates absence.</li>
<li><strong>Functional Composition:</strong> Enables elegant chaining of operations using <code>map</code>, <code>flatMap</code>, and <code>ap</code>, where <code>Nothing</code> short-circuits computations.</li>
<li><strong>HKT Integration:</strong> <code>MaybeKind&lt;A&gt;</code> (the HKT wrapper for <code>Maybe&lt;A&gt;</code>) and <code>MaybeMonad</code> allow <code>Maybe</code> to be used with generic functions and type classes that expect <code>Kind&lt;F, A&gt;</code>, <code>Functor&lt;F&gt;</code>, <code>Applicative&lt;F&gt;</code>, <code>Monad&lt;M&gt;</code>, or <code>MonadError&lt;M, E&gt;</code>.</li>
<li><strong>Error Handling for Absence:</strong> <code>MaybeMonad</code> implements <code>MonadError&lt;MaybeKind.Witness, Unit&gt;</code>. <code>Nothing</code> is treated as the "error" state, with <code>Unit</code> as the phantom error type, signifying absence.</li>
</ul>
</div>
</div>
<p>It implements <code>MonadError&lt;MaybeKind.Witness, Unit&gt;</code>, which transitively includes <code>Monad&lt;MaybeKind.Witness&gt;</code>, <code>Applicative&lt;MaybeKind.Witness&gt;</code>, and <code>Functor&lt;MaybeKind.Witness&gt;</code>.</p>
<h2 id="structure-2"><a class="header" href="#structure-2">Structure</a></h2>
<p><img src="monads/../images/puml/maybe_monad.svg" alt="maybe_monad.svg" /></p>
<h2 id="how-to-use-maybemonad-and-maybe"><a class="header" href="#how-to-use-maybemonad-and-maybe">How to Use <code>MaybeMonad</code> and <code>Maybe</code></a></h2>
<h3 id="creating-instances-2"><a class="header" href="#creating-instances-2">Creating Instances</a></h3>
<p><code>Maybe&lt;A&gt;</code> instances can be created directly using static factory methods on <code>Maybe</code>, or via <code>MaybeMonad</code> for HKT integration. <code>MaybeKind&lt;A&gt;</code> is the HKT wrapper.</p>
<p><strong>Direct <code>Maybe</code> Creation:</strong></p>
 <div id="admonition-_maybejustnonnull-t-value_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_maybejustnonnull-t-value_-title">
 <div class="admonition-title">
 <div id="admonition-_maybejustnonnull-t-value_-title">
<p><em>Maybe.just(@NonNull T value)</em></p>
 </div>
 <a class="admonition-anchor-link" href="monads/maybe_monad.html#admonition-_maybejustnonnull-t-value_"></a>
 </div>
 <div>
<p>Creates a <code>Just</code> holding a <strong>non-null</strong> value. Throws <code>NullPointerException</code> if <code>value</code> is null.</p>
<pre><code class="language-java">Maybe&lt;String&gt; justHello = Maybe.just("Hello"); // Just("Hello")
Maybe&lt;String&gt; illegalJust = Maybe.just(null); // Throws NullPointerException
</code></pre>
 </div>
 </div>
  <div id="admonition-_maybenothing_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_maybenothing_-title">
  <div class="admonition-title">
  <div id="admonition-_maybenothing_-title">
<p><em>Maybe.nothing()</em></p>
  </div>
  <a class="admonition-anchor-link" href="monads/maybe_monad.html#admonition-_maybenothing_"></a>
  </div>
  <div>
<p>Returns a singleton <code>Nothing</code> instance.</p>
<pre><code class="language-java">Maybe&lt;Integer&gt; noInt = Maybe.nothing(); // Nothing
</code></pre>
  </div>
  </div>
  <div id="admonition-_maybefromnullablenullable-t-value_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_maybefromnullablenullable-t-value_-title">
  <div class="admonition-title">
  <div id="admonition-_maybefromnullablenullable-t-value_-title">
<p><em>Maybe.fromNullable(@Nullable T value)</em></p>
  </div>
  <a class="admonition-anchor-link" href="monads/maybe_monad.html#admonition-_maybefromnullablenullable-t-value_"></a>
  </div>
  <div>
<p>Creates <code>Just(value)</code> if <code>value</code> is non-null, otherwise <code>Nothing</code>.</p>
<pre><code class="language-java">Maybe&lt;String&gt; fromPresent = Maybe.fromNullable("Present"); // Just("Present")
Maybe&lt;String&gt; fromNull = Maybe.fromNullable(null);     // Nothing
</code></pre>
  </div>
  </div>
<p><strong><code>MaybeKindHelper</code> (for HKT wrapping):</strong></p>
<div id="admonition-_maybekindhelperwidenmaybe-maybe_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_maybekindhelperwidenmaybe-maybe_-title">
<div class="admonition-title">
<div id="admonition-_maybekindhelperwidenmaybe-maybe_-title">
<p><em>MaybeKindHelper.widen(Maybe<A> maybe)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/maybe_monad.html#admonition-_maybekindhelperwidenmaybe-maybe_"></a>
</div>
<div>
<p>Converts a <code>Maybe&lt;A&gt;</code> to <code>MaybeKind&lt;A&gt;</code>.</p>
<pre><code class="language-java">Kind&lt;MaybeKind.Witness, String&gt; kindJust = MAYBE.widen(Maybe.just("Wrapped"));
Kind&lt;MaybeKind.Witness,Integer&gt; kindNothing = MAYBE.widen(Maybe.nothing());
</code></pre>
</div>
</div>
<div id="admonition-_maybejustnonnull-a-value_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_maybejustnonnull-a-value_-title">
<div class="admonition-title">
<div id="admonition-_maybejustnonnull-a-value_-title">
<p><em>MAYBE.just(@NonNull A value)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/maybe_monad.html#admonition-_maybejustnonnull-a-value_"></a>
</div>
<div>
<p>Convenience for <code>widen(Maybe.just(value))</code>.</p>
</div>
</div>
<div id="admonition-_maybenothing_-1" class="admonition admonish-note" role="note" aria-labelledby="admonition-_maybenothing_-1-title">
<div class="admonition-title">
<div id="admonition-_maybenothing_-1-title">
<p><em>MAYBE.nothing()</em></p>
</div>
<a class="admonition-anchor-link" href="monads/maybe_monad.html#admonition-_maybenothing_-1"></a>
</div>
<div>
<p>Convenience for <code>widen(Maybe.nothing())</code>.</p>
</div>
</div>
<p><strong><code>MaybeMonad</code> Instance Methods:</strong></p>
<div id="admonition-_maybemonadofnullable-a-value_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_maybemonadofnullable-a-value_-title">
<div class="admonition-title">
<div id="admonition-_maybemonadofnullable-a-value_-title">
<p><em>maybeMonad.of(@Nullable A value)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/maybe_monad.html#admonition-_maybemonadofnullable-a-value_"></a>
</div>
<div>
<p>Lifts a value into <code>Kind&lt;MaybeKind.Witness, A&gt;</code>. Uses <code>Maybe.fromNullable()</code> internally.</p>
<pre><code class="language-java">MaybeMonad maybeMonad = MaybeMonad.INSTANCE;
Kind&lt;MaybeKind.Witness, String&gt; kindFromMonad = maybeMonad.of("Monadic"); // Just("Monadic")
Kind&lt;MaybeKind.Witness, String&gt; kindNullFromMonad = maybeMonad.of(null);   // Nothing
</code></pre>
</div>
</div>
<div id="admonition-_maybemonadraiseerrornullable-unit-error_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_maybemonadraiseerrornullable-unit-error_-title">
<div class="admonition-title">
<div id="admonition-_maybemonadraiseerrornullable-unit-error_-title">
<p><em>maybeMonad.raiseError(@Nullable Unit error)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/maybe_monad.html#admonition-_maybemonadraiseerrornullable-unit-error_"></a>
</div>
<div>
<p>Creates a <code>Kind&lt;MaybeKind.Witness, E&gt;</code> representing <code>Nothing</code>. The <code>error</code> (Unit) argument is ignored.</p>
<pre><code class="language-java">Kind&lt;MaybeKind.Witness, Double&gt; errorKind = maybeMonad.raiseError(Unit.INSTANCE); // Nothing
</code></pre>
</div>
</div>
<div id="admonition-unwrapping-_maybekind_" class="admonition admonish-note" role="note" aria-labelledby="admonition-unwrapping-_maybekind_-title">
<div class="admonition-title">
<div id="admonition-unwrapping-_maybekind_-title">
<p>Unwrapping <em>MaybeKind</em></p>
</div>
<a class="admonition-anchor-link" href="monads/maybe_monad.html#admonition-unwrapping-_maybekind_"></a>
</div>
<div>
<p>To get the underlying <code>Maybe&lt;A&gt;</code> from a <code>MaybeKind&lt;A&gt;</code>, use <code>MAYBE.narrow()</code>:</p>
<pre><code class="language-java">MaybeKind&lt;String&gt; kindJust = MAYBE.just("Example");
Maybe&lt;String&gt; unwrappedMaybe = MAYBE.narrow(kindJust); // Just("Example")
System.out.println("Unwrapped: " + unwrappedMaybe);

MaybeKind&lt;Integer&gt; kindNothing = MAYBE.nothing();
Maybe&lt;Integer&gt; unwrappedNothing = MAYBE.narrow(kindNothing); // Nothing
System.out.println("Unwrapped Nothing: " + unwrappedNothing);
</code></pre>
</div>
</div>
<h3 id="interacting-with-maybe-values"><a class="header" href="#interacting-with-maybe-values">Interacting with <code>Maybe</code> values</a></h3>
<p>The <code>Maybe</code> interface itself provides useful methods:</p>
<ul>
<li><code>isJust()</code>: Returns <code>true</code> if it's a <code>Just</code>.</li>
<li><code>isNothing()</code>: Returns <code>true</code> if it's a <code>Nothing</code>.</li>
<li><code>get()</code>: Returns the value if <code>Just</code>, otherwise throws <code>NoSuchElementException</code>. <strong>Use with caution.</strong></li>
<li><code>orElse(@NonNull T other)</code>: Returns the value if <code>Just</code>, otherwise returns <code>other</code>.</li>
<li><code>orElseGet(@NonNull Supplier&lt;? extends @NonNull T&gt; other)</code>: Returns the value if <code>Just</code>, otherwise invokes <code>other.get()</code>.</li>
<li>The <code>Maybe</code> interface also has its own <code>map</code> and <code>flatMap</code> methods, which are similar in behaviour to those on <code>MaybeMonad</code> but operate directly on <code>Maybe</code> instances.</li>
</ul>
<h3 id="key-operations-via-maybemonad"><a class="header" href="#key-operations-via-maybemonad">Key Operations (via <code>MaybeMonad</code>)</a></h3>
<div id="admonition-example-_mapfunction-f-kind-ma_" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-_mapfunction-f-kind-ma_-title">
<div class="admonition-title">
<div id="admonition-example-_mapfunction-f-kind-ma_-title">
<p>Example: <em>map(Function&lt;A, B&gt; f, Kind&lt;MaybeKind.Witness, A&gt; ma)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/maybe_monad.html#admonition-example-_mapfunction-f-kind-ma_"></a>
</div>
<div>
<p>Applies <code>f</code> to the value inside <code>ma</code> if it's <code>Just</code>. If <code>ma</code> is <code>Nothing</code>, or if <code>f</code> returns <code>null</code> (which <code>Maybe.fromNullable</code> then converts to <code>Nothing</code>), the result is <code>Nothing</code>.</p>
<pre><code class="language-java">void mapExample() {
  MaybeMonad maybeMonad = MaybeMonad.INSTANCE;
  Kind&lt;MaybeKind.Witness, Integer&gt; justNum = MAYBE.just(10);
  Kind&lt;MaybeKind.Witness, Integer&gt; nothingNum = MAYBE.nothing();

  Function&lt;Integer, String&gt; numToString = n -&gt; "Val: " + n;
  Kind&lt;MaybeKind.Witness, String&gt; justStr = maybeMonad.map(numToString, justNum); // Just("Val: 10")
  Kind&lt;MaybeKind.Witness, String&gt; nothingStr = maybeMonad.map(numToString, nothingNum); // Nothing

  Function&lt;Integer, String&gt; numToNull = n -&gt; null;
  Kind&lt;MaybeKind.Witness, String&gt; mappedToNull = maybeMonad.map(numToNull, justNum); // Nothing

  System.out.println("Map (Just): " + MAYBE.narrow(justStr));
  System.out.println("Map (Nothing): " + MAYBE.narrow(nothingStr));
  System.out.println("Map (To Null): " + MAYBE.narrow(mappedToNull));
}
</code></pre>
</div>
</div>
<div id="admonition-example-_flatmapfunction-f-kind-ma_" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-_flatmapfunction-f-kind-ma_-title">
<div class="admonition-title">
<div id="admonition-example-_flatmapfunction-f-kind-ma_-title">
<p>Example: <em>flatMap(Function&lt;A, Kind&lt;MaybeKind.Witness, B&gt;&gt; f, Kind&lt;MaybeKind.Witness, A&gt; ma)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/maybe_monad.html#admonition-example-_flatmapfunction-f-kind-ma_"></a>
</div>
<div>
<p>If <code>ma</code> is <code>Just(a)</code>, applies <code>f</code> to <code>a</code>. <code>f</code> must return a <code>Kind&lt;MaybeKind.Witness, B&gt;</code>. If <code>ma</code> is <code>Nothing</code>, or <code>f</code> returns <code>Nothing</code>, the result is <code>Nothing</code>.</p>
<pre><code class="language-java">void flatMapExample() {
  MaybeMonad maybeMonad = MaybeMonad.INSTANCE;
  Function&lt;String, Kind&lt;MaybeKind.Witness, Integer&gt;&gt; parseString = s -&gt; {
    try {
      return MAYBE.just(Integer.parseInt(s));
    } catch (NumberFormatException e) {
      return MAYBE.nothing();
    }
  };

  Kind&lt;MaybeKind.Witness, String&gt; justFiveStr = MAYBE.just("5");
  Kind&lt;MaybeKind.Witness, Integer&gt; parsedJust = maybeMonad.flatMap(parseString, justFiveStr); // Just(5)

  Kind&lt;MaybeKind.Witness, String&gt; justNonNumStr = MAYBE.just("abc");
  Kind&lt;MaybeKind.Witness, Integer&gt; parsedNonNum = maybeMonad.flatMap(parseString, justNonNumStr); // Nothing

  System.out.println("FlatMap (Just): " + MAYBE.narrow(parsedJust));
  System.out.println("FlatMap (NonNum): " + MAYBE.narrow(parsedNonNum));
}
</code></pre>
</div>
</div>
<div id="admonition-example-_apkind-ff-kind-fa_" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-_apkind-ff-kind-fa_-title">
<div class="admonition-title">
<div id="admonition-example-_apkind-ff-kind-fa_-title">
<p>Example: <em>ap(Kind&lt;MaybeKind.Witness, Function&lt;A, B&gt;&gt; ff, Kind&lt;MaybeKind.Witness, A&gt; fa)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/maybe_monad.html#admonition-example-_apkind-ff-kind-fa_"></a>
</div>
<div>
<p>If <code>ff</code> is <code>Just(f)</code> and <code>fa</code> is <code>Just(a)</code>, applies <code>f</code> to <code>a</code>. Otherwise, <code>Nothing</code>.</p>
<pre><code class="language-java">void apExample() {
  MaybeMonad maybeMonad = MaybeMonad.INSTANCE;
  Kind&lt;MaybeKind.Witness, Integer&gt; justNum = MAYBE.just(10);
  Kind&lt;MaybeKind.Witness, Integer&gt; nothingNum = MAYBE.nothing();
  Kind&lt;MaybeKind.Witness, Function&lt;Integer, String&gt;&gt; justFunc = MAYBE.just(i -&gt; "Result: " + i);
  Kind&lt;MaybeKind.Witness, Function&lt;Integer, String&gt;&gt; nothingFunc = MAYBE.nothing();

  Kind&lt;MaybeKind.Witness, String&gt; apApplied = maybeMonad.ap(justFunc, justNum); // Just("Result: 10")
  Kind&lt;MaybeKind.Witness, String&gt; apNothingFunc = maybeMonad.ap(nothingFunc, justNum); // Nothing
  Kind&lt;MaybeKind.Witness, String&gt; apNothingVal = maybeMonad.ap(justFunc, nothingNum); // Nothing

  System.out.println("Ap (Applied): " + MAYBE.narrow(apApplied));
  System.out.println("Ap (Nothing Func): " + MAYBE.narrow(apNothingFunc));
  System.out.println("Ap (Nothing Val): " + MAYBE.narrow(apNothingVal));
}
</code></pre>
</div>
</div>
<div id="admonition-example-_handleerrorwithkind-ma-function-handler_" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-_handleerrorwithkind-ma-function-handler_-title">
<div class="admonition-title">
<div id="admonition-example-_handleerrorwithkind-ma-function-handler_-title">
<p>Example: <em>handleErrorWith(Kind&lt;MaybeKind.Witness, A&gt; ma, Function&lt;Void, Kind&lt;MaybeKind.Witness, A&gt;&gt; handler)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/maybe_monad.html#admonition-example-_handleerrorwithkind-ma-function-handler_"></a>
</div>
<div>
<p>If <code>ma</code> is <code>Just</code>, it's returned. If <code>ma</code> is <code>Nothing</code> (the "error" state), <code>handler</code> is invoked (with <code>Unit.INSTANCE</code> for <code>Unit</code>) to provide a recovery <code>MaybeKind</code>.</p>
<pre><code class="language-java">void handleErrorWithExample() {
  MaybeMonad maybeMonad = MaybeMonad.INSTANCE;
  Function&lt;Unit, Kind&lt;MaybeKind.Witness, String&gt;&gt; recover = v -&gt; MAYBE.just("Recovered");

  Kind&lt;MaybeKind.Witness, String&gt; handledJust = maybeMonad.handleErrorWith(MAYBE.just("Original"), recover); // Just("Original")
  Kind&lt;MaybeKind.Witness, String&gt; handledNothing = maybeMonad.handleErrorWith(MAYBE.nothing(), recover);    // Just("Recovered")

  System.out.println("HandleError (Just): " + MAYBE.narrow(handledJust));
  System.out.println("HandleError (Nothing): " + MAYBE.narrow(handledNothing));
}
</code></pre>
</div>
</div>
<div id="admonition-example-using-_maybemonad_" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-using-_maybemonad_-title">
<div class="admonition-title">
<div id="admonition-example-using-_maybemonad_-title">
<p>Example: Using <em>MaybeMonad</em></p>
</div>
<a class="admonition-anchor-link" href="monads/maybe_monad.html#admonition-example-using-_maybemonad_"></a>
</div>
<div>
<p>A complete example demonstrating generic usage:</p>
<pre><code class="language-java">public void monadExample() {
  MaybeMonad maybeMonad = MaybeMonad.INSTANCE;

  // 1. Create MaybeKind instances
  Kind&lt;MaybeKind.Witness, Integer&gt; presentIntKind = MAYBE.just(100);
  Kind&lt;MaybeKind.Witness, Integer&gt; absentIntKind = MAYBE.nothing();
  Kind&lt;MaybeKind.Witness, String&gt; nullInputStringKind = maybeMonad.of(null); // Becomes Nothing

  // 2. Use map
  Function&lt;Integer, String&gt; intToStatus = n -&gt; "Status: " + n;
  Kind&lt;MaybeKind.Witness, String&gt; mappedPresent = maybeMonad.map(intToStatus, presentIntKind);
  Kind&lt;MaybeKind.Witness, String&gt; mappedAbsent = maybeMonad.map(intToStatus, absentIntKind);

  System.out.println("Mapped (Present): " + MAYBE.narrow(mappedPresent)); // Just(Status: 100)
  System.out.println("Mapped (Absent): " + MAYBE.narrow(mappedAbsent));   // Nothing

  // 3. Use flatMap
  Function&lt;Integer, Kind&lt;MaybeKind.Witness, String&gt;&gt; intToPositiveStatusKind = n -&gt;
      (n &gt; 0) ? maybeMonad.of("Positive: " + n) : MAYBE.nothing();

  Kind&lt;MaybeKind.Witness, String&gt; flatMappedPresent = maybeMonad.flatMap(intToPositiveStatusKind, presentIntKind);
  Kind&lt;MaybeKind.Witness, String&gt; flatMappedZero = maybeMonad.flatMap(intToPositiveStatusKind, maybeMonad.of(0)); // 0 is not &gt; 0

  System.out.println("FlatMapped (Present Positive): " + MAYBE.narrow(flatMappedPresent)); // Just(Positive: 100)
  System.out.println("FlatMapped (Zero): " + MAYBE.narrow(flatMappedZero)); // Nothing

  // 4. Use 'of' and 'raiseError'
  Kind&lt;MaybeKind.Witness, String&gt; fromOf = maybeMonad.of("Direct Value");
  Kind&lt;MaybeKind.Witness, String&gt; fromRaiseError = maybeMonad.raiseError(Unit.INSTANCE); // Creates Nothing
  System.out.println("From 'of': " + MAYBE.narrow(fromOf)); // Just(Direct Value)
  System.out.println("From 'raiseError': " + MAYBE.narrow(fromRaiseError)); // Nothing
  System.out.println("From 'of(null)': " + MAYBE.narrow(nullInputStringKind)); // Nothing


  // 5. Use handleErrorWith
  Function&lt;Void, Kind&lt;MaybeKind.Witness, Integer&gt;&gt; recoverWithDefault =
      v -&gt; maybeMonad.of(-1); // Default value if absent

  Kind&lt;MaybeKind.Witness, Integer&gt; recoveredFromAbsent =
      maybeMonad.handleErrorWith(absentIntKind, recoverWithDefault);
  Kind&lt;MaybeKind.Witness, Integer&gt; notRecoveredFromPresent =
      maybeMonad.handleErrorWith(presentIntKind, recoverWithDefault);

  System.out.println("Recovered (from Absent): " + MAYBE.narrow(recoveredFromAbsent)); // Just(-1)
  System.out.println("Recovered (from Present): " + MAYBE.narrow(notRecoveredFromPresent)); // Just(100)

  // Using the generic processData function
  Kind&lt;MaybeKind.Witness, String&gt; processedPresent = processData(presentIntKind, x -&gt; "Processed: " + x, "N/A", maybeMonad);
  Kind&lt;MaybeKind.Witness, String&gt; processedAbsent = processData(absentIntKind, x -&gt; "Processed: " + x, "N/A", maybeMonad);

  System.out.println("Generic Process (Present): " + MAYBE.narrow(processedPresent)); // Just(Processed: 100)
  System.out.println("Generic Process (Absent): " + MAYBE.narrow(processedAbsent));   // Just(N/A)

  // Unwrap to get back the standard Maybe
  Maybe&lt;String&gt; finalMappedMaybe = MAYBE.narrow(mappedPresent);
  System.out.println("Final unwrapped mapped maybe: " + finalMappedMaybe); // Just(Status: 100)
}

public static &lt;A, B&gt; Kind&lt;MaybeKind.Witness, B&gt; processData(
    Kind&lt;MaybeKind.Witness, A&gt; inputKind,
    Function&lt;A, B&gt; mapper,
    B defaultValueOnAbsence,
    MaybeMonad monad
) {
  // inputKind is now Kind&lt;MaybeKind.Witness, A&gt;, which is compatible with monad.map
  Kind&lt;MaybeKind.Witness, B&gt; mappedKind = monad.map(mapper, inputKind);

  // The result of monad.map is Kind&lt;MaybeKind.Witness, B&gt;.
  // The handler (Unit v) -&gt; monad.of(defaultValueOnAbsence) also produces Kind&lt;MaybeKind.Witness, B&gt;.
  return monad.handleErrorWith(mappedKind, (Unit v) -&gt; monad.of(defaultValueOnAbsence));
}
</code></pre>
<p>This example highlights how <code>MaybeMonad</code> facilitates working with optional values in a functional, type-safe manner, especially when dealing with the HKT abstractions and requiring non-null guarantees for present values.</p>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="the-optionalmonad"><a class="header" href="#the-optionalmonad">The OptionalMonad:</a></h1>
<h2 id="monadic-operations-for-java-optional"><a class="header" href="#monadic-operations-for-java-optional"><em>Monadic Operations for Java Optional</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="monads/optional_monad.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to integrate Java's Optional with Higher-Kinded-J's type class system</li>
<li>Using MonadError with Unit to represent absence as an error state</li>
<li>Chaining optional operations with automatic empty propagation</li>
<li>Building safe database and service call pipelines</li>
<li>When to choose Optional vs Maybe for your use case</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="monads/optional_monad.html#admonition-see-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/optional/OptionalExample.java">OptionalExample.java</a></p>
</div>
</div>
<h2 id="purpose-3"><a class="header" href="#purpose-3">Purpose</a></h2>
<p>The <code>OptionalMonad</code> in the <code>Higher-Kinded-J</code> library provides a monadic interface for Java's standard <code>java.util.Optional&lt;T&gt;</code>. It allows developers to work with <code>Optional</code> values in a more functional and composable style, enabling operations like <code>map</code>, <code>flatMap</code>, and <code>ap</code> (apply) within the higher-kinded type (HKT) system. This is particularly useful for sequencing operations that may or may not produce a value, handling the presence or absence of values gracefully.</p>
<p>Key benefits include:</p>
<ul>
<li><strong>Functional Composition:</strong> Easily chain operations on <code>Optional</code>s, where each operation might return an <code>Optional</code> itself. If any step results in an <code>Optional.empty()</code>, subsequent operations are typically short-circuited, propagating the empty state.</li>
<li><strong>HKT Integration:</strong> <code>OptionalKind&lt;A&gt;</code> (the higher-kinded wrapper for <code>Optional&lt;A&gt;</code>) and <code>OptionalMonad</code> allow <code>Optional</code> to be used with generic functions and type classes expecting <code>Kind&lt;F, A&gt;</code>, <code>Functor&lt;F&gt;</code>, <code>Applicative&lt;F&gt;</code>, <code>Monad&lt;M&gt;</code>, or even <code>MonadError&lt;M, E&gt;</code>.</li>
<li><strong>Error Handling for Absence:</strong> <code>OptionalMonad</code> implements <code>MonadError&lt;OptionalKind.Witness, Unit&gt;</code>. In this context, <code>Optional.empty()</code> is treated as the "error" state, and <code>Unit</code> is used as the phantom error type, signifying absence rather than a traditional exception.</li>
</ul>
<p>It implements <code>MonadError&lt;OptionalKind.Witness, Unit&gt;</code>, which means it also transitively implements <code>Monad&lt;OptionalKind.Witness&gt;</code>, <code>Applicative&lt;OptionalKind.Witness&gt;</code>, and <code>Functor&lt;OptionalKind.Witness&gt;</code>.</p>
<h2 id="structure-3"><a class="header" href="#structure-3">Structure</a></h2>
<p><img src="monads/../images/puml/optional_monad.svg" alt="optional_monad.svg" /></p>
<h2 id="how-to-use-optionalmonad-and-optionalkind"><a class="header" href="#how-to-use-optionalmonad-and-optionalkind">How to Use <code>OptionalMonad</code> and <code>OptionalKind</code></a></h2>
<h3 id="creating-instances-3"><a class="header" href="#creating-instances-3">Creating Instances</a></h3>
<p><code>OptionalKind&lt;A&gt;</code> is the higher-kinded type representation for <code>java.util.Optional&lt;A&gt;</code>. You typically create <code>OptionalKind</code> instances using the <code>OptionalKindHelper</code> utility class or the <code>of</code> and <code>raiseError</code> methods from <code>OptionalMonad</code>.</p>
<div id="admonition-_optionalwidenoptional_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_optionalwidenoptional_-title">
<div class="admonition-title">
<div id="admonition-_optionalwidenoptional_-title">
<p><em>OPTIONAL.widen(Optional<A>)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/optional_monad.html#admonition-_optionalwidenoptional_"></a>
</div>
<div>
<p>Converts a standard <code>java.util.Optional&lt;A&gt;</code> into an <code>OptionalKind&lt;A&gt;</code>.</p>
<pre><code class="language-java">// Wrapping a present Optional
Optional&lt;String&gt; presentOptional = Optional.of("Hello");
OptionalKind&lt;String&gt; kindPresent = OPTIONAL.widen(presentOptional);

// Wrapping an empty Optional
Optional&lt;Integer&gt; emptyOptional = Optional.empty();
OptionalKind&lt;Integer&gt; kindEmpty = OPTIONAL.widen(emptyOptional);

// Wrapping an Optional that might be null (though Optional itself won't be null)
String possiblyNullValue = null;
Optional&lt;String&gt; nullableOptional = Optional.ofNullable(possiblyNullValue); // Results in Optional.empty()
OptionalKind&lt;String&gt; kindFromNullable = OPTIONAL.widen(nullableOptional);
</code></pre>
</div>
</div>
<div id="admonition-_optionalmonadofa-value_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_optionalmonadofa-value_-title">
<div class="admonition-title">
<div id="admonition-_optionalmonadofa-value_-title">
<p><em>optionalMonad.of(A value)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/optional_monad.html#admonition-_optionalmonadofa-value_"></a>
</div>
<div>
<p>Lifts a single value (which can be <code>null</code>) into the <code>OptionalKind</code> context. It uses <code>Optional.ofNullable(value)</code> internally.</p>
<pre><code class="language-java">OptionalMonad optionalMonad = OptionalMonad.INSTANCE;

Kind&lt;OptionalKind.Witness, String&gt; kindFromValue = optionalMonad.of("World"); // Wraps Optional.of("World")
Kind&lt;OptionalKind.Witness, Integer&gt; kindFromNullValue = optionalMonad.of(null); // Wraps Optional.empty()
</code></pre>
</div>
</div>
<div id="admonition-_optionalmonadraiseerrorunit-error_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_optionalmonadraiseerrorunit-error_-title">
<div class="admonition-title">
<div id="admonition-_optionalmonadraiseerrorunit-error_-title">
<p><em>optionalMonad.raiseError(Unit error)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/optional_monad.html#admonition-_optionalmonadraiseerrorunit-error_"></a>
</div>
<div>
<p>Creates an empty <code>OptionalKind</code>. Since <code>Unit</code> is the error type, this method effectively represents the "error" state of an <code>Optional</code>, which is <code>Optional.empty()</code>. The <code>error</code> argument (which would be <code>Unit.INSTANCE</code> for <code>Unit</code>) is ignored.</p>
<pre><code class="language-java">
OptionalMonad optionalMonad = OptionalMonad.INSTANCE;
Kind&lt;OptionalKind.Witness, String&gt; emptyKindFromError = optionalMonad.raiseError(Unit.INSTANCE); // Represents Optional.empty()
</code></pre>
</div>
</div>
<div id="admonition-_optionalnarrow_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_optionalnarrow_-title">
<div class="admonition-title">
<div id="admonition-_optionalnarrow_-title">
<p><em>OPTIONAL.narrow()</em></p>
</div>
<a class="admonition-anchor-link" href="monads/optional_monad.html#admonition-_optionalnarrow_"></a>
</div>
<div>
<p>To get the underlying <code>java.util.Optional&lt;A&gt;</code> from an <code>OptionalKind&lt;A&gt;</code>, use <code>OPTIONAL.narrow()</code>:</p>
<pre><code class="language-java">
OptionalKind&lt;String&gt; kindPresent = OPTIONAL.widen(Optional.of("Example"));
Optional&lt;String&gt; unwrappedOptional = OPTIONAL.narrow(kindPresent); // Returns Optional.of("Example")
System.out.println("Unwrapped: " + unwrappedOptional);

OptionalKind&lt;Integer&gt; kindEmpty = OPTIONAL.widen(Optional.empty());
Optional&lt;Integer&gt; unwrappedEmpty = OPTIONAL.narrow(kindEmpty); // Returns Optional.empty()
System.out.println("Unwrapped Empty: " + unwrappedEmpty);
</code></pre>
</div>
</div>
<h3 id="key-operations-1"><a class="header" href="#key-operations-1">Key Operations</a></h3>
<p>The <code>OptionalMonad</code> provides standard monadic and error-handling operations:</p>
<div id="admonition-example-_mapfunction-f-kind-fa_" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-_mapfunction-f-kind-fa_-title">
<div class="admonition-title">
<div id="admonition-example-_mapfunction-f-kind-fa_-title">
<p>Example: <em>map(Function&lt;A, B&gt; f, Kind&lt;OptionalKind.Witness, A&gt; fa)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/optional_monad.html#admonition-example-_mapfunction-f-kind-fa_"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/optional/OptionalExample.java">OptionalExample.java</a></li>
</ul>
<p>Applies a function <code>f</code> to the value inside <code>fa</code> if it's present. If <code>fa</code> is empty, it remains empty. The function <code>f</code> can return <code>null</code>, which <code>Optional.map</code> will turn into an <code>Optional.empty()</code>.</p>
<pre><code class="language-java">
public void mapExample() {
   OptionalMonad optionalMonad = OptionalMonad.INSTANCE;
   OptionalKind&lt;Integer&gt; presentNumber = OPTIONAL.widen(Optional.of(10));
   OptionalKind&lt;Integer&gt; emptyNumber = OPTIONAL.widen(Optional.empty());

   Function&lt;Integer, String&gt; intToString = i -&gt; "Number: " + i;
   Kind&lt;OptionalKind.Witness, String&gt; presentString = optionalMonad.map(intToString, presentNumber);
   // OPTIONAL.narrow(presentString) would be Optional.of("Number: 10")

   Kind&lt;OptionalKind.Witness, String&gt; emptyString = optionalMonad.map(intToString, emptyNumber);
   // OPTIONAL.narrow(emptyString) would be Optional.empty()

   Function&lt;Integer, String&gt; intToNull = i -&gt; null;
   Kind&lt;OptionalKind.Witness, String&gt; mappedToNull = optionalMonad.map(intToNull, presentNumber);
   // OPTIONAL.narrow(mappedToNull) would be Optional.empty()

   System.out.println("Map (Present): " + OPTIONAL.narrow(presentString));
   System.out.println("Map (Empty): " + OPTIONAL.narrow(emptyString));
   System.out.println("Map (To Null): " + OPTIONAL.narrow(mappedToNull));
}
</code></pre>
</div>
</div>
<div id="admonition-example-_flatmapfunction-f-kind-ma_" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-_flatmapfunction-f-kind-ma_-title">
<div class="admonition-title">
<div id="admonition-example-_flatmapfunction-f-kind-ma_-title">
<p>Example: <em>flatMap(Function&lt;A, Kind&lt;OptionalKind.Witness, B&gt;&gt; f, Kind&lt;OptionalKind.Witness, A&gt; ma)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/optional_monad.html#admonition-example-_flatmapfunction-f-kind-ma_"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/optional/OptionalExample.java">OptionalExample.java</a></li>
</ul>
<p>Applies a function <code>f</code> to the value inside <code>ma</code> if it's present. The function <code>f</code> itself returns an <code>OptionalKind&lt;B&gt;</code>. If <code>ma</code> is empty, or if <code>f</code> returns an empty <code>OptionalKind</code>, the result is an empty <code>OptionalKind</code>.</p>
<pre><code class="language-java">public void flatMapExample() {
   OptionalMonad optionalMonad = OptionalMonad.INSTANCE;
   OptionalKind&lt;String&gt; presentInput = OPTIONAL.widen(Optional.of("5"));
   OptionalKind&lt;String&gt; emptyInput = OPTIONAL.widen(Optional.empty());

   Function&lt;String, Kind&lt;OptionalKind.Witness, Integer&gt;&gt; parseToIntKind = s -&gt; {
      try {
         return OPTIONAL.widen(Optional.of(Integer.parseInt(s)));
      } catch (NumberFormatException e) {
         return OPTIONAL.widen(Optional.empty());
      }
   };

   Kind&lt;OptionalKind.Witness, Integer&gt; parsedPresent = optionalMonad.flatMap(parseToIntKind, presentInput);
   // OPTIONAL.narrow(parsedPresent) would be Optional.of(5)

   Kind&lt;OptionalKind.Witness, Integer&gt; parsedEmpty = optionalMonad.flatMap(parseToIntKind, emptyInput);
   // OPTIONAL.narrow(parsedEmpty) would be Optional.empty()

   OptionalKind&lt;String&gt; nonNumericInput = OPTIONAL.widen(Optional.of("abc"));
   Kind&lt;OptionalKind.Witness, Integer&gt; parsedNonNumeric = optionalMonad.flatMap(parseToIntKind, nonNumericInput);
   // OPTIONAL.narrow(parsedNonNumeric) would be Optional.empty()

   System.out.println("FlatMap (Present): " + OPTIONAL.narrow(parsedPresent));
   System.out.println("FlatMap (Empty Input): " + OPTIONAL.narrow(parsedEmpty));
   System.out.println("FlatMap (Non-numeric): " + OPTIONAL.narrow(parsedNonNumeric));
}
</code></pre>
</div>
</div>
<div id="admonition-example-_apkind-ff-kind-fa_" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-_apkind-ff-kind-fa_-title">
<div class="admonition-title">
<div id="admonition-example-_apkind-ff-kind-fa_-title">
<p>Example: <em>ap(Kind&lt;OptionalKind.Witness, Function&lt;A, B&gt;&gt; ff, Kind&lt;OptionalKind.Witness, A&gt; fa)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/optional_monad.html#admonition-example-_apkind-ff-kind-fa_"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/optional/OptionalExample.java">OptionalExample.java</a></li>
</ul>
<p>Applies an <code>OptionalKind</code> containing a function <code>ff</code> to an <code>OptionalKind</code> containing a value <code>fa</code>. If both are present, the function is applied. Otherwise, the result is empty.</p>
<pre><code class="language-java"> public void apExample() {
   OptionalMonad optionalMonad = OptionalMonad.INSTANCE;

   OptionalKind&lt;Function&lt;Integer, String&gt;&gt; presentFuncKind =
           OPTIONAL.widen(Optional.of(i -&gt; "Value: " + i));
   OptionalKind&lt;Function&lt;Integer, String&gt;&gt; emptyFuncKind =
           OPTIONAL.widen(Optional.empty());

   OptionalKind&lt;Integer&gt; presentValueKind = OPTIONAL.widen(Optional.of(100));
   OptionalKind&lt;Integer&gt; emptyValueKind = OPTIONAL.widen(Optional.empty());

   // Both present
   Kind&lt;OptionalKind.Witness, String&gt; result1 = optionalMonad.ap(presentFuncKind, presentValueKind);
   // OPTIONAL.narrow(result1) is Optional.of("Value: 100")

   // Function empty
   Kind&lt;OptionalKind.Witness, String&gt; result2 = optionalMonad.ap(emptyFuncKind, presentValueKind);
   // OPTIONAL.narrow(result2) is Optional.empty()

   // Value empty
   Kind&lt;OptionalKind.Witness, String&gt; result3 = optionalMonad.ap(presentFuncKind, emptyValueKind);
   // OPTIONAL.narrow(result3) is Optional.empty()

   System.out.println("Ap (Both Present): " + OPTIONAL.narrow(result1));
   System.out.println("Ap (Function Empty): " + OPTIONAL.narrow(result2));
   System.out.println("Ap (Value Empty): " + OPTIONAL.narrow(result3));
}

</code></pre>
</div>
</div>
<div id="admonition-example-handleerrorwithkind-ma-function-handler" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-handleerrorwithkind-ma-function-handler-title">
<div class="admonition-title">
<div id="admonition-example-handleerrorwithkind-ma-function-handler-title">
<p>Example: handleErrorWith(Kind&lt;OptionalKind.Witness, A&gt; ma, Function&lt;Unit, Kind&lt;OptionalKind.Witness, A&gt;&gt; handler)</p>
</div>
<a class="admonition-anchor-link" href="monads/optional_monad.html#admonition-example-handleerrorwithkind-ma-function-handler"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/optional/OptionalExample.java">OptionalExample.java</a></li>
</ul>
<p>If <code>ma</code> is present, it's returned. If <code>ma</code> is empty (the "error" state), the <code>handler</code> function is invoked (with <code>Unit.INSTANCE</code> as the <code>Unit</code> argument) to provide a recovery <code>OptionalKind</code>.</p>
<pre><code class="language-java">public void handleErrorWithExample() {
   OptionalMonad optionalMonad = OptionalMonad.INSTANCE;

   Kind&lt;OptionalKind.Witness, String&gt; presentKind = OPTIONAL.widen(Optional.of("Exists"));
   OptionalKind&lt;String&gt; emptyKind = OPTIONAL.widen(Optional.empty());

   Function&lt;Unit, Kind&lt;OptionalKind.Witness, String&gt;&gt; recoveryFunction =
           (Unit unitInstance) -&gt; OPTIONAL.widen(Optional.of("Recovered Value"));

   // Handling error on a present OptionalKind
   Kind&lt;OptionalKind.Witness, String&gt; handledPresent =
           optionalMonad.handleErrorWith(presentKind, recoveryFunction);
   // OPTIONAL.narrow(handledPresent) is Optional.of("Exists")

   // Handling error on an empty OptionalKind
   Kind&lt;OptionalKind.Witness, String&gt; handledEmpty =
           optionalMonad.handleErrorWith(emptyKind, recoveryFunction);

   // OPTIONAL.narrow(handledEmpty) is Optional.of("Recovered Value")
   System.out.println("HandleError (Present): " + OPTIONAL.narrow(handledPresent));
   System.out.println("HandleError (Empty): " + OPTIONAL.narrow(handledEmpty));
}
</code></pre>
</div>
</div>
<div id="admonition-example-using-_optionalmonad_" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-using-_optionalmonad_-title">
<div class="admonition-title">
<div id="admonition-example-using-_optionalmonad_-title">
<p>Example: Using <em>OptionalMonad</em></p>
</div>
<a class="admonition-anchor-link" href="monads/optional_monad.html#admonition-example-using-_optionalmonad_"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/optional/OptionalExample.java">OptionalExample.java</a></li>
</ul>
<p>To use <code>OptionalMonad</code> in generic contexts that operate over <code>Kind&lt;F, A&gt;</code>:</p>
<pre><code class="language-java">public void monadExample() {
    OptionalMonad optionalMonad = OptionalMonad.INSTANCE;

    // 1. Create OptionalKind instances
    OptionalKind&lt;Integer&gt; presentIntKind = OPTIONAL.widen(Optional.of(10));
    Kind&lt;OptionalKind.Witness, Integer&gt; emptyIntKind = optionalMonad.raiseError(null); // Creates empty
    
    // 2. Use map
    Function&lt;Integer, String&gt; intToMessage = n -&gt; "Value is " + n;
    Kind&lt;OptionalKind.Witness, String&gt; mappedPresent = optionalMonad.map(intToMessage, presentIntKind);
    Kind&lt;OptionalKind.Witness, String&gt; mappedEmpty = optionalMonad.map(intToMessage, emptyIntKind);
    
    System.out.println("Mapped (Present): " + OPTIONAL.narrow(mappedPresent)); // Optional[Value is 10]
    System.out.println("Mapped (Empty): " + OPTIONAL.narrow(mappedEmpty));   // Optional.empty
    
    // 3. Use flatMap
    Function&lt;Integer, Kind&lt;OptionalKind.Witness, Double&gt;&gt; intToOptionalDouble = n -&gt;
        (n &gt; 0) ? optionalMonad.of(n / 2.0) : optionalMonad.raiseError(null);
    
    Kind&lt;OptionalKind.Witness, Double&gt; flatMappedPresent = optionalMonad.flatMap(intToOptionalDouble, presentIntKind);
    Kind&lt;OptionalKind.Witness, Double&gt; flatMappedEmpty = optionalMonad.flatMap(intToOptionalDouble, emptyIntKind);
    Kind&lt;OptionalKind.Witness, Integer&gt; zeroIntKind = optionalMonad.of(0);
    Kind&lt;OptionalKind.Witness, Double&gt; flatMappedZero = optionalMonad.flatMap(intToOptionalDouble, zeroIntKind);
    
    
    System.out.println("FlatMapped (Present): " + OPTIONAL.narrow(flatMappedPresent)); // Optional[5.0]
    System.out.println("FlatMapped (Empty): " + OPTIONAL.narrow(flatMappedEmpty));     // Optional.empty
    System.out.println("FlatMapped (Zero): " + OPTIONAL.narrow(flatMappedZero));       // Optional.empty
    
    // 4. Use 'of' and 'raiseError' (already shown in creation)
    
    // 5. Use handleErrorWith
    Function&lt;Unit, Kind&lt;OptionalKind.Witness, Integer&gt;&gt; recoverWithDefault =
        v -&gt; optionalMonad.of(-1); // Default value if empty
    
    Kind&lt;OptionalKind.Witness, Integer&gt; recoveredFromEmpty =
        optionalMonad.handleErrorWith(emptyIntKind, recoverWithDefault);
    Kind&lt;OptionalKind.Witness, Integer&gt; notRecoveredFromPresent =
        optionalMonad.handleErrorWith(presentIntKind, recoverWithDefault);
    
    System.out.println("Recovered (from Empty): " + OPTIONAL.narrow(recoveredFromEmpty)); // Optional[-1]
    System.out.println("Recovered (from Present): " + OPTIONAL.narrow(notRecoveredFromPresent)); // Optional[10]
    
    // Unwrap to get back the standard Optional
    Optional&lt;String&gt; finalMappedOptional = OPTIONAL.narrow(mappedPresent);
    System.out.println("Final unwrapped mapped optional: " + finalMappedOptional);
}
</code></pre>
<p>This example demonstrates wrapping <code>Optional</code>s, applying monadic and error-handling operations via <code>OptionalMonad</code>, and unwrapping back to standard <code>Optional</code>s. The <code>MonadError</code> capabilities allow treating absence (<code>Optional.empty</code>) as a recoverable "error" state.</p>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="the-reader-monad"><a class="header" href="#the-reader-monad">The Reader Monad:</a></h1>
<h2 id="managed-dependencies-and-configuration"><a class="header" href="#managed-dependencies-and-configuration"><em>Managed Dependencies and Configuration</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="monads/reader_monad.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to inject dependencies functionally without passing them everywhere</li>
<li>Building computations that depend on shared configuration or context</li>
<li>Using <code>ask</code> to access the environment and <code>local</code> to modify it</li>
<li>Creating testable code with explicit dependency management</li>
<li>Real-world examples with database connections and API configurations</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="monads/reader_monad.html#admonition-see-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/reader/ReaderExample.java">ReaderExample.java</a></p>
</div>
</div>
<h2 id="purpose-4"><a class="header" href="#purpose-4">Purpose</a></h2>
<p>The <strong>Reader monad</strong> is a functional programming pattern primarily used for managing dependencies and context propagation in a clean and composable way. Imagine you have multiple functions or components that all need access to some shared, read-only environment, such as:</p>
<ul>
<li>Configuration settings (database URLs, API keys, feature flags).</li>
<li>Shared resources (thread pools, connection managers).</li>
<li>User context (user ID, permissions).</li>
</ul>
<p>Instead of explicitly passing this environment object as an argument to every single function (which can become cumbersome and clutter signatures), the Reader monad encapsulates computations that <em>depend</em> on such an environment.</p>
<p>A <code>Reader&lt;R, A&gt;</code> represents a computation that, when provided with an environment of type <code>R</code>, will produce a value of type <code>A</code>. It essentially wraps a function <code>R -&gt; A</code>.</p>
<p>The benefits of using the Reader monad include:</p>
<ol>
<li><strong>Implicit Dependency Injection:</strong> The environment (<code>R</code>) is implicitly passed along the computation chain. Functions defined within the Reader context automatically get access to the environment when needed, without needing it explicitly in their signature.</li>
<li><strong>Composability:</strong> Reader computations can be easily chained together using standard monadic operations like <code>map</code> and <code>flatMap</code>.</li>
<li><strong>Testability:</strong> Dependencies are managed explicitly when the final Reader computation is run, making it easier to provide mock environments or configurations during testing.</li>
<li><strong>Code Clarity:</strong> Reduces the need to pass configuration objects through multiple layers of functions.</li>
</ol>
<p>In <code>Higher-Kinded-J</code>, the Reader monad pattern is implemented via the <code>Reader&lt;R, A&gt;</code> interface and its corresponding HKT simulation types (<code>ReaderKind</code>, <code>ReaderKindHelper</code>) and type class instances (<code>ReaderMonad</code>, <code>ReaderApplicative</code>, <code>ReaderFunctor</code>).</p>
<h2 id="structure-4"><a class="header" href="#structure-4">Structure</a></h2>
<p><img src="monads/../images/puml/reader_monad.svg" alt="reader_monad.svg" /></p>
<h2 id="the-readerr-a-type"><a class="header" href="#the-readerr-a-type">The <code>Reader&lt;R, A&gt;</code> Type</a></h2>
<p>The core type is the <code>Reader&lt;R, A&gt;</code> functional interface:</p>
<pre><code class="language-java">@FunctionalInterface
public interface Reader&lt;R, A&gt; {
  @Nullable A run(@NonNull R r); // The core function: Environment -&gt; Value

  // Static factories
  static &lt;R, A&gt; @NonNull Reader&lt;R, A&gt; of(@NonNull Function&lt;R, A&gt; runFunction);
  static &lt;R, A&gt; @NonNull Reader&lt;R, A&gt; constant(@Nullable A value);
  static &lt;R&gt; @NonNull Reader&lt;R, R&gt; ask();

  // Instance methods (for composition)
  default &lt;B&gt; @NonNull Reader&lt;R, B&gt; map(@NonNull Function&lt;? super A, ? extends B&gt; f);
  default &lt;B&gt; @NonNull Reader&lt;R, B&gt; flatMap(@NonNull Function&lt;? super A, ? extends Reader&lt;R, ? extends B&gt;&gt; f);
}
</code></pre>
<ul>
<li><code>run(R r)</code>: Executes the computation by providing the environment <code>r</code> and returning the result <code>A</code>.</li>
<li><code>of(Function&lt;R, A&gt;)</code>: Creates a <code>Reader</code> from a given function.</li>
<li><code>constant(A value)</code>: Creates a <code>Reader</code> that ignores the environment and always returns the provided value.</li>
<li><code>ask()</code>: Creates a <code>Reader</code> that simply returns the environment itself as the result.</li>
<li><code>map(Function&lt;A, B&gt;)</code>: Transforms the result <code>A</code> to <code>B</code><em>after</em> the reader is run, without affecting the required environment <code>R</code>.</li>
<li><code>flatMap(Function&lt;A, Reader&lt;R, B&gt;&gt;)</code>: Sequences computations. It runs the first reader, uses its result <code>A</code> to create a <em>second</em> reader (<code>Reader&lt;R, B&gt;</code>), and then runs that second reader with the <em>original</em> environment <code>R</code>.</li>
</ul>
<h2 id="reader-components"><a class="header" href="#reader-components">Reader Components</a></h2>
<p>To integrate <code>Reader</code> with Higher-Kinded-J:</p>
<ul>
<li><strong><code>ReaderKind&lt;R, A&gt;</code>:</strong> The marker interface extending <code>Kind&lt;ReaderKind.Witness&lt;R&gt;, A&gt;</code>. The witness type <code>F</code> is <code>ReaderKind.Witness&lt;R&gt;</code> (where <code>R</code> is fixed for a given monad instance), and the value type <code>A</code> is the result type of the reader.</li>
<li><strong><code>ReaderKindHelper</code>:</strong> The utility class with static methods:
<ul>
<li><code>widen(Reader&lt;R, A&gt;)</code>: Converts a <code>Reader</code> to <code>ReaderKind&lt;R, A&gt;</code>.</li>
<li><code>narrow(Kind&lt;ReaderKind.Witness&lt;R&gt;, A&gt;)</code>: Converts <code>ReaderKind</code> back to <code>Reader</code>. Throws <code>KindUnwrapException</code> if the input is invalid.</li>
<li><code>reader(Function&lt;R, A&gt;)</code>: Factory method to create a <code>ReaderKind</code> from a function.</li>
<li><code>constant(A value)</code>: Factory method for a <code>ReaderKind</code> returning a constant value.</li>
<li><code>ask()</code>: Factory method for a <code>ReaderKind</code> that returns the environment.</li>
<li><code>runReader(Kind&lt;ReaderKind.Witness&lt;R&gt;, A&gt; kind, R environment)</code>: The primary way to execute a <code>ReaderKind</code> computation by providing the environment.</li>
</ul>
</li>
</ul>
<h2 id="type-class-instances-readerfunctor-readerapplicative-readermonad"><a class="header" href="#type-class-instances-readerfunctor-readerapplicative-readermonad">Type Class Instances (<code>ReaderFunctor</code>, <code>ReaderApplicative</code>, <code>ReaderMonad</code>)</a></h2>
<p>These classes provide the standard functional operations for <code>ReaderKind.Witness&lt;R&gt;</code>, allowing you to treat <code>Reader</code> computations generically within Higher-Kinded-J:</p>
<ul>
<li><strong><code>ReaderFunctor&lt;R&gt;</code>:</strong> Implements <code>Functor&lt;ReaderKind.Witness&lt;R&gt;&gt;</code>. Provides the <code>map</code> operation.</li>
<li><strong><code>ReaderApplicative&lt;R&gt;</code>:</strong> Extends <code>ReaderFunctor&lt;R&gt;</code> and implements <code>Applicative&lt;ReaderKind.Witness&lt;R&gt;&gt;</code>. Provides <code>of</code> (lifting a value) and <code>ap</code> (applying a wrapped function to a wrapped value).</li>
<li><strong><code>ReaderMonad&lt;R&gt;</code>:</strong> Extends <code>ReaderApplicative&lt;R&gt;</code> and implements <code>Monad&lt;ReaderKind.Witness&lt;R&gt;&gt;</code>. Provides <code>flatMap</code> for sequencing computations that depend on previous results while implicitly carrying the environment <code>R</code>.</li>
</ul>
<p>You typically instantiate <code>ReaderMonad&lt;R&gt;</code> for the specific environment type <code>R</code> you are working with.</p>
<div id="admonition-example-managing-configuration" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-managing-configuration-title">
<div class="admonition-title">
<div id="admonition-example-managing-configuration-title">
<p>Example: Managing Configuration</p>
</div>
<a class="admonition-anchor-link" href="monads/reader_monad.html#admonition-example-managing-configuration"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/reader/ReaderExample.java">ReaderExample.java</a></li>
</ul>
<h3 id="1-define-your-environment"><a class="header" href="#1-define-your-environment">1. Define Your Environment</a></h3>
<pre><code class="language-java">// Example Environment: Application Configuration
record AppConfig(String databaseUrl, int timeoutMillis, String apiKey) {}
</code></pre>
<h3 id="2-create-reader-computations"><a class="header" href="#2-create-reader-computations">2. Create Reader Computations</a></h3>
<p>Use <code>ReaderKindHelper</code> factory methods:</p>
<pre><code class="language-java">import static org.higherkindedj.hkt.reader.ReaderKindHelper.*;

import org.higherkindedj.hkt.Kind;
import org.higherkindedj.hkt.reader.ReaderKind;

// Reader that retrieves the database URL from the config
Kind&lt;ReaderKind.Witness&lt;AppConfig&gt;, String&gt; getDbUrl = reader(AppConfig::databaseUrl);

// Reader that retrieves the timeout
Kind&lt;ReaderKind.Witness&lt;AppConfig&gt;, Integer&gt; getTimeout = reader(AppConfig::timeoutMillis);

// Reader that returns a constant value, ignoring the environment
Kind&lt;ReaderKind.Witness&lt;AppConfig&gt;, String&gt; getDefaultUser = constant("guest");

// Reader that returns the entire configuration environment
Kind&lt;ReaderKind.Witness&lt;AppConfig&gt;, AppConfig&gt; getConfig = ask();
</code></pre>
<h3 id="3-get-the-readermonad-instance"><a class="header" href="#3-get-the-readermonad-instance">3. Get the <code>ReaderMonad</code> Instance</a></h3>
<p>Instantiate the monad for your specific environment type <code>R</code>.</p>
<pre><code class="language-java">import org.higherkindedj.hkt.reader.ReaderMonad;

// Monad instance for computations depending on AppConfig
ReaderMonad&lt;AppConfig&gt; readerMonad = new ReaderMonad&lt;&gt;();
</code></pre>
<h3 id="4-compose-computations-using-map-and-flatmap"><a class="header" href="#4-compose-computations-using-map-and-flatmap">4. Compose Computations using <code>map</code> and <code>flatMap</code></a></h3>
<p>Use the methods on the <code>readerMonad</code> instance.</p>
<pre><code class="language-java">// Example 1: Map the timeout value
Kind&lt;ReaderKind.Witness&lt;AppConfig&gt;, String&gt; timeoutMessage = readerMonad.map(
    timeout -&gt; "Timeout is: " + timeout + "ms",
    getTimeout // Input: Kind&lt;ReaderKind.Witness&lt;AppConfig&gt;, Integer&gt;
);

// Example 2: Use flatMap to get DB URL and then construct a connection string (depends on URL)
Function&lt;String, Kind&lt;ReaderKind.Witness&lt;AppConfig&gt;, String&gt;&gt; buildConnectionString =
    dbUrl -&gt; reader( // &lt;- We return a new Reader computation
        config -&gt; dbUrl + "?apiKey=" + config.apiKey() // Access apiKey via the 'config' env
    );

Kind&lt;ReaderKind.Witness&lt;AppConfig&gt;, String&gt; connectionStringReader = readerMonad.flatMap(
    buildConnectionString, // Function: String -&gt; Kind&lt;ReaderKind.Witness&lt;AppConfig&gt;, String&gt;
    getDbUrl               // Input: Kind&lt;ReaderKind.Witness&lt;AppConfig&gt;, String&gt;
);

// Example 3: Combine multiple values using mapN (from Applicative)
Kind&lt;ReaderKind.Witness&lt;AppConfig&gt;, String&gt; dbInfo = readerMonad.map2(
    getDbUrl,
    getTimeout,
    (url, timeout) -&gt; "DB: " + url + " (Timeout: " + timeout + ")"
);
</code></pre>
<h3 id="5-run-the-computation"><a class="header" href="#5-run-the-computation">5. Run the Computation</a></h3>
<p>Provide the actual environment using <code>ReaderKindHelper.runReader</code>:</p>
<pre><code class="language-java">AppConfig productionConfig = new AppConfig("prod-db.example.com", 5000, "prod-key-123");
AppConfig stagingConfig = new AppConfig("stage-db.example.com", 10000, "stage-key-456");

// Run the composed computations with different environments
String prodTimeoutMsg = runReader(timeoutMessage, productionConfig);
String stageTimeoutMsg = runReader(timeoutMessage, stagingConfig);

String prodConnectionString = runReader(connectionStringReader, productionConfig);
String stageConnectionString = runReader(connectionStringReader, stagingConfig);

String prodDbInfo = runReader(dbInfo, productionConfig);
String stageDbInfo = runReader(dbInfo, stagingConfig);

// Get the raw config using ask()
AppConfig retrievedProdConfig = runReader(getConfig, productionConfig);


System.out.println("Prod Timeout: " + prodTimeoutMsg);           // Output: Timeout is: 5000ms
System.out.println("Stage Timeout: " + stageTimeoutMsg);         // Output: Timeout is: 10000ms
System.out.println("Prod Connection: " + prodConnectionString); // Output: prod-db.example.com?apiKey=prod-key-123
System.out.println("Stage Connection: " + stageConnectionString);// Output: stage-db.example.com?apiKey=stage-key-456
System.out.println("Prod DB Info: " + prodDbInfo);               // Output: DB: prod-db.example.com (Timeout: 5000)
System.out.println("Stage DB Info: " + stageDbInfo);             // Output: DB: stage-db.example.com (Timeout: 10000)
System.out.println("Retrieved Prod Config: " + retrievedProdConfig); // Output: AppConfig[databaseUrl=prod-db.example.com, timeoutMillis=5000, apiKey=prod-key-123]
</code></pre>
<p>Notice how the functions (<code>buildConnectionString</code>, the lambda in <code>map2</code>) don't need <code>AppConfig</code> as a parameter, but they can access it when needed within the <code>reader(...)</code> factory or implicitly via <code>flatMap</code> composition. The configuration is only provided once at the end when <code>runReader</code> is called.</p>
</div>
</div>
<div id="admonition-example-reader-for-side-effects-returning-unit" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-reader-for-side-effects-returning-unit-title">
<div class="admonition-title">
<div id="admonition-example-reader-for-side-effects-returning-unit-title">
<p>Example: Reader for Side-Effects (Returning Unit)</p>
</div>
<a class="admonition-anchor-link" href="monads/reader_monad.html#admonition-example-reader-for-side-effects-returning-unit"></a>
</div>
<div>
<p>Sometimes, a computation depending on an environment <code>R</code> might perform an action (like logging or initialising a component based on <code>R</code>) but doesn't produce a specific value other than signaling its completion. In such cases, the result type <code>A</code> of the <code>Reader&lt;R, A&gt;</code> can be <code>org.higherkindedj.hkt.unit.Unit</code>.</p>
<pre><code class="language-java">import static org.higherkindedj.hkt.reader.ReaderKindHelper.*;
import org.higherkindedj.hkt.Kind;
import org.higherkindedj.hkt.reader.ReaderKind;
import org.higherkindedj.hkt.reader.ReaderMonad;
import org.higherkindedj.hkt.unit.Unit; // Import Unit

// Assume AppConfig is defined as before
// record AppConfig(String databaseUrl, int timeoutMillis, String apiKey) {}

// ReaderMonad instance (can be the same as before)
// ReaderMonad&lt;AppConfig&gt; readerMonad = new ReaderMonad&lt;&gt;();

// A Reader computation that performs a side-effect (printing to console)
// using the config and returns Unit.
Kind&lt;ReaderKind.Witness&lt;AppConfig&gt;, Unit&gt; logApiKey = reader(
    config -&gt; {
        System.out.println("Accessed API Key: " + config.apiKey().substring(0, Math.min(config.apiKey().length(), 4)) + "...");
        return Unit.INSTANCE; // Explicitly return Unit.INSTANCE
    }
);

// You can compose this with other Reader computations.
// For example, get the DB URL and then log the API key.
Kind&lt;ReaderKind.Witness&lt;AppConfig&gt;, Unit&gt; getUrlAndLogKey = readerMonad.flatMap(
    dbUrl -&gt; {
        System.out.println("Database URL for logging context: " + dbUrl);
        // After processing dbUrl (here, just printing), return the next action
        return logApiKey;
    },
    getDbUrl // Assuming getDbUrl: Kind&lt;ReaderKind.Witness&lt;AppConfig&gt;, String&gt;
);


// To run it:
// AppConfig currentConfig = new AppConfig("prod-db.example.com", 5000, "prod-key-123");
// Unit result = runReader(logApiKey, currentConfig);
// System.out.println("Log API Key result: " + result); // Output: Log API Key result: ()

// Unit resultChained = runReader(getUrlAndLogKey, currentConfig);
// System.out.println("Get URL and Log Key result: " + resultChained);
// Output:
// Database URL for logging context: prod-db.example.com
// Accessed API Key: prod...
// Get URL and Log Key result: ()
</code></pre>
<p>In this example:</p>
<ul>
<li><code>logApiKey</code> is a <code>Reader&lt;AppConfig, Unit&gt;</code>. Its purpose is to perform an action (logging) using the <code>AppConfig</code>.</li>
<li>It returns <code>Unit.INSTANCE</code> to signify that the action completed successfully but yields no other specific data.</li>
<li>When composing, flatMap can be used to sequence such an action. If logApiKey were the last step in a sequence, the overall <code>flatMap</code> chain would also result in <code>Kind&lt;ReaderKind.Witness&lt;AppConfig&gt;, Unit&gt;</code>.</li>
</ul>
</div>
</div>
<div id="admonition-key-points" class="admonition admonish-tip" role="note" aria-labelledby="admonition-key-points-title">
<div class="admonition-title">
<div id="admonition-key-points-title">
<p>Key Points:</p>
</div>
<a class="admonition-anchor-link" href="monads/reader_monad.html#admonition-key-points"></a>
</div>
<div>
<p>The Reader monad (<code>Reader&lt;R, A&gt;</code>, <code>ReaderKind</code>, <code>ReaderMonad</code>) in <code>Higher-Kinded-J</code> provides a functional approach to dependency injection and configuration management.</p>
<p>It allows you to define computations that depend on a read-only environment <code>R</code> without explicitly passing <code>R</code> everywhere. By using Higher-Kinded-J and the <code>ReaderMonad</code>, you can compose these dependent functions cleanly using <code>map</code> and <code>flatMap</code>, providing the actual environment only once when the final computation is executed via <code>runReader</code>.</p>
<p>This leads to more modular, testable, and less cluttered code when dealing with shared context.</p>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="the-state-monad"><a class="header" href="#the-state-monad">The State Monad:</a></h1>
<h2 id="managing-state-functionally"><a class="header" href="#managing-state-functionally"><em>Managing State Functionally</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="monads/state_monad.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to manage state functionally without mutable variables</li>
<li>Using <code>get</code>, <code>set</code>, <code>modify</code>, and <code>inspect</code> for state operations</li>
<li>Building complex stateful workflows with automatic state threading</li>
<li>Creating a bank account simulation with transaction history</li>
<li>Why pure state management leads to more testable and maintainable code</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="monads/state_monad.html#admonition-see-example-code"></a>
</div>
<div>
<ul>
<li>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/state/StateExample.java">StateExample</a></p>
</li>
<li>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/state/BankAccountWorkflow.java">BankAccountWorkflow.java</a></p>
</li>
</ul>
</div>
</div>
<h2 id="purpose-5"><a class="header" href="#purpose-5">Purpose</a></h2>
<p>In many applications, we need to manage computations that involve <strong>state</strong> that changes over time.</p>
<p>Examples could include:</p>
<ul>
<li>A counter being incremented.</li>
<li>A configuration object being updated.</li>
<li>The state of a game character.</li>
<li>Parsing input where the current position needs to be tracked.</li>
</ul>
<p>While imperative programming uses mutable variables, functional programming prefers immutability. The <strong>State monad</strong> provides a purely functional way to handle stateful computations without relying on mutable variables.</p>
<p>A <code>State&lt;S, A&gt;</code> represents a computation that takes an initial state <code>S</code> and produces a result value <code>A</code> along with a <strong>new, updated state</strong> <code>S</code>. It essentially wraps a function of the type <code>S -&gt; (A, S)</code>.</p>
<h3 id="key-benefits"><a class="header" href="#key-benefits">Key Benefits</a></h3>
<ol>
<li><strong>Explicit State:</strong> The state manipulation is explicitly encoded within the type <code>State&lt;S, A&gt;</code>.</li>
<li><strong>Purity:</strong> Functions using the State monad remain pure; they don't cause side effects by mutating external state. Instead, they describe how the state <em>should</em> transform.</li>
<li><strong>Composability:</strong> State computations can be easily sequenced using standard monadic operations (<code>map</code>, <code>flatMap</code>), where the state is automatically threaded through the sequence without explicitly threading state everywhere.</li>
<li><strong>Decoupling</strong>: Logic is decoupled from state handling mechanics.</li>
<li><strong>Testability:</strong> Pure state transitions are easier to test and reason about than code relying on mutable side effects.</li>
</ol>
<p>In <code>Higher-Kinded-J</code>, the State monad pattern is implemented via the <code>State&lt;S, A&gt;</code> interface, its associated <code>StateTuple&lt;S, A&gt;</code> record, the HKT simulation types (<code>StateKind</code>, <code>StateKindHelper</code>), and the type class instances (<code>StateMonad</code>, <code>StateApplicative</code>, <code>StateFunctor</code>).</p>
<h2 id="structure-5"><a class="header" href="#structure-5">Structure</a></h2>
<p><img src="monads/../images/puml/state_monad.svg" alt="state_monad.svg" /></p>
<h2 id="the-states-a-type-and-statetuples-a"><a class="header" href="#the-states-a-type-and-statetuples-a">The <code>State&lt;S, A&gt;</code> Type and <code>StateTuple&lt;S, A&gt;</code></a></h2>
<p>The core type is the <code>State&lt;S, A&gt;</code> functional interface:</p>
<pre><code class="language-java">@FunctionalInterface
public interface State&lt;S, A&gt; {

  // Represents the result: final value A and final state S
  record StateTuple&lt;S, A&gt;(@Nullable A value, @NonNull S state) { /* ... */ }

  // The core function: Initial State -&gt; (Result Value, Final State)
  @NonNull StateTuple&lt;S, A&gt; run(@NonNull S initialState);

  // Static factories
  static &lt;S, A&gt; @NonNull State&lt;S, A&gt; of(@NonNull Function&lt;@NonNull S, @NonNull StateTuple&lt;S, A&gt;&gt; runFunction);
  static &lt;S, A&gt; @NonNull State&lt;S, A&gt; pure(@Nullable A value); // Creates State(s -&gt; (value, s))
  static &lt;S&gt; @NonNull State&lt;S, S&gt; get();                      // Creates State(s -&gt; (s, s))
  static &lt;S&gt; @NonNull State&lt;S, Unit&gt; set(@NonNull S newState); // Creates State(s -&gt; (Unit.INSTANCE, newState))
  static &lt;S&gt; @NonNull State&lt;S, Unit&gt; modify(@NonNull Function&lt;@NonNull S, @NonNull S&gt; f); // Creates State(s -&gt; (Unit.INSTANCE, f(s)))
  static &lt;S, A&gt; @NonNull State&lt;S, A&gt; inspect(@NonNull Function&lt;@NonNull S, @Nullable A&gt; f); // Creates State(s -&gt; (f(s), s))

  // Instance methods for composition
  default &lt;B&gt; @NonNull State&lt;S, B&gt; map(@NonNull Function&lt;? super A, ? extends B&gt; f);
  default &lt;B&gt; @NonNull State&lt;S, B&gt; flatMap(@NonNull Function&lt;? super A, ? extends State&lt;S, ? extends B&gt;&gt; f);
}
</code></pre>
<ul>
<li><code>StateTuple&lt;S, A&gt;</code>: A simple record holding the pair <code>(value: A, state: S)</code> returned by running a <code>State</code> computation.</li>
<li><code>run(S initialState)</code>: Executes the stateful computation by providing the starting state.</li>
<li><code>of(...)</code>: The basic factory method taking the underlying function <code>S -&gt; StateTuple&lt;S, A&gt;</code>.</li>
<li><code>pure(A value)</code>: Creates a computation that returns the given value <code>A</code><em>without changing</em> the state.</li>
<li><code>get()</code>: Creates a computation that returns the <em>current</em> state <code>S</code> as its value, leaving the state unchanged.</li>
<li><code>set(S newState)</code>: Creates a computation that <em>replaces</em> the current state with <code>newState</code> and returns <code>Unit.INSTANCE</code> as its result value.</li>
<li><code>modify(Function&lt;S, S&gt; f)</code>: Creates a computation that applies a function <code>f</code> to the current state to get the <em>new</em> state, returning Unit.INSTANCE as its result value.</li>
<li><code>inspect(Function&lt;S, A&gt; f)</code>: Creates a computation that applies a function <code>f</code> to the current state to calculate a <em>result value</em><code>A</code>, leaving the state unchanged.</li>
<li><code>map(...)</code>: Transforms the <em>result value</em><code>A</code> to <code>B</code> after the computation runs, leaving the state transition logic untouched.</li>
<li><code>flatMap(...)</code>: The core sequencing operation. It runs the first <code>State</code> computation, takes its result value <code>A</code>, uses it to create a <em>second</em><code>State</code> computation, and runs that second computation using the state produced by the first one. The final result and state are those from the second computation.</li>
</ul>
<h2 id="state-components"><a class="header" href="#state-components">State Components</a></h2>
<p>To integrate <code>State</code> with Higher-Kinded-J:</p>
<ul>
<li><strong><code>StateKind&lt;S, A&gt;</code>:</strong> The marker interface extending <code>Kind&lt;StateKind.Witness&lt;S&gt;, A&gt;</code>. The witness type <code>F</code> is <code>StateKind.Witness&lt;S&gt;</code> (where <code>S</code> is fixed for a given monad instance), and the value type <code>A</code> is the result type <code>A</code> from <code>StateTuple</code>.</li>
<li><strong><code>StateKindHelper</code>:</strong> The utility class with static methods:
<ul>
<li><code>widen(State&lt;S, A&gt;)</code>: Converts a <code>State</code> to <code>Kind&lt;StateKind.Witness&lt;S&gt;, A&gt;</code>.</li>
<li><code>narrow(Kind&lt;StateKind.Witness&lt;S&gt;, A&gt;)</code>: Converts <code>StateKind</code> back to <code>State</code>. Throws <code>KindUnwrapException</code> if the input is invalid.</li>
<li><code>pure(A value)</code>: Factory for <code>Kind</code> equivalent to <code>State.pure</code>.</li>
<li><code>get()</code>: Factory for <code>Kind</code> equivalent to <code>State.get</code>.</li>
<li><code>set(S newState)</code>: Factory for <code>Kind</code> equivalent to <code>State.set</code>.</li>
<li><code>modify(Function&lt;S, S&gt; f)</code>: Factory for <code>Kind</code> equivalent to <code>State.modify</code>.</li>
<li><code>inspect(Function&lt;S, A&gt; f)</code>: Factory for <code>Kind</code> equivalent to <code>State.inspect</code>.</li>
<li><code>runState(Kind&lt;StateKind.Witness&lt;S&gt;, A&gt; kind, S initialState)</code>: Runs the computation and returns the <code>StateTuple&lt;S, A&gt;</code>.</li>
<li><code>evalState(Kind&lt;StateKind.Witness&lt;S&gt;, A&gt; kind, S initialState)</code>: Runs the computation and returns only the final value <code>A</code>.</li>
<li><code>execState(Kind&lt;StateKind.Witness&lt;S&gt;, A&gt; kind, S initialState)</code>: Runs the computation and returns only the final state <code>S</code>.</li>
</ul>
</li>
</ul>
<h2 id="type-class-instances-statefunctor-stateapplicative-statemonad"><a class="header" href="#type-class-instances-statefunctor-stateapplicative-statemonad">Type Class Instances (<code>StateFunctor</code>, <code>StateApplicative</code>, <code>StateMonad</code>)</a></h2>
<p>These classes provide the standard functional operations for <code>StateKind.Witness&lt;S&gt;</code>:</p>
<ul>
<li><strong><code>StateFunctor&lt;S&gt;</code>:</strong> Implements <code>Functor&lt;StateKind.Witness&lt;S&gt;&gt;</code>. Provides <code>map</code>.</li>
<li><strong><code>StateApplicative&lt;S&gt;</code>:</strong> Extends <code>StateFunctor&lt;S&gt;</code>, implements <code>Applicative&lt;StateKind.Witness&lt;S&gt;&gt;</code>. Provides <code>of</code> (same as <code>pure</code>) and <code>ap</code>.</li>
<li><strong><code>StateMonad&lt;S&gt;</code>:</strong> Extends <code>StateApplicative&lt;S&gt;</code>, implements <code>Monad&lt;StateKind.Witness&lt;S&gt;&gt;</code>. Provides <code>flatMap</code> for sequencing stateful computations.</li>
</ul>
<p>You instantiate <code>StateMonad&lt;S&gt;</code> for the specific state type <code>S</code> you are working with.</p>
<div id="admonition-example-managing-bank-account-transactions" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-managing-bank-account-transactions-title">
<div class="admonition-title">
<div id="admonition-example-managing-bank-account-transactions-title">
<p>Example: Managing Bank Account Transactions</p>
</div>
<a class="admonition-anchor-link" href="monads/state_monad.html#admonition-example-managing-bank-account-transactions"></a>
</div>
<div>
<p>We want to model a bank account where we can:</p>
<ul>
<li>Deposit funds.</li>
<li>Withdraw funds (if sufficient balance).</li>
<li>Get the current balance.</li>
<li>Get the transaction history.</li>
</ul>
<p>All these operations will affect or depend on the account's state (balance and history).</p>
<h2 id="1-define-the-state"><a class="header" href="#1-define-the-state">1. Define the State</a></h2>
<p>First, we define a record to represent the state of our bank account.</p>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/state/AccountState.java">AccountState.java</a></li>
</ul>
<pre><code class="language-java">public record AccountState(BigDecimal balance, List&lt;Transaction&gt; history) {
  public AccountState {
    requireNonNull(balance, "Balance cannot be null.");
    requireNonNull(history, "History cannot be null.");
    // Ensure history is unmodifiable and a defensive copy is made.
    history = Collections.unmodifiableList(new ArrayList&lt;&gt;(history));
  }

  // Convenience constructor for initial state
  public static AccountState initial(BigDecimal initialBalance) {
    requireNonNull(initialBalance, "Initial balance cannot be null");
    if (initialBalance.compareTo(BigDecimal.ZERO) &lt; 0) {
      throw new IllegalArgumentException("Initial balance cannot be negative.");
    }
    Transaction initialTx = new Transaction(
            TransactionType.INITIAL_BALANCE,
            initialBalance,
            LocalDateTime.now(),
            "Initial account balance"
    );
    // The history now starts with this initial transaction
    return new AccountState(initialBalance, Collections.singletonList(initialTx));
  }

  public AccountState addTransaction(Transaction transaction) {
    requireNonNull(transaction, "Transaction cannot be null");
    List&lt;Transaction&gt; newHistory = new ArrayList&lt;&gt;(history); // Takes current history
    newHistory.add(transaction);                             // Adds new one
    return new AccountState(this.balance, Collections.unmodifiableList(newHistory));
  }

  public AccountState withBalance(BigDecimal newBalance) {
    requireNonNull(newBalance, "New balance cannot be null");
    return new AccountState(newBalance, this.history);
  }
}
</code></pre>
<h3 id="2-define-transaction-types"><a class="header" href="#2-define-transaction-types">2. Define Transaction Types</a></h3>
<p>We'll also need a way to represent transactions.</p>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/state/TransactionType.java">TransactionType.java</a></li>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/state/Transaction.java">Transaction.java</a></li>
</ul>
<pre><code class="language-java">public enum TransactionType {
  INITIAL_BALANCE,
  DEPOSIT,
  WITHDRAWAL,
  REJECTED_WITHDRAWAL,
  REJECTED_DEPOSIT
}

public record Transaction(
        TransactionType type, BigDecimal amount, LocalDateTime timestamp, String description) {
  public Transaction {
    requireNonNull(type, "Transaction type cannot be null");
    requireNonNull(amount, "Transaction amount cannot be null");
    requireNonNull(timestamp, "Transaction timestamp cannot be null");
    requireNonNull(description, "Transaction description cannot be null");
    if (type != INITIAL_BALANCE &amp;&amp; amount.compareTo(BigDecimal.ZERO) &lt;= 0) {
      if (!(type == REJECTED_DEPOSIT &amp;&amp; amount.compareTo(BigDecimal.ZERO) &lt;= 0)
              &amp;&amp; !(type == REJECTED_WITHDRAWAL &amp;&amp; amount.compareTo(BigDecimal.ZERO) &lt;= 0)) {
        throw new IllegalArgumentException(
                "Transaction amount must be positive for actual operations.");
      }
    }
  }
}
</code></pre>
<h3 id="3-define-state-actions"><a class="header" href="#3-define-state-actions">3. Define State Actions</a></h3>
<p>Now, we define our bank operations as functions that return <code>Kind&lt;StateKind.Witness&lt;AccountState&gt;, YourResultType&gt;</code>.
These actions describe how the state should change and what value they produce.</p>
<p>We'll put these in a <code>BankAccountWorkflow.java class</code>.</p>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/state/BankAccountWorkflow.java">BankAccountWorkflow.java</a></li>
</ul>
<pre><code class="language-java">public class BankAccountWorkflow {

  private static final StateMonad&lt;AccountState&gt; accountStateMonad = new StateMonad&lt;&gt;();

  public static Function&lt;BigDecimal, Kind&lt;StateKind.Witness&lt;AccountState&gt;, Unit&gt;&gt; deposit(
          String description) {
    return amount -&gt;
        STATE.widen(
          State.modify(
            currentState -&gt; {
              if (amount.compareTo(BigDecimal.ZERO) &lt;= 0) {
                // For rejected deposit, log the problematic amount
                Transaction rejected =
                        new Transaction(
                                TransactionType.REJECTED_DEPOSIT,
                                amount,
                                LocalDateTime.now(),
                                "Rejected Deposit: " + description + " - Invalid Amount " + amount);
                return currentState.addTransaction(rejected);
              }
              BigDecimal newBalance = currentState.balance().add(amount);
              Transaction tx =
                      new Transaction(
                              TransactionType.DEPOSIT, amount, LocalDateTime.now(), description);
              return currentState.withBalance(newBalance).addTransaction(tx);
        }));
  }

  public static Function&lt;BigDecimal, Kind&lt;StateKind.Witness&lt;AccountState&gt;, Boolean&gt;&gt; withdraw(
          String description) {
    return amount -&gt;
        STATE.widen(
                State.of(
                    currentState -&gt; {
                      if (amount.compareTo(BigDecimal.ZERO) &lt;= 0) {
                        // For rejected withdrawal due to invalid amount, log the problematic amount
                        Transaction rejected =
                            new Transaction(
                                    TransactionType.REJECTED_WITHDRAWAL,
                                    amount,
                                    LocalDateTime.now(),
                                    "Rejected Withdrawal: " + description + " - Invalid Amount " + amount);
                        return new StateTuple&lt;&gt;(false, currentState.addTransaction(rejected));
                      }
                      if (currentState.balance().compareTo(amount) &gt;= 0) {
                        BigDecimal newBalance = currentState.balance().subtract(amount);
                        Transaction tx =
                                new Transaction(
                                        TransactionType.WITHDRAWAL, amount, LocalDateTime.now(), description);
                        AccountState updatedState =
                                currentState.withBalance(newBalance).addTransaction(tx);
                        return new StateTuple&lt;&gt;(true, updatedState);
                      } else {
                        // For rejected withdrawal due to insufficient funds, log the amount that was
                        // attempted
                        Transaction tx =
                            new Transaction(
                                    TransactionType.REJECTED_WITHDRAWAL,
                                    amount,
                                    LocalDateTime.now(),
                                    "Rejected Withdrawal: "
                                            + description
                                            + " - Insufficient Funds. Balance: "
                                            + currentState.balance());
                        AccountState updatedState = currentState.addTransaction(tx);
                        return new StateTuple&lt;&gt;(false, updatedState);
                      }
                  }));
  }

  public static Kind&lt;StateKind.Witness&lt;AccountState&gt;, BigDecimal&gt; getBalance() {
    return STATE.widen(State.inspect(AccountState::balance));
  }

  public static Kind&lt;StateKind.Witness&lt;AccountState&gt;, List&lt;Transaction&gt;&gt; getHistory() {
    return STATE.widen(State.inspect(AccountState::history));
  }

  // ... main method will be added

}
</code></pre>
<h3 id="4-compose-computations-using-map-and-flatmap-1"><a class="header" href="#4-compose-computations-using-map-and-flatmap-1">4. Compose Computations using <code>map</code> and <code>flatMap</code></a></h3>
<p>We use <code>flatMap</code> and <code>map</code> from  <code>accountStateMonad</code> to sequence these actions. The state is threaded automatically.</p>
<pre><code class="language-java">public class BankAccountWorkflow {
  // ... (monad instance and previous actions)
  public static void main(String[] args) {
    // Initial state: Account with ¬£100 balance.
    AccountState initialState = AccountState.initial(new BigDecimal("100.00"));
   var workflow =
           For.from(accountStateMonad, deposit("Salary").apply(new BigDecimal("20.00")))
               .from(a -&gt; withdraw("Bill Payment").apply(new BigDecimal("50.00")))
               .from(b -&gt; withdraw("Groceries").apply(new BigDecimal("70.00")))
               .from(c -&gt; getBalance())
               .from(t -&gt; getHistory())
               .yield((deposit, w1, w2, bal, history) -&gt; {
                 var report = new StringBuilder();
                 history.forEach(tx -&gt; report.append("  - %s\n".formatted(tx)));
                 return report.toString();
               });

    StateTuple&lt;AccountState, String&gt; finalResultTuple =
        StateKindHelper.runState(workflow, initialState);

    System.out.println(finalResultTuple.value());

    System.out.println("\nDirect Final Account State:");
    System.out.println("Balance: ¬£" + finalResultTuple.state().balance());
    System.out.println(
        "History contains " + finalResultTuple.state().history().size() + " transaction(s):");
    finalResultTuple.state().history().forEach(tx -&gt; System.out.println("  - " + tx));
  }
}
</code></pre>
<h3 id="5-run-the-computation-1"><a class="header" href="#5-run-the-computation-1">5. Run the Computation</a></h3>
<p>The <code>StateKindHelper.runState(workflow, initialState)</code> call executes the entire sequence of operations, starting with <code>initialState</code>.
It returns a StateTuple containing the final result of the <em>entire workflow</em> (in this case, the <code>String</code> report) and the final state of the <code>AccountState</code>.</p>
<pre><code>
Direct Final Account State:
Balance: ¬£0.00
History contains 4 transaction(s):
  - Transaction[type=INITIAL_BALANCE, amount=100.00, timestamp=2025-05-18T17:35:53.564874439, description=Initial account balance]
  - Transaction[type=DEPOSIT, amount=20.00, timestamp=2025-05-18T17:35:53.578424630, description=Salary]
  - Transaction[type=WITHDRAWAL, amount=50.00, timestamp=2025-05-18T17:35:53.579196349, description=Bill Payment]
  - Transaction[type=WITHDRAWAL, amount=70.00, timestamp=2025-05-18T17:35:53.579453984, description=Groceries]
</code></pre>
</div>
</div>
<div id="admonition-key-points" class="admonition admonish-tip" role="note" aria-labelledby="admonition-key-points-title">
<div class="admonition-title">
<div id="admonition-key-points-title">
<p>Key Points:</p>
</div>
<a class="admonition-anchor-link" href="monads/state_monad.html#admonition-key-points"></a>
</div>
<div>
<p>The State monad (<code>State&lt;S, A&gt;</code>, <code>StateKind</code>, <code>StateMonad</code>) , as provided by higher-kinded-j, offers an elegant and functional way to manage state transformations.</p>
<p>By defining atomic state operations and composing them with map and flatMap, you can build complex stateful workflows that are easier to reason about, test, and maintain, as the state is explicitly managed by the monad's structure rather than through mutable side effects. The For comprehension helps simplify the workflow.</p>
<p>Key operations like <code>get</code>, <code>set</code>, <code>modify</code>, and <code>inspect</code> provide convenient ways to interact with the state within the monadic context.</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="the-trymonad"><a class="header" href="#the-trymonad">The TryMonad:</a></h1>
<h2 id="typed-error-handling-1"><a class="header" href="#typed-error-handling-1"><em>Typed Error Handling</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="monads/try_monad.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to handle exceptions functionally with Success and Failure cases</li>
<li>Converting exception-throwing code into composable, safe operations</li>
<li>Using <code>recover</code> and <code>recoverWith</code> for graceful error recovery</li>
<li>Building robust parsing and processing pipelines</li>
<li>When to choose Try vs Either for error handling</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="monads/try_monad.html#admonition-see-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/trymonad/TryExample.java">TryExample.java</a></p>
</div>
</div>
<h2 id="purpose-6"><a class="header" href="#purpose-6">Purpose</a></h2>
<p>The <code>Try&lt;T&gt;</code> type in the <code>Higher-Kinded-J</code> library represents a computation that might result in a value of type <code>T</code> (a <code>Success</code>) or fail with a <code>Throwable</code> (a <code>Failure</code>). It serves as a functional alternative to traditional <code>try-catch</code> blocks for handling exceptions, particularly checked exceptions, within a computation chain.  We can think of it as an <code>Either</code> where the <code>Left</code> is an <code>Exception</code>, but also using try-catch blocks behind the scene, so that we don‚Äôt have to.</p>
<p><strong>Try Type</strong></p>
<p><img src="monads/../images/puml/try_type.svg" alt="try_type.svg" /></p>
<p><strong>Monadic Structure</strong></p>
<p><img src="monads/../images/puml/try_monad.svg" alt="try_monad.svg" /></p>
<p>Key benefits include:</p>
<ul>
<li><strong>Explicit Error Handling:</strong> Makes it clear from the return type (<code>Try&lt;T&gt;</code>) that a computation might fail.</li>
<li><strong>Composability:</strong> Allows chaining operations using methods like <code>map</code> and <code>flatMap</code>, where failures are automatically propagated without interrupting the flow with exceptions.</li>
<li><strong>Integration with HKT:</strong> Provides HKT simulation (<code>TryKind</code>) and type class instances (<code>TryMonad</code>) to work seamlessly with generic functional abstractions operating over <code>Kind&lt;F, A&gt;</code>.</li>
<li><strong>Error Recovery:</strong> Offers methods like <code>recover</code> and <code>recoverWith</code> to handle failures gracefully within the computation chain.</li>
</ul>
<p>It implements <code>MonadError&lt;TryKind&lt;?&gt;, Throwable&gt;</code>, signifying its monadic nature and its ability to handle errors of type `Throwable.</p>
<h2 id="how-to-use-tryt"><a class="header" href="#how-to-use-tryt">How to Use <code>Try&lt;T&gt;</code></a></h2>
<div id="admonition-creating-instance" class="admonition admonish-note" role="note" aria-labelledby="admonition-creating-instance-title">
<div class="admonition-title">
<div id="admonition-creating-instance-title">
<p>Creating Instance</p>
</div>
<a class="admonition-anchor-link" href="monads/try_monad.html#admonition-creating-instance"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/trymonad/TryExample.java">TryExample.java</a></li>
</ul>
<p>You can create <code>Try</code> instances in several ways:</p>
<ol>
<li>
<p><strong><code>Try.of(Supplier)</code>:</strong> Executes a <code>Supplier</code> and wraps the result in <code>Success</code> or catches any thrown <code>Throwable</code> (including <code>Error</code> and checked exceptions) and wraps it in <code>Failure</code>.</p>
<pre><code class="language-java">import org.higherkindedj.hkt.trymonad.Try;
import java.io.FileInputStream;

// Success case
Try&lt;String&gt; successResult = Try.of(() -&gt; "This will succeed"); // Success("This will succeed")

// Failure case (checked exception)
Try&lt;FileInputStream&gt; failureResult = Try.of(() -&gt; new FileInputStream("nonexistent.txt")); // Failure(FileNotFoundException)

// Failure case (runtime exception)
Try&lt;Integer&gt; divisionResult = Try.of(() -&gt; 10 / 0); // Failure(ArithmeticException)
</code></pre>
</li>
<li>
<p><strong><code>Try.success(value)</code>:</strong> Directly creates a <code>Success</code> instance holding the given value (which can be null).</p>
<pre><code class="language-java">Try&lt;String&gt; directSuccess = Try.success("Known value");
Try&lt;String&gt; successNull = Try.success(null);
</code></pre>
</li>
<li>
<p><strong><code>Try.failure(throwable)</code>:</strong> Directly creates a <code>Failure</code> instance holding the given non-null <code>Throwable</code>.</p>
<pre><code class="language-java">Try&lt;String&gt; directFailure = Try.failure(new RuntimeException("Something went wrong"));
</code></pre>
</li>
</ol>
</div>
</div>
<div id="admonition-checking-the-state" class="admonition admonish-note" role="note" aria-labelledby="admonition-checking-the-state-title">
<div class="admonition-title">
<div id="admonition-checking-the-state-title">
<p>Checking the State</p>
</div>
<a class="admonition-anchor-link" href="monads/try_monad.html#admonition-checking-the-state"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/trymonad/TryExample.java">TryExample.java</a></li>
</ul>
<ul>
<li><code>isSuccess()</code>: Returns <code>true</code> if it's a <code>Success</code>.</li>
<li><code>isFailure()</code>: Returns <code>true</code> if it's a <code>Failure</code>.</li>
</ul>
<h3 id="getting-the-value-use-with-caution"><a class="header" href="#getting-the-value-use-with-caution">Getting the Value (Use with Caution)</a></h3>
<ul>
<li><code>get()</code>: Returns the value if <code>Success</code>, otherwise throws the contained <code>Throwable</code>. <strong>Avoid using this directly; prefer <code>fold</code>, <code>map</code>, <code>flatMap</code>, or recovery methods.</strong></li>
</ul>
</div>
</div>
<div id="admonition-transforming-values-_map_" class="admonition admonish-note" role="note" aria-labelledby="admonition-transforming-values-_map_-title">
<div class="admonition-title">
<div id="admonition-transforming-values-_map_-title">
<p>Transforming Values (<em>map</em>)</p>
</div>
<a class="admonition-anchor-link" href="monads/try_monad.html#admonition-transforming-values-_map_"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/trymonad/TryExample.java">TryExample.java</a></li>
</ul>
<p>Applies a function to the value inside a <code>Success</code>. If the function throws an exception, the result becomes a <code>Failure</code>. If the original <code>Try</code> was a <code>Failure</code>, <code>map</code> does nothing and returns the original <code>Failure</code>.</p>
<pre><code class="language-java">Try&lt;Integer&gt; initialSuccess = Try.success(5);
Try&lt;String&gt; mappedSuccess = initialSuccess.map(value -&gt; "Value: " + value); // Success("Value: 5")

Try&lt;Integer&gt; initialFailure = Try.failure(new RuntimeException("Fail"));
Try&lt;String&gt; mappedFailure = initialFailure.map(value -&gt; "Value: " + value); // Failure(RuntimeException)

Try&lt;Integer&gt; mapThrows = initialSuccess.map(value -&gt; { throw new NullPointerException(); }); // Failure(NullPointerException)
</code></pre>
</div>
</div>
<div id="admonition-chaining-operations-_flatmap_" class="admonition admonish-note" role="note" aria-labelledby="admonition-chaining-operations-_flatmap_-title">
<div class="admonition-title">
<div id="admonition-chaining-operations-_flatmap_-title">
<p>Chaining Operations (<em>flatMap</em>)</p>
</div>
<a class="admonition-anchor-link" href="monads/try_monad.html#admonition-chaining-operations-_flatmap_"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/trymonad/TryExample.java">TryExample.java</a></li>
</ul>
<p>Applies a function that returns another <code>Try</code> to the value inside a <code>Success</code>. This is used to sequence operations where each step might fail. Failures are propagated.</p>
<pre><code class="language-java">Function&lt;Integer, Try&lt;Double&gt;&gt; safeDivide =
value -&gt; (value == 0) ? Try.failure(new ArithmeticException("Div by zero")) : Try.success(10.0 / value);

Try&lt;Integer&gt; inputSuccess = Try.success(2);
Try&lt;Double&gt; result1 = inputSuccess.flatMap(safeDivide); // Success(5.0)

Try&lt;Integer&gt; inputZero = Try.success(0);
Try&lt;Double&gt; result2 = inputZero.flatMap(safeDivide); // Failure(ArithmeticException)

Try&lt;Integer&gt; inputFailure = Try.failure(new RuntimeException("Initial fail"));
Try&lt;Double&gt; result3 = inputFailure.flatMap(safeDivide); // Failure(RuntimeException) - initial failure propagates
</code></pre>
</div>
</div>
<hr />
<h3 id="handling-failures-fold-recover-recoverwith"><a class="header" href="#handling-failures-fold-recover-recoverwith">Handling Failures (<code>fold</code>, <code>recover</code>, <code>recoverWith</code>)</a></h3>
<div id="admonition-_foldsuccessfunc-failurefunc_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_foldsuccessfunc-failurefunc_-title">
<div class="admonition-title">
<div id="admonition-_foldsuccessfunc-failurefunc_-title">
<p><em>fold(successFunc, failureFunc)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/try_monad.html#admonition-_foldsuccessfunc-failurefunc_"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/trymonad/TryExample.java">TryExample.java</a></li>
</ul>
<p>Safely handles both cases by applying one of two functions.</p>
<pre><code class="language-java">String message = result2.fold(
    successValue -&gt; "Succeeded with " + successValue,
    failureThrowable -&gt; "Failed with " + failureThrowable.getMessage()
); // "Failed with Div by zero"

</code></pre>
</div>
</div>
<div id="admonition-_recoverrecoveryfunc_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_recoverrecoveryfunc_-title">
<div class="admonition-title">
<div id="admonition-_recoverrecoveryfunc_-title">
<p><em>recover(recoveryFunc)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/try_monad.html#admonition-_recoverrecoveryfunc_"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/trymonad/TryExample.java">TryExample.java</a></li>
</ul>
<p>If <code>Failure</code>, applies a function <code>Throwable -&gt; T</code> to produce a new <code>Success</code> value. If the recovery function throws, the result is a <code>Failure</code> containing that new exception.</p>
<pre><code class="language-java">Function&lt;Throwable, Double&gt; recoverHandler = throwable -&gt; -1.0;
Try&lt;Double&gt; recovered1 = result2.recover(recoverHandler); // Success(-1.0)
Try&lt;Double&gt; recovered2 = result1.recover(recoverHandler); // Stays Success(5.0)
</code></pre>
</div>
</div>
<div id="admonition-_recoverwithrecoveryfunc_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_recoverwithrecoveryfunc_-title">
<div class="admonition-title">
<div id="admonition-_recoverwithrecoveryfunc_-title">
<p><em>recoverWith(recoveryFunc)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/try_monad.html#admonition-_recoverwithrecoveryfunc_"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/trymonad/TryExample.java">TryExample.java</a></li>
</ul>
<p>Similar to <code>recover</code>, but the recovery function <code>Throwable -&gt; Try&lt;T&gt;</code> must return a <code>Try</code>. This allows recovery to potentially result in another <code>Failure</code>.</p>
<pre><code class="language-java">Function&lt;Throwable, Try&lt;Double&gt;&gt; recoverWithHandler = throwable -&gt;
    (throwable instanceof ArithmeticException) ? Try.success(Double.POSITIVE_INFINITY) : Try.failure(throwable);

Try&lt;Double&gt; recoveredWith1 = result2.recoverWith(recoverWithHandler); // Success(Infinity)
Try&lt;Double&gt; recoveredWith2 = result3.recoverWith(recoverWithHandler); // Failure(RuntimeException) - re-raised
</code></pre>
</div>
</div>
<hr />
<div id="admonition-example-using-_trymonad_" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-using-_trymonad_-title">
<div class="admonition-title">
<div id="admonition-example-using-_trymonad_-title">
<p>Example: Using <em>TryMonad</em></p>
</div>
<a class="admonition-anchor-link" href="monads/try_monad.html#admonition-example-using-_trymonad_"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/trymonad/TryExample.java">TryExample.java</a></li>
</ul>
<p>To use <code>Try</code> with generic code expecting <code>Kind&lt;F, A&gt;</code>:</p>
<ol>
<li><strong>Get Instance:</strong><code>TryMonad tryMonad = TryMonad.INSTANCE;</code></li>
<li><strong>Wrap(Widen):</strong> Use <code>TRY.widen(myTry)</code> or factories like <code>TRY.tryOf(() -&gt; ...)</code>.</li>
<li><strong>Operate:</strong> Use <code>tryMonad.map(...)</code>, <code>tryMonad.flatMap(...)</code>, <code>tryMonad.handleErrorWith(...)</code> etc.</li>
<li><strong>Unwrap(Narrow):</strong> Use <code>TRY.narrow(tryKind)</code> to get the <code>Try&lt;T&gt;</code> back.</li>
</ol>
<pre><code class="language-java">
TryMonad tryMonad = TryMonad.INSTANCE;

Kind&lt;TryKind.Witness, Integer&gt; tryKind1 = TRY.tryOf(() -&gt; 10 / 2); // Success(5) Kind
Kind&lt;TryKind.Witness, Integer&gt; tryKind2 = TRY.tryOf(() -&gt; 10 / 0); // Failure(...) Kind

// Map using Monad instance
Kind&lt;TryKind.Witness, String&gt; mappedKind = tryMonad.map(Object::toString, tryKind1); // Success("5") Kind

// FlatMap using Monad instance
Function&lt;Integer, Kind&lt;TryKind.Witness, Double&gt;&gt; safeDivideKind =
        i -&gt; TRY.tryOf(() -&gt; 10.0 / i);
Kind&lt;TryKind.Witness, Double&gt; flatMappedKind = tryMonad.flatMap(safeDivideKind, tryKind1); // Success(2.0) Kind

// Handle error using MonadError instance
Kind&lt;TryKind.Witness, Integer&gt; handledKind = tryMonad.handleErrorWith(
        tryKind2, // The Failure Kind
        error -&gt; TRY.success(-1) // Recover to Success(-1) Kind
);

// Unwrap
Try&lt;String&gt; mappedTry = TRY.narrow(mappedKind); // Success("5")
Try&lt;Double&gt; flatMappedTry = TRY.narrow(flatMappedKind); // Success(2.0)
Try&lt;Integer&gt; handledTry = TRY.narrow(handledKind); // Success(-1)

System.out.println(mappedTry);
System.out.println(flatMappedTry);
System.out.println(handledTry);
</code></pre>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="the-validatedmonad"><a class="header" href="#the-validatedmonad">The ValidatedMonad:</a></h1>
<h2 id="handling-valid-or-invalid-operations"><a class="header" href="#handling-valid-or-invalid-operations"><em>Handling Valid or Invalid Operations</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="monads/validated_monad.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to distinguish between valid and invalid data with explicit types</li>
<li>Building form validation that collects all errors, not just the first one</li>
<li>Using Validated as a MonadError for standardised error handling</li>
<li>The difference between fail-fast (Monad) and error-accumulating (Applicative) validation</li>
<li>Real-world input validation scenarios with detailed error reporting</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="monads/validated_monad.html#admonition-see-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/validated/ValidatedMonadExample.java">ValidatedMonadExample.java</a></p>
</div>
</div>
<h2 id="purpose-7"><a class="header" href="#purpose-7">Purpose</a></h2>
<p>The <code>Validated&lt;E, A&gt;</code> type in <code>Higher-Kinded-J</code> represents a value that can either be <code>Valid&lt;A&gt;</code> (correct) or <code>Invalid&lt;E&gt;</code> (erroneous). It is commonly used in scenarios like input validation where you want to clearly distinguish between a successful result and an error. Unlike types like <code>Either</code> which are often used for general-purpose sum types, <code>Validated</code> is specifically focused on the valid/invalid dichotomy. Operations like <code>map</code>, <code>flatMap</code>, and <code>ap</code> are right-biased, meaning they operate on the <code>Valid</code> value and propagate <code>Invalid</code> values unchanged.</p>
<p>The <code>ValidatedMonad&lt;E&gt;</code> provides a monadic interface for <code>Validated&lt;E, A&gt;</code> (where the error type <code>E</code> is fixed for the monad instance), allowing for functional composition and integration with the Higher-Kinded-J framework. This facilitates chaining operations that can result in either a valid outcome or an error.</p>
<div id="admonition-key-benefits-include" class="admonition admonish-info" role="note" aria-labelledby="admonition-key-benefits-include-title">
<div class="admonition-title">
<div id="admonition-key-benefits-include-title">
<p>Key benefits include:</p>
</div>
<a class="admonition-anchor-link" href="monads/validated_monad.html#admonition-key-benefits-include"></a>
</div>
<div>
<ul>
<li><strong>Explicit Validation Outcome:</strong> The type signature <code>Validated&lt;E, A&gt;</code> makes it clear that a computation can result in either a success (<code>Valid&lt;A&gt;</code>) or an error (<code>Invalid&lt;E&gt;</code>).</li>
<li><strong>Functional Composition:</strong> Enables chaining of operations using <code>map</code>, <code>flatMap</code>, and <code>ap</code>. If an operation results in an <code>Invalid</code>, subsequent operations in the chain are typically short-circuited, propagating the <code>Invalid</code> state.</li>
<li><strong>HKT Integration:</strong> <code>ValidatedKind&lt;E, A&gt;</code> (the HKT wrapper for <code>Validated&lt;E, A&gt;</code>) and <code>ValidatedMonad&lt;E&gt;</code> allow <code>Validated</code> to be used with generic functions and type classes that expect <code>Kind&lt;F, A&gt;</code>, <code>Functor&lt;F&gt;</code>, <code>Applicative&lt;F&gt;</code>, or <code>Monad&lt;M&gt;</code>.</li>
<li><strong>Clear Error Handling:</strong> Provides methods like <code>fold</code>, <code>ifValid</code>, <code>ifInvalid</code> to handle both <code>Valid</code> and <code>Invalid</code> cases explicitly.</li>
<li><strong>Standardized Error Handling:</strong> As a <code>MonadError&lt;ValidatedKind.Witness&lt;E&gt;, E&gt;</code>, it offers <code>raiseError</code> to construct error states and <code>handleErrorWith</code> for recovery, integrating with generic error-handling combinators.</li>
</ul>
</div>
</div>
<p><code>ValidatedMonad&lt;E&gt;</code> implements <code>MonadError&lt;ValidatedKind.Witness&lt;E&gt;, E&gt;</code>, which transitively includes <code>Monad&lt;ValidatedKind.Witness&lt;E&gt;&gt;</code>, <code>Applicative&lt;ValidatedKind.Witness&lt;E&gt;&gt;</code>, and <code>Functor&lt;ValidatedKind.Witness&lt;E&gt;&gt;</code>.</p>
<h2 id="structure-6"><a class="header" href="#structure-6">Structure</a></h2>
<p><strong>Validated Type</strong> Conceptually, <code>Validated&lt;E, A&gt;</code> has two sub-types:</p>
<ul>
<li><code>Valid&lt;A&gt;</code>: Contains a valid value of type <code>A</code>.</li>
<li><code>Invalid&lt;E&gt;</code>: Contains an error value of type <code>E</code>.
<img src="monads/../images/puml/validated_type.svg" alt="validated_type.svg" /></li>
</ul>
<p><strong>Monadic Structure</strong> The <code>ValidatedMonad&lt;E&gt;</code> enables monadic operations on <code>ValidatedKind.Witness&lt;E&gt;</code>.
<img src="monads/../images/puml/validated_monad.svg" alt="validated_monad.svg" /></p>
<h2 id="how-to-use-validatedmonade-and-validatede-a"><a class="header" href="#how-to-use-validatedmonade-and-validatede-a">How to Use <code>ValidatedMonad&lt;E&gt;</code> and <code>Validated&lt;E, A&gt;</code></a></h2>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/validated/ValidatedMonadExample.java">ValidatedMonadExample.java</a></li>
</ul>
<h3 id="creating-instances-4"><a class="header" href="#creating-instances-4">Creating Instances</a></h3>
<p><code>Validated&lt;E, A&gt;</code> instances can be created directly using static factory methods on <code>Validated</code>. For HKT integration, <code>ValidatedKindHelper</code> and <code>ValidatedMonad</code> are used. <code>ValidatedKind&lt;E, A&gt;</code> is the HKT wrapper.</p>
<p><strong>Direct <code>Validated</code> Creation &amp; HKT Helpers:</strong> Refer to <code>ValidatedMonadExample.java</code> (Section 1) for runnable examples.</p>
<div id="admonition-creating-_valid_-_invalid_-and-hkt-wrappers" class="admonition admonish-note" role="note" aria-labelledby="admonition-creating-_valid_-_invalid_-and-hkt-wrappers-title">
<div class="admonition-title">
<div id="admonition-creating-_valid_-_invalid_-and-hkt-wrappers-title">
<p>Creating <em>Valid</em>, <em>Invalid</em> and HKT Wrappers</p>
</div>
<a class="admonition-anchor-link" href="monads/validated_monad.html#admonition-creating-_valid_-_invalid_-and-hkt-wrappers"></a>
</div>
<div>
<p>Creates a <code>Valid</code> instance holding a <strong>non-null</strong> value.</p>
<pre><code class="language-java">Validated&lt;List&lt;String&gt;, String&gt; validInstance = Validated.valid("Success!"); // Valid("Success!")
</code></pre>
<p>Creates an <code>Invalid</code> instance holding a <strong>non-null</strong> error.</p>
<pre><code class="language-java">Validated&lt;List&lt;String&gt;, String&gt; invalidInstance = Validated.invalid(Collections.singletonList("Error: Something went wrong.")); // Invalid([Error: Something went wrong.])
</code></pre>
<p>Converts a <code>Validated&lt;E, A&gt;</code> to <code>Kind&lt;ValidatedKind.Witness&lt;E&gt;, A&gt;</code> using <code>VALIDATED.widen()</code>.</p>
<pre><code class="language-java">Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, String&gt; kindValid = VALIDATED.widen(Validated.valid("Wrapped"));
</code></pre>
<p>Converts a <code>Kind&lt;ValidatedKind.Witness&lt;E&gt;, A&gt;</code> back to <code>Validated&lt;E, A&gt;</code> using <code>VALIDATED.narrow()</code>.</p>
<pre><code class="language-java">Validated&lt;List&lt;String&gt;, String&gt; narrowedValidated = VALIDATED.narrow(kindValid);
</code></pre>
<p>Convenience for <code>widen(Validated.valid(value))</code>using <code>VALIDATED.valid()</code>.</p>
<pre><code class="language-java">Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt; kindValidInt = VALIDATED.valid(123);
</code></pre>
<p>Convenience for <code>widen(Validated.invalid(error))</code> using <code>VALIDATED.invalid()</code>.</p>
<pre><code class="language-java">Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt; kindInvalidInt = VALIDATED.invalid(Collections.singletonList("Bad number"));
</code></pre>
</div>
</div>
<h3 id="validatedmonade-instance-methods"><a class="header" href="#validatedmonade-instance-methods"><code>ValidatedMonad&lt;E&gt;</code> Instance Methods:</a></h3>
<p>Refer to <code>ValidatedMonadExample.java</code> (Sections 1 &amp; 6) for runnable examples.</p>
<div id="admonition-_validatedmonadofa-value_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_validatedmonadofa-value_-title">
<div class="admonition-title">
<div id="admonition-_validatedmonadofa-value_-title">
<p><em>validatedMonad.of(A value)</em></p>
</div>
<a class="admonition-anchor-link" href="monads/validated_monad.html#admonition-_validatedmonadofa-value_"></a>
</div>
<div>
<p>Lifts a value into <code>ValidatedKind.Witness&lt;E&gt;</code>, creating a <code>Valid(value)</code>. This is part of the <code>Applicative</code> interface.</p>
<pre><code class="language-java">ValidatedMonad&lt;List&lt;String&gt;&gt; validatedMonad = ValidatedMonad.instance();
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, String&gt; kindFromMonadOf = validatedMonad.of("Monadic Valid"); // Valid("Monadic Valid")
System.out.println("From monad.of(): " + VALIDATED.narrow(kindFromMonadOf));
</code></pre>
<p>Lifts an error <code>E</code> into the <code>ValidatedKind</code> context, creating an <code>Invalid(error)</code>. This is part of the <code>MonadError</code> interface.</p>
<pre><code class="language-java">ValidatedMonad&lt;List&lt;String&gt;&gt; validatedMonad = ValidatedMonad.instance();
List&lt;String&gt; errorPayload = Collections.singletonList("Raised error condition");
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, String&gt; raisedError =
    validatedMonad.raiseError(errorPayload); // Invalid(["Raised error condition"])
System.out.println("From monad.raiseError(): " + VALIDATED.narrow(raisedError));
</code></pre>
</div>
</div>
<h3 id="interacting-with-validatede-a-values"><a class="header" href="#interacting-with-validatede-a-values">Interacting with <code>Validated&lt;E, A&gt;</code> values</a></h3>
<p>The <code>Validated&lt;E, A&gt;</code> interface itself provides useful methods: Refer to <code>ValidatedMonadExample.java</code> (Section 5) for runnable examples of <code>fold</code>, <code>ifValid</code>, <code>ifInvalid</code>.</p>
<ul>
<li><code>isValid()</code>: Returns <code>true</code> if it's a <code>Valid</code>.</li>
<li><code>isInvalid()</code>: Returns <code>true</code> if it's an <code>Invalid</code>.</li>
<li><code>get()</code>: Returns the value if <code>Valid</code>, otherwise throws <code>NoSuchElementException</code>. <em>Use with caution.</em></li>
<li><code>getError()</code>: Returns the error if <code>Invalid</code>, otherwise throws <code>NoSuchElementException</code>. <em>Use with caution.</em></li>
<li><code>orElse(@NonNull A other)</code>: Returns the value if <code>Valid</code>, otherwise returns <code>other</code>.</li>
<li><code>orElseGet(@NonNull Supplier&lt;? extends @NonNull A&gt; otherSupplier)</code>: Returns the value if <code>Valid</code>, otherwise invokes <code>otherSupplier.get()</code>.</li>
<li><code>orElseThrow(@NonNull Supplier&lt;? extends X&gt; exceptionSupplier)</code>: Returns the value if <code>Valid</code>, otherwise throws the exception from the supplier.</li>
<li><code>ifValid(@NonNull Consumer&lt;? super A&gt; consumer)</code>: Performs action if <code>Valid</code>.</li>
<li><code>ifInvalid(@NonNull Consumer&lt;? super E&gt; consumer)</code>: Performs action if <code>Invalid</code>.</li>
<li><code>fold(@NonNull Function&lt;? super E, ? extends T&gt; invalidMapper, @NonNull Function&lt;? super A, ? extends T&gt; validMapper)</code>: Applies one of two functions depending on the state.</li>
<li><code>Validated</code> also has its own <code>map</code>, <code>flatMap</code>, and <code>ap</code> methods that operate directly on <code>Validated</code> instances.</li>
</ul>
<h3 id="key-operations-via-validatedmonade"><a class="header" href="#key-operations-via-validatedmonade">Key Operations (via <code>ValidatedMonad&lt;E&gt;</code>)</a></h3>
<p>These operations are performed on the HKT wrapper <code>Kind&lt;ValidatedKind.Witness&lt;E&gt;, A&gt;</code>. Refer to <code>ValidatedMonadExample.java</code> (Sections 2, 3, 4) for runnable examples of <code>map</code>, <code>flatMap</code>, and <code>ap</code>.</p>
<p>Applies <code>f</code> to the value inside <code>kind</code> if it's <code>Valid</code>. If <code>kind</code> is <code>Invalid</code>, or if <code>f</code> throws an exception (The behaviour depends on <code>Validated.map</code> internal error handling, typically an <code>Invalid</code> from <code>Validated.map</code> would be a new <code>Invalid</code>), the result is <code>Invalid</code>.</p>
<div id="admonition-transforming-values-_map_" class="admonition admonish-note" role="note" aria-labelledby="admonition-transforming-values-_map_-title">
<div class="admonition-title">
<div id="admonition-transforming-values-_map_-title">
<p>Transforming Values (<em>map</em>)</p>
</div>
<a class="admonition-anchor-link" href="monads/validated_monad.html#admonition-transforming-values-_map_"></a>
</div>
<div>
<pre><code class="language-java">// From ValidatedMonadExample.java (Section 2)
ValidatedMonad&lt;List&lt;String&gt;&gt; validatedMonad = ValidatedMonad.instance();
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt; validKindFromOf = validatedMonad.of(42);
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt; invalidIntKind =
    VALIDATED.invalid(Collections.singletonList("Initial error for map"));

Function&lt;Integer, String&gt; intToString = i -&gt; "Value: " + i;

Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, String&gt; mappedValid =
    validatedMonad.map(intToString, validKindFromOf); // Valid("Value: 42")
System.out.println("Map (Valid input): " + VALIDATED.narrow(mappedValid));

Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, String&gt; mappedInvalid =
    validatedMonad.map(intToString, invalidIntKind); // Invalid(["Initial error for map"])
System.out.println("Map (Invalid input): " + VALIDATED.narrow(mappedInvalid));
</code></pre>
</div>
</div>
<div id="admonition-transforming-values-_flatmap_" class="admonition admonish-note" role="note" aria-labelledby="admonition-transforming-values-_flatmap_-title">
<div class="admonition-title">
<div id="admonition-transforming-values-_flatmap_-title">
<p>Transforming Values (<em>flatMap</em>)</p>
</div>
<a class="admonition-anchor-link" href="monads/validated_monad.html#admonition-transforming-values-_flatmap_"></a>
</div>
<div>
<p>If <code>kind</code> is <code>Valid(a)</code>, applies <code>f</code> to <code>a</code>. <code>f</code> must return a <code>Kind&lt;ValidatedKind.Witness&lt;E&gt;, B&gt;</code>. If <code>kind</code> is <code>Invalid</code>, or <code>f</code> returns an <code>Invalid Kind</code>, the result is <code>Invalid</code>.</p>
<pre><code class="language-java">// From ValidatedMonadExample.java (Section 3)
ValidatedMonad&lt;List&lt;String&gt;&gt; validatedMonad = ValidatedMonad.instance();
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt; positiveNumKind = validatedMonad.of(10);
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt; nonPositiveNumKind = validatedMonad.of(-5);
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt; invalidIntKind =
        VALIDATED.invalid(Collections.singletonList("Initial error for flatMap"));


Function&lt;Integer, Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, String&gt;&gt; intToValidatedStringKind =
    i -&gt; {
      if (i &gt; 0) {
        return VALIDATED.valid("Positive: " + i);
      } else {
        return VALIDATED.invalid(Collections.singletonList("Number not positive: " + i));
      }
    };

Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, String&gt; flatMappedToValid =
    validatedMonad.flatMap(intToValidatedStringKind, positiveNumKind); // Valid("Positive: 10")
System.out.println("FlatMap (Valid to Valid): " + VALIDATED.narrow(flatMappedToValid));

Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, String&gt; flatMappedToInvalid =
    validatedMonad.flatMap(intToValidatedStringKind, nonPositiveNumKind); // Invalid(["Number not positive: -5"])
System.out.println("FlatMap (Valid to Invalid): " + VALIDATED.narrow(flatMappedToInvalid));

Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, String&gt; flatMappedFromInvalid =
    validatedMonad.flatMap(intToValidatedStringKind, invalidIntKind); // Invalid(["Initial error for flatMap"])
System.out.println("FlatMap (Invalid input): " + VALIDATED.narrow(flatMappedFromInvalid));
</code></pre>
</div>
</div>
<div id="admonition-applicative-operation-ap" class="admonition admonish-note" role="note" aria-labelledby="admonition-applicative-operation-ap-title">
<div class="admonition-title">
<div id="admonition-applicative-operation-ap-title">
<p>Applicative Operation (ap)</p>
</div>
<a class="admonition-anchor-link" href="monads/validated_monad.html#admonition-applicative-operation-ap"></a>
</div>
<div>
<ul>
<li>If <code>ff</code> is <code>Valid(f)</code> and <code>fa</code> is <code>Valid(a)</code>, applies <code>f</code> to <code>a</code>, resulting in <code>Valid(f(a))</code>.</li>
<li>If either <code>ff</code> or <code>fa</code> is <code>Invalid</code>, the result is <code>Invalid</code>. Specifically, if <code>ff</code> is <code>Invalid</code>, its error is returned.</li>
<li>If <code>ff</code> is <code>Valid</code> but <code>fa</code> is <code>Invalid</code>, then <code>fa</code>'s error is returned. If both are <code>Invalid</code>, <code>ff</code>'s error takes precedence.</li>
</ul>
<p>Note: This <code>ap</code> behaviour is right-biased and does not accumulate errors in the way some applicative validations might; it propagates the first encountered <code>Invalid</code> or the <code>Invalid</code> function.</p>
<pre><code class="language-java">// From ValidatedMonadExample.java (Section 4)
ValidatedMonad&lt;List&lt;String&gt;&gt; validatedMonad = ValidatedMonad.instance();
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Function&lt;Integer, String&gt;&gt; validFnKind =
    VALIDATED.valid(i -&gt; "Applied: " + (i * 2));
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Function&lt;Integer, String&gt;&gt; invalidFnKind =
    VALIDATED.invalid(Collections.singletonList("Function is invalid"));

Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt; validValueForAp = validatedMonad.of(25);
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt; invalidValueForAp =
    VALIDATED.invalid(Collections.singletonList("Value is invalid"));

// Valid function, Valid value
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, String&gt; apValidFnValidVal =
    validatedMonad.ap(validFnKind, validValueForAp); // Valid("Applied: 50")
System.out.println("Ap (ValidFn, ValidVal): " + VALIDATED.narrow(apValidFnValidVal));

// Invalid function, Valid value
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, String&gt; apInvalidFnValidVal =
    validatedMonad.ap(invalidFnKind, validValueForAp); // Invalid(["Function is invalid"])
System.out.println("Ap (InvalidFn, ValidVal): " + VALIDATED.narrow(apInvalidFnValidVal));

// Valid function, Invalid value
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, String&gt; apValidFnInvalidVal =
    validatedMonad.ap(validFnKind, invalidValueForAp); // Invalid(["Value is invalid"])
System.out.println("Ap (ValidFn, InvalidVal): " + VALIDATED.narrow(apValidFnInvalidVal));

// Invalid function, Invalid value
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, String&gt; apInvalidFnInvalidVal =
    validatedMonad.ap(invalidFnKind, invalidValueForAp); // Invalid(["Function is invalid"])
System.out.println("Ap (InvalidFn, InvalidVal): " + VALIDATED.narrow(apInvalidFnInvalidVal));
</code></pre>
</div>
</div>
<h3 id="monaderror-operations"><a class="header" href="#monaderror-operations">MonadError Operations</a></h3>
<p>As <code>ValidatedMonad&lt;E&gt;</code> implements <code>MonadError&lt;ValidatedKind.Witness&lt;E&gt;, E&gt;</code>, it provides standardized ways to create and handle errors. Refer to ValidatedMonadExample.java (Section 6) for detailed examples.</p>
<div id="admonition-_recover_-and-_recoverwith_" class="admonition admonish-note" role="note" aria-labelledby="admonition-_recover_-and-_recoverwith_-title">
<div class="admonition-title">
<div id="admonition-_recover_-and-_recoverwith_-title">
<p><em>recover</em> and <em>recoverWith</em></p>
</div>
<a class="admonition-anchor-link" href="monads/validated_monad.html#admonition-_recover_-and-_recoverwith_"></a>
</div>
<div>
<pre><code class="language-java">// From ValidatedMonadExample.java (Section 6)
ValidatedMonad&lt;List&lt;String&gt;&gt; validatedMonad = ValidatedMonad.instance();
List&lt;String&gt; initialError = Collections.singletonList("Initial Failure");

// 1. Create an Invalid Kind using raiseError
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt; invalidKindRaised = // Renamed to avoid conflict
    validatedMonad.raiseError(initialError);
System.out.println("Raised error: " + VALIDATED.narrow(invalidKindRaised)); // Invalid([Initial Failure])

// 2. Handle the error: recover to a Valid state
Function&lt;List&lt;String&gt;, Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt;&gt; recoverToValid =
    errors -&gt; {
        System.out.println("MonadError: Recovery handler called with errors: " + errors);
        return validatedMonad.of(0); // Recover with default value 0
    };
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt; recoveredValid =
    validatedMonad.handleErrorWith(invalidKindRaised, recoverToValid);
System.out.println("Recovered to Valid: " + VALIDATED.narrow(recoveredValid)); // Valid(0)

// 3. Handle the error: transform to another Invalid state
Function&lt;List&lt;String&gt;, Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt;&gt; transformError =
    errors -&gt; validatedMonad.raiseError(Collections.singletonList("Transformed Error: " + errors.get(0)));
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt; transformedInvalid =
    validatedMonad.handleErrorWith(invalidKindRaised, transformError);
System.out.println("Transformed to Invalid: " + VALIDATED.narrow(transformedInvalid)); // Invalid([Transformed Error: Initial Failure])

// 4. Handle a Valid Kind: handler is not called
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt; validKindOriginal = validatedMonad.of(100);
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt; notHandled =
    validatedMonad.handleErrorWith(validKindOriginal, recoverToValid); // Handler not called
System.out.println("Handling Valid (no change): " + VALIDATED.narrow(notHandled)); // Valid(100)

// 5. Using a default method like handleError
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt; errorForHandle = validatedMonad.raiseError(Collections.singletonList("Error for handleError"));
Function&lt;List&lt;String&gt;, Integer&gt; plainValueRecoveryHandler = errors -&gt; -1; // Returns plain value
Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt; recoveredWithHandle = validatedMonad.handleError(errorForHandle, plainValueRecoveryHandler);
System.out.println("Recovered with handleError: " + VALIDATED.narrow(recoveredWithHandle)); // Valid(-1)
</code></pre>
<p>The default <code>recover</code> and <code>recoverWith</code> methods from <code>MonadError</code> are also available.</p>
</div>
</div>
<div id="admonition-combining-operations-for-simple-validation" class="admonition admonish-note" role="note" aria-labelledby="admonition-combining-operations-for-simple-validation-title">
<div class="admonition-title">
<div id="admonition-combining-operations-for-simple-validation-title">
<p>Combining operations for simple validation</p>
</div>
<a class="admonition-anchor-link" href="monads/validated_monad.html#admonition-combining-operations-for-simple-validation"></a>
</div>
<div>
<p>This example demonstrates how <code>ValidatedMonad</code> along with <code>Validated</code> can be used to chain operations that might succeed or fail. With <code>ValidatedMonad</code> now implementing <code>MonadError</code>, operations like <code>raiseError</code> can be used for clearer error signaling, and <code>handleErrorWith</code> (or other <code>MonadError</code> methods) can be used for more robust recovery strategies within such validation flows.</p>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/validated/ValidatedMonadExample.java">ValidatedMonadExample.java</a> <em>see "Combined Validation Scenario"</em>.</li>
</ul>
<pre><code class="language-java">// Simplified from the ValidatedMonadExample.java
public void combinedValidationScenarioWithMonadError() {
  ValidatedMonad&lt;List&lt;String&gt;&gt; validatedMonad = ValidatedMonad.instance();
  Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, String&gt; userInput1 = validatedMonad.of("123");
  Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, String&gt; userInput2 = validatedMonad.of("abc"); // This will lead to an Invalid

  Function&lt;String, Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt;&gt; parseToIntKindMonadError =
      (String s) -&gt; {
        try {
          return validatedMonad.of(Integer.parseInt(s)); // Lifts to Valid
        } catch (NumberFormatException e) {
          // Using raiseError for semantic clarity
          return validatedMonad.raiseError(
              Collections.singletonList("'" + s + "' is not a number (via raiseError)."));
        }
      };

  Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt; parsed1 =
      validatedMonad.flatMap(parseToIntKindMonadError, userInput1);
  Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt; parsed2 =
      validatedMonad.flatMap(parseToIntKindMonadError, userInput2); // Will be Invalid

  System.out.println("Parsed Input 1 (Combined): " + VALIDATED.narrow(parsed1)); // Valid(123)
  System.out.println("Parsed Input 2 (Combined): " + VALIDATED.narrow(parsed2)); // Invalid(['abc' is not a number...])

  // Example of recovering the parse of userInput2 using handleErrorWith
  Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt; parsed2Recovered =
      validatedMonad.handleErrorWith(
          parsed2,
          errors -&gt; {
            System.out.println("Combined scenario recovery: " + errors);
            return validatedMonad.of(0); // Default to 0 if parsing failed
          });
  System.out.println(
      "Parsed Input 2 (Recovered to 0): " + VALIDATED.narrow(parsed2Recovered)); // Valid(0)
}
</code></pre>
<p>This example demonstrates how <code>ValidatedMonad</code> along with <code>Validated</code> can be used to chain operations that might succeed or fail, propagating errors and allowing for clear handling of either outcome, further enhanced by <code>MonadError</code> capabilities.</p>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="the-writermonad"><a class="header" href="#the-writermonad">The WriterMonad:</a></h1>
<h2 id="accumulating-output-alongside-computations"><a class="header" href="#accumulating-output-alongside-computations"><em>Accumulating Output Alongside Computations</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="monads/writer_monad.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to accumulate logs or output alongside your main computation</li>
<li>Understanding the role of Monoid in combining accumulated values</li>
<li>Building detailed audit trails and debugging information</li>
<li>Using <code>tell</code> for pure logging and <code>listen</code> for capturing output</li>
<li>Creating calculations that produce both results and comprehensive logs</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="monads/writer_monad.html#admonition-see-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/writer/WriterExample.java">WriterExample.java</a></p>
</div>
</div>
<h2 id="purpose-8"><a class="header" href="#purpose-8">Purpose</a></h2>
<p>The <strong>Writer monad</strong> is a functional pattern designed for computations that, in addition to producing a primary result value, also need to <strong>accumulate</strong> some secondary output or log along the way. Think of scenarios like:</p>
<ul>
<li>Detailed logging of steps within a complex calculation.</li>
<li>Collecting metrics or events during a process.</li>
<li>Building up a sequence of results or messages.</li>
</ul>
<p>A <code>Writer&lt;W, A&gt;</code> represents a computation that produces a main result of type <code>A</code> and simultaneously accumulates an output of type <code>W</code>. The key requirement is that the accumulated type <code>W</code> must form a <strong>Monoid</strong>.</p>
<h3 id="the-role-of-monoidw"><a class="header" href="#the-role-of-monoidw">The Role of <code>Monoid&lt;W&gt;</code></a></h3>
<p>A <code>Monoid&lt;W&gt;</code> is a type class that defines two things for type <code>W</code>:</p>
<ol>
<li><code>empty()</code>: Provides an identity element (like <code>""</code> for String concatenation, <code>0</code> for addition, or an empty list).</li>
<li><code>combine(W w1, W w2)</code>: Provides an <strong>associative</strong> binary operation to combine two values of type <code>W</code> (like <code>+</code> for strings or numbers, or list concatenation).</li>
</ol>
<p>The Writer monad uses the <code>Monoid&lt;W&gt;</code> to:</p>
<ul>
<li>Provide a starting point (the <code>empty</code> value) for the accumulation.</li>
<li>Combine the accumulated outputs (<code>W</code>) from different steps using the <code>combine</code> operation when sequencing computations with <code>flatMap</code> or <code>ap</code>.</li>
</ul>
<p>Common examples for <code>W</code> include <code>String</code> (using concatenation), <code>Integer</code> (using addition or multiplication), or <code>List</code> (using concatenation).</p>
<h2 id="structure-7"><a class="header" href="#structure-7">Structure</a></h2>
<p>The <code>Writer&lt;W, A&gt;</code> record directly implements <code>WriterKind&lt;W, A&gt;</code>, which in turn extends <code>Kind&lt;WriterKind.Witness&lt;W&gt;, A&gt;</code>.</p>
<p><img src="monads/../images/puml/writer.svg" alt="writer.svg" /></p>
<h2 id="the-writerw-a-type"><a class="header" href="#the-writerw-a-type">The <code>Writer&lt;W, A&gt;</code> Type</a></h2>
<p>The core type is the <code>Writer&lt;W, A&gt;</code> record:</p>
<pre><code class="language-java">// From: org.higherkindedj.hkt.writer.Writer
public record Writer&lt;W, A&gt;(@NonNull W log, @Nullable A value) implements WriterKind&lt;W, A&gt; {
  // Static factories
  public static &lt;W, A&gt; @NonNull Writer&lt;W, A&gt; create(@NonNull W log, @Nullable A value);
  public static &lt;W, A&gt; @NonNull Writer&lt;W, A&gt; value(@NonNull Monoid&lt;W&gt; monoidW, @Nullable A value); // Creates (monoidW.empty(), value)
  public static &lt;W&gt; @NonNull Writer&lt;W, Unit&gt; tell(@NonNull W log); // Creates (log, Unit.INSTANCE) 

  // Instance methods (primarily for direct use, HKT versions via Monad instance)
  public &lt;B&gt; @NonNull Writer&lt;W, B&gt; map(@NonNull Function&lt;? super A, ? extends B&gt; f);
  public &lt;B&gt; @NonNull Writer&lt;W, B&gt; flatMap(
          @NonNull Monoid&lt;W&gt; monoidW, // Monoid needed for combining logs
          @NonNull Function&lt;? super A, ? extends Writer&lt;W, ? extends B&gt;&gt; f
  );
  public @Nullable A run(); // Get the value A, discard log
  public @NonNull W exec(); // Get the log W, discard value
}
</code></pre>
<ul>
<li>It simply holds a pair: the accumulated <code>log</code> (of type <code>W</code>) and the computed <code>value</code> (of type <code>A</code>).</li>
<li><code>create(log, value)</code>: Basic constructor.</li>
<li><code>value(monoid, value)</code>: Creates a Writer with the given value and an <em>empty</em> log according to the provided <code>Monoid</code>.</li>
<li><code>tell(log)</code>: Creates a Writer with the given log, and <code>Unit.INSTANCE</code> as it's  value, signifying that the operation's primary purpose is the accumulation of the log. Useful for just adding to the log. (Note: The original <code>Writer.java</code> might have <code>tell(W log)</code> and infer monoid elsewhere, or <code>WriterMonad</code> handles <code>tell</code>).</li>
<li><code>map(...)</code>: Transforms the computed value <code>A</code> to <code>B</code> while leaving the log <code>W</code> untouched.</li>
<li><code>flatMap(...)</code>: Sequences computations. It runs the first Writer, uses its value <code>A</code> to create a second Writer, and combines the logs from both using the provided <code>Monoid</code>.</li>
<li><code>run()</code>: Extracts only the computed value <code>A</code>, discarding the log.</li>
<li><code>exec()</code>: Extracts only the accumulated log <code>W</code>, discarding the value.</li>
</ul>
<h2 id="writer-components"><a class="header" href="#writer-components">Writer Components</a></h2>
<p>To integrate <code>Writer</code> with Higher-Kinded-J:</p>
<ul>
<li><code>WriterKind&lt;W, A&gt;</code>: The HKT interface. <code>Writer&lt;W, A&gt;</code> itself implements <code>WriterKind&lt;W, A&gt;</code>. <code>WriterKind&lt;W, A&gt;</code> extends <code>Kind&lt;WriterKind.Witness&lt;W&gt;, A&gt;</code>.
<ul>
<li>It contains a nested <code>final class Witness&lt;LOG_W&gt; {}</code> which serves as the phantom type <code>F_WITNESS</code> for <code>Writer&lt;LOG_W, ?&gt;</code>.</li>
</ul>
</li>
<li><strong><code>WriterKindHelper</code></strong>: The utility class with static methods:
<ul>
<li><code>widen(Writer&lt;W, A&gt;)</code>: Converts a <code>Writer</code> to <code>Kind&lt;WriterKind.Witness&lt;W&gt;, A&gt;</code>. Since <code>Writer</code> directly implements <code>WriterKind</code>, this is effectively a checked cast.</li>
<li><code>narrow(Kind&lt;WriterKind.Witness&lt;W&gt;, A&gt;)</code>: Converts <code>Kind</code> back to <code>Writer&lt;W,A&gt;</code>. This is also effectively a checked cast after an <code>instanceof Writer</code> check.</li>
<li><code>value(Monoid&lt;W&gt; monoid, A value)</code>: Factory method for a <code>Kind</code> representing a <code>Writer</code> with an empty log.</li>
<li><code>tell(W log)</code>: Factory method for a <code>Kind</code> representing a <code>Writer</code> that only logs.</li>
<li><code>runWriter(Kind&lt;WriterKind.Witness&lt;W&gt;, A&gt;)</code>: Unwraps to <code>Writer&lt;W,A&gt;</code> and returns the record itself.</li>
<li><code>run(Kind&lt;WriterKind.Witness&lt;W&gt;, A&gt;)</code>: Executes (unwraps) and returns only the value <code>A</code>.</li>
<li><code>exec(Kind&lt;WriterKind.Witness&lt;W&gt;, A&gt;)</code>: Executes (unwraps) and returns only the log <code>W</code>.</li>
</ul>
</li>
</ul>
<h2 id="type-class-instances-writerfunctor-writerapplicative-writermonad"><a class="header" href="#type-class-instances-writerfunctor-writerapplicative-writermonad">Type Class Instances (<code>WriterFunctor</code>, <code>WriterApplicative</code>, <code>WriterMonad</code>)</a></h2>
<p>These classes provide the standard functional operations for <code>Kind&lt;WriterKind.Witness&lt;W&gt;, A&gt;</code>, allowing you to treat <code>Writer</code> computations generically. <strong>Crucially, <code>WriterApplicative&lt;W&gt;</code> and <code>WriterMonad&lt;W&gt;</code> require a <code>Monoid&lt;W&gt;</code> instance during construction.</strong></p>
<ul>
<li><code>WriterFunctor&lt;W&gt;</code>: Implements <code>Functor&lt;WriterKind.Witness&lt;W&gt;&gt;</code>. Provides <code>map</code> (operates only on the value <code>A</code>).</li>
<li><strong><code>WriterApplicative&lt;W&gt;</code></strong>: Extends <code>WriterFunctor&lt;W&gt;</code>, implements <code>Applicative&lt;WriterKind.Witness&lt;W&gt;&gt;</code>. Requires a <code>Monoid&lt;W&gt;</code>. Provides <code>of</code> (lifting a value with an empty log) and <code>ap</code> (applying a wrapped function to a wrapped value, combining logs).</li>
<li><strong><code>WriterMonad&lt;W&gt;</code></strong>: Extends <code>WriterApplicative&lt;W&gt;</code>, implements <code>Monad&lt;WriterKind.Witness&lt;W&gt;&gt;</code>. Requires a <code>Monoid&lt;W&gt;</code>. Provides <code>flatMap</code> for sequencing computations, automatically combining logs using the <code>Monoid</code>.</li>
</ul>
<div id="admonition-example-logging-a-complex-calculation" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-logging-a-complex-calculation-title">
<div class="admonition-title">
<div id="admonition-example-logging-a-complex-calculation-title">
<p>Example: Logging a complex calculation</p>
</div>
<a class="admonition-anchor-link" href="monads/writer_monad.html#admonition-example-logging-a-complex-calculation"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/writer/WriterExample.java">WriterExample.java</a></li>
</ul>
<p>You typically instantiate <code>WriterMonad&lt;W&gt;</code> for the specific log type <code>W</code> and its corresponding <code>Monoid</code>.</p>
<h3 id="1-choose-your-log-type-w-and-monoidw"><a class="header" href="#1-choose-your-log-type-w-and-monoidw">1. Choose Your Log Type <code>W</code> and <code>Monoid&lt;W&gt;</code></a></h3>
<p>Decide what you want to accumulate (e.g., <code>String</code> for logs, <code>List&lt;String&gt;</code> for messages, <code>Integer</code> for counts) and get its <code>Monoid</code>.</p>
<pre><code class="language-java">
class StringMonoid implements Monoid&lt;String&gt; {
  @Override public String empty() { return ""; }
  @Override public String combine(String x, String y) { return x + y; }
}

Monoid&lt;String&gt; stringMonoid = new StringMonoid(); 
</code></pre>
<h3 id="2-get-the-writermonad-instance"><a class="header" href="#2-get-the-writermonad-instance">2. Get the <code>WriterMonad</code> Instance</a></h3>
<p>Instantiate the monad for your chosen log type <code>W</code>, providing its <code>Monoid</code>.</p>
<pre><code class="language-java">import org.higherkindedj.hkt.writer.WriterMonad;

// Monad instance for computations logging Strings
// F_WITNESS here is WriterKind.Witness&lt;String&gt;
WriterMonad&lt;String&gt; writerMonad = new WriterMonad&lt;&gt;(stringMonoid);

</code></pre>
<h3 id="3-create-writer-computations"><a class="header" href="#3-create-writer-computations">3. Create Writer Computations</a></h3>
<p>Use <code>WriterKindHelper</code> factory methods, providing the <code>Monoid</code> where needed. The result is <code>Kind&lt;WriterKind.Witness&lt;W&gt;, A&gt;</code>.</p>
<pre><code class="language-java">
// Writer with an initial value and empty log
Kind&lt;WriterKind.Witness&lt;String&gt;, Integer&gt; initialValue = WRITER.value(stringMonoid, 5); // Log: "", Value: 5

// Writer that just logs a message (value is Unit.INSTANCE)
Kind&lt;WriterKind.Witness&lt;String&gt;, Unit&gt; logStart = WRITER.tell("Starting calculation; "); // Log: "Starting calculation; ", Value: ()

// A function that performs a calculation and logs its step
Function&lt;Integer, Kind&lt;WriterKind.Witness&lt;String&gt;, Integer&gt;&gt; addAndLog =
        x -&gt; {
          int result = x + 10;
          String logMsg = "Added 10 to " + x + " -&gt; " + result + "; ";
          // Create a Writer directly then wrap with helper or use helper factory
          return WRITER.widen(Writer.create(logMsg, result));
        };

Function&lt;Integer, Kind&lt;WriterKind.Witness&lt;String&gt;, String&gt;&gt; multiplyAndLogToString =
        x -&gt; {
          int result = x * 2;
          String logMsg = "Multiplied " + x + " by 2 -&gt; " + result + "; ";
          return WRITER.widen(Writer.create(logMsg, "Final:" + result));
        };

</code></pre>
<h3 id="4-compose-computations-using-map-and-flatmap-2"><a class="header" href="#4-compose-computations-using-map-and-flatmap-2">4. Compose Computations using <code>map</code> and <code>flatMap</code></a></h3>
<p>Use the methods on the <code>writerMonad</code> instance. <code>flatMap</code> automatically combines logs using the <code>Monoid</code>.</p>
<pre><code class="language-java">// Chain the operations:
// Start with a pure value 0 in the Writer context (empty log)
Kind&lt;WriterKind.Witness&lt;String&gt;, Integer&gt; computationStart = writerMonad.of(0);

// 1. Log the start
Kind&lt;WriterKind.Witness&lt;String&gt;, Integer&gt; afterLogStart  = writerMonad.flatMap(ignoredUnit -&gt; initialValue, logStart);

Kind&lt;WriterKind.Witness&lt;String&gt;, Integer&gt; step1Value = WRITER.value(stringMonoid, 5); // ("", 5)
Kind&lt;WriterKind.Witness&lt;String&gt;, Unit&gt; step1Log = WRITER.tell("Initial value set to 5; "); // ("Initial value set to 5; ", ())


// Start -&gt; log -&gt; transform value -&gt; log -&gt; transform value ...
Kind&lt;WriterKind.Witness&lt;String&gt;, Integer&gt; calcPart1 = writerMonad.flatMap(
        ignored -&gt; addAndLog.apply(5), // Apply addAndLog to 5, after logging "start"
        WRITER.tell("Starting with 5; ")
);
// calcPart1: Log: "Starting with 5; Added 10 to 5 -&gt; 15; ", Value: 15

Kind&lt;WriterKind.Witness&lt;String&gt;, String&gt; finalComputation = writerMonad.flatMap(
        intermediateValue -&gt; multiplyAndLogToString.apply(intermediateValue),
        calcPart1
);
// finalComputation: Log: "Starting with 5; Added 10 to 5 -&gt; 15; Multiplied 15 by 2 -&gt; 30; ", Value: "Final:30"


// Using map: Only transforms the value, log remains unchanged from the input Kind
Kind&lt;WriterKind.Witness&lt;String&gt;, Integer&gt; initialValForMap = value(stringMonoid, 100); // Log: "", Value: 100
Kind&lt;WriterKind.Witness&lt;String&gt;, String&gt; mappedVal = writerMonad.map(
        i -&gt; "Value is " + i,
        initialValForMap
); // Log: "", Value: "Value is 100"
</code></pre>
<h3 id="5-run-the-computation-and-extract-results"><a class="header" href="#5-run-the-computation-and-extract-results">5. Run the Computation and Extract Results</a></h3>
<p>Use <code>WRITER.runWriter</code>, <code>WRITER.run</code>, or <code>WRITER.exec</code> from <code>WriterKindHelper</code>.</p>
<pre><code class="language-java">
import org.higherkindedj.hkt.writer.Writer; 

// Get the final Writer record (log and value)
Writer&lt;String, String&gt; finalResultWriter = runWriter(finalComputation);
String finalLog = finalResultWriter.log();
String finalValue = finalResultWriter.value();

System.out.println("Final Log: " + finalLog);
// Output: Final Log: Starting with 5; Added 10 to 5 -&gt; 15; Multiplied 15 by 2 -&gt; 30;
System.out.println("Final Value: " + finalValue);
// Output: Final Value: Final:30

// Or get only the value or log
String justValue = WRITER.run(finalComputation); // Extracts value from finalResultWriter
String justLog = WRITER.exec(finalComputation);  // Extracts log from finalResultWriter

System.out.println("Just Value: " + justValue); // Output: Just Value: Final:30
System.out.println("Just Log: " + justLog);     // Output: Just Log: Starting with 5; Added 10 to 5 -&gt; 15; Multiplied 15 by 2 -&gt; 30;

Writer&lt;String, String&gt; mappedResult = WRITER.runWriter(mappedVal);
System.out.println("Mapped Log: " + mappedResult.log());   // Output: Mapped Log
System.out.println("Mapped Value: " + mappedResult.value()); // Output: Mapped Value: Value is 100
</code></pre>
</div>
</div>
<div id="admonition-key-points" class="admonition admonish-tip" role="note" aria-labelledby="admonition-key-points-title">
<div class="admonition-title">
<div id="admonition-key-points-title">
<p>Key Points:</p>
</div>
<a class="admonition-anchor-link" href="monads/writer_monad.html#admonition-key-points"></a>
</div>
<div>
<p>The Writer monad (<code>Writer&lt;W, A&gt;</code>, <code>WriterKind.Witness&lt;W&gt;</code>, <code>WriterMonad&lt;W&gt;</code>) in <code>Higher-Kinded-J</code> provides a structured way to perform computations that produce a main value (<code>A</code>) while simultaneously accumulating some output (<code>W</code>, like logs or metrics).</p>
<p>It relies on a <code>Monoid&lt;W&gt;</code> instance to combine the accumulated outputs when sequencing steps with <code>flatMap</code>. This pattern helps separate the core computation logic from the logging/accumulation aspect, leading to cleaner, more composable code.</p>
<p>The Higher-Kinded-J enables these operations to be performed generically using standard type class interfaces, with <code>Writer&lt;W,A&gt;</code> directly implementing <code>WriterKind&lt;W,A&gt;</code>.</p>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="the-transformers"><a class="header" href="#the-transformers">The Transformers:</a></h1>
<p><em>Combining Monadic Effects</em></p>
<p><img src="transformers/../images/stand_back_monad_transformers.jpg" alt="stand_back_monad_transformers.jpg" /></p>
<h2 id="the-problem"><a class="header" href="#the-problem">The Problem</a></h2>
<p>When building applications, we often encounter scenarios where we need to combine different computational contexts or effects. For example:</p>
<ul>
<li>An operation might be <strong>asynchronous</strong> (represented by <code>CompletableFuture</code>).</li>
<li>The same operation might also <strong>fail with specific domain errors</strong> (represented by <code>Either&lt;DomainError, Result&gt;</code>).</li>
<li>An operation might need <strong>access to a configuration</strong> (using <code>Reader</code>) and also be <strong>asynchronous</strong>.</li>
<li>A computation might <strong>accumulate logs</strong> (using <code>Writer</code>) and also <strong>potentially fail</strong> (using <code>Maybe</code> or <code>Either</code>).</li>
</ul>
<h3 id="monads-stack-poorly"><a class="header" href="#monads-stack-poorly">Monads Stack Poorly</a></h3>
<p>Directly nesting these monadic types, like <code>CompletableFuture&lt;Either&lt;DomainError, Result&gt;&gt;</code> or <code>Reader&lt;Config, Optional&lt;Data&gt;&gt;</code>, leads to complex, deeply nested code ("callback hell" or nested <code>flatMap</code>/<code>map</code> calls). It becomes difficult to sequence operations and handle errors or contexts uniformly.</p>
<p>For instance, an operation might need to be both asynchronous <em>and</em> handle potential domain-specific errors. Representing this naively leads to nested types like:</p>
<pre><code class="language-java">// A future that, when completed, yields either a DomainError or a SuccessValue
Kind&lt;CompletableFutureKind.Witness, Either&lt;DomainError, SuccessValue&gt;&gt; nestedResult;
</code></pre>
<p>But now, how do we <code>map</code> or <code>flatMap</code> over this stack  without lots of boilerplate?</p>
<h2 id="monad-transformers-a-wrapper-to-simplify-nested-monads"><a class="header" href="#monad-transformers-a-wrapper-to-simplify-nested-monads">Monad Transformers: A <em>wrapper</em> to simplify nested Monads</a></h2>
<p><strong>Monad Transformers</strong> are a design pattern in functional programming used to combine the effects of two different monads into a single, new monad. They provide a standard way to "stack" monadic contexts, allowing you to work with the combined structure more easily using familiar monadic operations like <code>map</code> and <code>flatMap</code>.</p>
<p>A monad transformer <code>T</code> takes a monad <code>M</code> and produces a new monad <code>T&lt;M&gt;</code> that combines the effects of both <code>T</code> (conceptually) and <code>M</code>.</p>
<h4 id="for-example"><a class="header" href="#for-example">For example:</a></h4>
<ul>
<li><code>MaybeT m a</code> wraps a monad <code>m</code> and adds <code>Maybe</code>-like failure</li>
<li><code>StateT s m a</code> wraps a monad <code>m</code> and adds state-handling capability</li>
<li><code>ReaderT r m a</code> adds dependency injection (read-only environment)</li>
</ul>
<p>They allow you to <strong>stack</strong> monadic behaviours.</p>
<p>Key characteristics:</p>
<ol>
<li><strong>Stacking:</strong> They allow "stacking" monadic effects in a standard way.</li>
<li><strong>Unified Interface:</strong> The resulting transformed monad (e.g., <code>EitherT&lt;CompletableFutureKind, ...&gt;</code>) itself implements the <code>Monad</code> (and often <code>MonadError</code>, etc.) interface.</li>
<li><strong>Abstraction:</strong> They hide the complexity of manually managing the nested structure. You can use standard <code>map</code>, <code>flatMap</code>, <code>handleErrorWith</code> operations on the transformed monad, and it automatically handles the logic for both underlying monads correctly.</li>
</ol>
<h2 id="transformers-in-higher-kinded-j"><a class="header" href="#transformers-in-higher-kinded-j">Transformers in Higher-Kinded-J</a></h2>
<p><img src="transformers/../images/puml/supported_transformers.svg" alt="supported_transformers.svg" /></p>
<h3 id="1-eithertf-l-r-monad-transformer"><a class="header" href="#1-eithertf-l-r-monad-transformer">1. <code>EitherT&lt;F, L, R&gt;</code> (Monad Transformer)</a></h3>
<p><img src="transformers/../images/puml/transformers.svg" alt="transformers.svg" /></p>
<ul>
<li><strong>Definition:</strong> A monad transformer (<a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/either_t/EitherT.java"><code>EitherT</code></a>) that combines an outer monad <code>F</code> with an inner <code>Either&lt;L, R&gt;</code>. Implemented as a record wrapping <code>Kind&lt;F, Either&lt;L, R&gt;&gt;</code>.</li>
<li><strong>Kind Interface:</strong> <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/either_t/EitherTKind.java"><code>EitherTKind&lt;F, L, R&gt;</code></a></li>
<li><strong>Witness Type <code>G</code>:</strong> <code>EitherTKind.Witness&lt;F, L&gt;</code> (where <code>F</code> and <code>L</code> are fixed for a given type class instance)</li>
<li><strong>Helper:</strong> <code>EitherTKindHelper</code> (<code>wrap</code>, <code>unwrap</code>). Instances are primarily created via <code>EitherT</code> static factories (<code>fromKind</code>, <code>right</code>, <code>left</code>, <code>fromEither</code>, <code>liftF</code>).</li>
<li><strong>Type Class Instances:</strong>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/either_t/EitherT.java"><code>EitherTMonad&lt;F, L&gt;</code></a> (<code>MonadError&lt;EitherTKind.Witness&lt;F, L&gt;, L&gt;</code>)</li>
</ul>
</li>
<li><strong>Notes:</strong> Simplifies working with nested structures like <code>F&lt;Either&lt;L, R&gt;&gt;</code>. Requires a <code>Monad&lt;F&gt;</code> instance for the outer monad <code>F</code> passed to its constructor. Implements <code>MonadError</code> for the <em>inner</em> <code>Either</code>'s <code>Left</code> type <code>L</code>. See the <a href="transformers/../hkts/order-walkthrough.html">Order Processing Example Walkthrough</a> for practical usage with <code>CompletableFuture</code> as <code>F</code>.</li>
<li><strong>Usage:</strong> <a href="transformers/eithert_transformer.html">How to use the EitherT Monad Transformer</a></li>
</ul>
<hr />
<h3 id="2-maybetf-a-monad-transformer"><a class="header" href="#2-maybetf-a-monad-transformer">2. <code>MaybeT&lt;F, A&gt;</code> (Monad Transformer)</a></h3>
<ul>
<li><strong>Definition:</strong> A monad transformer (<a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt/maybe_t/MaybeT.java"><code>MaybeT</code></a>) that combines an outer monad <code>F</code> with an inner <code>Maybe&lt;A&gt;</code>. Implemented as a record wrapping <code>Kind&lt;F, Maybe&lt;A&gt;&gt;</code>.</li>
<li><strong>Kind Interface:</strong> <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt//maybe_t/MaybeTKind.java"><code>MaybeTKind&lt;F, A&gt;</code></a></li>
<li><strong>Witness Type <code>G</code>:</strong> <code>MaybeTKind.Witness&lt;F&gt;</code> (where <code>F</code> is fixed for a given type class instance)</li>
<li><strong>Helper:</strong> <code>MaybeTKindHelper</code> (<code>wrap</code>, <code>unwrap</code>). Instances are primarily created via <code>MaybeT</code> static factories (<code>fromKind</code>, <code>just</code>, <code>nothing</code>, <code>fromMaybe</code>, <code>liftF</code>).</li>
<li><strong>Type Class Instances:</strong>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt//maybe_t/MaybeTMonad.java"><code>MaybeTMonad&lt;F&gt;</code></a> (<code>MonadError&lt;MaybeTKind.Witness&lt;F&gt;, Void&gt;</code>)</li>
</ul>
</li>
<li><strong>Notes:</strong> Simplifies working with nested structures like <code>F&lt;Maybe&lt;A&gt;&gt;</code>. Requires a <code>Monad&lt;F&gt;</code> instance for the outer monad <code>F</code>. Implements <code>MonadError</code> where the error type is <code>Void</code>, corresponding to the <code>Nothing</code> state from the inner <code>Maybe</code>.</li>
<li><strong>Usage:</strong> <a href="transformers/./maybet_transformer.html">How to use the MaybeT Monad Transformer</a></li>
</ul>
<hr />
<h3 id="3-optionaltf-a-monad-transformer"><a class="header" href="#3-optionaltf-a-monad-transformer">3. <code>OptionalT&lt;F, A&gt;</code> (Monad Transformer)</a></h3>
<ul>
<li><strong>Definition:</strong> A monad transformer (<a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt//optional_t/OptionalT.java"><code>OptionalT</code></a>) that combines an outer monad <code>F</code> with an inner <code>java.util.Optional&lt;A&gt;</code>. Implemented as a record wrapping <code>Kind&lt;F, Optional&lt;A&gt;&gt;</code>.</li>
<li><strong>Kind Interface:</strong> <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt//optional_t/OptionalTKind.java"><code>OptionalTKind&lt;F, A&gt;</code></a></li>
<li><strong>Witness Type <code>G</code>:</strong> <code>OptionalTKind.Witness&lt;F&gt;</code> (where <code>F</code> is fixed for a given type class instance)</li>
<li><strong>Helper:</strong> <code>OptionalTKindHelper</code> (<code>wrap</code>, <code>unwrap</code>). Instances are primarily created via <code>OptionalT</code> static factories (<code>fromKind</code>, <code>some</code>, <code>none</code>, <code>fromOptional</code>, <code>liftF</code>).</li>
<li><strong>Type Class Instances:</strong>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt//optional_t/OptionalTMonad.java"><code>OptionalTMonad&lt;F&gt;</code></a> (<code>MonadError&lt;OptionalTKind.Witness&lt;F&gt;, Void&gt;</code>)</li>
</ul>
</li>
<li><strong>Notes:</strong> Simplifies working with nested structures like <code>F&lt;Optional&lt;A&gt;&gt;</code>. Requires a <code>Monad&lt;F&gt;</code> instance for the outer monad <code>F</code>. Implements <code>MonadError</code> where the error type is <code>Void</code>, corresponding to the <code>Optional.empty()</code> state from the inner <code>Optional</code>.</li>
<li><strong>Usage:</strong> <a href="transformers/./optionalt_transformer.html">How to use the OptionalT Monad Transformer</a></li>
</ul>
<hr />
<h3 id="4-readertf-r-a-monad-transformer"><a class="header" href="#4-readertf-r-a-monad-transformer">4. <code>ReaderT&lt;F, R, A&gt;</code> (Monad Transformer)</a></h3>
<ul>
<li><strong>Definition:</strong> A monad transformer (<a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt//reader_t/ReaderT.java"><code>ReaderT</code></a>) that combines an outer monad <code>F</code> with an inner <code>Reader&lt;R, A&gt;</code>-like behaviour (dependency on environment <code>R</code>). Implemented as a record wrapping a function <code>R -&gt; Kind&lt;F, A&gt;</code>.</li>
<li><strong>Kind Interface:</strong> <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt//reader_t/ReaderTKind.java"><code>ReaderTKind&lt;F, R, A&gt;</code></a></li>
<li><strong>Witness Type <code>G</code>:</strong> <code>ReaderTKind.Witness&lt;F, R&gt;</code> (where <code>F</code> and <code>R</code> are fixed for a given type class instance)</li>
<li><strong>Helper:</strong> <code>ReaderTKindHelper</code> (<code>wrap</code>, <code>unwrap</code>). Instances are primarily created via <code>ReaderT</code> static factories (<code>of</code>, <code>lift</code>, <code>reader</code>, <code>ask</code>).</li>
<li><strong>Type Class Instances:</strong>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt//reader_t/ReaderTMonad.java"><code>ReaderTMonad&lt;F, R&gt;</code></a> (<code>Monad&lt;ReaderTKind&lt;F, R, ?&gt;&gt;</code>)</li>
</ul>
</li>
<li><strong>Notes:</strong> Simplifies managing computations that depend on a read-only environment <code>R</code> while also involving other monadic effects from <code>F</code>. Requires a <code>Monad&lt;F&gt;</code> instance for the outer monad. The <code>run()</code> method of <code>ReaderT</code> takes <code>R</code> and returns <code>Kind&lt;F, A&gt;</code>.</li>
<li><strong>Usage:</strong> <a href="transformers/./readert_transformer.html">How to use the ReaderT Monad Transformer</a></li>
</ul>
<h3 id="-statets-f-a-monad-transformer"><a class="header" href="#-statets-f-a-monad-transformer">. <code>StateT&lt;S, F, A&gt;</code> (Monad Transformer)</a></h3>
<ul>
<li><strong>Definition:</strong> A monad transformer (<a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt//state_t/StateT.java"><code>StateT</code></a>) that adds stateful computation (type <code>S</code>) to an underlying monad <code>F</code>. It represents a function <code>S -&gt; Kind&lt;F, StateTuple&lt;S, A&gt;&gt;</code>.</li>
<li><strong>Kind Interface:</strong><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt//state_t/StateTKind.java"><code>StateTKind&lt;S, F, A&gt;</code></a></li>
<li><strong>Witness Type <code>G</code>:</strong><code>StateTKind.Witness&lt;S, F&gt;</code> (where <code>S</code> for state and <code>F</code> for the underlying monad witness are fixed for a given type class instance; <code>A</code> is the value type parameter)</li>
<li><strong>Helper:</strong><code>StateTKindHelper</code> (<code>narrow</code>, <code>wrap</code>, <code>runStateT</code>, <code>evalStateT</code>, <code>execStateT</code>, <code>lift</code>). Instances are created via <code>StateT.create()</code>, <code>StateTMonad.of()</code>, or <code>StateTKind.lift()</code>.</li>
<li><strong>Type Class Instances:</strong>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-core/src/main/java/org/higherkindedj/hkt//state_t/StateTMonad.java"><code>StateTMonad&lt;S, F&gt;</code></a> (<code>Monad&lt;StateTKind.Witness&lt;S, F&gt;&gt;</code>)</li>
</ul>
</li>
<li><strong>Notes:</strong> Allows combining stateful logic with other monadic effects from <code>F</code>. Requires a <code>Monad&lt;F&gt;</code> instance for the underlying monad. The <code>runStateT(initialState)</code> method executes the computation, returning <code>Kind&lt;F, StateTuple&lt;S, A&gt;&gt;</code>.</li>
<li><strong>Usage:</strong><a href="transformers/./statet_transformer.html">How to use the StateT Monad Transformer</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="the-eithert-transformer"><a class="header" href="#the-eithert-transformer">The EitherT Transformer:</a></h1>
<h2 id="combining-monadic-effects"><a class="header" href="#combining-monadic-effects"><em>Combining Monadic Effects</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="transformers/eithert_transformer.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to combine async operations (CompletableFuture) with typed error handling (Either)</li>
<li>Building workflows that can fail with specific domain errors while remaining async</li>
<li>Using <code>fromKind</code>, <code>fromEither</code>, and <code>liftF</code> to construct EitherT values</li>
<li>Real-world order processing with validation, inventory checks, and payment processing</li>
<li>Why EitherT eliminates "callback hell" in complex async workflows</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="transformers/eithert_transformer.html#admonition-see-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/either_t/EitherTExample.java">EitherTExample.java</a></p>
</div>
</div>
<h2 id="eithert-monad-transformer"><a class="header" href="#eithert-monad-transformer"><code>EitherT</code> Monad Transformer.</a></h2>
<p><img src="transformers/../images/puml/eithert_transformer.svg" alt="eithert_transformer.svg" /></p>
<h2 id="eithertf-l-r-combining-any-monad-f-with-eitherl-r"><a class="header" href="#eithertf-l-r-combining-any-monad-f-with-eitherl-r"><code>EitherT&lt;F, L, R&gt;</code>: Combining any Monad <code>F</code> with <code>Either&lt;L, R&gt;</code></a></h2>
<p>The <code>EitherT</code> monad transformer allows you to combine the error-handling capabilities of <code>Either&lt;L, R&gt;</code> with another outer monad <code>F</code>. It transforms a computation that results in <code>Kind&lt;F, Either&lt;L, R&gt;&gt;</code> into a single monadic structure that can be easily composed. This is particularly useful when dealing with operations that can fail (represented by <code>Left&lt;L&gt;</code>) within an effectful context <code>F</code> (like asynchronous operations using <code>CompletableFutureKind</code> or computations involving state with <code>StateKind</code>).</p>
<ul>
<li><strong><code>F</code></strong>: The witness type of the <strong>outer monad</strong> (e.g., <code>CompletableFutureKind.Witness</code>, <code>OptionalKind.Witness</code>). This monad handles the primary effect (e.g., asynchronicity, optionality).</li>
<li><strong><code>L</code></strong>: The <strong>Left type</strong> of the inner <code>Either</code>. This typically represents the <em>error</em> type for the computation or alternative result.</li>
<li><strong><code>R</code></strong>: The <strong>Right type</strong> of the inner <code>Either</code>. This typically represents the <em>success</em> value type.</li>
</ul>
<pre><code class="language-java">public record EitherT&lt;F, L, R&gt;(@NonNull Kind&lt;F, Either&lt;L, R&gt;&gt; value) { 
  /* ... static factories ... */ }
</code></pre>
<p>It holds a value of type <code>Kind&lt;F, Either&lt;L, R&gt;&gt;</code>. The real power comes from its associated type class instance, <code>EitherTMonad</code>.</p>
<p>Essentially, <code>EitherT&lt;F, L, R&gt;</code> wraps a value of type <code>Kind&lt;F, Either&lt;L, R&gt;&gt;</code>. It represents a computation within the context <code>F</code> that will eventually yield an <code>Either&lt;L, R&gt;</code>.</p>
<p>The primary goal of <code>EitherT</code> is to provide a unified <code>Monad</code> interface (specifically <code>MonadError</code> for the <code>L</code> type) for this nested structure, hiding the complexity of manually handling both the outer <code>F</code> context and the inner <code>Either</code> context.</p>
<h2 id="eithertkindf-l-r-the-witness-type"><a class="header" href="#eithertkindf-l-r-the-witness-type"><code>EitherTKind&lt;F, L, R&gt;</code>: The Witness Type</a></h2>
<p>Just like other types in the Higher-Kinded-J, <code>EitherT</code> needs a corresponding <code>Kind</code> interface to act as its witness type in generic functions. This is <code>EitherTKind&lt;F, L, R&gt;</code>.</p>
<ul>
<li>It extends <code>Kind&lt;G, R&gt;</code> where <code>G</code> (the witness for the combined monad) is <code>EitherTKind.Witness&lt;F, L&gt;</code>.</li>
<li><code>F</code> and <code>L</code> are fixed for a specific <code>EitherT</code> context, while <code>R</code> is the variable type parameter <code>A</code> in <code>Kind&lt;G, A&gt;</code>.</li>
</ul>
<p>You'll primarily interact with this type when providing type signatures or receiving results from <code>EitherTMonad</code> methods.</p>
<h2 id="eithertkindhelper"><a class="header" href="#eithertkindhelper"><code>EitherTKindHelper</code></a></h2>
<ul>
<li>Provides widen and narrow methods to safely convert between the concrete <code>EitherT&lt;F, L, R&gt;</code> and its Kind representation (<code>Kind&lt;EitherTKind&lt;F, L, ?&gt;, R&gt;</code>).</li>
</ul>
<h2 id="eithertmonadf-l-operating-on-eithert"><a class="header" href="#eithertmonadf-l-operating-on-eithert"><code>EitherTMonad&lt;F, L&gt;</code>: Operating on <code>EitherT</code></a></h2>
<ul>
<li>The EitherTMonad class implements <code>MonadError&lt;EitherTKind.Witness&lt;F, L&gt;, L&gt;</code>.</li>
</ul>
<ul>
<li>It requires a Monad<F> instance for the outer monad F to be provided during construction. This outer monad instance is used internally to handle the effects of <code>F</code>.</li>
<li>It uses <code>EITHER_T.widen</code> and <code>EITHER_T.narrow</code> internally to manage the conversion between the <code>Kind</code> and the concrete <code>EitherT</code>.</li>
<li>The error type E for MonadError is fixed to L, the 'Left' type of the inner Either. Error handling operations like <code>raiseError(L l)</code> will create an <code>EitherT</code> representing <code>F&lt;Left(l)&gt;</code>, and <code>handleErrorWith</code> allows recovering from such Left states.</li>
</ul>
<pre><code class="language-java">// Example: F = CompletableFutureKind.Witness, L = DomainError
// 1. Get the MonadError instance for the outer monad F
MonadError&lt;CompletableFutureKind.Witness, Throwable&gt; futureMonad = CompletableFutureMonad.INSTANCE;

// 2. Create the EitherTMonad, providing the outer monad instance
//    This EitherTMonad handles DomainError for the inner Either.
MonadError&lt;EitherTKind.Witness&lt;CompletableFutureKind.Witness, DomainError&gt;, DomainError&gt; eitherTMonad =
    new EitherTMonad&lt;&gt;(futureMonad);

// Now 'eitherTMonad' can be used to operate on Kind&lt;EitherTKind.Witness&lt;CompletableFutureKind.Witness, DomainError&gt;, A&gt; values.
</code></pre>
<div id="admonition-key-operations-with-_eithertmonad_" class="admonition admonish-info" role="note" aria-labelledby="admonition-key-operations-with-_eithertmonad_-title">
<div class="admonition-title">
<div id="admonition-key-operations-with-_eithertmonad_-title">
<p>Key Operations with <em>EitherTMonad</em>:</p>
</div>
<a class="admonition-anchor-link" href="transformers/eithert_transformer.html#admonition-key-operations-with-_eithertmonad_"></a>
</div>
<div>
<ul>
<li><strong><code>eitherTMonad.of(value)</code>:</strong> Lifts a pure value <code>A</code> into the <code>EitherT</code> context. Result: <code>F&lt;Right(A)&gt;</code>.</li>
<li><strong><code>eitherTMonad.map(f, eitherTKind)</code>:</strong> Applies function <code>A -&gt; B</code> to the <code>Right</code> value inside the nested structure, preserving both <code>F</code> and <code>Either</code> contexts (if Right). Result: <code>F&lt;Either&lt;L, B&gt;&gt;</code>.</li>
<li><strong><code>eitherTMonad.flatMap(f, eitherTKind)</code>:</strong> The core sequencing operation. Takes a function <code>A -&gt; Kind&lt;EitherTKind.Witness&lt;F, L&gt;, B&gt;</code> (i.e., <code>A -&gt; EitherT&lt;F, L, B&gt;</code>). It unwraps the input <code>EitherT</code>, handles the <code>F</code> context, checks the inner <code>Either</code>:
<ul>
<li>If <code>Left(l)</code>, it propagates <code>F&lt;Left(l)&gt;</code>.</li>
<li>If <code>Right(a)</code>, it applies <code>f(a)</code> to get the next <code>EitherT&lt;F, L, B&gt;</code>, and extracts its inner <code>Kind&lt;F, Either&lt;L, B&gt;&gt;</code>, effectively chaining the <code>F</code> contexts and the <code>Either</code> logic.</li>
</ul>
</li>
<li><strong><code>eitherTMonad.raiseError(errorL)</code>:</strong> Creates an <code>EitherT</code> representing a failure in the inner <code>Either</code>. Result: <code>F&lt;Left(L)&gt;</code>.</li>
<li><strong><code>eitherTMonad.handleErrorWith(eitherTKind, handler)</code>:</strong> Handles a failure <code>L</code> from the <em>inner</em> <code>Either</code>. Takes a handler <code>L -&gt; Kind&lt;EitherTKind.Witness&lt;F, L&gt;, A&gt;</code>. It unwraps the input <code>EitherT</code>, checks the inner <code>Either</code>:
<ul>
<li>If <code>Right(a)</code>, propagates <code>F&lt;Right(a)&gt;</code>.</li>
<li>If <code>Left(l)</code>, applies <code>handler(l)</code> to get a recovery <code>EitherT&lt;F, L, A&gt;</code>, and extracts its inner <code>Kind&lt;F, Either&lt;L, A&gt;&gt;</code>.</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="admonition-creating-_eithert_-instances" class="admonition admonish-note" role="note" aria-labelledby="admonition-creating-_eithert_-instances-title">
<div class="admonition-title">
<div id="admonition-creating-_eithert_-instances-title">
<p>Creating <em>EitherT</em> Instances</p>
</div>
<a class="admonition-anchor-link" href="transformers/eithert_transformer.html#admonition-creating-_eithert_-instances"></a>
</div>
<div>
<p>You typically create <code>EitherT</code> instances using its static factory methods, providing the necessary outer <code>Monad&lt;F&gt;</code> instance:</p>
<pre><code class="language-java">// Assume:
Monad&lt;OptionalKind.Witness&gt; optMonad = OptionalMonad.INSTANCE; // Outer Monad F=Optional
String errorL = "FAILED";
String successR = "OK";
Integer otherR = 123;

// 1. Lifting a pure 'Right' value: Optional&lt;Right(R)&gt;
EitherT&lt;OptionalKind.Witness, String, String&gt; etRight = EitherT.right(optMonad, successR);
// Resulting wrapped value: Optional.of(Either.right("OK"))

// 2. Lifting a pure 'Left' value: Optional&lt;Left(L)&gt;
EitherT&lt;OptionalKind.Witness, String, Integer&gt; etLeft = EitherT.left(optMonad, errorL);
// Resulting wrapped value: Optional.of(Either.left("FAILED"))

// 3. Lifting a plain Either: Optional&lt;Either(input)&gt;
Either&lt;String, String&gt; plainEither = Either.left(errorL);
EitherT&lt;OptionalKind.Witness, String, String&gt; etFromEither = EitherT.fromEither(optMonad, plainEither);
// Resulting wrapped value: Optional.of(Either.left("FAILED"))

// 4. Lifting an outer monad value F&lt;R&gt;: Optional&lt;Right(R)&gt;
Kind&lt;OptionalKind.Witness, Integer&gt; outerOptional = OPTIONAL.widen(Optional.of(otherR));
EitherT&lt;OptionalKind.Witness, String, Integer&gt; etLiftF = EitherT.liftF(optMonad, outerOptional);
// Resulting wrapped value: Optional.of(Either.right(123))

// 5. Wrapping an existing nested Kind: F&lt;Either&lt;L, R&gt;&gt;
Kind&lt;OptionalKind.Witness, Either&lt;String, String&gt;&gt; nestedKind =
    OPTIONAL.widen(Optional.of(Either.right(successR)));
EitherT&lt;OptionalKind.Witness, String, String&gt; etFromKind = EitherT.fromKind(nestedKind);
// Resulting wrapped value: Optional.of(Either.right("OK"))

// Accessing the wrapped value:
Kind&lt;OptionalKind.Witness, Either&lt;String, String&gt;&gt; wrappedValue = etRight.value();
Optional&lt;Either&lt;String, String&gt;&gt; unwrappedOptional = OPTIONAL.narrow(wrappedValue);
// unwrappedOptional is Optional.of(Either.right("OK"))
</code></pre>
</div>
</div>
<hr />
<div id="admonition-async-workflow-with-error-handling" class="admonition admonish-note" role="note" aria-labelledby="admonition-async-workflow-with-error-handling-title">
<div class="admonition-title">
<div id="admonition-async-workflow-with-error-handling-title">
<p>Async Workflow with Error Handling</p>
</div>
<a class="admonition-anchor-link" href="transformers/eithert_transformer.html#admonition-async-workflow-with-error-handling"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/either_t/EitherTExample.java">EitherTExample.java</a></li>
</ul>
<p>The most common use case for <code>EitherT</code> is combining asynchronous operations (<code>CompletableFuture</code>) with domain error handling (<code>Either</code>).  The <code>OrderWorkflowRunner</code> class provides a detailed example.</p>
<p>Here's a simplified conceptual structure based on that example:</p>
<pre><code class="language-java">public class EitherTExample {

  // --- Setup ---

  // Assume DomainError is a sealed interface for specific errors
  // Re-defining a local DomainError to avoid dependency on the full DomainError hierarchy for this isolated example.
  // In a real scenario, you would use the shared DomainError.
  record DomainError(String message) {}
  record ValidatedData(String data) {}
  record ProcessedData(String data) {}

  MonadError&lt;CompletableFutureKind.Witness, Throwable&gt; futureMonad = CompletableFutureMonad.INSTANCE;
  MonadError&lt;EitherTKind.Witness&lt;CompletableFutureKind.Witness, DomainError&gt;, DomainError&gt; eitherTMonad =
          new EitherTMonad&lt;&gt;(futureMonad);

  // --- Workflow Steps (returning Kinds) ---

  // Simulates a sync validation returning Either
  Kind&lt;EitherKind.Witness&lt;DomainError&gt;, ValidatedData&gt; validateSync(String input) {
    System.out.println("Validating synchronously...");
    if (input.isEmpty()) {
      return EITHER.widen(Either.left(new DomainError("Input empty")));
    }
    return EITHER.widen(Either.right(new ValidatedData("Validated:" + input)));
  }

  // Simulates an async processing step returning Future&lt;Either&gt;
  Kind&lt;CompletableFutureKind.Witness, Either&lt;DomainError, ProcessedData&gt;&gt; processAsync(ValidatedData vd) {
    System.out.println("Processing asynchronously for: " + vd.data());
    CompletableFuture&lt;Either&lt;DomainError, ProcessedData&gt;&gt; future =
            CompletableFuture.supplyAsync(() -&gt; {
              try {
                Thread.sleep(50);
              } catch (InterruptedException e) { /* ignore */ }
              if (vd.data().contains("fail")) {
                return Either.left(new DomainError("Processing failed"));
              }
              return Either.right(new ProcessedData("Processed:" + vd.data()));
            });
    return FUTURE.widen(future);
  }

  // Function to run the workflow for given input
  Kind&lt;CompletableFutureKind.Witness, Either&lt;DomainError, ProcessedData&gt;&gt; runWorkflow(String initialInput) {

    // Start with initial data lifted into EitherT
    Kind&lt;EitherTKind.Witness&lt;CompletableFutureKind.Witness, DomainError&gt;, String&gt; initialET = eitherTMonad.of(initialInput);

    // Step 1: Validate (Sync Either lifted into EitherT)
    Kind&lt;EitherTKind.Witness&lt;CompletableFutureKind.Witness, DomainError&gt;, ValidatedData&gt; validatedET =
            eitherTMonad.flatMap(
                    input -&gt; {
                      // Call sync step returning Kind&lt;EitherKind.Witness,...&gt;
                      // Correction 1: Use EitherKind.Witness here
                      Kind&lt;EitherKind.Witness&lt;DomainError&gt;, ValidatedData&gt; validationResult = validateSync(input);
                      // Lift the Either result into EitherT using fromEither
                      return EitherT.fromEither(futureMonad, EITHER.narrow(validationResult));
                    },
                    initialET
            );

    // Step 2: Check Inventory (Asynchronous - returns Future&lt;Either&lt;DomainError, Unit&gt;&gt;) 
    Kind&lt;EitherTKind.Witness&lt;CompletableFutureKind.Witness, DomainError&gt;, WorkflowContext&gt; inventoryET =
        eitherTMonad.flatMap( // Chain from validation result
            ctx -&gt; { // Executed only if validatedET was F&lt;Right(...)&gt;
                // Call async step -&gt; Kind&lt;CompletableFutureKind.Witness, Either&lt;DomainError, Unit&gt;&gt; 
                Kind&lt;CompletableFutureKind.Witness, Either&lt;DomainError, Unit&gt;&gt; inventoryCheckFutureKind =
                    steps.checkInventoryAsync(ctx.validatedOrder().productId(), ctx.validatedOrder().quantity());
    
                // Lift the F&lt;Either&gt; directly into EitherT using fromKind
                Kind&lt;EitherTKind.Witness&lt;CompletableFutureKind.Witness, DomainError&gt;, Unit&gt; inventoryCheckET = 
                    EitherT.fromKind(inventoryCheckFutureKind);
    
                // If inventory check resolves to Right (now Right(Unit.INSTANCE)), update context.
 
                return eitherTMonad.map(unitInstance -&gt; ctx.withInventoryChecked(), inventoryCheckET);
            },
            validatedET // Input is result of validation step
        );

    // Unwrap the final EitherT to get the underlying Future&lt;Either&gt;
    return ((EitherT&lt;CompletableFutureKind.Witness, DomainError, ProcessedData&gt;) processedET).value();
  }

  public void asyncWorkflowErrorHandlingExample(){
    // --- Workflow Definition using EitherT ---

    // Input data
    String inputData = "Data";
    String badInputData = "";
    String processingFailData = "Data-fail";

    // --- Execution ---
    System.out.println("--- Running Good Workflow ---");

    Kind&lt;CompletableFutureKind.Witness, Either&lt;DomainError, ProcessedData&gt;&gt; resultGoodKind = runWorkflow(inputData);
    System.out.println("Good Result: "+FUTURE.join(resultGoodKind));
    // Expected: Right(ProcessedData[data=Processed:Validated:Data])

    System.out.println("\n--- Running Bad Input Workflow ---");

    Kind&lt;CompletableFutureKind.Witness, Either&lt;DomainError, ProcessedData&gt;&gt; resultBadInputKind = runWorkflow(badInputData);
    System.out.println("Bad Input Result: "+ FUTURE.join(resultBadInputKind));
    // Expected: Left(DomainError[message=Input empty])

    System.out.println("\n--- Running Processing Failure Workflow ---");

    Kind&lt;CompletableFutureKind.Witness, Either&lt;DomainError, ProcessedData&gt;&gt; resultProcFailKind = runWorkflow(processingFailData);
    System.out.println("Processing Fail Result: "+FUTURE.join(resultProcFailKind));
    // Expected: Left(DomainError[message=Processing failed])

  }
  public static void main(String[] args){
    EitherTExample example = new EitherTExample();
    example.asyncWorkflowErrorHandlingExample();

  }

}

</code></pre>
<p>This example demonstrates:</p>
<ol>
<li>Instantiating <code>EitherTMonad</code> with the outer <code>CompletableFutureMonad</code>.</li>
<li>Lifting the initial value using <code>eitherTMonad.of</code>.</li>
<li>Using <code>eitherTMonad.flatMap</code> to sequence steps.</li>
<li>Lifting a synchronous <code>Either</code> result into <code>EitherT</code> using <code>EitherT.fromEither</code>.</li>
<li>Lifting an asynchronous <code>Kind&lt;F, Either&lt;L,R&gt;&gt;</code> result using <code>EitherT.fromKind</code>.</li>
<li>Automatic short-circuiting: If validation returns <code>Left</code>, the processing step is skipped.</li>
<li>Unwrapping the final <code>EitherT</code> using <code>.value()</code> to get the <code>Kind&lt;CompletableFutureKind.Witness, Either&lt;DomainError, ProcessedData&gt;&gt;</code> result.</li>
</ol>
</div>
</div>
<div id="admonition-using-_eithertmonad_-for-sequencing-and-error-handling" class="admonition admonish-note" role="note" aria-labelledby="admonition-using-_eithertmonad_-for-sequencing-and-error-handling-title">
<div class="admonition-title">
<div id="admonition-using-_eithertmonad_-for-sequencing-and-error-handling-title">
<p>Using <em>EitherTMonad</em> for Sequencing and Error Handling</p>
</div>
<a class="admonition-anchor-link" href="transformers/eithert_transformer.html#admonition-using-_eithertmonad_-for-sequencing-and-error-handling"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/order/workflow/OrderWorkflowRunner.java">OrderWorkflowRunner.java</a></li>
</ul>
<p>The primary use is chaining operations using <code>flatMap</code> and handling errors using <code>handleErrorWith</code> or related methods. The <code>OrderWorkflowRunner</code> is the best example. Let's break down a key part:</p>
<pre><code class="language-java">// --- From OrderWorkflowRunner.java ---
// Assume setup:
// F = CompletableFutureKind&lt;?&gt;
// L = DomainError
// futureMonad = CompletableFutureMonad.INSTANCE;
// eitherTMonad = new EitherTMonad&lt;&gt;(futureMonad);
// steps = new OrderWorkflowSteps(dependencies); // Contains workflow logic

// Initial Context (lifted)
WorkflowContext initialContext = WorkflowContext.start(orderData);
Kind&lt;EitherTKind.Witness&lt;CompletableFutureKind.Witness, DomainError&gt;, WorkflowContext&gt; initialET =
    eitherTMonad.of(initialContext); // F&lt;Right(initialContext)&gt;

// Step 1: Validate Order (Synchronous - returns Either)
Kind&lt;EitherTKind.Witness&lt;CompletableFutureKind.Witness, DomainError&gt;, WorkflowContext&gt; validatedET =
    eitherTMonad.flatMap( // Use flatMap on EitherTMonad
        ctx -&gt; { // Lambda receives WorkflowContext if initialET was Right
            // Call sync step -&gt; Either&lt;DomainError, ValidatedOrder&gt;
            Either&lt;DomainError, ValidatedOrder&gt; syncResultEither =
                EITHER.narrow(steps.validateOrder(ctx.initialData()));

            // Lift sync Either into EitherT: -&gt; F&lt;Either&lt;DomainError, ValidatedOrder&gt;&gt;
            Kind&lt;EitherTKind.Witness&lt;CompletableFutureKind.Witness, DomainError&gt;, ValidatedOrder&gt;
                validatedOrderET = EitherT.fromEither(futureMonad, syncResultEither);

            // If validation produced Left, map is skipped.
            // If validation produced Right(vo), map updates the context: F&lt;Right(ctx.withValidatedOrder(vo))&gt;
            return eitherTMonad.map(ctx::withValidatedOrder, validatedOrderET);
        },
        initialET // Input to the flatMap
    );

// Step 2: Check Inventory (Asynchronous - returns Future&lt;Either&lt;DomainError, Void&gt;&gt;)
Kind&lt;EitherTKind.Witness&lt;CompletableFutureKind.Witness, DomainError&gt;, WorkflowContext&gt; inventoryET =
    eitherTMonad.flatMap( // Chain from validation result
        ctx -&gt; { // Executed only if validatedET was F&lt;Right(...)&gt;
            // Call async step -&gt; Kind&lt;CompletableFutureKind.Witness, Either&lt;DomainError, Void&gt;&gt;
            Kind&lt;CompletableFutureKind.Witness, Either&lt;DomainError, Void&gt;&gt; inventoryCheckFutureKind =
                steps.checkInventoryAsync(ctx.validatedOrder().productId(), ctx.validatedOrder().quantity());

            // Lift the F&lt;Either&gt; directly into EitherT using fromKind
            Kind&lt;EitherTKind.Witness&lt;CompletableFutureKind.Witness, DomainError&gt;, Void&gt; inventoryCheckET =
                EitherT.fromKind(inventoryCheckFutureKind);

            // If inventory check resolves to Right, update context. If Left, map is skipped.
            return eitherTMonad.map(ignored -&gt; ctx.withInventoryChecked(), inventoryCheckET);
        },
        validatedET // Input is result of validation step
    );

// Step 4: Create Shipment (Asynchronous with Recovery)
Kind&lt;EitherTKind.Witness&lt;CompletableFutureKind.Witness, DomainError&gt;, WorkflowContext&gt; shipmentET =
    eitherTMonad.flatMap( // Chain from previous step
        ctx -&gt; {
            // Call async shipment step -&gt; F&lt;Either&lt;DomainError, ShipmentInfo&gt;&gt;
            Kind&lt;CompletableFutureKind.Witness, Either&lt;DomainError, ShipmentInfo&gt;&gt; shipmentAttemptFutureKind =
                steps.createShipmentAsync(ctx.validatedOrder().orderId(), ctx.validatedOrder().shippingAddress());

            // Lift into EitherT
            Kind&lt;EitherTKind.Witness&lt;CompletableFutureKind.Witness, DomainError&gt;, ShipmentInfo&gt; shipmentAttemptET =
                 EitherT.fromKind(shipmentAttemptFutureKind);

            // *** Error Handling using MonadError ***
            Kind&lt;EitherTKind.Witness&lt;CompletableFutureKind.Witness, DomainError&gt;, ShipmentInfo&gt; recoveredShipmentET =
                eitherTMonad.handleErrorWith( // Operates on the EitherT value
                    shipmentAttemptET,
                    error -&gt; { // Lambda receives DomainError if shipmentAttemptET resolves to Left(error)
                        if (error instanceof DomainError.ShippingError se &amp;&amp; "Temporary Glitch".equals(se.reason())) {
                           // Specific recoverable error: Return a *successful* EitherT
                           return eitherTMonad.of(new ShipmentInfo("DEFAULT_SHIPPING_USED"));
                        } else {
                           // Non-recoverable error: Re-raise it within EitherT
                           return eitherTMonad.raiseError(error); // Returns F&lt;Left(error)&gt;
                        }
                    });

            // Map the potentially recovered result to update context
            return eitherTMonad.map(ctx::withShipmentInfo, recoveredShipmentET);
        },
        paymentET // Assuming paymentET was the previous step
    );

// ... rest of workflow ...

// Final unwrap
// EitherT&lt;CompletableFutureKind.Witness, DomainError, FinalResult&gt; finalET = ...;
// Kind&lt;CompletableFutureKind.Witness, Either&lt;DomainError, FinalResult&gt;&gt; finalResultKind = finalET.value();
</code></pre>
<p>This demonstrates how <code>EitherTMonad.flatMap</code> sequences the steps, while <code>EitherT.fromEither</code>, <code>EitherT.fromKind</code>, and <code>eitherTMonad.of/raiseError/handleErrorWith</code> manage the lifting and error handling within the combined <code>Future&lt;Either&lt;...&gt;&gt;</code> context.</p>
</div>
</div>
<div id="admonition-key-points" class="admonition admonish-tip" role="note" aria-labelledby="admonition-key-points-title">
<div class="admonition-title">
<div id="admonition-key-points-title">
<p>Key Points:</p>
</div>
<a class="admonition-anchor-link" href="transformers/eithert_transformer.html#admonition-key-points"></a>
</div>
<div>
<p>The <code>Higher-Kinded-J</code> library simplifies the implementation and usage of concepts like monad transformers (e.g., <code>EitherT</code>) in Java precisely <em>because</em> it simulates Higher-Kinded Types (HKTs). Here's how:</p>
<ol>
<li>
<p><strong>The Core Problem Without HKTs:</strong> Java's type system doesn't allow you to directly parameterize a type by a <em>type constructor</em> like <code>List</code>, <code>Optional</code>, or <code>CompletableFuture</code>. You can write <code>List&lt;String&gt;</code>, but you cannot easily write a generic class <code>Transformer&lt;F, A&gt;</code> where <code>F</code> itself represents <em>any</em> container type (like <code>List&lt;_&gt;</code>) and <code>A</code> is the value type.
This limitation makes defining <em>general</em> monad transformers rather difficult. A monad transformer like <code>EitherT</code> needs to combine an <em>arbitrary</em> outer monad <code>F</code> with the inner <code>Either</code> monad. Without HKTs, you would typically have to:</p>
<ul>
<li>Create separate, specific transformers for each outer monad (e.g., <code>EitherTOptional</code>, <code>EitherTFuture</code>, <code>EitherTIO</code>). This leads to significant code duplication.</li>
<li>Resort to complex, often unsafe casting or reflection.</li>
<li>Write extremely verbose code manually handling the nested structure for every combination.</li>
</ul>
</li>
<li>
<p><strong>How this helps with simulating HKTs):</strong> <code>Higher-Kinded-J</code> introduces the <code>Kind&lt;F, A&gt;</code> interface. This interface, along with specific "witness types" (like <code>OptionalKind.Witness</code>, <code>CompletableFutureKind.Witness</code>, <code>EitherKind.Witness&lt;L&gt;</code>), simulates the concept of <code>F&lt;A&gt;</code>. It allows you to pass <code>F</code> (the type constructor, represented by its witness type) as a type parameter, even though Java doesn't support it natively.</p>
</li>
<li>
<p><strong>Simplifying Transformer Definition (<code>EitherT&lt;F, L, R&gt;</code>):</strong> Because we can now simulate <code>F&lt;A&gt;</code> using <code>Kind&lt;F, A&gt;</code>, we can define the <code>EitherT</code> data structure generically:</p>
<pre><code class="language-java">// Simplified from EitherT.java
public record EitherT&lt;F, L, R&gt;(@NonNull Kind&lt;F, Either&lt;L, R&gt;&gt; value)
    implements EitherTKind&lt;F, L, R&gt; { /* ... */ }
</code></pre>
<p>Here, <code>F</code> is a type parameter representing the <em>witness type</em> of the outer monad. <code>EitherT</code> doesn't need to know <em>which</em> specific monad <code>F</code> is at compile time; it just knows it holds a <code>Kind&lt;F, ...&gt;</code>. This makes the <code>EitherT</code> structure itself general-purpose.</p>
</li>
<li>
<p><strong>Simplifying Transformer Operations (<code>EitherTMonad&lt;F, L&gt;</code>):</strong> The real benefit comes with the type class instance <code>EitherTMonad</code>. This class implements <code>MonadError&lt;EitherTKind.Witness&lt;F, L&gt;, L&gt;</code>, providing the standard monadic operations (<code>map</code>, <code>flatMap</code>, <code>of</code>, <code>ap</code>, <code>raiseError</code>, <code>handleErrorWith</code>) for the combined <code>EitherT</code> structure.</p>
<p>Critically, <code>EitherTMonad</code> takes the <code>Monad&lt;F&gt;</code> instance for the <em>specific outer monad</em><code>F</code> as a constructor argument:</p>
<pre><code class="language-java">// From EitherTMonad.java
public class EitherTMonad&lt;F, L&gt; implements MonadError&lt;EitherTKind.Witness&lt;F, L&gt;, L&gt; {
    private final @NonNull Monad&lt;F&gt; outerMonad; // &lt;-- Holds the specific outer monad instance

    public EitherTMonad(@NonNull Monad&lt;F&gt; outerMonad) {
        this.outerMonad = Objects.requireNonNull(outerMonad, "Outer Monad instance cannot be null");
    }
    // ... implementation of map, flatMap etc. ...
}
</code></pre>
<p>Inside its <code>map</code>, <code>flatMap</code>, etc., implementations, <code>EitherTMonad</code> uses the provided <code>outerMonad</code> instance (via its <code>map</code> and <code>flatMap</code> methods) to handle the outer context <code>F</code>, while also managing the inner <code>Either</code> logic (checking for <code>Left</code>/<code>Right</code>, applying functions, propagating <code>Left</code>).
<strong>This is where the Higher-Kinded-J drastically simplifies things:</strong></p>
</li>
</ol>
<ul>
<li>You only need <strong>one</strong><code>EitherTMonad</code> implementation.</li>
<li>It works <strong>generically</strong> for any outer monad <code>F</code><em>for which you have a <code>Monad&lt;F&gt;</code> instance</em> (like <code>OptionalMonad</code>, <code>CompletableFutureMonad</code>, <code>IOMonad</code>, etc.).</li>
<li>The complex logic of combining the two monads' behaviours (e.g., how <code>flatMap</code> should work on <code>F&lt;Either&lt;L, R&gt;&gt;</code>) is encapsulated <em>within</em><code>EitherTMonad</code>, leveraging the simulated HKTs and the provided <code>outerMonad</code> instance.</li>
<li>As a user, you just instantiate <code>EitherTMonad</code> with the appropriate outer monad instance and then use its standard methods (<code>map</code>, <code>flatMap</code>, etc.) on your <code>EitherT</code> values, as seen in the <code>OrderWorkflowRunner</code> example. You don't need to manually handle the nesting.</li>
</ul>
<p>In essence, the HKT simulation provided by <code>Higher-Kinded-J</code> allows defining the structure (<code>EitherT</code>) and the operations (<code>EitherTMonad</code>) generically over the outer monad <code>F</code>, overcoming Java's native limitations and making monad transformers feasible and much less boilerplate-heavy than they would otherwise be.</p>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="the-optionalt-transformer"><a class="header" href="#the-optionalt-transformer">The OptionalT Transformer:</a></h1>
<h2 id="combining-monadic-effects-with-javautiloptional"><a class="header" href="#combining-monadic-effects-with-javautiloptional"><em>Combining Monadic Effects with <code>java.util.Optional</code></em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="transformers/optionalt_transformer.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to integrate Java's Optional with other monadic contexts</li>
<li>Building async workflows where each step might return empty results</li>
<li>Using <code>some</code>, <code>none</code>, and <code>fromOptional</code> to construct OptionalT values</li>
<li>Creating multi-step data retrieval with graceful failure handling</li>
<li>Providing default values when optional chains result in empty</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="transformers/optionalt_transformer.html#admonition-see-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/optional_t/OptionalTExample.java">OptionalTExample.java</a></p>
</div>
</div>
<h2 id="optionalt-monad-transformer"><a class="header" href="#optionalt-monad-transformer"><code>OptionalT</code> Monad Transformer</a></h2>
<p>The <code>OptionalT</code> monad transformer (short for Optional Transformer) is designed to combine the semantics of <code>java.util.Optional&lt;A&gt;</code> (representing a value that might be present or absent) with an arbitrary outer monad <code>F</code>. It effectively allows you to work with computations of type <code>Kind&lt;F, Optional&lt;A&gt;&gt;</code> as a single, unified monadic structure.</p>
<p>This is particularly useful when operations within an effectful context <code>F</code> (such as asynchronicity with <code>CompletableFutureKind</code>, non-determinism with <code>ListKind</code>, or dependency injection with <code>ReaderKind</code>) can also result in an absence of a value (represented by <code>Optional.empty()</code>).</p>
<h2 id="structure-8"><a class="header" href="#structure-8">Structure</a></h2>
<p><img src="transformers/../images/puml/optional_t_transformer.svg" alt="optional_t_transformer.svg" /></p>
<h2 id="optionaltf-a-the-core-data-type"><a class="header" href="#optionaltf-a-the-core-data-type"><code>OptionalT&lt;F, A&gt;</code>: The Core Data Type</a></h2>
<p><code>OptionalT&lt;F, A&gt;</code> is a record that wraps a computation yielding <code>Kind&lt;F, Optional&lt;A&gt;&gt;</code>.</p>
<pre><code class="language-java">public record OptionalT&lt;F, A&gt;(@NonNull Kind&lt;F, Optional&lt;A&gt;&gt; value)
    implements OptionalTKind&lt;F, A&gt; {
  // ... static factory methods ...
}
</code></pre>
<ul>
<li><strong><code>F</code></strong>: The witness type of the <strong>outer monad</strong> (e.g., <code>CompletableFutureKind.Witness</code>, <code>ListKind.Witness</code>). This monad encapsulates the primary effect of the computation.</li>
<li><strong><code>A</code></strong>: The type of the value that might be present within the **<code>Optional</code>, which itself is within the context of <code>F</code>.</li>
<li><strong><code>value</code></strong>: The core wrapped value of type **<code>Kind&lt;F, Optional&lt;A&gt;&gt;</code>. This represents an effectful computation <code>F</code> that, upon completion, yields a <code>java.util.Optional&lt;A&gt;</code>.</li>
</ul>
<h2 id="optionaltkindf-a-the-witness-type"><a class="header" href="#optionaltkindf-a-the-witness-type"><code>OptionalTKind&lt;F, A&gt;</code>: The Witness Type</a></h2>
<p><strong>For integration with Higher-Kinded-J's generic programming model,</strong> <code>OptionalTKind&lt;F, A&gt;</code> acts as the higher-kinded type witness.</p>
<ul>
<li><strong>It extends</strong> <code>Kind&lt;G, A&gt;</code>, where <code>G</code> (the witness for the combined <code>OptionalT</code> monad) is <code>OptionalTKind.Witness&lt;F&gt;</code>.</li>
<li><strong>The outer monad</strong> <code>F</code> is fixed for a particular <code>OptionalT</code> context, while <code>A</code> is the variable type parameter representing the value inside the <code>Optional</code>.</li>
</ul>
<pre><code class="language-java">public interface OptionalTKind&lt;F, A&gt; extends Kind&lt;OptionalTKind.Witness&lt;F&gt;, A&gt; {
  // Witness type G = OptionalTKind.Witness&lt;F&gt;
  // Value type A = A (from Optional&lt;A&gt;)
}
</code></pre>
<h2 id="optionaltkindhelper-utility-for-wrapping-and-unwrapping"><a class="header" href="#optionaltkindhelper-utility-for-wrapping-and-unwrapping"><code>OptionalTKindHelper</code>: Utility for Wrapping and Unwrapping</a></h2>
<p><code>OptionalTKindHelper</code> is a final utility class providing static methods to seamlessly convert between the concrete <code>OptionalT&lt;F, A&gt;</code> type and its <code>Kind</code> representation (<code>Kind&lt;OptionalTKind.Witness&lt;F&gt;, A&gt;</code>).</p>
<pre><code class="language-java">
public enum OptionalTKindHelper {
   
  OPTIONAL_T;
  
    // Unwraps Kind&lt;OptionalTKind.Witness&lt;F&gt;, A&gt; to OptionalT&lt;F, A&gt;
    public  &lt;F, A&gt; @NonNull OptionalT&lt;F, A&gt; narrow(
        @Nullable Kind&lt;OptionalTKind.Witness&lt;F&gt;, A&gt; kind);

    // Wraps OptionalT&lt;F, A&gt; into OptionalTKind&lt;F, A&gt;
    public  &lt;F, A&gt; @NonNull OptionalTKind&lt;F, A&gt; widen(
        @NonNull OptionalT&lt;F, A&gt; optionalT);
}
</code></pre>
<p><strong>Internally, it uses a private record</strong> <code>OptionalTHolder</code> to implement <code>OptionalTKind</code>, but this is an implementation detail.</p>
<h2 id="optionaltmonadf-operating-on-optionalt"><a class="header" href="#optionaltmonadf-operating-on-optionalt"><code>OptionalTMonad&lt;F&gt;</code>: Operating on <code>OptionalT</code></a></h2>
<p><strong>The</strong> <code>OptionalTMonad&lt;F&gt;</code> class implements <code>MonadError&lt;OptionalTKind.Witness&lt;F&gt;, Unit&gt;</code>. This provides the standard monadic operations (<code>of</code>, <code>map</code>, <code>flatMap</code>, <code>ap</code>) and error handling capabilities for the <code>OptionalT</code> structure. The error type <code>E</code> for <code>MonadError</code> is fixed to <code>Unit</code> signifying that an "error" in this context is the <code>Optional.empty()</code> state within <code>F&lt;Optional&lt;A&gt;&gt;</code>.</p>
<ul>
<li><strong>It requires a</strong> <code>Monad&lt;F&gt;</code> instance for the outer monad <code>F</code>, which must be supplied during construction. This <code>outerMonad</code> is used to manage and sequence the effects of <code>F</code>.</li>
</ul>
<pre><code class="language-java">// Example: F = CompletableFutureKind.Witness
// 1. Get the Monad instance for the outer monad F
Monad&lt;CompletableFutureKind.Witness&gt; futureMonad = CompletableFutureMonad.INSTANCE;

// 2. Create the OptionalTMonad
OptionalTMonad&lt;CompletableFutureKind.Witness&gt; optionalTFutureMonad =
    new OptionalTMonad&lt;&gt;(futureMonad);

// Now 'optionalTFutureMonad' can be used to operate on
// Kind&lt;OptionalTKind.Witness&lt;CompletableFutureKind.Witness&gt;, A&gt; values.

</code></pre>
<div id="admonition-key-operations-with-_optionaltmonad_" class="admonition admonish-info" role="note" aria-labelledby="admonition-key-operations-with-_optionaltmonad_-title">
<div class="admonition-title">
<div id="admonition-key-operations-with-_optionaltmonad_-title">
<p>Key Operations with <em>OptionalTMonad</em>:</p>
</div>
<a class="admonition-anchor-link" href="transformers/optionalt_transformer.html#admonition-key-operations-with-_optionaltmonad_"></a>
</div>
<div>
<ul>
<li><strong><code>optionalTMonad.of(value)</code></strong>: Lifts a (nullable) value <code>A</code> into the <code>OptionalT</code> context. The underlying operation is <code>r -&gt; outerMonad.of(Optional.ofNullable(value))</code>. Result: <code>OptionalT(F&lt;Optional&lt;A&gt;&gt;)</code>.</li>
<li><strong><code>optionalTMonad.map(func, optionalTKind)</code></strong>: Applies a function <code>A -&gt; B</code> to the value <code>A</code> if it's present within the <code>Optional</code> and the <code>F</code> context is successful. The transformation occurs within <code>outerMonad.map</code>. If <code>func</code> returns <code>null</code>, the result becomes <code>F&lt;Optional.empty()&gt;</code>. Result: <code>OptionalT(F&lt;Optional&lt;B&gt;&gt;)</code>.</li>
<li><strong><code>optionalTMonad.flatMap(func, optionalTKind)</code></strong>: The primary sequencing operation. It takes a function <code>A -&gt; Kind&lt;OptionalTKind.Witness&lt;F&gt;, B&gt;</code> (which effectively means <code>A -&gt; OptionalT&lt;F, B&gt;</code>). It runs the initial <code>OptionalT</code> to get <code>Kind&lt;F, Optional&lt;A&gt;&gt;</code>. Using <code>outerMonad.flatMap</code>, if this yields an <code>Optional.of(a)</code>, <code>func</code> is applied to <code>a</code> to get the next <code>OptionalT&lt;F, B&gt;</code>. The <code>value</code> of this new <code>OptionalT</code> (<code>Kind&lt;F, Optional&lt;B&gt;&gt;</code>) becomes the result. If at any point an <code>Optional.empty()</code> is encountered within <code>F</code>, it short-circuits and propagates <code>F&lt;Optional.empty()&gt;</code>. Result: <code>OptionalT(F&lt;Optional&lt;B&gt;&gt;)</code>.</li>
<li><strong><code>optionalTMonad.raiseError(error)</code></strong> (where error is <code>Unit</code>): Creates an <code>OptionalT</code> representing absence. Result: <code>OptionalT(F&lt;Optional.empty()&gt;)</code>.</li>
<li><strong><code>optionalTMonad.handleErrorWith(optionalTKind, handler)</code></strong>: Handles an empty state from the <em>inner</em> <code>Optional</code>. Takes a handler <code>Function&lt;Unit, Kind&lt;OptionalTKind.Witness&lt;F&gt;, A&gt;&gt;</code>.</li>
</ul>
</div>
</div>
<hr />
<div id="admonition-creating-_optionalt_-instances" class="admonition admonish-note" role="note" aria-labelledby="admonition-creating-_optionalt_-instances-title">
<div class="admonition-title">
<div id="admonition-creating-_optionalt_-instances-title">
<p>Creating <em>OptionalT</em> Instances</p>
</div>
<a class="admonition-anchor-link" href="transformers/optionalt_transformer.html#admonition-creating-_optionalt_-instances"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/optional_t/OptionalTExample.java">OptionalTExample.java</a></li>
</ul>
<p><code>OptionalT</code> instances are typically created using its static factory methods. These often require a <code>Monad&lt;F&gt;</code> instance for the outer monad.</p>
<pre><code class="language-java">public void createExample() {
    // --- Setup ---
    // Outer Monad F = CompletableFutureKind.Witness
    Monad&lt;CompletableFutureKind.Witness&gt; futureMonad = CompletableFutureMonad.INSTANCE;
    String presentValue = "Data";
    Integer numericValue = 123;

    // 1. `OptionalT.fromKind(Kind&lt;F, Optional&lt;A&gt;&gt; value)`
    //    Wraps an existing F&lt;Optional&lt;A&gt;&gt;.
    Kind&lt;CompletableFutureKind.Witness, Optional&lt;String&gt;&gt; fOptional =
        FUTURE.widen(CompletableFuture.completedFuture(Optional.of(presentValue)));
    OptionalT&lt;CompletableFutureKind.Witness, String&gt; ot1 = OptionalT.fromKind(fOptional);
    // Value: CompletableFuture&lt;Optional.of("Data")&gt;

    // 2. `OptionalT.some(Monad&lt;F&gt; monad, A a)`
    //    Creates an OptionalT with a present value, F&lt;Optional.of(a)&gt;.
    OptionalT&lt;CompletableFutureKind.Witness, String&gt; ot2 = OptionalT.some(futureMonad, presentValue);
    // Value: CompletableFuture&lt;Optional.of("Data")&gt;

    // 3. `OptionalT.none(Monad&lt;F&gt; monad)`
    //    Creates an OptionalT representing an absent value, F&lt;Optional.empty()&gt;.
    OptionalT&lt;CompletableFutureKind.Witness, String&gt; ot3 = OptionalT.none(futureMonad);
    // Value: CompletableFuture&lt;Optional.empty()&gt;

    // 4. `OptionalT.fromOptional(Monad&lt;F&gt; monad, Optional&lt;A&gt; optional)`
    //    Lifts a plain java.util.Optional into OptionalT, F&lt;Optional&lt;A&gt;&gt;.
    Optional&lt;Integer&gt; optInt = Optional.of(numericValue);
    OptionalT&lt;CompletableFutureKind.Witness, Integer&gt; ot4 = OptionalT.fromOptional(futureMonad, optInt);
    // Value: CompletableFuture&lt;Optional.of(123)&gt;


    Optional&lt;Integer&gt; optEmpty = Optional.empty();
    OptionalT&lt;CompletableFutureKind.Witness, Integer&gt; ot4Empty = OptionalT.fromOptional(futureMonad, optEmpty);
    // Value: CompletableFuture&lt;Optional.empty()&gt;


    // 5. `OptionalT.liftF(Monad&lt;F&gt; monad, Kind&lt;F, A&gt; fa)`
    //    Lifts an F&lt;A&gt; into OptionalT. If A is null, it becomes F&lt;Optional.empty()&gt;, otherwise F&lt;Optional.of(A)&gt;.
    Kind&lt;CompletableFutureKind.Witness, String&gt; fValue =
        FUTURE.widen(CompletableFuture.completedFuture(presentValue));
    OptionalT&lt;CompletableFutureKind.Witness, String&gt; ot5 = OptionalT.liftF(futureMonad, fValue);
    // Value: CompletableFuture&lt;Optional.of("Data   ")&gt;

    Kind&lt;CompletableFutureKind.Witness, String&gt; fNullValue =
        FUTURE.widen(CompletableFuture.completedFuture(null)); // F&lt;null&gt;
    OptionalT&lt;CompletableFutureKind.Witness, String&gt; ot5Null = OptionalT.liftF(futureMonad, fNullValue);
    // Value: CompletableFuture&lt;Optional.empty()&gt; (because the value inside F was null)


    // Accessing the wrapped value:
    Kind&lt;CompletableFutureKind.Witness, Optional&lt;String&gt;&gt; wrappedFVO = ot1.value();
    CompletableFuture&lt;Optional&lt;String&gt;&gt; futureOptional = FUTURE.narrow(wrappedFVO);
    futureOptional.thenAccept(optStr -&gt; System.out.println("ot1 result: " + optStr));
  }
</code></pre>
</div>
</div>
<div id="admonition-asynchronous-multi-step-data-retrieval" class="admonition admonish-note" role="note" aria-labelledby="admonition-asynchronous-multi-step-data-retrieval-title">
<div class="admonition-title">
<div id="admonition-asynchronous-multi-step-data-retrieval-title">
<p>Asynchronous Multi-Step Data Retrieval</p>
</div>
<a class="admonition-anchor-link" href="transformers/optionalt_transformer.html#admonition-asynchronous-multi-step-data-retrieval"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/optional_t/OptionalTExample.java">OptionalTExample.java</a></li>
</ul>
<p>Consider a scenario where you need to fetch a user, then their profile, and finally their preferences. Each step is asynchronous (<code>CompletableFuture</code>) and might return an empty <code>Optional</code> if the data is not found. <code>OptionalT</code> helps manage this composition cleanly.</p>
<pre><code class="language-java">public static class OptionalTAsyncExample {

    // --- Monad Setup ---
    static final Monad&lt;CompletableFutureKind.Witness&gt; futureMonad = CompletableFutureMonad.INSTANCE;
    static final OptionalTMonad&lt;CompletableFutureKind.Witness&gt; optionalTFutureMonad =
        new OptionalTMonad&lt;&gt;(futureMonad);
    static final ExecutorService executor = Executors.newFixedThreadPool(2);

    public static Kind&lt;CompletableFutureKind.Witness, Optional&lt;User&gt;&gt; fetchUserAsync(String userId) {
      return FUTURE.widen(CompletableFuture.supplyAsync(() -&gt; {
        System.out.println("Fetching user " + userId + " on " + Thread.currentThread().getName());
        try {
          TimeUnit.MILLISECONDS.sleep(50);
        } catch (InterruptedException e) { /* ignore */ }
        return "user1".equals(userId) ? Optional.of(new User(userId, "Alice")) : Optional.empty();
      }, executor));
    }

    public static Kind&lt;CompletableFutureKind.Witness, Optional&lt;UserProfile&gt;&gt; fetchProfileAsync(String userId) {
      return FUTURE.widen(CompletableFuture.supplyAsync(() -&gt; {
        System.out.println("Fetching profile for " + userId + " on " + Thread.currentThread().getName());
        try {
          TimeUnit.MILLISECONDS.sleep(50);
        } catch (InterruptedException e) { /* ignore */ }
        return "user1".equals(userId) ? Optional.of(new UserProfile(userId, "Loves HKJ")) : Optional.empty();
      }, executor));
    }

    public static Kind&lt;CompletableFutureKind.Witness, Optional&lt;UserPreferences&gt;&gt; fetchPrefsAsync(String userId) {
      return FUTURE.widen(CompletableFuture.supplyAsync(() -&gt; {
        System.out.println("Fetching preferences for " + userId + " on " + Thread.currentThread().getName());
        try {
          TimeUnit.MILLISECONDS.sleep(50);
        } catch (InterruptedException e) { /* ignore */ }
        // Simulate preferences sometimes missing even for a valid user
        return "user1".equals(userId) &amp;&amp; Math.random() &gt; 0.3 ? Optional.of(new UserPreferences(userId, "dark")) : Optional.empty();
      }, executor));
    }

    // --- Service Stubs (simulating async calls returning Future&lt;Optional&lt;T&gt;&gt;) ---

    // --- Workflow using OptionalT ---
    public static OptionalT&lt;CompletableFutureKind.Witness, UserPreferences&gt; getFullUserPreferences(String userId) {
      // Start by fetching the user, lifting into OptionalT
      OptionalT&lt;CompletableFutureKind.Witness, User&gt; userOT =
          OptionalT.fromKind(fetchUserAsync(userId));

      // If user exists, fetch profile
      OptionalT&lt;CompletableFutureKind.Witness, UserProfile&gt; profileOT =
          OPTIONAL_T.narrow(
              optionalTFutureMonad.flatMap(
                  user -&gt; OPTIONAL_T.widen(OptionalT.fromKind(fetchProfileAsync(user.id()))),
                  OPTIONAL_T.widen(userOT)
              )
          );

      // If profile exists, fetch preferences
      OptionalT&lt;CompletableFutureKind.Witness, UserPreferences&gt; preferencesOT =
          OPTIONAL_T.narrow(
              optionalTFutureMonad.flatMap(
                  profile -&gt; OPTIONAL_T.widen(OptionalT.fromKind(fetchPrefsAsync(profile.userId()))),
                  OPTIONAL_T.widen(profileOT)
              )
          );
      return preferencesOT;
    }

    // Workflow with recovery / default
    public static OptionalT&lt;CompletableFutureKind.Witness, UserPreferences&gt; getPrefsWithDefault(String userId) {
      OptionalT&lt;CompletableFutureKind.Witness, UserPreferences&gt; prefsAttemptOT = getFullUserPreferences(userId);

      Kind&lt;OptionalTKind.Witness&lt;CompletableFutureKind.Witness&gt;, UserPreferences&gt; recoveredPrefsOTKind =
          optionalTFutureMonad.handleErrorWith(
              OPTIONAL_T.widen(prefsAttemptOT),
              (Unit v) -&gt; { // This lambda is called if prefsAttemptOT results in F&lt;Optional.empty()&gt;
                System.out.println("Preferences not found for " + userId + ", providing default.");
                // Lift a default preference into OptionalT
                UserPreferences defaultPrefs = new UserPreferences(userId, "default-light");
                return OPTIONAL_T.widen(OptionalT.some(futureMonad, defaultPrefs));
              }
          );
      return OPTIONAL_T.narrow(recoveredPrefsOTKind);
    }

    public static void main(String[] args) {
      System.out.println("--- Attempting to get preferences for existing user (user1) ---");
      OptionalT&lt;CompletableFutureKind.Witness, UserPreferences&gt; resultUser1OT = getFullUserPreferences("user1");
      CompletableFuture&lt;Optional&lt;UserPreferences&gt;&gt; future1 =
          FUTURE.narrow(resultUser1OT.value());

      future1.whenComplete((optPrefs, ex) -&gt; {
        if (ex != null) {
          System.err.println("Error for user1: " + ex.getMessage());
        } else {
          System.out.println("User1 Preferences: " + optPrefs.map(UserPreferences::toString).orElse("NOT FOUND"));
        }
      });


      System.out.println("\n--- Attempting to get preferences for non-existing user (user2) ---");
      OptionalT&lt;CompletableFutureKind.Witness, UserPreferences&gt; resultUser2OT = getFullUserPreferences("user2");
      CompletableFuture&lt;Optional&lt;UserPreferences&gt;&gt; future2 =
          FUTURE.narrow(resultUser2OT.value());

      future2.whenComplete((optPrefs, ex) -&gt; {
        if (ex != null) {
          System.err.println("Error for user2: " + ex.getMessage());
        } else {
          System.out.println("User2 Preferences: " + optPrefs.map(UserPreferences::toString).orElse("NOT FOUND (as expected)"));
        }
      });

      System.out.println("\n--- Attempting to get preferences for user1 WITH DEFAULT ---");
      OptionalT&lt;CompletableFutureKind.Witness, UserPreferences&gt; resultUser1WithDefaultOT = getPrefsWithDefault("user1");
      CompletableFuture&lt;Optional&lt;UserPreferences&gt;&gt; future3 =
          FUTURE.narrow(resultUser1WithDefaultOT.value());

      future3.whenComplete((optPrefs, ex) -&gt; {
        if (ex != null) {
          System.err.println("Error for user1 (with default): " + ex.getMessage());
        } else {
          // This will either be the fetched prefs or the default.
          System.out.println("User1 Preferences (with default): " + optPrefs.map(UserPreferences::toString).orElse("THIS SHOULD NOT HAPPEN if default works"));
        }
        // Wait for async operations to complete for demonstration
        try {
          TimeUnit.SECONDS.sleep(1);
        } catch (InterruptedException e) {
          Thread.currentThread().interrupt();
        }
        executor.shutdown();
      });
    }

    // --- Domain Model ---
    record User(String id, String name) {
    }

    record UserProfile(String userId, String bio) {
    }

    record UserPreferences(String userId, String theme) {
    }
  }
</code></pre>
<p><strong>This example demonstrates:</strong></p>
<ol>
<li><strong>Setting up</strong> <code>OptionalTMonad</code> with <code>CompletableFutureMonad</code>.</li>
<li><strong>Using</strong> <code>OptionalT.fromKind</code> to lift an existing <code>Kind&lt;F, Optional&lt;A&gt;&gt;</code> (the result of async service calls) into the <code>OptionalT</code> context.</li>
<li><strong>Sequencing operations with</strong> <code>optionalTFutureMonad.flatMap</code>. If any step in the chain (e.g., <code>fetchUserAsync</code>) results in <code>F&lt;Optional.empty()&gt;</code>, subsequent <code>flatMap</code> lambdas are short-circuited, and the overall result becomes <code>F&lt;Optional.empty()&gt;</code>.</li>
<li><strong>Using</strong> <code>handleErrorWith</code> to provide a default <code>UserPreferences</code> if the chain of operations results in an empty <code>Optional</code>.</li>
<li><strong>Finally,</strong> <code>.value()</code> is used to extract the underlying <code>Kind&lt;CompletableFutureKind.Witness, Optional&lt;UserPreferences&gt;&gt;</code> to interact with the <code>CompletableFuture</code> directly.</li>
</ol>
<p><code>OptionalT</code> simplifies managing sequences of operations where each step might not yield</p>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="the-maybet-transformer"><a class="header" href="#the-maybet-transformer">The MaybeT Transformer:</a></h1>
<h2 id="combining-monadic-effects-with-optionality"><a class="header" href="#combining-monadic-effects-with-optionality"><em>Combining Monadic Effects with Optionality</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="transformers/maybet_transformer.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to add stateful computation to any existing monad</li>
<li>Building stack operations that can fail (StateT with Optional)</li>
<li>Understanding the relationship between State and StateT&lt;S, Identity, A&gt;</li>
<li>Creating complex workflows that manage both state and other effects</li>
<li>Using <code>get</code>, <code>set</code>, <code>modify</code> operations within transformer contexts</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="transformers/maybet_transformer.html#admonition-see-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/maybe_t/MaybeTExample.java">MaybeTExample.java</a></p>
</div>
</div>
## `MaybeT` Monad Transformer.
<p><img src="transformers/../images/puml/maybet_transformer.svg" alt="maybet_transformer.svg" /></p>
<h2 id="maybetf-a-combining-any-monad-f-with-maybea"><a class="header" href="#maybetf-a-combining-any-monad-f-with-maybea"><code>MaybeT&lt;F, A&gt;</code>: Combining Any Monad <code>F</code> with <code>Maybe&lt;A&gt;</code></a></h2>
<p>The <code>MaybeT</code> monad transformer allows you to combine the optionality of <code>Maybe&lt;A&gt;</code> (representing a value that might be
<code>Just&lt;A&gt;</code> or <code>Nothing</code>) with another outer monad <code>F</code>. It transforms a computation that results in <code>Kind&lt;F, Maybe&lt;A&gt;&gt;</code>
into a single monadic structure. This is useful for operations within an effectful context <code>F</code> (like
<code>CompletableFutureKind</code> for async operations or <code>ListKind</code> for non-deterministic computations) that can also result in
an absence of a value.</p>
<ul>
<li><strong><code>F</code></strong>: The witness type of the <strong>outer monad</strong> (e.g., <code>CompletableFutureKind.Witness</code>, <code>ListKind.Witness</code>). This
monad handles the primary effect (e.g., asynchronicity, non-determinism).</li>
<li><strong><code>A</code></strong>: The type of the value potentially held by the inner <code>Maybe</code>.</li>
</ul>
<pre><code>// From: org.higherkindedj.hkt.maybe_t.MaybeT
public record MaybeT&lt;F, A&gt;(@NonNull Kind&lt;F, Maybe&lt;A&gt;&gt; value) { 
/* ... static factories ... */ }
</code></pre>
<p><code>MaybeT&lt;F, A&gt;</code> wraps a value of type <code>Kind&lt;F, Maybe&lt;A&gt;&gt;</code>. It signifies a computation in the context of <code>F</code> that will
eventually produce a <code>Maybe&lt;A&gt;</code>. The main benefit comes from its associated type class instance, <code>MaybeTMonad</code>, which
provides monadic operations for this combined structure.</p>
<h2 id="maybetkindf-a-the-witness-type"><a class="header" href="#maybetkindf-a-the-witness-type"><code>MaybeTKind&lt;F, A&gt;</code>: The Witness Type</a></h2>
<p>Similar to other HKTs in Higher-Kinded-J, <code>MaybeT</code> uses <code>MaybeTKind&lt;F, A&gt;</code> as its witness type for use in generic
functions.</p>
<ul>
<li>It extends <code>Kind&lt;G, A&gt;</code> where <code>G</code> (the witness for the combined monad) is <code>MaybeTKind.Witness&lt;F&gt;</code>.</li>
<li><code>F</code> is fixed for a specific <code>MaybeT</code> context, while <code>A</code> is the variable type parameter.</li>
</ul>
<pre><code class="language-java">public interface MaybeTKind&lt;F, A&gt; extends Kind&lt;MaybeTKind.Witness&lt;F&gt;, A&gt; {
  // Witness type G = MaybeTKind.Witness&lt;F&gt;
  // Value type A = A (from Maybe&lt;A&gt;)
}
</code></pre>
<h2 id="maybetkindhelper"><a class="header" href="#maybetkindhelper"><code>MaybeTKindHelper</code></a></h2>
<ul>
<li>This utility class provides static <code>wrap</code> and <code>unwrap</code> methods for safe conversion between the concrete <code>MaybeT&lt;F, A&gt;</code>
and its <code>Kind</code> representation (<code>Kind&lt;MaybeTKind.Witness&lt;F&gt;, A&gt;</code>).</li>
</ul>
<pre><code class="language-java">// To wrap:
// MaybeT&lt;F, A&gt; maybeT = ...;
Kind&lt;MaybeTKind.Witness&lt;F&gt;, A&gt; kind = MAYBE_T.widen(maybeT);
// To unwrap:
MaybeT&lt;F, A&gt; unwrappedMaybeT = MAYBE_T.narrow(kind);
</code></pre>
<h2 id="maybetmonadf-operating-on-maybet"><a class="header" href="#maybetmonadf-operating-on-maybet"><code>MaybeTMonad&lt;F&gt;</code>: Operating on <code>MaybeT</code></a></h2>
<p>The <code>MaybeTMonad&lt;F&gt;</code> class implements <code>MonadError&lt;MaybeTKind.Witness&lt;F&gt;, Unit&gt;</code>. The error type <code>E</code> for <code>MonadError</code> is fixed to <code>Unit</code>, signifying that an "error" in this context is the <code>Maybe.nothing()</code> state within the <code>F&lt;Maybe&lt;A&gt;&gt;</code> structure.
<code>MaybeT</code> represents failure (or absence) as <code>Nothing</code>, which doesn't carry an error value itself.</p>
<ul>
<li>It requires a <code>Monad&lt;F&gt;</code> instance for the outer monad <code>F</code>, provided during construction. This instance is used to
manage the effects of <code>F</code>.</li>
<li>It uses <code>MaybeTKindHelper.wrap</code> and <code>MaybeTKindHelper.unwrap</code> for conversions.</li>
<li>Operations like <code>raiseError(Unit.INSTANCE)</code> will create a <code>MaybeT</code> representing <code>F&lt;Nothing&gt;</code>.
The <code>Unit.INSTANCE</code> signifies the <code>Nothing</code> state without carrying a separate error value.</li>
<li><code>handleErrorWith</code> allows "recovering" from a <code>Nothing</code> state by providing an alternative <code>MaybeT</code>. The handler function passed to <code>handleErrorWith</code> will receive <code>Unit.INSTANCE</code> if a <code>Nothing</code> state is encountered.</li>
</ul>
<pre><code class="language-java">// Example: F = CompletableFutureKind.Witness, Error type for MonadError is Unit
// 1. Get the Monad instance for the outer monad F
Monad&lt;CompletableFutureKind.Witness&gt; futureMonad = CompletableFutureMonad.INSTANCE; 

// 2. Create the MaybeTMonad, providing the outer monad instance
MonadError&lt;MaybeTKind.Witness&lt;CompletableFutureKind.Witness&gt;, Unit&gt; maybeTMonad =
    new MaybeTMonad&lt;&gt;(futureMonad);

// Now 'maybeTMonad' can be used to operate on Kind&lt;MaybeTKind.Witness&lt;CompletableFutureKind.Witness&gt;, A&gt; values.
</code></pre>
<div id="admonition-key-operations-with-_maybetmonad_" class="admonition admonish-info" role="note" aria-labelledby="admonition-key-operations-with-_maybetmonad_-title">
<div class="admonition-title">
<div id="admonition-key-operations-with-_maybetmonad_-title">
<p>Key Operations with <em>MaybeTMonad</em>:</p>
</div>
<a class="admonition-anchor-link" href="transformers/maybet_transformer.html#admonition-key-operations-with-_maybetmonad_"></a>
</div>
<div>
<ul>
<li><strong><code>maybeTMonad.of(value)</code>:</strong> Lifts a nullable value <code>A</code> into the <code>MaybeT</code> context. Result:
<code>F&lt;Maybe.fromNullable(value)&gt;</code>.</li>
<li><strong><code>maybeTMonad.map(f, maybeTKind)</code>:</strong> Applies function <code>A -&gt; B</code> to the <code>Just</code> value inside the nested structure. If
it's <code>Nothing</code>, or <code>f</code> returns <code>null</code>, it propagates <code>F&lt;Nothing&gt;</code>.</li>
<li><strong><code>maybeTMonad.flatMap(f, maybeTKind)</code>:</strong> Sequences operations. Takes <code>A -&gt; Kind&lt;MaybeTKind.Witness&lt;F&gt;, B&gt;</code>. If the
input is <code>F&lt;Just(a)&gt;</code>, it applies <code>f(a)</code> to get the next <code>MaybeT&lt;F, B&gt;</code> and extracts its <code>Kind&lt;F, Maybe&lt;B&gt;&gt;</code>. If
<code>F&lt;Nothing&gt;</code>, it propagates <code>F&lt;Nothing&gt;</code>.</li>
<li><strong><code>maybeTMonad.raiseError(Unit.INSTANCE)</code>:</strong> Creates <code>MaybeT</code> representing <code>F&lt;Nothing&gt;</code>.</li>
<li><strong><code>maybeTMonad.handleErrorWith(maybeTKind, handler)</code>:</strong> Handles a <code>Nothing</code> state. The handler
<code>Unit -&gt; Kind&lt;MaybeTKind.Witness&lt;F&gt;, A&gt;</code> is invoked with <code>null</code>.</li>
</ul>
</div>
</div>
<hr />
<div id="admonition-creating-_maybet_-instances" class="admonition admonish-note" role="note" aria-labelledby="admonition-creating-_maybet_-instances-title">
<div class="admonition-title">
<div id="admonition-creating-_maybet_-instances-title">
<p>Creating <em>MaybeT</em> Instances</p>
</div>
<a class="admonition-anchor-link" href="transformers/maybet_transformer.html#admonition-creating-_maybet_-instances"></a>
</div>
<div>
<p><code>MaybeT</code> instances are typically created using its static factory methods, often requiring the outer <code>Monad&lt;F&gt;</code>
instance:</p>
<pre><code class="language-java">public void createExample() {
    Monad&lt;OptionalKind.Witness&gt; optMonad = OptionalMonad.INSTANCE; // Outer Monad F=Optional
    String presentValue = "Hello";

    // 1. Lifting a non-null value: Optional&lt;Just(value)&gt;
    MaybeT&lt;OptionalKind.Witness, String&gt; mtJust = MaybeT.just(optMonad, presentValue);
    // Resulting wrapped value: Optional.of(Maybe.just("Hello"))

    // 2. Creating a 'Nothing' state: Optional&lt;Nothing&gt;
    MaybeT&lt;OptionalKind.Witness, String&gt; mtNothing = MaybeT.nothing(optMonad);
    // Resulting wrapped value: Optional.of(Maybe.nothing())

    // 3. Lifting a plain Maybe: Optional&lt;Maybe(input)&gt;
    Maybe&lt;Integer&gt; plainMaybe = Maybe.just(123);
    MaybeT&lt;OptionalKind.Witness, Integer&gt; mtFromMaybe = MaybeT.fromMaybe(optMonad, plainMaybe);
    // Resulting wrapped value: Optional.of(Maybe.just(123))

    Maybe&lt;Integer&gt; plainNothing = Maybe.nothing();
    MaybeT&lt;OptionalKind.Witness, Integer&gt; mtFromMaybeNothing = MaybeT.fromMaybe(optMonad, plainNothing);
    // Resulting wrapped value: Optional.of(Maybe.nothing())


    // 4. Lifting an outer monad value F&lt;A&gt;: Optional&lt;Maybe&lt;A&gt;&gt; (using fromNullable)
    Kind&lt;OptionalKind.Witness, String&gt; outerOptional = OPTIONAL.widen(Optional.of("World"));
    MaybeT&lt;OptionalKind.Witness, String&gt; mtLiftF = MaybeT.liftF(optMonad, outerOptional);
    // Resulting wrapped value: Optional.of(Maybe.just("World"))

    Kind&lt;OptionalKind.Witness, String&gt; outerEmptyOptional = OPTIONAL.widen(Optional.empty());
    MaybeT&lt;OptionalKind.Witness, String&gt; mtLiftFEmpty = MaybeT.liftF(optMonad, outerEmptyOptional);
    // Resulting wrapped value: Optional.of(Maybe.nothing())


    // 5. Wrapping an existing nested Kind: F&lt;Maybe&lt;A&gt;&gt;
    Kind&lt;OptionalKind.Witness, Maybe&lt;String&gt;&gt; nestedKind =
        OPTIONAL.widen(Optional.of(Maybe.just("Present")));
    MaybeT&lt;OptionalKind.Witness, String&gt; mtFromKind = MaybeT.fromKind(nestedKind);
    // Resulting wrapped value: Optional.of(Maybe.just("Present"))

    // Accessing the wrapped value:
    Kind&lt;OptionalKind.Witness, Maybe&lt;String&gt;&gt; wrappedValue = mtJust.value();
    Optional&lt;Maybe&lt;String&gt;&gt; unwrappedOptional = OPTIONAL.narrow(wrappedValue);
    // unwrappedOptional is Optional.of(Maybe.just("Hello"))
  }
</code></pre>
</div>
</div>
<div id="admonition-asynchronous-optional-resource-fetching" class="admonition admonish-note" role="note" aria-labelledby="admonition-asynchronous-optional-resource-fetching-title">
<div class="admonition-title">
<div id="admonition-asynchronous-optional-resource-fetching-title">
<p>Asynchronous Optional Resource Fetching</p>
</div>
<a class="admonition-anchor-link" href="transformers/maybet_transformer.html#admonition-asynchronous-optional-resource-fetching"></a>
</div>
<div>
<p>Let's consider fetching a user and then their preferences, where each step is asynchronous and might not return a value.</p>
<pre><code class="language-java">public static class MaybeTAsyncExample {
  // --- Setup ---
  Monad&lt;CompletableFutureKind.Witness&gt; futureMonad = CompletableFutureMonad.INSTANCE;
  MonadError&lt;MaybeTKind.Witness&lt;CompletableFutureKind.Witness&gt;, Unit&gt; maybeTMonad =
      new MaybeTMonad&lt;&gt;(futureMonad);

  // Simulates fetching a user asynchronously
  Kind&lt;CompletableFutureKind.Witness, Maybe&lt;User&gt;&gt; fetchUserAsync(String userId) {
    System.out.println("Fetching user: " + userId);
    CompletableFuture&lt;Maybe&lt;User&gt;&gt; future = CompletableFuture.supplyAsync(() -&gt; {
      try {
        TimeUnit.MILLISECONDS.sleep(50);
      } catch (InterruptedException e) { /* ignore */ }
      if ("user123".equals(userId)) {
        return Maybe.just(new User(userId, "Alice"));
      }
      return Maybe.nothing();
    });
    return FUTURE.widen(future);
  }

  // Simulates fetching user preferences asynchronously
  Kind&lt;CompletableFutureKind.Witness, Maybe&lt;UserPreferences&gt;&gt; fetchPreferencesAsync(String userId) {
    System.out.println("Fetching preferences for user: " + userId);
    CompletableFuture&lt;Maybe&lt;UserPreferences&gt;&gt; future = CompletableFuture.supplyAsync(() -&gt; {
      try {
        TimeUnit.MILLISECONDS.sleep(30);
      } catch (InterruptedException e) { /* ignore */ }
      if ("user123".equals(userId)) {
        return Maybe.just(new UserPreferences(userId, "dark-mode"));
      }
      return Maybe.nothing(); // No preferences for other users or if user fetch failed
    });
    return FUTURE.widen(future);
  }

  // --- Service Stubs (returning Future&lt;Maybe&lt;T&gt;&gt;) ---

  // Function to run the workflow for a given userId
  Kind&lt;CompletableFutureKind.Witness, Maybe&lt;UserPreferences&gt;&gt; getUserPreferencesWorkflow(String userIdToFetch) {

    // Step 1: Fetch User
    // Directly use MaybeT.fromKind as fetchUserAsync already returns F&lt;Maybe&lt;User&gt;&gt;
    Kind&lt;MaybeTKind.Witness&lt;CompletableFutureKind.Witness&gt;, User&gt; userMT =
        MAYBE_T.widen(MaybeT.fromKind(fetchUserAsync(userIdToFetch)));

    // Step 2: Fetch Preferences if User was found
    Kind&lt;MaybeTKind.Witness&lt;CompletableFutureKind.Witness&gt;, UserPreferences&gt; preferencesMT =
        maybeTMonad.flatMap(
            user -&gt; { // This lambda is only called if userMT contains F&lt;Just(user)&gt;
              System.out.println("User found: " + user.name() + ". Now fetching preferences.");
              // fetchPreferencesAsync returns Kind&lt;CompletableFutureKind.Witness, Maybe&lt;UserPreferences&gt;&gt;
              // which is F&lt;Maybe&lt;A&gt;&gt;, so we can wrap it directly.
              return MAYBE_T.widen(MaybeT.fromKind(fetchPreferencesAsync(user.id())));
            },
            userMT // Input to flatMap
        );

    // Try to recover if preferences are Nothing, but user was found (conceptual)
    Kind&lt;MaybeTKind.Witness&lt;CompletableFutureKind.Witness&gt;, UserPreferences&gt; preferencesWithDefaultMT =
        maybeTMonad.handleErrorWith(preferencesMT, (Unit v) -&gt; { // Handler for Nothing
          System.out.println("Preferences not found, attempting to use default.");
          // We need userId here. For simplicity, let's assume we could get it or just return nothing.
          // This example shows returning nothing again if we can't provide a default.
          // A real scenario might try to fetch default preferences or construct one.
          return maybeTMonad.raiseError(Unit.INSTANCE); // Still Nothing, or could be MaybeT.just(defaultPrefs)
        });


    // Unwrap the final MaybeT to get the underlying Future&lt;Maybe&lt;UserPreferences&gt;&gt;
    MaybeT&lt;CompletableFutureKind.Witness, UserPreferences&gt; finalMaybeT =
        MAYBE_T.narrow(preferencesWithDefaultMT); // or preferencesMT if no recovery
    return finalMaybeT.value();
  }

  public void asyncExample() {
    System.out.println("--- Fetching preferences for known user (user123) ---");
    Kind&lt;CompletableFutureKind.Witness, Maybe&lt;UserPreferences&gt;&gt; resultKnownUserKind =
        getUserPreferencesWorkflow("user123");
    Maybe&lt;UserPreferences&gt; resultKnownUser = FUTURE.join(resultKnownUserKind);
    System.out.println("Known User Result: " + resultKnownUser);
    // Expected: Just(UserPreferences[userId=user123, theme=dark-mode])

    System.out.println("\n--- Fetching preferences for unknown user (user999) ---");
    Kind&lt;CompletableFutureKind.Witness, Maybe&lt;UserPreferences&gt;&gt; resultUnknownUserKind =
        getUserPreferencesWorkflow("user999");
    Maybe&lt;UserPreferences&gt; resultUnknownUser = FUTURE.join(resultUnknownUserKind);
    System.out.println("Unknown User Result: " + resultUnknownUser);
    // Expected: Nothing
  }

  // --- Workflow Definition using MaybeT ---

  // --- Domain Model ---
  record User(String id, String name) {
  }

  record UserPreferences(String userId, String theme) {
  }
}
</code></pre>
<p>This example illustrates:</p>
<ol>
<li>Setting up <code>MaybeTMonad</code> with <code>CompletableFutureMonad</code>and <code>Unit</code> as the error type.</li>
<li>Using <code>MaybeT.fromKind</code> to lift an existing <code>Kind&lt;F, Maybe&lt;A&gt;&gt;</code> into the <code>MaybeT</code> context.</li>
<li>Sequencing operations with <code>maybeTMonad.flatMap</code>. If <code>WorkspaceUserAsync</code> results in <code>F&lt;Nothing&gt;</code>, the lambda for
fetching preferences is skipped.</li>
<li>The <code>handleErrorWith</code> shows a way to potentially recover from a <code>Nothing</code> state using <code>Unit</code> in the handler and <code>raiseError(Unit.INSTANCE)</code>.</li>
<li>Finally, <code>.value()</code> is used to extract the underlying <code>Kind&lt;CompletableFutureKind.Witness, Maybe&lt;UserPreferences&gt;&gt;</code>.</li>
</ol>
</div>
</div>
<div id="admonition-key-points" class="admonition admonish-tip" role="note" aria-labelledby="admonition-key-points-title">
<div class="admonition-title">
<div id="admonition-key-points-title">
<p>Key Points:</p>
</div>
<a class="admonition-anchor-link" href="transformers/maybet_transformer.html#admonition-key-points"></a>
</div>
<div>
<ul>
<li>The <code>MaybeT</code> transformer simplifies working with nested optional values within other monadic contexts by providing a
unified monadic interface, abstracting away the manual checks and propagation of <code>Nothing</code> states.</li>
<li>When <code>MaybeTMonad</code> is used as a <code>MonadError</code>, the error type is <code>Unit</code>, indicating that the "error" (a <code>Nothing</code> state) doesn't carry a specific value beyond its occurrence.</li>
</ul>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="the-readert-transformer"><a class="header" href="#the-readert-transformer">The ReaderT Transformer:</a></h1>
<h2 id="combining-monadic-effects-with-a-read-only-environment"><a class="header" href="#combining-monadic-effects-with-a-read-only-environment"><em>Combining Monadic Effects with a Read-Only Environment</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="transformers/readert_transformer.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to combine dependency injection (Reader) with other effects like async operations</li>
<li>Building configuration-dependent workflows that are also async or failable</li>
<li>Using <code>ask</code>, <code>reader</code>, and <code>lift</code> to work with environment-dependent computations</li>
<li>Creating testable microservice clients with injected configuration</li>
<li>Managing database connections, API keys, and other contextual dependencies</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="transformers/readert_transformer.html#admonition-see-example-code"></a>
</div>
<div>
<ul>
<li>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/reader_t/ReaderTExample.java">ReaderTExample.java</a></p>
</li>
<li>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/reader_t/ReaderTAsyncExample.java">ReaderTUnitExample.java</a></p>
</li>
<li>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/reader_t/ReaderTAsyncUnitExample.java">ReaderTAsyncUnitExample.java</a></p>
</li>
</ul>
</div>
</div>
<h2 id="readert-monad-transformer"><a class="header" href="#readert-monad-transformer"><code>ReaderT</code> Monad Transformer</a></h2>
<p>The <code>ReaderT</code> monad transformer (short for Reader Transformer) allows you to combine the capabilities of the <code>Reader</code> monad (providing a read-only environment <code>R</code>) with another outer monad <code>F</code>. It encapsulates a computation that, given an environment <code>R</code>, produces a result within the monadic context <code>F</code> (i.e., <code>Kind&lt;F, A&gt;</code>).</p>
<p>This is particularly useful when you have operations that require some configuration or context (<code>R</code>) and also involve other effects managed by <code>F</code>, such as asynchronicity (<code>CompletableFutureKind</code>), optionality (<code>OptionalKind</code>, <code>MaybeKind</code>), or error handling (<code>EitherKind</code>).</p>
<p>The <code>ReaderT&lt;F, R, A&gt;</code> structure essentially wraps a function <code>R -&gt; Kind&lt;F, A&gt;</code>.</p>
<h2 id="structure-9"><a class="header" href="#structure-9">Structure</a></h2>
<p><img src="transformers/../images/puml/readert_transformer.svg" alt="readert_transformer.svg" /></p>
<h2 id="readertf-r-a-the-core-data-type"><a class="header" href="#readertf-r-a-the-core-data-type"><code>ReaderT&lt;F, R, A&gt;</code>: The Core Data Type</a></h2>
<p><code>ReaderT&lt;F, R, A&gt;</code> is a record that encapsulates the core computation.</p>
<pre><code class="language-java">public record ReaderT&lt;F, R, A&gt;(@NonNull Function&lt;R, Kind&lt;F, A&gt;&gt; run)
    implements ReaderTKind&lt;F, R, A&gt; {
  // ... static factory methods ...
}
</code></pre>
<ul>
<li><strong><code>F</code></strong>: The witness type of the <strong>outer monad</strong> (e.g., <code>OptionalKind.Witness</code>, <code>CompletableFutureKind.Witness</code>). This monad handles an effect such as optionality or asynchronicity.</li>
<li><strong><code>R</code></strong>: The type of the <strong>read-only environment</strong> (context or configuration) that the computation depends on.</li>
<li><strong><code>A</code></strong>: The type of the value produced by the computation, wrapped within the outer monad <code>F</code>.</li>
<li><strong><code>run</code></strong>: The essential function <code>R -&gt; Kind&lt;F, A&gt;</code>. When this function is applied to an environment of type <code>R</code>, it yields a monadic value <code>Kind&lt;F, A&gt;</code>.</li>
</ul>
<h2 id="readertkindf-r-a-the-witness-type"><a class="header" href="#readertkindf-r-a-the-witness-type"><code>ReaderTKind&lt;F, R, A&gt;</code>: The Witness Type</a></h2>
<p>To integrate with Higher-Kinded-J's generic programming capabilities, <code>ReaderTKind&lt;F, R, A&gt;</code> serves as the witness type.</p>
<ul>
<li>It extends <code>Kind&lt;G, A&gt;</code>, where <code>G</code> (the witness for the combined <code>ReaderT</code> monad) is <code>ReaderTKind.Witness&lt;F, R&gt;</code>.</li>
<li>The types <code>F</code> (outer monad) and <code>R</code> (environment) are fixed for a specific <code>ReaderT</code> context, while <code>A</code> is the variable value type.</li>
</ul>
<pre><code class="language-java">public interface ReaderTKind&lt;F, R, A&gt; extends Kind&lt;ReaderTKind.Witness&lt;F, R&gt;, A&gt; {
  // Witness type G = ReaderTKind.Witness&lt;F, R&gt;
  // Value type A = A
}
</code></pre>
<h2 id="readertkindhelper-utility-for-wrapping-and-unwrapping"><a class="header" href="#readertkindhelper-utility-for-wrapping-and-unwrapping"><code>ReaderTKindHelper</code>: Utility for Wrapping and Unwrapping</a></h2>
<p><code>ReaderTKindHelper</code> provides READER_T enum essential utility methods to convert between the concrete <code>ReaderT&lt;F, R, A&gt;</code> type and its <code>Kind</code> representation (<code>Kind&lt;ReaderTKind.Witness&lt;F, R&gt;, A&gt;</code>).</p>
<pre><code class="language-java">public enum ReaderTKindHelper {
   READER_T;
  
    // Unwraps Kind&lt;ReaderTKind.Witness&lt;F, R&gt;, A&gt; to ReaderT&lt;F, R, A&gt;
    public &lt;F, R, A&gt; @NonNull ReaderT&lt;F, R, A&gt; narrow(
        @Nullable Kind&lt;ReaderTKind.Witness&lt;F, R&gt;, A&gt; kind);

    // Wraps ReaderT&lt;F, R, A&gt; into ReaderTKind&lt;F, R, A&gt;
    public &lt;F, R, A&gt; @NonNull ReaderTKind&lt;F, R, A&gt; widen(
        @NonNull ReaderT&lt;F, R, A&gt; readerT);
}
</code></pre>
<h2 id="readertmonadf-r-operating-on-readert"><a class="header" href="#readertmonadf-r-operating-on-readert"><code>ReaderTMonad&lt;F, R&gt;</code>: Operating on <code>ReaderT</code></a></h2>
<p>The <code>ReaderTMonad&lt;F, R&gt;</code> class implements the <code>Monad&lt;ReaderTKind.Witness&lt;F, R&gt;&gt;</code> interface, providing the standard monadic operations (<code>of</code>, <code>map</code>, <code>flatMap</code>, <code>ap</code>) for the <code>ReaderT</code> structure.</p>
<ul>
<li>It requires a <code>Monad&lt;F&gt;</code> instance for the outer monad <code>F</code> to be provided during its construction. This <code>outerMonad</code> is used internally to sequence operations within the <code>F</code> context.</li>
<li><code>R</code> is the fixed environment type for this monad instance.</li>
</ul>
<pre><code class="language-java">// Example: F = OptionalKind.Witness, R = AppConfig
// 1. Get the Monad instance for the outer monad F
OptionalMonad optionalMonad = OptionalMonad.INSTANCE;

// 2. Define your environment type
record AppConfig(String apiKey) {}

// 3. Create the ReaderTMonad
ReaderTMonad&lt;OptionalKind.Witness, AppConfig&gt; readerTOptionalMonad =
    new ReaderTMonad&lt;&gt;(optionalMonad);

// Now 'readerTOptionalMonad' can be used to operate on 
// Kind&lt;ReaderTKind.Witness&lt;OptionalKind.Witness, AppConfig&gt;, A&gt; values.
</code></pre>
<div id="admonition-key-operations-with-_readertmonad_" class="admonition admonish-info" role="note" aria-labelledby="admonition-key-operations-with-_readertmonad_-title">
<div class="admonition-title">
<div id="admonition-key-operations-with-_readertmonad_-title">
<p>Key Operations with <em>ReaderTMonad</em></p>
</div>
<a class="admonition-anchor-link" href="transformers/readert_transformer.html#admonition-key-operations-with-_readertmonad_"></a>
</div>
<div>
<ul>
<li><strong><code>readerTMonad.of(value)</code></strong>: Lifts a pure value <code>A</code> into the <code>ReaderT</code> context. The underlying function becomes <code>r -&gt; outerMonad.of(value)</code>. Result: <code>ReaderT(r -&gt; F&lt;A&gt;)</code>.</li>
<li><strong><code>readerTMonad.map(func, readerTKind)</code></strong>: Applies a function <code>A -&gt; B</code> to the value <code>A</code> inside the <code>ReaderT</code> structure, if present and successful within the <code>F</code> context. The transformation <code>A -&gt; B</code> happens within the <code>outerMonad.map</code> call. Result: <code>ReaderT(r -&gt; F&lt;B&gt;)</code>.</li>
<li><strong><code>readerTMonad.flatMap(func, readerTKind)</code></strong>: The core sequencing operation. Takes a function <code>A -&gt; Kind&lt;ReaderTKind.Witness&lt;F, R&gt;, B&gt;</code> (which is effectively <code>A -&gt; ReaderT&lt;F, R, B&gt;</code>). It runs the initial <code>ReaderT</code> with the environment <code>R</code> to get <code>Kind&lt;F, A&gt;</code>. Then, it uses <code>outerMonad.flatMap</code> to process this. If <code>Kind&lt;F, A&gt;</code> yields an <code>A</code>, <code>func</code> is applied to <code>a</code> to get a new <code>ReaderT&lt;F, R, B&gt;</code>. This new <code>ReaderT</code> is then also run with the <em>same original environment</em><code>R</code> to yield <code>Kind&lt;F, B&gt;</code>. This allows composing computations that all depend on the same environment <code>R</code> while also managing the effects of <code>F</code>. Result: <code>ReaderT(r -&gt; F&lt;B&gt;)</code>.</li>
</ul>
</div>
</div>
<div id="admonition-creating-_readert_-instances" class="admonition admonish-note" role="note" aria-labelledby="admonition-creating-_readert_-instances-title">
<div class="admonition-title">
<div id="admonition-creating-_readert_-instances-title">
<p>Creating <em>ReaderT</em> Instances</p>
</div>
<a class="admonition-anchor-link" href="transformers/readert_transformer.html#admonition-creating-_readert_-instances"></a>
</div>
<div>
<p>You typically create <code>ReaderT</code> instances using its static factory methods. These methods often require an instance of <code>Monad&lt;F&gt;</code> for the outer monad.</p>
<pre><code class="language-java"> public void createExample(){
  // --- Setup ---
  // Outer Monad F = OptionalKind.Witness
  OptionalMonad optMonad = OptionalMonad.INSTANCE;

  // Environment Type R
  record Config(String setting) {
  }
  Config testConfig = new Config("TestValue");

  // --- Factory Methods ---

  // 1. `ReaderT.of(Function&lt;R, Kind&lt;F, A&gt;&gt; runFunction)`
  //    Constructs directly from the R -&gt; F&lt;A&gt; function.
  Function&lt;Config, Kind&lt;OptionalKind.Witness, String&gt;&gt; runFn1 =
      cfg -&gt; OPTIONAL.widen(Optional.of("Data based on " + cfg.setting()));
  ReaderT&lt;OptionalKind.Witness, Config, String&gt; rt1 = ReaderT.of(runFn1);
  // To run: OPTIONAL.narrow(rt1.run().apply(testConfig)) is Optional.of("Data based on TestValue")
  System.out.println(OPTIONAL.narrow(rt1.run().apply(testConfig)));

  // 2. `ReaderT.lift(Monad&lt;F&gt; outerMonad, Kind&lt;F, A&gt; fa)`
  //    Lifts an existing monadic value `Kind&lt;F, A&gt;` into ReaderT.
  //    The resulting ReaderT ignores the environment R and always returns `fa`.
  Kind&lt;OptionalKind.Witness, Integer&gt; optionalValue = OPTIONAL.widen(Optional.of(123));
  ReaderT&lt;OptionalKind.Witness, Config, Integer&gt; rt2 = ReaderT.lift(optMonad, optionalValue);
  // To run: OPTIONAL.narrow(rt2.run().apply(testConfig)) is Optional.of(123)
  System.out.println(OPTIONAL.narrow(rt2.run().apply(testConfig)));

  Kind&lt;OptionalKind.Witness, Integer&gt; emptyOptional = OPTIONAL.widen(Optional.empty());
  ReaderT&lt;OptionalKind.Witness, Config, Integer&gt; rt2Empty = ReaderT.lift(optMonad, emptyOptional);
  // To run: OPTIONAL.narrow(rt2Empty.run().apply(testConfig)) is Optional.empty()


  // 3. `ReaderT.reader(Monad&lt;F&gt; outerMonad, Function&lt;R, A&gt; f)`
  //    Creates a ReaderT from a function R -&gt; A. The result A is then lifted into F using outerMonad.of(A).
  Function&lt;Config, String&gt; simpleReaderFn = cfg -&gt; "Hello from " + cfg.setting();
  ReaderT&lt;OptionalKind.Witness, Config, String&gt; rt3 = ReaderT.reader(optMonad, simpleReaderFn);
  // To run: OPTIONAL.narrow(rt3.run().apply(testConfig)) is Optional.of("Hello from TestValue")
  System.out.println(OPTIONAL.narrow(rt3.run().apply(testConfig)));

  // 4. `ReaderT.ask(Monad&lt;F&gt; outerMonad)`
  //    Creates a ReaderT that, when run, provides the environment R itself as the result, lifted into F.
  //    The function is r -&gt; outerMonad.of(r).
  ReaderT&lt;OptionalKind.Witness, Config, Config&gt; rt4 = ReaderT.ask(optMonad);
  // To run: OPTIONAL.narrow(rt4.run().apply(testConfig)) is Optional.of(new Config("TestValue"))
  System.out.println(OPTIONAL.narrow(rt4.run().apply(testConfig)));

  // --- Using ReaderTKindHelper.READER_T to widen/narrow for Monad operations ---
  //    Avoid a cast with var ReaderTKind&lt;OptionalKind.Witness, Config, String&gt; kindRt1 =
  //        (ReaderTKind&lt;OptionalKind.Witness, Config, String&gt;) READER_T.widen(rt1);
  var kindRt1 = READER_T.widen(rt1);
  ReaderT&lt;OptionalKind.Witness, Config, String&gt; unwrappedRt1 = READER_T.narrow(kindRt1);
}
</code></pre>
</div>
</div>
<div id="admonition-example-readert-for-actions-returning-unit" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-readert-for-actions-returning-unit-title">
<div class="admonition-title">
<div id="admonition-example-readert-for-actions-returning-unit-title">
<p>Example: <code>ReaderT</code> for Actions Returning <code>Unit</code></p>
</div>
<a class="admonition-anchor-link" href="transformers/readert_transformer.html#admonition-example-readert-for-actions-returning-unit"></a>
</div>
<div>
<p>Sometimes, a computation dependent on an environment <code>R</code> and involving an outer monad <code>F</code> might perform an action (e.g., logging, initializing a resource, sending a fire-and-forget message) without producing a specific data value. In such cases, the result type <code>A</code> of <code>ReaderT&lt;F, R, A&gt;</code> can be <code>org.higherkindedj.hkt.unit.Unit</code>.</p>
<p>Let's extend the asynchronous example to include an action that logs a message using the <code>AppConfig</code> and completes asynchronously, returning <code>Unit</code>.</p>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/reader_t/ReaderTAsyncUnitExample.java">ReaderTAsyncUnitExample.java</a></li>
</ul>
<pre><code class="language-java">    // Action: Log a message using AppConfig, complete asynchronously returning F&lt;Unit&gt;
    public static Kind&lt;CompletableFutureKind.Witness, Unit&gt; logInitializationAsync(AppConfig config) {
        CompletableFuture&lt;Unit&gt; future = CompletableFuture.runAsync(() -&gt; {
            System.out.println("Thread: " + Thread.currentThread().getName() +
                " - Initializing component with API Key: " + config.apiKey() +
                " for Service URL: " + config.serviceUrl());
            // Simulate some work
            try {
                TimeUnit.MILLISECONDS.sleep(50);
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
                throw new RuntimeException(e);
            }
            System.out.println("Thread: " + Thread.currentThread().getName() +
                " - Initialization complete for: " + config.serviceUrl());
        }, config.executor()).thenApply(v -&gt; Unit.INSTANCE); // Ensure CompletableFuture&lt;Unit&gt;
        return FUTURE.widen(future);
    }

    // Wrap the action in ReaderT: R -&gt; F&lt;Unit&gt;
    public static ReaderT&lt;CompletableFutureKind.Witness, AppConfig, Unit&gt; initializeComponentRT() {
        return ReaderT.of(ReaderTAsyncUnitExample::logInitializationAsync);
    }

    public static void main(String[] args) {
        ExecutorService executor = Executors.newFixedThreadPool(2);
        AppConfig prodConfig = new AppConfig("prod_secret_for_init", "[https://init.prod.service](https://init.prod.service)", executor);

        // Get the ReaderT for the initialization action
        ReaderT&lt;CompletableFutureKind.Witness, AppConfig, Unit&gt; initAction = initializeComponentRT();

        System.out.println("--- Running Initialization Action with Prod Config ---");
        // Run the action by providing the prodConfig environment
        // This returns Kind&lt;CompletableFutureKind.Witness, Unit&gt;
        Kind&lt;CompletableFutureKind.Witness, Unit&gt; futureUnit = initAction.run().apply(prodConfig);

        // Wait for completion and get the Unit result (which is just Unit.INSTANCE)
        Unit result = FUTURE.join(futureUnit);
        System.out.println("Initialization Result: " + result); // Expected: Initialization Result: ()

        executor.shutdown();
        try {
            if (!executor.awaitTermination(5, TimeUnit.SECONDS)) {
                executor.shutdownNow();
            }
        } catch (InterruptedException e) {
            executor.shutdownNow();
            Thread.currentThread().interrupt();
        }
    }
</code></pre>
<p>This example illustrates:</p>
<ul>
<li>An asynchronous action (<code>logInitializationAsync</code>) that depends on <code>AppConfig</code> but logically returns no specific data, so its result is <code>CompletableFuture&lt;Unit&gt;</code>.</li>
<li>This action is wrapped into a <code>ReaderT&lt;CompletableFutureKind.Witness, AppConfig, Unit&gt;</code>.</li>
<li>When this <code>ReaderT</code> is run with an <code>AppConfig</code>, it yields a <code>Kind&lt;CompletableFutureKind.Witness, Unit&gt;</code>.</li>
<li>The final result of joining such a future is <code>Unit.INSTANCE</code>, signifying successful completion of the effectful, environment-dependent action.</li>
</ul>
</div>
</div>
<div id="admonition-example-configuration-dependent-asynchronous-service-calls" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-configuration-dependent-asynchronous-service-calls-title">
<div class="admonition-title">
<div id="admonition-example-configuration-dependent-asynchronous-service-calls-title">
<p>Example: Configuration-Dependent Asynchronous Service Calls</p>
</div>
<a class="admonition-anchor-link" href="transformers/readert_transformer.html#admonition-example-configuration-dependent-asynchronous-service-calls"></a>
</div>
<div>
<p>Let's illustrate <code>ReaderT</code> by combining an environment dependency (<code>AppConfig</code>) with an asynchronous operation (<code>CompletableFuture</code>).</p>
<pre><code class="language-java">
public class ReaderTAsyncExample {
  // --- Monad Setup ---
  // Outer Monad F = CompletableFutureKind.Witness
  static final Monad&lt;CompletableFutureKind.Witness&gt; futureMonad = CompletableFutureMonad.INSTANCE;
  // ReaderTMonad for AppConfig and CompletableFutureKind
  static final ReaderTMonad&lt;CompletableFutureKind.Witness, AppConfig&gt; cfReaderTMonad =
      new ReaderTMonad&lt;&gt;(futureMonad);

  // Simulates an async call to an external service
  public static Kind&lt;CompletableFutureKind.Witness, ServiceData&gt; fetchExternalData(AppConfig config, String itemId) {
    System.out.println("Thread: " + Thread.currentThread().getName() + " - Fetching external data for " + itemId + " using API key: " + config.apiKey() + " from " + config.serviceUrl());
    CompletableFuture&lt;ServiceData&gt; future = CompletableFuture.supplyAsync(() -&gt; {
      try {
        TimeUnit.MILLISECONDS.sleep(100); // Simulate network latency
      } catch (InterruptedException e) {
        Thread.currentThread().interrupt();
        throw new RuntimeException(e);
      }
      return new ServiceData("Raw data for " + itemId + " from " + config.serviceUrl());
    }, config.executor());
    return FUTURE.widen(future);
  }

  // Operation 1: Fetch data, wrapped in ReaderT
  // This is R -&gt; F&lt;A&gt; which is the core of ReaderT
  public static ReaderT&lt;CompletableFutureKind.Witness, AppConfig, ServiceData&gt; fetchServiceDataRT(String itemId) {
    return ReaderT.of(appConfig -&gt; fetchExternalData(appConfig, itemId));
  }

  // Operation 2: Process data (sync part, depends on AppConfig, then lifts to ReaderT)
  // This uses ReaderT.reader: R -&gt; A, then A is lifted to F&lt;A&gt;
  public static ReaderT&lt;CompletableFutureKind.Witness, AppConfig, ProcessedData&gt; processDataRT(ServiceData sData) {
    return ReaderT.reader(futureMonad, // Outer monad to lift the result
        appConfig -&gt; { // Function R -&gt; A (Config -&gt; ProcessedData)
          System.out.println("Thread: " + Thread.currentThread().getName() + " - Processing data with config: " + appConfig.apiKey());
          return new ProcessedData("Processed: " + sData.rawData().toUpperCase() + " (API Key Suffix: " + appConfig.apiKey().substring(Math.max(0, appConfig.apiKey().length() - 3)) + ")");
        });
  }


  // --- Service Logic (depends on AppConfig, returns Future&lt;ServiceData&gt;) ---

  public static void main(String[] args) throws Exception {
    ExecutorService executor = Executors.newFixedThreadPool(2);
    AppConfig prodConfig = new AppConfig("prod_secret_key_xyz", "https://api.prod.example.com", executor);
    AppConfig stagingConfig = new AppConfig("stag_test_key_123", "https://api.staging.example.com", executor);

    // --- Composing with ReaderTMonad.flatMap ---
    // Define a workflow: fetch data, then process it.
    // The AppConfig is threaded through automatically by ReaderT.
    Kind&lt;ReaderTKind.Witness&lt;CompletableFutureKind.Witness, AppConfig&gt;, ProcessedData&gt; workflowRTKind =
        cfReaderTMonad.flatMap(
            serviceData -&gt; READER_T.widen(processDataRT(serviceData)), // ServiceData -&gt; ReaderTKind&lt;..., ProcessedData&gt;
            READER_T.widen(fetchServiceDataRT("item123")) // Initial ReaderTKind&lt;..., ServiceData&gt;
        );

    // Unwrap to the concrete ReaderT to run it
    ReaderT&lt;CompletableFutureKind.Witness, AppConfig, ProcessedData&gt; composedWorkflow =
        READER_T.narrow(workflowRTKind);

    // --- Running the workflow with different configurations ---

    System.out.println("--- Running with Production Config ---");
    // Run the workflow by providing the 'prodConfig' environment
    // This returns Kind&lt;CompletableFutureKind.Witness, ProcessedData&gt;
    Kind&lt;CompletableFutureKind.Witness, ProcessedData&gt; futureResultProd = composedWorkflow.run().apply(prodConfig);
    ProcessedData resultProd = FUTURE.join(futureResultProd); // Blocks for result
    System.out.println("Prod Result: " + resultProd);
    // Expected output will show "prod_secret_key_xyz", "[https://api.prod.example.com](https://api.prod.example.com)" in logs
    // and "Processed: RAW DATA FOR ITEM123 FROM [https://api.prod.example.com](https://api.prod.example.com) (API Key Suffix: xyz)"


    System.out.println("\n--- Running with Staging Config ---");
    // Run the same workflow with 'stagingConfig'
    Kind&lt;CompletableFutureKind.Witness, ProcessedData&gt; futureResultStaging = composedWorkflow.run().apply(stagingConfig);
    ProcessedData resultStaging = FUTURE.join(futureResultStaging); // Blocks for result
    System.out.println("Staging Result: " + resultStaging);
    // Expected output will show "stag_test_key_123", "[https://api.staging.example.com](https://api.staging.example.com)" in logs
    // and "Processed: RAW DATA FOR ITEM123 FROM [https://api.staging.example.com](https://api.staging.example.com) (API Key Suffix: 123)"


    // --- Another example: Using ReaderT.ask ---
    ReaderT&lt;CompletableFutureKind.Witness, AppConfig, AppConfig&gt; getConfigSettingRT =
        ReaderT.ask(futureMonad); // Provides the whole AppConfig

    Kind&lt;ReaderTKind.Witness&lt;CompletableFutureKind.Witness, AppConfig&gt;, String&gt; getServiceUrlRT =
        cfReaderTMonad.map(
            (AppConfig cfg) -&gt; "Service URL from ask: " + cfg.serviceUrl(),
            READER_T.widen(getConfigSettingRT)
        );

    String stagingServiceUrl = FUTURE.join(
        READER_T.narrow(getServiceUrlRT).run().apply(stagingConfig)
    );
    System.out.println("\nStaging Service URL via ask: " + stagingServiceUrl);


    executor.shutdown();
    try {
      if (!executor.awaitTermination(5, TimeUnit.SECONDS)) {
        executor.shutdownNow();
      }
    } catch (InterruptedException e) {
      executor.shutdownNow();
      Thread.currentThread().interrupt();
    }
  }

  // --- ReaderT-based Service Operations ---

  // --- Environment ---
  record AppConfig(String apiKey, String serviceUrl, ExecutorService executor) {
  }

  // --- Service Response ---
  record ServiceData(String rawData) {
  }

  record ProcessedData(String info) {
  }
}
</code></pre>
<p><strong>This</strong> example demonstrates:</p>
<ol>
<li>Defining an <code>AppConfig</code> environment.</li>
<li>Creating service operations (<code>WorkspaceServiceDataRT</code>, <code>processDataRT</code>) that return <code>ReaderT&lt;CompletableFutureKind, AppConfig, A&gt;</code>. These operations implicitly depend on <code>AppConfig</code>.</li>
<li>Using <code>cfReaderTMonad.flatMap</code> to chain these operations. The <code>AppConfig</code> is passed implicitly through the chain.</li>
<li>Executing the composed workflow (<code>composedWorkflow.run().apply(config)</code>) by providing a specific <code>AppConfig</code>. This "injects" the dependency at the very end.</li>
<li>The asynchronicity from <code>CompletableFuture</code> is handled by the <code>futureMonad</code> within <code>ReaderTMonad</code> and <code>ReaderT</code>'s factories.</li>
<li>Using <code>ReaderT.ask</code> to directly access the configuration within a <code>ReaderT</code> computation.</li>
</ol>
</div>
</div>
<div id="admonition-key-points" class="admonition admonish-tip" role="note" aria-labelledby="admonition-key-points-title">
<div class="admonition-title">
<div id="admonition-key-points-title">
<p>Key Points:</p>
</div>
<a class="admonition-anchor-link" href="transformers/readert_transformer.html#admonition-key-points"></a>
</div>
<div>
<p><code>ReaderT</code> simplifies managing computations that require a shared, read-only environment while also dealing with other monadic effects, leading to cleaner, more composable, and testable code by deferring environment injection.</p>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="the-statet-transformer"><a class="header" href="#the-statet-transformer">The StateT Transformer:</a></h1>
<h2 id="monad-transformer"><a class="header" href="#monad-transformer"><em>Monad Transformer</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="transformers/statet_transformer.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to add stateful computation to any existing monad</li>
<li>Building stack operations that can fail (StateT with Optional)</li>
<li>Understanding the relationship between State and StateT&lt;S, Identity, A&gt;</li>
<li>Creating complex workflows that manage both state and other effects</li>
<li>Using <code>get</code>, <code>set</code>, <code>modify</code> operations within transformer contexts</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="transformers/statet_transformer.html#admonition-see-example-code"></a>
</div>
<div>
<ul>
<li>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/state_t/StateTExample.java">StateTExample.java</a></p>
</li>
<li>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/state_t/StateTStackExample.java">StateTStackExample</a></p>
</li>
</ul>
</div>
</div>
<p>The <code>StateT</code> monad transformer is a powerful construct that allows you to add state-management capabilities to an existing monadic context. Think of it as taking the <a href="transformers/../monads/state_monad.html">State Monad</a> and making it work on top of <em>another</em> monad, like <code>OptionalKind</code>, <code>EitherKind</code>, or <code>IOKind</code>.</p>
<p>This is incredibly useful when you have computations that are both stateful and involve other effects, such as:</p>
<ul>
<li>Potentially missing values (<code>Optional</code>)</li>
<li>Operations that can fail (<code>Either</code>, <code>Try</code>)</li>
<li>Side-effecting computations (<code>IO</code>)</li>
</ul>
<h2 id="what-is-statet"><a class="header" href="#what-is-statet">What is StateT?</a></h2>
<p>At its core, a <code>StateT&lt;S, F, A&gt;</code> represents a computation that:</p>
<ol>
<li>Takes an initial state of type <code>S</code>.</li>
<li>Produces a result of type <code>A</code> along with a new state of type <code>S</code>.</li>
<li>And this entire process of producing the <code>(newState, value)</code> pair is itself wrapped in an underlying monadic context <code>F</code>.</li>
</ol>
<p>So, the fundamental structure of a <code>StateT</code> computation can be thought of as a function:
<code>S -&gt; F&lt;StateTuple&lt;S, A&gt;&gt;</code></p>
<p>Where:</p>
<ul>
<li><code>S</code>: The type of the state.</li>
<li><code>F</code>: The witness type for the underlying monad (e.g., <code>OptionalKind.Witness</code>, <code>IOKind.Witness</code>).</li>
<li><code>A</code>: The type of the computed value.</li>
<li><code>StateTuple&lt;S, A&gt;</code>: A simple container holding a pair of <code>(state, value)</code>.</li>
</ul>
<p><img src="transformers/../images/puml/statet_transformer.svg" alt="statet_transformer.svg" /></p>
<h2 id="key-classes-and-concepts-1"><a class="header" href="#key-classes-and-concepts-1">Key Classes and <code>Concepts</code></a></h2>
<ul>
<li><strong><code>StateT&lt;S, F, A&gt;</code></strong>: The primary data type representing the stateful computation stacked on monad <code>F</code>. It holds the function <code>S -&gt; Kind&lt;F, StateTuple&lt;S, A&gt;&gt;</code>.</li>
<li><strong><code>StateTKind&lt;S, F, A&gt;</code></strong>: The <code>Kind</code> representation for <code>StateT</code>, allowing it to be used with <code>higher-kinded-j</code>'s typeclasses like <code>Monad</code>. This is what you'll mostly interact with when using <code>StateT</code> in a generic monadic context.</li>
<li><strong><code>StateTKind.Witness&lt;S, F&gt;</code></strong>: The higher-kinded type witness for <code>StateT&lt;S, F, _&gt;</code>. Note that both the state type <code>S</code> and the underlying monad witness <code>F</code> are part of the <code>StateT</code> witness.</li>
<li><strong><code>StateTMonad&lt;S, F&gt;</code></strong>: The <code>Monad</code> instance for <code>StateT&lt;S, F, _&gt;</code>. It requires a <code>Monad</code> instance for the underlying monad <code>F</code> to function.</li>
<li><strong><code>StateTKindHelper</code></strong>: A utility class providing static methods for working with <code>StateTKind</code>, such as <code>narrow</code> (to convert <code>Kind&lt;StateTKind.Witness&lt;S, F&gt;, A&gt;</code> back to <code>StateT&lt;S, F, A&gt;</code>), <code>runStateT</code>, <code>evalStateT</code>, and <code>execStateT</code>.</li>
<li><strong><code>StateTuple&lt;S, A&gt;</code></strong>: A simple record-like class holding the pair <code>(S state, A value)</code>.</li>
</ul>
<h2 id="motivation-why-use-statet"><a class="header" href="#motivation-why-use-statet">Motivation: Why Use StateT?</a></h2>
<p>Imagine you're processing a sequence of items, and for each item:</p>
<ol>
<li>You need to update some running total (state).</li>
<li>The processing of an item might fail or return no result (e.g., <code>Optional</code>).</li>
</ol>
<p>Without <code>StateT</code>, you might end up with deeply nested <code>Optional&lt;StateTuple&lt;S, A&gt;&gt;</code> and manually manage both the optionality and the state threading. <code>StateT&lt;S, OptionalKind.Witness, A&gt;</code> elegantly combines these concerns.</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/state_t/StateTExample.java">StateTExample.java</a></li>
</ul>
<h3 id="creating-statet-instances"><a class="header" href="#creating-statet-instances">Creating StateT Instances</a></h3>
<p>You typically create <code>StateT</code> instances in a few ways:</p>
<ol>
<li>
<p><strong>Directly with <code>StateT.create()</code></strong>:
This is the most fundamental way, providing the state function and the underlying monad instance.</p>
<pre><code class="language-java">

// Assume S = Integer (state type), F = OptionalKind.Witness, A = String (value type)
 OptionalMonad optionalMonad = OptionalMonad.INSTANCE;

 Function&lt;Integer, Kind&lt;OptionalKind.Witness, StateTuple&lt;Integer, String&gt;&gt;&gt; runFn =
     currentState -&gt; {
       if (currentState &lt; 0) {
         return OPTIONAL.widen(Optional.empty());
       }
       return OPTIONAL.widen(Optional.of(StateTuple.of(currentState + 1, "Value: " + currentState)));
     };

 StateT&lt;Integer, OptionalKind.Witness, String&gt; stateTExplicit =
     StateT.create(runFn, optionalMonad);

 Kind&lt;StateTKind.Witness&lt;Integer, OptionalKind.Witness&gt;, String&gt; stateTKind =
     stateTExplicit;
</code></pre>
</li>
<li>
<p><strong>Lifting values with <code>StateTMonad.of()</code></strong>:
This lifts a pure value <code>A</code> into the <code>StateT</code> context. The state remains unchanged, and the underlying monad <code>F</code> will wrap the result using its own <code>of</code> method.</p>
<pre><code class="language-java"> StateTMonad&lt;Integer, OptionalKind.Witness&gt; stateTMonad = StateTMonad.instance(optionalMonad);

 Kind&lt;StateTKind.Witness&lt;Integer, OptionalKind.Witness&gt;, String&gt; pureStateT =
     stateTMonad.of("pure value");


 Optional&lt;StateTuple&lt;Integer, String&gt;&gt; pureResult =
     OPTIONAL.narrow(STATE_T.runStateT(pureStateT, 10));
 System.out.println("Pure StateT result: " + pureResult);
// When run with state 10, this will result in Optional.of(StateTuple(10, "pure value"))
</code></pre>
</li>
</ol>
<h3 id="running-statet-computations"><a class="header" href="#running-statet-computations">Running StateT Computations</a></h3>
<p>To execute a <code>StateT</code> computation and extract the result, you use methods from <code>StateTKindHelper</code> or directly from the <code>StateT</code> object:</p>
<ul>
<li>
<p><strong><code>runStateT(initialState)</code></strong>: Executes the computation with an <code>initialState</code> and returns the result wrapped in the underlying monad: <code>Kind&lt;F, StateTuple&lt;S, A&gt;&gt;</code>.</p>
<pre><code class="language-java">// Continuing the stateTKind from above:
Kind&lt;OptionalKind.Witness, StateTuple&lt;Integer, String&gt;&gt; resultOptionalTuple =
      StateTKindHelper.runStateT(stateTKind, 10);

  Optional&lt;StateTuple&lt;Integer, String&gt;&gt; actualOptional = OPTIONAL.narrow(resultOptionalTuple);

  if (actualOptional.isPresent()) {
    StateTuple&lt;Integer, String&gt; tuple = actualOptional.get();
    System.out.println("New State (from stateTExplicit): " + tuple.state());
    System.out.println("Value (from stateTExplicit): " + tuple.value());
  } else {
    System.out.println("actualOptional was empty for initial state 10");
  }

  // Example with negative initial state (expecting empty Optional)
  Kind&lt;OptionalKind.Witness, StateTuple&lt;Integer, String&gt;&gt; resultEmptyOptional =
      StateTKindHelper.runStateT(stateTKind, -5);
  Optional&lt;StateTuple&lt;Integer, String&gt;&gt; actualEmpty = OPTIONAL.narrow(resultEmptyOptional);
  // Output: Is empty: true
  System.out.println("Is empty (for initial state -5): " + actualEmpty.isEmpty());

</code></pre>
</li>
<li>
<p><strong><code>evalStateT(initialState)</code></strong>: Executes and gives you <code>Kind&lt;F, A&gt;</code> (the value, discarding the final state).</p>
</li>
<li>
<p><strong><code>execStateT(initialState)</code></strong>: Executes and gives you <code>Kind&lt;F, S&gt;</code> (the final state, discarding the value).</p>
</li>
</ul>
<h3 id="composing-statet-actions"><a class="header" href="#composing-statet-actions">Composing StateT Actions</a></h3>
<p>Like any monad, <code>StateT</code> computations can be composed using <code>map</code> and <code>flatMap</code>.</p>
<ul>
<li>
<p><strong><code>map(Function&lt;A, B&gt; fn)</code></strong>: Transforms the value <code>A</code> to <code>B</code> within the <code>StateT</code> context, leaving the state transformation logic and the underlying monad <code>F</code>'s effect untouched for that step.</p>
<pre><code class="language-java">    Kind&lt;StateTKind.Witness&lt;Integer, OptionalKind.Witness&gt;, Integer&gt; initialComputation =
      StateT.create(s -&gt; OPTIONAL.widen(Optional.of(StateTuple.of(s + 1, s * 2))), optionalMonad);

  Kind&lt;StateTKind.Witness&lt;Integer, OptionalKind.Witness&gt;, String&gt; mappedComputation =
      stateTMonad.map(
          val -&gt; "Computed: " + val,
          initialComputation);

  // Run mappedComputation with initial state 5:
  // 1. initialComputation runs: state becomes 6, value is 10. Wrapped in Optional.
  // 2. map's function ("Computed: " + 10) is applied to 10.
  // Result: Optional.of(StateTuple(6, "Computed: 10"))
  Optional&lt;StateTuple&lt;Integer, String&gt;&gt; mappedResult =
      OPTIONAL.narrow(STATE_T.runStateT(mappedComputation, 5));
  System.out.print("Mapped result (initial state 5): ");
  mappedResult.ifPresentOrElse(System.out::println, () -&gt; System.out.println("Empty"));
  // Output: StateTuple[state=6, value=Computed: 10]
</code></pre>
</li>
<li>
<p><strong><code>flatMap(Function&lt;A, Kind&lt;StateTKind.Witness&lt;S, F&gt;, B&gt;&gt; fn)</code></strong>: Sequences two <code>StateT</code> computations. The state from the first computation is passed to the second. The effects of the underlying monad <code>F</code> are also sequenced according to <code>F</code>'s <code>flatMap</code>.</p>
<pre><code class="language-java">    // stateTMonad and optionalMonad are defined
  Kind&lt;StateTKind.Witness&lt;Integer, OptionalKind.Witness&gt;, Integer&gt; firstStep =
      StateT.create(s -&gt; OPTIONAL.widen(Optional.of(StateTuple.of(s + 1, s * 10))), optionalMonad);

  Function&lt;Integer, Kind&lt;StateTKind.Witness&lt;Integer, OptionalKind.Witness&gt;, String&gt;&gt; secondStepFn =
      prevValue -&gt; StateT.create(
          s -&gt; {
            if (prevValue &gt; 100) {
              return OPTIONAL.widen(Optional.of(StateTuple.of(s + prevValue, "Large: " + prevValue)));
            } else {
              return OPTIONAL.widen(Optional.empty());
            }
          },
          optionalMonad);

  Kind&lt;StateTKind.Witness&lt;Integer, OptionalKind.Witness&gt;, String&gt; combined =
      stateTMonad.flatMap(secondStepFn, firstStep);

  // Run with initial state 15
  // 1. firstStep(15): state=16, value=150. Wrapped in Optional.of.
  // 2. secondStepFn(150) is called. It returns a new StateT.
  // 3. The new StateT is run with state=16:
  //    Its function: s' (which is 16) -&gt; Optional.of(StateTuple(16 + 150, "Large: 150"))
  //    Result: Optional.of(StateTuple(166, "Large: 150"))
  Optional&lt;StateTuple&lt;Integer, String&gt;&gt; combinedResult =
      OPTIONAL.narrow(STATE_T.runStateT(combined, 15));
  System.out.print("Combined result (initial state 15): ");
  combinedResult.ifPresentOrElse(System.out::println, () -&gt; System.out.println("Empty"));

  // Output: StateTuple[state=166, value=Large: 150]

  // Run with initial state 5
  // 1. firstStep(5): state=6, value=50. Wrapped in Optional.of.
  // 2. secondStepFn(50) is called.
  // 3. The new StateT is run with state=6:
  //    Its function: s' (which is 6) -&gt; Optional.empty()
  //    Result: Optional.empty()
  Optional&lt;StateTuple&lt;Integer, String&gt;&gt; combinedEmptyResult =
      OPTIONAL.narrow(STATE_T.runStateT(combined, 5));
  // Output: true
  System.out.println("Is empty from small initial (state 5 for combined): " + combinedEmptyResult.isEmpty());
</code></pre>
</li>
<li>
<p><strong><code>ap(ff, fa)</code></strong>: Applies a wrapped function to a wrapped value.</p>
</li>
</ul>
<div id="admonition-null-handling" class="admonition admonish-warning" role="note" aria-labelledby="admonition-null-handling-title">
<div class="admonition-title">
<div id="admonition-null-handling-title">
<p>Null Handling</p>
</div>
<a class="admonition-anchor-link" href="transformers/statet_transformer.html#admonition-null-handling"></a>
</div>
<div>
<blockquote>
<p><strong>Note on Null Handling:</strong> The <code>ap</code> method requires the function it extracts from the first <code>StateT</code> computation to be non-null. If the function is <code>null</code>, a <code>NullPointerException</code> will be thrown when the computation is executed. It is the developer's responsibility to ensure that any functions provided within a <code>StateT</code> context are non-null. Similarly, the value from the second computation may be <code>null</code>, and the provided function must be able to handle a <code>null</code> input if that is a valid state.</p>
</blockquote>
</div>
</div>
<h3 id="state-specific-operations"><a class="header" href="#state-specific-operations">State-Specific Operations</a></h3>
<p>While <code>higher-kinded-j</code>'s <code>StateT</code> provides the core monadic structure, you'll often want common state operations like <code>get</code>, <code>set</code>, <code>modify</code>. These can be constructed using <code>StateT.create</code> or <code>StateTKind.lift</code>.</p>
<ul>
<li>
<p><strong><code>get()</code></strong>:  Retrieves the current state as the value.</p>
<pre><code class="language-java">public static &lt;S, F&gt; Kind&lt;StateTKind.Witness&lt;S, F&gt;, S&gt; get(Monad&lt;F&gt; monadF) {
  Function&lt;S, Kind&lt;F, StateTuple&lt;S, S&gt;&gt;&gt; runFn = s -&gt; monadF.of(StateTuple.of(s, s));
  return StateT.create(runFn, monadF);
}
// Usage: stateTMonad.flatMap(currentState -&gt; ..., get(optionalMonad))
</code></pre>
</li>
<li>
<p><strong><code>set(newState, monadF)</code></strong>: Replaces the current state with <code>newState</code>. The value is often <code>Void</code> or <code>Unit</code>.</p>
<pre><code class="language-java">public static &lt;S, F&gt; Kind&lt;StateTKind.Witness&lt;S, F&gt;, Unit&gt; set(S newState, Monad&lt;F&gt; monadF) {
  Function&lt;S, Kind&lt;F, StateTuple&lt;S, Void&gt;&gt;&gt; runFn = s -&gt; monadF.of(StateTuple.of(newState, Unit.INSTANCE));
  return StateT.create(runFn, monadF);
}
</code></pre>
</li>
<li>
<p><strong><code>modify(f, monadF)</code></strong>: Modifies the state using a function.</p>
<pre><code class="language-java">public static &lt;S, F&gt; Kind&lt;StateTKind.Witness&lt;S, F&gt;, Unit&gt; modify(Function&lt;S, S&gt; f, Monad&lt;F&gt; monadF) {
  Function&lt;S, Kind&lt;F, StateTuple&lt;S, Unit&gt;&gt;&gt; runFn = s -&gt; monadF.of(StateTuple.of(f.apply(s), Unit.INSTANCE));
  return StateT.create(runFn, monadF);
}
</code></pre>
</li>
<li>
<p><strong><code>gets(f, monadF)</code></strong>: Retrieves a value derived from the current state.</p>
</li>
</ul>
<pre><code class="language-java">public static &lt;S, F, A&gt; Kind&lt;StateTKind.Witness&lt;S, F&gt;, A&gt; gets(Function&lt;S, A&gt; f, Monad&lt;F&gt; monadF) {
Function&lt;S, Kind&lt;F, StateTuple&lt;S, A&gt;&gt;&gt; runFn = s -&gt; monadF.of(StateTuple.of(s, f.apply(s)));
return StateT.create(runFn, monadF);
}
</code></pre>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/state_t/StateTStackExample.java">StateTStackExample.java</a></li>
</ul>
<p>Let's simulate stack operations where the stack is a <code>List&lt;Integer&gt;</code> and operations might be absent if, for example, popping an empty stack.</p>
<pre><code class="language-java">public class StateTStackExample {

  private static final OptionalMonad OPT_MONAD = OptionalMonad.INSTANCE;
  private static final StateTMonad&lt;List&lt;Integer&gt;, OptionalKind.Witness&gt; ST_OPT_MONAD =
      StateTMonad.instance(OPT_MONAD);

  // Helper to lift a state function into StateT&lt;List&lt;Integer&gt;, OptionalKind.Witness, A&gt;
  private static &lt;A&gt; Kind&lt;StateTKind.Witness&lt;List&lt;Integer&gt;, OptionalKind.Witness&gt;, A&gt; liftOpt(
      Function&lt;List&lt;Integer&gt;, Kind&lt;OptionalKind.Witness, StateTuple&lt;List&lt;Integer&gt;, A&gt;&gt;&gt; f) {
    return StateTKindHelper.stateT(f, OPT_MONAD);
  }

  // push operation
  public static Kind&lt;StateTKind.Witness&lt;List&lt;Integer&gt;, OptionalKind.Witness&gt;, Unit&gt; push(Integer value) {
    return liftOpt(stack -&gt; {
      List&lt;Integer&gt; newStack = new LinkedList&lt;&gt;(stack);
      newStack.add(0, value); // Add to front
      return OPTIONAL.widen(Optional.of(StateTuple.of(newStack, Unit.INSTANCE)));
    });
  }

  // pop operation
  public static Kind&lt;StateTKind.Witness&lt;List&lt;Integer&gt;, OptionalKind.Witness&gt;, Integer&gt; pop() {
    return liftOpt(stack -&gt; {
      if (stack.isEmpty()) {
        return OPTIONAL.widen(Optional.empty()); // Cannot pop from empty stack
      }
      List&lt;Integer&gt; newStack = new LinkedList&lt;&gt;(stack);
      Integer poppedValue = newStack.remove(0);
      return OPTIONAL.widen(Optional.of(StateTuple.of(newStack, poppedValue)));
    });
  }

  public static void main(String[] args) {
    var computation =
        For.from(ST_OPT_MONAD, push(10))
            .from(_ -&gt; push(20))
            .from(_ -&gt; pop())
            .from(_ -&gt; pop()) // t._3() is the first popped value
            .yield((a, b, p1, p2) -&gt; {
              System.out.println("Popped in order: " + p1 + ", then " + p2);
              return p1 + p2;
            });


    List&lt;Integer&gt; initialStack = Collections.emptyList();
    Kind&lt;OptionalKind.Witness, StateTuple&lt;List&lt;Integer&gt;, Integer&gt;&gt; resultWrapped =
        StateTKindHelper.runStateT(computation, initialStack);

    Optional&lt;StateTuple&lt;List&lt;Integer&gt;, Integer&gt;&gt; resultOpt =
        OPTIONAL.narrow(resultWrapped);

    resultOpt.ifPresentOrElse(
        tuple -&gt; {
          System.out.println("Final value: " + tuple.value());       // Expected: 30
          System.out.println("Final stack: " + tuple.state());       // Expected: [] (empty)
        },
        () -&gt; System.out.println("Computation resulted in empty Optional.")
    );

    // Example of popping an empty stack
    Kind&lt;StateTKind.Witness&lt;List&lt;Integer&gt;, OptionalKind.Witness&gt;, Integer&gt; popEmptyStack = pop();
    Optional&lt;StateTuple&lt;List&lt;Integer&gt;, Integer&gt;&gt; emptyPopResult =
        OPTIONAL.narrow(StateTKindHelper.runStateT(popEmptyStack, Collections.emptyList()));
    System.out.println("Popping empty stack was successful: " + emptyPopResult.isPresent()); // false
  }
}
</code></pre>
<div id="admonition-key-points" class="admonition admonish-tip" role="note" aria-labelledby="admonition-key-points-title">
<div class="admonition-title">
<div id="admonition-key-points-title">
<p>Key Points:</p>
</div>
<a class="admonition-anchor-link" href="transformers/statet_transformer.html#admonition-key-points"></a>
</div>
<div>
<h2 id="relationship-to-state-monad"><a class="header" href="#relationship-to-state-monad">Relationship to State Monad</a></h2>
<p>The <a href="transformers/../monads/state_monad.html">State Monad</a> (<code>State&lt;S, A&gt;</code>) can be seen as a specialised version of <code>StateT</code>. Specifically, <code>State&lt;S, A&gt;</code> is equivalent to <code>StateT&lt;S, Id, A&gt;</code>, where <code>Id</code> is the Identity monad (a monad that doesn't add any effects, simply <code>Id&lt;A&gt; = A</code>). <code>higher-kinded-j</code> provides an <code>Id</code> monad. <code>State&lt;S, A&gt;</code> can be seen as an equivalent to <code>StateT&lt;S, Id.Witness, A&gt;</code>.</p>
<h2 id="further-reading"><a class="header" href="#further-reading">Further Reading</a></h2>
<ul>
<li><a href="transformers/../monads/state_monad.html">State Monad</a>: Understand the basics of stateful computations.</li>
<li><a href="transformers/./transformers.html">Monad Transformers</a>: General concept of monad transformers.</li>
<li>Documentation for the underlying monads you might use with <code>StateT</code>, such as:
<ul>
<li><a href="transformers/../monads/optional_monad.html">OptionalKind</a></li>
<li><a href="transformers/../monads/either_monad.html">EitherKind</a></li>
<li><a href="transformers/../monads/io_monad.html">IOKind</a></li>
</ul>
</li>
</ul>
<p>Using <code>StateT</code>, helps write cleaner, more composable code when dealing with computations that involve both state and other monadic effects.</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="the-order-workflow-example"><a class="header" href="#the-order-workflow-example">The Order Workflow Example</a></h1>
<p>This example is a practical demonstration of how to use the Higher-Kinded-J library to manage a common real-world scenario.</p>
<p>The scenario covers an Order workflow that involves asynchronous operations.  The Operations can fail with specific, expected business errors.</p>
<h2 id="async-operations-with-error-handling"><a class="header" href="#async-operations-with-error-handling">Async Operations with Error Handling:</a></h2>
<p>You can find the code for the Order Processing example in the <a href="https://github.com/higher-kinded-j/higher-kinded-j/tree/main/hkj-examples/src/main/java/org/higherkindedj/example/order/workflow"><code>org.higherkindedj.example.order</code></a> package.</p>
<p><strong>Goal of this Example:</strong></p>
<ul>
<li>To show how to compose asynchronous steps (using <code>CompletableFuture</code>) with steps that might result in domain-specific errors (using <code>Either</code>).</li>
<li>To introduce the <strong><code>EitherT</code> monad transformer</strong> as a powerful tool to simplify working with nested structures like <code>CompletableFuture&lt;Either&lt;DomainError, Result&gt;&gt;</code>.</li>
<li>To illustrate how to handle different kinds of errors:
<ul>
<li><strong>Domain Errors:</strong> Expected business failures (e.g., invalid input, item out of stock) represented by <code>Either.Left</code>.</li>
<li><strong>System Errors:</strong> Unexpected issues during async execution (e.g., network timeouts) handled by <code>CompletableFuture</code>.</li>
<li><strong>Synchronous Exceptions:</strong> Using <code>Try</code> to capture exceptions from synchronous code and integrate them into the error handling flow.</li>
</ul>
</li>
<li>To demonstrate error recovery using <code>MonadError</code> capabilities.</li>
<li>To show how dependencies (like logging) can be managed within the workflow steps.</li>
</ul>
<p><strong>Prerequisites:</strong></p>
<p>Before diving in, it's helpful to have a basic understanding of:</p>
<ul>
<li><a href="hkts/core-concepts.html">Core Concepts</a> of Higher-Kinded-J (<code>Kind</code>and Type Classes).</li>
<li>The specific types being used: <a href="hkts/../monads/supported-types.html">Supported Types</a>.</li>
<li>The general <a href="hkts/usage-guide.html">Usage Guide</a>.</li>
</ul>
<p><strong>Key Files:</strong></p>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/order/workflow/Dependencies.java"><code>Dependencies.java</code></a>: Holds external dependencies (e.g., logger).</li>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/order/workflow/OrderWorkflowRunner.java"><code>OrderWorkflowRunner.java</code></a>: Orchestrates the workflow, initialising and running different workflow versions (Workflow1 and Workflow2).</li>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/order/workflow/OrderWorkflowSteps.java"><code>OrderWorkflowSteps.java</code></a>: Defines the individual workflow steps (sync/async), accepting <code>Dependencies</code>.</li>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/order/workflow/Workflow1.java"><code>Workflow1.java</code></a>: Implements the order processing workflow using <code>EitherT</code> over <code>CompletableFuture</code>, with the initial validation step using an <code>Either</code>.</li>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/order/workflow/Workflow2.java"><code>Workflow2.java</code></a>: Implements a similar workflow to <code>Workflow1</code>, but the initial validation step uses a <code>Try</code> that is then converted to an <code>Either</code>.</li>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/order/model/WorkflowModels.java"><code>WorkflowModels.java</code></a>: Data records (<code>OrderData</code>, <code>ValidatedOrder</code>, etc.).</li>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/order/error/DomainError.java"><code>DomainError.java</code></a>: Sealed interface defining specific business errors.</li>
</ul>
<hr />
<h2 id="order-processing-workflow"><a class="header" href="#order-processing-workflow">Order Processing Workflow</a></h2>
<p><img src="hkts/../images/mermaid-flow-transparent.svg" alt="mermaid-flow-transparent.svg" /></p>
<hr />
<h2 id="the-problem-combining-asynchronicity-and-typed-errors"><a class="header" href="#the-problem-combining-asynchronicity-and-typed-errors">The Problem: Combining Asynchronicity and Typed Errors</a></h2>
<p>Imagine an online order process with the following stages:</p>
<ol>
<li><strong>Validate Order Data:</strong> Check quantity, product ID, etc. (Can fail with <code>ValidationError</code>). This is a synchronous operation.</li>
<li><strong>Check Inventory:</strong> Call an external inventory service (async). (Can fail with <code>StockError</code>).</li>
<li><strong>Process Payment:</strong> Call a payment gateway (async). (Can fail with <code>PaymentError</code>).</li>
<li><strong>Create Shipment:</strong> Call a shipping service (async). (Can fail with <code>ShippingError</code>, some of which might be recoverable).</li>
<li><strong>Notify Customer:</strong> Send an email/SMS (async). (Might fail, but should not critically fail the entire order).</li>
</ol>
<p>We face several challenges:</p>
<ul>
<li><strong>Asynchronicity:</strong> Steps 2, 3, 4, 5 involve network calls and should use <code>CompletableFuture</code>.</li>
<li><strong>Domain Errors:</strong> Steps can fail for specific business reasons. We want to represent these failures with <em>types</em> (like <code>ValidationError</code>, <code>StockError</code>) rather than just generic exceptions or nulls. <code>Either&lt;DomainError, SuccessValue&gt;</code> is a good fit for this.</li>
<li><strong>Composition:</strong> How do we chain these steps together? Directly nesting <code>CompletableFuture&lt;Either&lt;DomainError, ...&gt;&gt;</code> leads to complex and hard-to-read code (often called "callback hell" or nested <code>thenCompose</code>/<code>thenApply</code> chains).</li>
<li><strong>Short-Circuiting:</strong> If validation fails (returns <code>Left(ValidationError)</code>), we shouldn't proceed to check inventory or process payment. The workflow should stop and return the validation error.</li>
<li><strong>Dependencies &amp; Logging:</strong> Steps need access to external resources (like service clients, configuration, loggers). How do we manage this cleanly?</li>
</ul>
<h2 id="the-solution-eithert-monad-transformer--dependency-injection"><a class="header" href="#the-solution-eithert-monad-transformer--dependency-injection">The Solution: <code>EitherT</code> Monad Transformer + Dependency Injection</a></h2>
<p>This example tackles these challenges using:</p>
<ol>
<li><strong><code>Either&lt;DomainError, R&gt;</code></strong>: To represent the result of steps that can fail with a specific business error (<code>DomainError</code>). <code>Left</code> holds the error, <code>Right</code> holds the success value <code>R</code>.</li>
<li><strong><code>CompletableFuture&lt;T&gt;</code></strong>: To handle the asynchronous nature of external service calls. It also inherently handles system-level exceptions (network timeouts, service unavailability) by completing exceptionally with a <code>Throwable</code>.</li>
<li><strong><code>EitherT&lt;F_OUTER_WITNESS, L_ERROR, R_VALUE&gt;</code></strong>: The key component! This <em>monad transformer</em> wraps a nested structure <code>Kind&lt;F_OUTER_WITNESS, Either&lt;L_ERROR, R_VALUE&gt;&gt;</code>. In our case:
<ul>
<li><code>F_OUTER_WITNESS</code> (Outer Monad's Witness) = <code>CompletableFutureKind.Witness</code> (handling async and system errors <code>Throwable</code>).</li>
<li><code>L_ERROR</code> (Left Type) = <code>DomainError</code> (handling business errors).</li>
<li><code>R_VALUE</code> (Right Type) = The success value of a step.
It provides <code>map</code>, <code>flatMap</code>, and <code>handleErrorWith</code> operations that work seamlessly across <em>both</em> the outer <code>CompletableFuture</code> context and the inner <code>Either</code> context.</li>
</ul>
</li>
<li><strong>Dependency Injection:</strong> A <code>Dependencies</code> record holds external collaborators (like a logger). This record is passed to <code>OrderWorkflowSteps</code>, making dependencies explicit and testable.</li>
<li><strong>Structured Logging:</strong> Steps use the injected logger (<code>dependencies.log(...)</code>) for consistent logging.</li>
</ol>
<h3 id="setting-up-eithertmonad"><a class="header" href="#setting-up-eithertmonad">Setting up <code>EitherTMonad</code></a></h3>
<p>In <code>OrderWorkflowRunner</code>, we get the necessary type class instances:</p>
<pre><code class="language-java">// MonadError instance for CompletableFuture (handles Throwable)
// F_OUTER_WITNESS for CompletableFuture is CompletableFutureKind.Witness
private final @NonNull MonadError&lt;CompletableFutureKind.Witness, Throwable&gt; futureMonad =
    CompletableFutureMonad.INSTANCE;

// EitherTMonad instance, providing the outer monad (futureMonad).
// This instance handles DomainError for the inner Either.
// The HKT witness for EitherT here is EitherTKind.Witness&lt;CompletableFutureKind.Witness, DomainError&gt;
private final @NonNull
MonadError&lt;EitherTKind.Witness&lt;CompletableFutureKind.Witness, DomainError&gt;, DomainError&gt;
    eitherTMonad = new EitherTMonad&lt;&gt;(this.futureMonad);
</code></pre>
<p>Now, <code>eitherTMonad</code> can be used to chain operations on <code>EitherT</code> values (which are <code>Kind&lt;EitherTKind.Witness&lt;CompletableFutureKind.Witness, DomainError&gt;, A&gt;</code>). Its <code>flatMap</code> method automatically handles:</p>
<ul>
<li><strong>Async Sequencing:</strong> Delegated to <code>futureMonad.flatMap</code> (which translates to <code>CompletableFuture::thenCompose</code>).</li>
<li><strong>Error Short-Circuiting:</strong> If an inner <code>Either</code> becomes <code>Left(domainError)</code>, subsequent <code>flatMap</code> operations are skipped, propagating the <code>Left</code> within the <code>CompletableFuture</code>.</li>
</ul>
<h2 id="workflow-step-by-step-workflow1java"><a class="header" href="#workflow-step-by-step-workflow1java">Workflow Step-by-Step (<code>Workflow1.java</code>)</a></h2>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/order/workflow/Workflow1.java">Workflow1.java</a></li>
</ul>
<p>Let's trace the execution flow defined in <code>Workflow1</code>. The workflow uses a <code>For</code> comprehension to sequentially chain the steps. steps. The state (<code>WorkflowContext</code>) is carried implicitly within the <code>Right</code> side of the <code>EitherT</code>.</p>
<p>The <code>OrderWorkflowRunner</code> initialises and calls <code>Workflow1</code> (or <code>Workflow2</code>). The core logic for composing the steps resides within these classes.</p>
<p>We start with <code>OrderData</code> and create an initial <code>WorkflowContext</code>.</p>
<p>Next <code>eitherTMonad.of(initialContext)</code> lifts this context into an <code>EitherT</code> value. This represents a <code>CompletableFuture</code> that is already successfully completed with an <code>Either.Right(initialContext)</code>.We start with OrderData and create an initial WorkflowContext.
eitherTMonad.of(initialContext) lifts this context into an EitherT value. This represents a CompletableFuture that is already successfully completed with an Either.Right(initialContext).</p>
<pre><code class="language-java">// From Workflow1.run()

var initialContext = WorkflowModels.WorkflowContext.start(orderData);

// The For-comprehension expresses the workflow sequentially.
// Each 'from' step represents a monadic bind (flatMap).
var workflow = For.from(eitherTMonad, eitherTMonad.of(initialContext))
    // Step 1: Validation. The lambda receives the initial context.
    .from(ctx1 -&gt; {
      var validatedOrderET = EitherT.fromEither(futureMonad, EITHER.narrow(steps.validateOrder(ctx1.initialData())));
      return eitherTMonad.map(ctx1::withValidatedOrder, validatedOrderET);
    })
    // Step 2: Inventory. The lambda receives a tuple of (initial context, context after validation).
    .from(t -&gt; {
      var ctx = t._2(); // Get the context from the previous step
      var inventoryCheckET = EitherT.fromKind(steps.checkInventoryAsync(ctx.validatedOrder().productId(), ctx.validatedOrder().quantity()));
      return eitherTMonad.map(ignored -&gt; ctx.withInventoryChecked(), inventoryCheckET);
    })
    // Step 3: Payment. The lambda receives a tuple of all previous results. The latest context is the last element.
    .from(t -&gt; {
      var ctx = t._3(); // Get the context from the previous step
      var paymentConfirmET = EitherT.fromKind(steps.processPaymentAsync(ctx.validatedOrder().paymentDetails(), ctx.validatedOrder().amount()));
      return eitherTMonad.map(ctx::withPaymentConfirmation, paymentConfirmET);
    })
    // Step 4: Shipment (with error handling).
    .from(t -&gt; {
        var ctx = t._4(); // Get the context from the previous step
        var shipmentAttemptET = EitherT.fromKind(steps.createShipmentAsync(ctx.validatedOrder().orderId(), ctx.validatedOrder().shippingAddress()));
        var recoveredShipmentET = eitherTMonad.handleErrorWith(shipmentAttemptET, error -&gt; {
            if (error instanceof DomainError.ShippingError(var reason) &amp;&amp; "Temporary Glitch".equals(reason)) {
                dependencies.log("WARN: Recovering from temporary shipping glitch for order " + ctx.validatedOrder().orderId());
                return eitherTMonad.of(new WorkflowModels.ShipmentInfo("DEFAULT_SHIPPING_USED"));
            }
            return eitherTMonad.raiseError(error);
        });
        return eitherTMonad.map(ctx::withShipmentInfo, recoveredShipmentET);
    })
    // Step 5 &amp; 6 are combined in the yield for a cleaner result.
    .yield(t -&gt; {
      var finalContext = t._5(); // The context after the last 'from'
      var finalResult = new WorkflowModels.FinalResult(
          finalContext.validatedOrder().orderId(),
          finalContext.paymentConfirmation().transactionId(),
          finalContext.shipmentInfo().trackingId()
      );

      // Attempt notification, but recover from failure, returning the original FinalResult.
      var notifyET = EitherT.fromKind(steps.notifyCustomerAsync(finalContext.initialData().customerId(), "Order processed: " + finalResult.orderId()));
      var recoveredNotifyET = eitherTMonad.handleError(notifyET, notifyError -&gt; {
        dependencies.log("WARN: Notification failed for order " + finalResult.orderId() + ": " + notifyError.message());
        return Unit.INSTANCE;
      });

      // Map the result of the notification back to the FinalResult we want to return.
      return eitherTMonad.map(ignored -&gt; finalResult, recoveredNotifyET);
    });

// The yield returns a Kind&lt;M, Kind&lt;M, R&gt;&gt;, so we must flatten it one last time.
var flattenedFinalResultET = eitherTMonad.flatMap(x -&gt; x, workflow);

var finalConcreteET = EITHER_T.narrow(flattenedFinalResultET);
return finalConcreteET.value();
</code></pre>
<p>There is a lot going on in the <code>For</code> comprehension so lets try and unpick it.</p>
<h4 id="breakdown-of-the-for-comprehension"><a class="header" href="#breakdown-of-the-for-comprehension">Breakdown of the <code>For</code> Comprehension:</a></h4>
<ol>
<li><strong><code>For.from(eitherTMonad, eitherTMonad.of(initialContext))</code></strong>: The comprehension is initiated with a starting value. We lift the initial <code>WorkflowContext</code> into our <code>EitherT</code> monad, representing a successful, asynchronous starting point: <code>Future&lt;Right(initialContext)&gt;</code>.</li>
<li><strong><code>.from(ctx1 -&gt; ...)</code> (Validation)</strong>:
<ul>
<li><strong>Purpose:</strong> Validates the basic order data.</li>
<li><strong>Sync/Async:</strong> Synchronous. <code>steps.validateOrder</code> returns <code>Kind&lt;EitherKind.Witness&lt;DomainError&gt;, ValidatedOrder&gt;</code>.</li>
<li><strong>HKT Integration:</strong> The <code>Either</code> result is lifted into the <code>EitherT&lt;CompletableFuture, ...&gt;</code> context using <code>EitherT.fromEither(...)</code>. This wraps the immediate <code>Either</code> result in a <em>completed</em><code>CompletableFuture</code>.</li>
<li><strong>Error Handling:</strong> If validation fails, <code>validateOrder</code> returns a <code>Left(ValidationError)</code>. This becomes a <code>Future&lt;Left(ValidationError)&gt;</code>, and the <code>For</code> comprehension automatically short-circuits, skipping all subsequent steps.</li>
</ul>
</li>
<li><strong><code>.from(t -&gt; ...)</code> (Inventory Check)</strong>:
<ul>
<li><strong>Purpose:</strong> Asynchronously checks if the product is in stock.</li>
<li><strong>Sync/Async:</strong> Asynchronous. <code>steps.checkInventoryAsync</code> returns <code>Kind&lt;CompletableFutureKind.Witness, Either&lt;DomainError, Unit&gt;&gt;</code>.</li>
<li><strong>HKT Integration:</strong> The <code>Kind</code> returned by the async step is directly wrapped into <code>EitherT</code> using <code>EitherT.fromKind(...)</code>.</li>
<li><strong>Error Handling:</strong> Propagates <code>Left(StockError)</code> or underlying <code>CompletableFuture</code> failures.</li>
</ul>
</li>
<li><strong><code>.from(t -&gt; ...)</code> (Payment)</strong>:
<ul>
<li><strong>Purpose:</strong> Asynchronously processes the payment.</li>
<li><strong>Sync/Async:</strong> Asynchronous.</li>
<li><strong>HKT Integration &amp; Error Handling:</strong> Works just like the inventory check, propagating <code>Left(PaymentError)</code> or <code>CompletableFuture</code> failures.</li>
</ul>
</li>
<li><strong><code>.from(t -&gt; ...)</code> (Shipment with Recovery)</strong>:
<ul>
<li><strong>Purpose:</strong> Asynchronously creates a shipment.</li>
<li><strong>HKT Integration:</strong> Uses <code>EitherT.fromKind</code> and <code>eitherTMonad.handleErrorWith</code>.</li>
<li><strong>Error Handling &amp; Recovery:</strong> If <code>createShipmentAsync</code> returns a <code>Left(ShippingError("Temporary Glitch"))</code>, the <code>handleErrorWith</code> block catches it and returns a <em>successful</em><code>EitherT</code> with default shipment info, allowing the workflow to proceed. All other errors are propagated.</li>
</ul>
</li>
<li><strong><code>.yield(t -&gt; ...)</code> (Final Result and Notification)</strong>:
<ul>
<li><strong>Purpose:</strong> The final block of the <code>For</code> comprehension. It takes the accumulated results from all previous steps (in a tuple <code>t</code>) and produces the final result of the entire chain.</li>
<li><strong>Logic:</strong>
<ol>
<li>It constructs the <code>FinalResult</code> from the successful <code>WorkflowContext</code>.</li>
<li>It attempts the final, non-critical notification step (<code>notifyCustomerAsync</code>).</li>
<li>Crucially, it uses <code>handleError</code> on the notification result. If notification fails, it logs a warning but recovers to a <code>Right(Unit.INSTANCE)</code>, ensuring the overall workflow remains successful.</li>
<li>It then maps the result of the recovered notification step back to the <code>FinalResult</code>, which becomes the final value of the entire comprehension.</li>
</ol>
</li>
</ul>
</li>
<li><strong>Final <code>flatMap</code> and Unwrapping</strong>:
<ul>
<li>The <code>yield</code> block itself can return a monadic value. To get the final, single-layer result, we do one last <code>flatMap</code> over the <code>For</code> comprehension's result.</li>
<li>Finally, <code>EITHER_T.narrow(...)</code> and <code>.value()</code> are used to extract the underlying <code>Kind&lt;CompletableFutureKind.Witness, Either&lt;...&gt;&gt;</code> from the <code>EitherT</code> record. The <code>main</code> method in <code>OrderWorkflowRunner</code> then uses <code>FUTURE.narrow()</code> and <code>.join()</code> to get the final <code>Either</code> result for printing.</li>
</ul>
</li>
</ol>
<hr />
<h2 id="alternative-handling-exceptions-with-try-workflow2java"><a class="header" href="#alternative-handling-exceptions-with-try-workflow2java">Alternative: Handling Exceptions with <code>Try</code> (<code>Workflow2.java</code>)</a></h2>
<p>The <code>OrderWorkflowRunner</code> also initialises and can run <code>Workflow2</code>. This workflow is identical to Workflow1 except for the first step. It demonstrates how to integrate synchronous code that might throw exceptions.</p>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/order/workflow/Workflow2.java">Workflow2.java</a></li>
</ul>
<pre><code class="language-java">// From Workflow2.run(), inside the first .from(...)
.from(ctx1 -&gt; {
  var tryResult = TRY.narrow(steps.validateOrderWithTry(ctx1.initialData()));
  var eitherResult = tryResult.toEither(
      throwable -&gt; (DomainError) new DomainError.ValidationError(throwable.getMessage()));
  var validatedOrderET = EitherT.fromEither(futureMonad, eitherResult);
  // ... map context ...
})
</code></pre>
<ul>
<li>The <code>steps.validateOrderWithTry</code> method is designed to throw exceptions on validation failure (e.g., <code>IllegalArgumentException</code>).</li>
<li><code>TRY.tryOf(...)</code> in <code>OrderWorkflowSteps</code> wraps this potentially exception-throwing code, returning a <code>Kind&lt;TryKind.Witness, ValidatedOrder&gt;</code>.</li>
<li>In <code>Workflow2</code>, we <code>narrow</code> this to a concrete <code>Try&lt;ValidatedOrder&gt;</code>.</li>
<li>We use <code>tryResult.toEither(...)</code> to convert the <code>Try</code> into an <code>Either&lt;DomainError, ValidatedOrder&gt;</code>:
<ul>
<li>A <code>Try.Success(validatedOrder)</code> becomes <code>Either.right(validatedOrder)</code>.</li>
<li>A <code>Try.Failure(throwable)</code> is mapped to an <code>Either.left(new DomainError.ValidationError(throwable.getMessage()))</code>.</li>
</ul>
</li>
<li>The resulting <code>Either</code> is then lifted into <code>EitherT</code> using <code>EitherT.fromEither</code>, and the rest of the workflow proceeds as before.</li>
</ul>
<p>This demonstrates a practical pattern for integrating synchronous, exception-throwing code into the <code>EitherT</code>-based workflow by explicitly converting failures into your defined <code>DomainError</code> types.</p>
<hr />
<div id="admonition-key-points" class="admonition admonish-tip" role="note" aria-labelledby="admonition-key-points-title">
<div class="admonition-title">
<div id="admonition-key-points-title">
<p>Key Points:</p>
</div>
<a class="admonition-anchor-link" href="hkts/order-walkthrough.html#admonition-key-points"></a>
</div>
<div>
<p>This example illustrates several powerful patterns enabled by Higher-Kinded-J:</p>
<ol>
<li><strong><code>EitherT</code> for <code>Future&lt;Either&lt;Error, Value&gt;&gt;</code></strong>: This is the core pattern. Use <code>EitherT</code> whenever you need to sequence asynchronous operations (<code>CompletableFuture</code>) where each step can also fail with a specific, typed error (<code>Either</code>).
<ul>
<li>Instantiate <code>EitherTMonad&lt;F_OUTER_WITNESS, L_ERROR&gt;</code> with the <code>Monad&lt;F_OUTER_WITNESS&gt;</code> instance for your outer monad (e.g., <code>CompletableFutureMonad</code>).</li>
<li>Use <code>eitherTMonad.flatMap</code> or a <code>For</code> comprehension to chain steps.</li>
<li>Lift async results (<code>Kind&lt;F_OUTER_WITNESS, Either&lt;L, R&gt;&gt;</code>) into <code>EitherT</code> using <code>EitherT.fromKind</code>.</li>
<li>Lift sync results (<code>Either&lt;L, R&gt;</code>) into <code>EitherT</code> using <code>EitherT.fromEither</code>.</li>
<li>Lift pure values (<code>R</code>) into <code>EitherT</code> using <code>eitherTMonad.of</code> or <code>EitherT.right</code>.</li>
<li>Lift errors (<code>L</code>) into <code>EitherT</code> using <code>eitherTMonad.raiseError</code> or <code>EitherT.left</code>.</li>
</ul>
</li>
<li><strong>Typed Domain Errors</strong>: Use <code>Either</code> (often with a sealed interface like <code>DomainError</code> for the <code>Left</code> type) to represent expected business failures clearly. This improves type safety and makes error handling more explicit.</li>
<li><strong>Error Recovery</strong>: Use <code>eitherTMonad.handleErrorWith</code> (for complex recovery returning another <code>EitherT</code>) or <code>handleError</code> (for simpler recovery to a pure value for the <code>Right</code> side) to inspect <code>DomainError</code>s and potentially recover, allowing the workflow to continue gracefully.</li>
<li><strong>Integrating <code>Try</code></strong>: If dealing with synchronous legacy code or libraries that throw exceptions, wrap calls using <code>TRY.tryOf</code>. Then, <code>narrow</code> the <code>Try</code> and use <code>toEither</code> (or <code>fold</code>) to convert <code>Try.Failure</code> into an appropriate <code>Either.Left&lt;DomainError&gt;</code> before lifting into <code>EitherT</code>.</li>
<li><strong>Dependency Injection</strong>: Pass necessary dependencies (loggers, service clients, configurations) into your workflow steps (e.g., via a constructor and a <code>Dependencies</code> record). This promotes loose coupling and testability.</li>
<li><strong>Structured Logging</strong>: Use an injected logger within steps to provide visibility into the workflow's progress and state without tying the steps to a specific logging implementation (like <code>System.out</code>).</li>
<li><strong><code>var</code> for Conciseness</strong>: Utilise Java's <code>var</code> for local variable type inference where the type is clear from the right-hand side of an assignment. This can reduce verbosity, especially with complex generic types common in HKT.</li>
</ol>
</div>
</div>
<hr />
<div id="admonition-further-considerations--potential-enhancements" class="admonition admonish-success" role="note" aria-labelledby="admonition-further-considerations--potential-enhancements-title">
<div class="admonition-title">
<div id="admonition-further-considerations--potential-enhancements-title">
<p>Further Considerations &amp; Potential Enhancements</p>
</div>
<a class="admonition-anchor-link" href="hkts/order-walkthrough.html#admonition-further-considerations--potential-enhancements"></a>
</div>
<div>
<p>While this example covers a the core concepts, a real-world application might involve more complexities. Here are some areas to consider for further refinement:</p>
<ol>
<li><strong>More Sophisticated Error Handling/Retries:</strong>
<ul>
<li><strong>Retry Mechanisms:</strong> For transient errors (like network hiccups or temporary service unavailability), you might implement retry logic. This could involve retrying a failed async step a certain number of times with exponential backoff. While <code>higher-kinded-j</code> itself doesn't provide specific retry utilities, you could integrate libraries like Resilience4j or implement custom retry logic within a <code>flatMap</code> or <code>handleErrorWith</code> block.</li>
<li><strong>Compensating Actions (Sagas):</strong> If a step fails after previous steps have caused side effects (e.g., payment succeeds, but shipment fails irrevocably), you might need to trigger compensating actions (e.g., refund payment). This often leads to more complex Saga patterns.</li>
</ul>
</li>
<li><strong>Configuration of Services:</strong>
<ul>
<li>The <code>Dependencies</code> record currently only holds a logger. In a real application, it would also provide configured instances of service clients (e.g., <code>InventoryService</code>, <code>PaymentGatewayClient</code>, <code>ShippingServiceClient</code>). These clients would be interfaces, with concrete implementations (real or mock for testing) injected.</li>
</ul>
</li>
<li><strong>Parallel Execution of Independent Steps:</strong>
<ul>
<li>If some workflow steps are independent and can be executed concurrently, you could leverage <code>CompletableFuture.allOf</code> (to await all) or <code>CompletableFuture.thenCombine</code> (to combine results of two).</li>
<li>Integrating these with <code>EitherT</code> would require careful management of the <code>Either</code> results from parallel futures. For instance, if you run two <code>EitherT</code> operations in parallel, you'd get two <code>CompletableFuture&lt;Either&lt;DomainError, ResultX&gt;&gt;</code>. You would then need to combine these, deciding how to aggregate errors if multiple occur, or how to proceed if one fails and others succeed.</li>
</ul>
</li>
<li><strong>Transactionality:</strong>
<ul>
<li>For operations requiring atomicity (all succeed or all fail and roll back), traditional distributed transactions are complex. The Saga pattern mentioned above is a common alternative for managing distributed consistency.</li>
<li>Individual steps might interact with transactional resources (e.g., a database). The workflow itself would coordinate these, but doesn't typically manage a global transaction across disparate async services.</li>
</ul>
</li>
<li><strong>More Detailed &amp; Structured Logging:</strong>
<ul>
<li>The current logging is simple string messages. For better observability, use a structured logging library (e.g., SLF4J with Logback/Log4j2) and log key-value pairs (e.g., <code>orderId</code>, <code>stepName</code>, <code>status</code>, <code>durationMs</code>, <code>errorType</code> if applicable). This makes logs easier to parse, query, and analyse.</li>
<li>Consider logging at the beginning and end of each significant step, including the outcome (success/failure and error details).</li>
</ul>
</li>
<li><strong>Metrics &amp; Monitoring:</strong>
<ul>
<li>Instrument the workflow to emit metrics (e.g., using Micrometer). Track things like workflow execution time, step durations, success/failure counts for each step, and error rates. This is crucial for monitoring the health and performance of the system.</li>
</ul>
</li>
</ol>
</div>
</div>
<p>Higher-Kinded-J can help build more robust, resilient, and observable workflows using these foundational patterns from this example.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="building-a-playable-draughts-game"><a class="header" href="#building-a-playable-draughts-game">Building a Playable Draughts Game</a></h1>
<p><img src="hkts/../images/draughts_board.png" alt="draughts_board.png" /></p>
<p>This tutorial will guide you through building a complete and playable command-line draughts (checkers) game.</p>
<p>We will provide all the necessary code, broken down into manageable files. More importantly, we will demonstrate how <code>higher-kinded-j</code> makes this process more robust, maintainable, and functionally elegant by cleanly separating game logic, user interaction, and state management.</p>
<h3 id="the-functional-approach"><a class="header" href="#the-functional-approach">The Functional Approach</a></h3>
<p>At its core, a game like draughts involves several key aspects where functional patterns can shine:</p>
<ul>
<li><strong>State Management</strong>: The board, the position of pieces, whose turn it is ‚Äì this is all game state. Managing this immutably can prevent a host of bugs.</li>
<li><strong>User Input</strong>: Players will enter moves, which might be valid, invalid, or incorrectly formatted.</li>
<li><strong>Game Logic</strong>: Operations like validating a move, capturing a piece, checking for kings, or determining a winner.</li>
<li><strong>Side Effects</strong>: Interacting with the console for input and output.</li>
</ul>
<p><code>higher-kinded-j</code> provides monads that are perfect for these tasks:</p>
<ul>
<li><strong><a href="hkts/../monads/state_monad.html"><code>State</code> Monad</a></strong>: For cleanly managing and transitioning the game state without mutable variables.</li>
<li><strong><a href="hkts/../monads/either_monad.html"><code>Either</code> Monad</a></strong>: For handling input parsing and move validation, clearly distinguishing between success and different kinds of errors.</li>
<li><strong><a href="hkts/../monads/io_monad.html"><code>IO</code> Monad</a></strong>: For encapsulating side effects like reading from and printing to the console, keeping the core logic pure.</li>
<li><a href="hkts/../functional/for_comprehension.html"><code>For</code> Comprehension</a>: To flatten sequences of monadic operations (<code>flatMap</code> calls) into a more readable, sequential style.</li>
</ul>
<p>By using these, we can build a more declarative and composable game.</p>
<h3 id="the-complete-code"><a class="header" href="#the-complete-code">The Complete Code</a></h3>
<p>you can find the complete code in the package:</p>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/tree/main/hkj-examples/src/main/java/org/higherkindedj/example/draughts"><code>org.higherkindedj.example.draughts</code></a></li>
</ul>
<h3 id="step-1-core-concepts-quick-recap"><a class="header" href="#step-1-core-concepts-quick-recap">Step 1: Core Concepts Quick Recap</a></h3>
<p>Before we write game code, let's briefly revisit <em>why</em><code>higher-kinded-j</code> is necessary. Java doesn't let us write, for example, a generic function that works for <em>any</em> container <code>F&lt;A&gt;</code> (like <code>List&lt;A&gt;</code> or <code>Optional&lt;A&gt;</code>). <code>higher-kinded-j</code> simulates this with:</p>
<ul>
<li><strong><code>Kind&lt;F, A&gt;</code></strong>: A bridge interface representing a type <code>A</code> within a context <code>F</code>.</li>
<li><strong>Witness Types</strong>: Marker types that stand in for <code>F</code> (the type constructor).</li>
<li><strong>Type Classes</strong>: Interfaces like <code>Functor</code>, <code>Applicative</code>, <code>Monad</code>, and <code>MonadError</code> that define operations (like <code>map</code>, <code>flatMap</code>, <code>handleErrorWith</code>) which work over these <code>Kind</code>s.</li>
</ul>
<p>For a deeper dive, check out the <a href="hkts/core-concepts.html">Core Concepts of Higher-Kinded-J</a> and the <a href="hkts/usage-guide.html">Usage Guide</a>.</p>
<h3 id="step-2-defining-the-draughts-game-state"><a class="header" href="#step-2-defining-the-draughts-game-state">Step 2: Defining the Draughts Game State</a></h3>
<p>Our game state needs to track the board, pieces, and current player.
First, we need to define the core data structures of our game. These are simple, immutable records represent the game's state.</p>
<pre><code class="language-java">// Enum for the two players
enum Player { RED, BLACK }

// Enum for the type of piece
enum PieceType { MAN, KING }

// A piece on the board, owned by a player with a certain type
record Piece(Player owner, PieceType type) {}

// A square on the 8x8 board, identified by row and column
record Square(int row, int col) {
  @Override
  public @NonNull String toString() {
    return "" + (char)('a' + col) + (row + 1);
  }
}

// Represents an error during move parsing or validation
record GameError(String description) {}

// The command to make a move from one square to another
record MoveCommand(Square from, Square to) {}

// The outcome of a move attempt
enum MoveOutcome { SUCCESS, INVALID_MOVE, CAPTURE_MADE, GAME_WON }
record MoveResult(MoveOutcome outcome, String message) {}

</code></pre>
<p>We can define a <code>GameState</code> record:</p>
<pre><code class="language-java">// The complete, immutable state of the game at any point in time
public record GameState(Map&lt;Square, Piece&gt; board, Player currentPlayer, String message, boolean isGameOver) {

  public static GameState initial() {
    Map&lt;Square, Piece&gt; startingBoard = new HashMap&lt;&gt;();
    // Place BLACK pieces
    for (int r = 0; r &lt; 3; r++) {
      for (int c = (r % 2 != 0) ? 0 : 1; c &lt; 8; c += 2) {
        startingBoard.put(new Square(r, c), new Piece(Player.BLACK, PieceType.MAN));
      }
    }
    // Place RED pieces
    for (int r = 5; r &lt; 8; r++) {
      for (int c = (r % 2 != 0) ? 0 : 1; c &lt; 8; c += 2) {
        startingBoard.put(new Square(r, c), new Piece(Player.RED, PieceType.MAN));
      }
    }
    return new GameState(Collections.unmodifiableMap(startingBoard), Player.RED, "Game started. RED's turn.", false);
  }

   GameState withBoard(Map&lt;Square, Piece&gt; newBoard) {
    return new GameState(Collections.unmodifiableMap(newBoard), this.currentPlayer, this.message, this.isGameOver);
  }

   GameState withCurrentPlayer(Player nextPlayer) {
    return new GameState(this.board, nextPlayer, this.message, this.isGameOver);
  }

   GameState withMessage(String newMessage) {
    return new GameState(this.board, this.currentPlayer, newMessage, this.isGameOver);
  }

  GameState withGameOver() {
    return new GameState(this.board, this.currentPlayer, this.message, true);
  }

   GameState togglePlayer() {
    Player next = (this.currentPlayer == Player.RED) ? Player.BLACK : Player.RED;
    return withCurrentPlayer(next).withMessage(next + "'s turn.");
  }
}

</code></pre>
<p>We'll use the <code>State&lt;S, A&gt;</code> monad from <code>higher-kinded-j</code> to manage this <code>GameState</code>. A <code>State&lt;GameState, A&gt;</code> represents a computation that takes an initial <code>GameState</code> and produces a result <code>A</code> along with a new, updated <code>GameState</code>. Explore the <a href="hkts/../monads/state_monad.html">State Monad documentation</a> for more.</p>
<h3 id="step-3-handling-user-input-with-io-and-either"><a class="header" href="#step-3-handling-user-input-with-io-and-either">Step 3: Handling User Input with <code>IO</code> and <code>Either</code></a></h3>
<p>This class handles reading user input from the console. The <code>readMoveCommand</code> method returns an <code>IO&lt;Either&lt;GameError, MoveCommand&gt;&gt;</code>. This type signature is very descriptive: it tells us the action is an <code>IO</code> side effect, and its result will be either a <code>GameError</code> or a valid <code>MoveCommand</code>.</p>
<pre><code class="language-java">class InputHandler {
  private static final Scanner scanner = new Scanner(System.in);

   static Kind&lt;IOKind.Witness, Either&lt;GameError, MoveCommand&gt;&gt; readMoveCommand() {
    return IOKindHelper.IO_OP.delay(() -&gt; {
      System.out.print("Enter move for " + " (e.g., 'a3 b4') or 'quit': ");
      String line = scanner.nextLine();

      if ("quit".equalsIgnoreCase(line.trim())) {
        return Either.left(new GameError("Player quit the game."));
      }

      String[] parts = line.trim().split("\\s+");
      if (parts.length != 2) {
        return Either.left(new GameError("Invalid input. Use 'from to' format (e.g., 'c3 d4')."));
      }
      try {
        Square from = parseSquare(parts[0]);
        Square to = parseSquare(parts[1]);
        return Either.right(new MoveCommand(from, to));
      } catch (IllegalArgumentException e) {
        return Either.left(new GameError(e.getMessage()));
      }
    });
  }

  private static Square parseSquare(String s) throws IllegalArgumentException {
    if (s == null || s.length() != 2) throw new IllegalArgumentException("Invalid square format: " + s);
    char colChar = s.charAt(0);
    char rowChar = s.charAt(1);
    if (colChar &lt; 'a' || colChar &gt; 'h' || rowChar &lt; '1' || rowChar &gt; '8') {
      throw new IllegalArgumentException("Square out of bounds (a1-h8): " + s);
    }
    int col = colChar - 'a';
    int row = rowChar - '1';
    return new Square(row, col);
  }
}

</code></pre>
<p>Learn more about the <a href="hkts/../monads/io_monad.html">IO Monad</a> and <a href="hkts/../monads/either_monad.html">Either Monad</a>.</p>
<hr />
<h3 id="step-4-game-logic-as-state-transitions"><a class="header" href="#step-4-game-logic-as-state-transitions">Step 4: Game Logic as State Transitions</a></h3>
<p>This is the heart of our application. It contains the rules of draughts. The <code>applyMove</code> method takes a <code>MoveCommand </code>and returns a <code>State</code> computation. This computation, when run, will validate the move against the current <code>GameState</code>, and if valid, produce a <code>MoveResult</code> and the new <code>GameState</code>. <em>This entire class has no side effects.</em></p>
<pre><code class="language-java">public class GameLogicSimple {

  static Kind&lt;StateKind.Witness&lt;GameState&gt;, MoveResult&gt; applyMove(MoveCommand command) {
    return StateKindHelper.STATE.widen(
        State.of(
            currentState -&gt; {
              // Unpack command for easier access
              Square from = command.from();
              Square to = command.to();
              Piece piece = currentState.board().get(from);
              String invalidMsg; // To hold error messages

              // Validate the move based on currentState and command
              //    - Is it the current player's piece?
              //    - Is the move diagonal?
              //    - Is the destination square empty or an opponent's piece for a jump?

              if (piece == null) {
                invalidMsg = "No piece at " + from;
                return new StateTuple&lt;&gt;(
                    new MoveResult(MoveOutcome.INVALID_MOVE, invalidMsg),
                    currentState.withMessage(invalidMsg));
              }
              if (piece.owner() != currentState.currentPlayer()) {
                invalidMsg = "Not your piece.";
                return new StateTuple&lt;&gt;(
                    new MoveResult(MoveOutcome.INVALID_MOVE, invalidMsg),
                    currentState.withMessage(invalidMsg));
              }
              if (currentState.board().containsKey(to)) {
                invalidMsg = "Destination square " + to + " is occupied.";
                return new StateTuple&lt;&gt;(
                    new MoveResult(MoveOutcome.INVALID_MOVE, invalidMsg),
                    currentState.withMessage(invalidMsg));
              }

              int rowDiff = to.row() - from.row();
              int colDiff = to.col() - from.col();

              // Simple move or jump?
              if (Math.abs(rowDiff) == 1 &amp;&amp; Math.abs(colDiff) == 1) { // Simple move
                if (piece.type() == PieceType.MAN) {
                  if ((piece.owner() == Player.RED &amp;&amp; rowDiff &gt; 0)
                      || (piece.owner() == Player.BLACK &amp;&amp; rowDiff &lt; 0)) {
                    invalidMsg = "Men can only move forward.";
                    return new StateTuple&lt;&gt;(
                        new MoveResult(MoveOutcome.INVALID_MOVE, invalidMsg),
                        currentState.withMessage(invalidMsg));
                  }
                }
                return performMove(currentState, command, piece);
              } else if (Math.abs(rowDiff) == 2 &amp;&amp; Math.abs(colDiff) == 2) { // Jump move
                Square jumpedSquare =
                    new Square(from.row() + rowDiff / 2, from.col() + colDiff / 2);
                Piece jumpedPiece = currentState.board().get(jumpedSquare);

                if (jumpedPiece == null || jumpedPiece.owner() == currentState.currentPlayer()) {
                  invalidMsg = "Invalid jump. Must jump over an opponent's piece.";
                  return new StateTuple&lt;&gt;(
                      new MoveResult(MoveOutcome.INVALID_MOVE, invalidMsg),
                      currentState.withMessage(invalidMsg));
                }

                return performJump(currentState, command, piece, jumpedSquare);
              } else {
                invalidMsg = "Move must be diagonal by 1 or 2 squares.";
                return new StateTuple&lt;&gt;(
                    new MoveResult(MoveOutcome.INVALID_MOVE, invalidMsg),
                    currentState.withMessage(invalidMsg));
              }
            }));
  }

  private static StateTuple&lt;GameState, MoveResult&gt; performMove(
      GameState state, MoveCommand command, Piece piece) {
    Map&lt;Square, Piece&gt; newBoard = new HashMap&lt;&gt;(state.board());
    newBoard.remove(command.from());
    newBoard.put(command.to(), piece);

    GameState movedState = state.withBoard(newBoard);
    GameState finalState = checkAndKingPiece(movedState, command.to());

    return new StateTuple&lt;&gt;(
        new MoveResult(MoveOutcome.SUCCESS, "Move successful."), finalState.togglePlayer());
  }

  private static StateTuple&lt;GameState, MoveResult&gt; performJump(
      GameState state, MoveCommand command, Piece piece, Square jumpedSquare) {
    Map&lt;Square, Piece&gt; newBoard = new HashMap&lt;&gt;(state.board());
    newBoard.remove(command.from());
    newBoard.remove(jumpedSquare);
    newBoard.put(command.to(), piece);

    GameState jumpedState = state.withBoard(newBoard);
    GameState finalState = checkAndKingPiece(jumpedState, command.to());

    // Check for win condition
    boolean blackWins =
        finalState.board().values().stream().noneMatch(p -&gt; p.owner() == Player.RED);
    boolean redWins =
        finalState.board().values().stream().noneMatch(p -&gt; p.owner() == Player.BLACK);

    if (blackWins || redWins) {
      String winner = blackWins ? "BLACK" : "RED";
      return new StateTuple&lt;&gt;(
          new MoveResult(MoveOutcome.GAME_WON, winner + " wins!"),
          finalState.withGameOver().withMessage(winner + " has captured all pieces!"));
    }

    return new StateTuple&lt;&gt;(
        new MoveResult(MoveOutcome.CAPTURE_MADE, "Capture successful."), finalState.togglePlayer());
  }

  private static GameState checkAndKingPiece(GameState state, Square to) {
    Piece piece = state.board().get(to);
    if (piece != null &amp;&amp; piece.type() == PieceType.MAN) {
      // A RED piece is kinged on row index 0 (the "1st" row).
      // A BLACK piece is kinged on row index 7 (the "8th" row).
      if ((piece.owner() == Player.RED &amp;&amp; to.row() == 0)
          || (piece.owner() == Player.BLACK &amp;&amp; to.row() == 7)) {
        Map&lt;Square, Piece&gt; newBoard = new HashMap&lt;&gt;(state.board());
        newBoard.put(to, new Piece(piece.owner(), PieceType.KING));
        return state
            .withBoard(newBoard)
            .withMessage(piece.owner() + "'s piece at " + to + " has been kinged!");
      }
    }
    return state;
  }
}
</code></pre>
<p>This uses <code>State.of</code> to create a stateful computation. <code>State.get()</code>, <code>State.set()</code>, and <code>State.modify()</code> are other invaluable tools from the State monad.</p>
<hr />
<h3 id="step-5-composing-with-flatmap---the-monadic-power"><a class="header" href="#step-5-composing-with-flatmap---the-monadic-power">Step 5: Composing with <code>flatMap</code> - The Monadic Power</a></h3>
<p>Now, we combine these pieces. The main loop needs to:</p>
<ol>
<li>Display the board (<code>IO</code>).</li>
<li>Read user input (<code>IO</code>).</li>
<li>If the input is valid, apply it to the game logic (<code>State</code>).</li>
<li>Loop with the new game state.</li>
</ol>
<p>This sequence of operations is a goodt use case for a <code>For</code> comprehension to improve on nested <code>flatMap</code> calls.</p>
<pre><code class="language-java">
public class Draughts {

  private static final IOMonad ioMonad = IOMonad.INSTANCE;
  
  // Processes a single turn of the game
  private static Kind&lt;IOKind.Witness, GameState&gt; processTurn(GameState currentGameState) {
  
    // 1. Use 'For' to clearly sequence the display and read actions.
    var sequence = For.from(ioMonad, BoardDisplay.displayBoard(currentGameState))
        .from(ignored -&gt; InputHandler.readMoveCommand())
        .yield((ignored, eitherResult) -&gt; eitherResult); // Yield the result of the read action

    // 2. The result of the 'For' is an IO&lt;Either&lt;...&gt;&gt;.
    //    Now, flatMap that single result to handle the branching.
    return ioMonad.flatMap(
        eitherResult -&gt;
            eitherResult.fold(
                error -&gt; { // Left case: Input error
                  return IOKindHelper.IO_OP.delay(
                      () -&gt; {
                        System.out.println("Error: " + error.description());
                        return currentGameState;
                      });
                },
                moveCommand -&gt; { // Right case: Valid input
                  var stateComputation = GameLogic.applyMove(moveCommand);
                  var resultTuple = StateKindHelper.STATE.runState(stateComputation, currentGameState);
                  return ioMonad.of(resultTuple.state());
                }),
        sequence);
  }

  
  // other methods....
}

</code></pre>
<p>The <code>For</code> comprehension flattens the <code>display -&gt; read</code> sequence, making the primary workflow more declarative and easier to read than nested callbacks.</p>
<p>The <a href="hkts/order-walkthrough.html">Order Processing Example</a> in the <code>higher-kinded-j</code> docs shows a more complex scenario using <code>CompletableFuture</code> and <code>EitherT</code>, which is a great reference for getting started with monad transformers.</p>
<hr />
<h3 id="step-6-the-game-loop"><a class="header" href="#step-6-the-game-loop">Step 6: The Game Loop</a></h3>
<pre><code class="language-java">
public class Draughts {

  private static final IOMonad ioMonad = IOMonad.INSTANCE;

  // The main game loop as a single, recursive IO computation
  private static Kind&lt;IOKind.Witness, Unit&gt; gameLoop(GameState gameState) {
    if (gameState.isGameOver()) {
      // Base case: game is over, just display the final board and message.
      return BoardDisplay.displayBoard(gameState);
    }

    // Recursive step: process one turn and then loop with the new state
    return ioMonad.flatMap(Draughts::gameLoop, processTurn(gameState));
  }

  // processTurn as before....

  public static void main(String[] args) {
    // Get the initial state
    GameState initialState = GameState.initial();
    // Create the full game IO program
    Kind&lt;IOKind.Witness, Unit&gt; fullGame = gameLoop(initialState);
    // Execute the program. This is the only place where side effects are actually run.
    IOKindHelper.IO_OP.unsafeRunSync(fullGame);
    System.out.println("Thank you for playing!");
  }
}

</code></pre>
<p>Key methods like <code>IOKindHelper.IO_OP.unsafeRunSync()</code> and <code>StateKindHelper.STATE.runState()</code> are used to execute the monadic computations at the "edge" of the application.</p>
<h3 id="step-7-displaying-the-board"><a class="header" href="#step-7-displaying-the-board">Step 7: Displaying the Board</a></h3>
<p>A simple text representation will do the trick.
This class is responsible for rendering the GameState to the console. Notice how the displayBoard method doesn't perform the printing directly; it returns an <code>IO&lt;Unit&gt;</code> which is a description of the printing action. This keeps the method pure.</p>
<pre><code class="language-java">
public class BoardDisplay {

  public static Kind&lt;IOKind.Witness, Unit&gt; displayBoard(GameState gameState) {
    return IOKindHelper.IO_OP.delay(
        () -&gt; {
          System.out.println("\n  a b c d e f g h");
          System.out.println(" +-----------------+");
          for (int r = 7; r &gt;= 0; r--) { // Print from row 8 down to 1
            System.out.print((r + 1) + "| ");
            for (int c = 0; c &lt; 8; c++) {
              Piece p = gameState.board().get(new Square(r, c));
              if (p == null) {
                System.out.print(". ");
              } else {
                char pieceChar = (p.owner() == Player.RED) ? 'r' : 'b';
                if (p.type() == PieceType.KING) pieceChar = Character.toUpperCase(pieceChar);
                System.out.print(pieceChar + " ");
              }
            }
            System.out.println("|" + (r + 1));
          }
          System.out.println(" +-----------------+");
          System.out.println("  a b c d e f g h");
          System.out.println("\n" + gameState.message());
          if (!gameState.isGameOver()) {
            System.out.println("Current Player: " + gameState.currentPlayer());
          }
          return Unit.INSTANCE;
        });
  }
}

</code></pre>
<h3 id="playing-the-game"><a class="header" href="#playing-the-game">Playing the game</a></h3>
<p><img src="hkts/../images/draughts_game.png" alt="draughts_game.png" /></p>
<p>In the game we can see the black has "kinged" a piece by reaching <code>e8</code>.</p>
<h3 id="step-8-refactoring-for-multiple-captures"><a class="header" href="#step-8-refactoring-for-multiple-captures">Step 8: Refactoring for Multiple Captures</a></h3>
<p>A key rule in draughts is that if a capture is available, it must be taken, and if a capture leads to another possible capture for the same piece, that jump must also be taken.</p>
<p>The beauty of our functional approach is that we only need to modify the core rules in <code>GameLogic.java</code>. <code>The Draughts.java</code> game loop, the IO handlers, and the data models don't need to change at all.</p>
<p>The core idea is to modify the <code>performJump</code> method. After a jump is completed, we will check if the piece that just moved can make another jump from its new position.</p>
<p>We do this by adding a helper <code>canPieceJump</code> and modify <code>performJump</code> to check for subsequent jumps.</p>
<p>If another jump is possible, the player's turn does not end., we will update the board state but not switch the current player, forcing them to make another capture.
If another jump is not possible, we will switch the player as normal.</p>
<pre><code class="language-java">
/** Check if a piece at a given square has any valid jumps. */
  private static boolean canPieceJump(GameState state, Square from) {
    Piece piece = state.board().get(from);
    if (piece == null) return false;

    int[] directions = {-2, 2};
    for (int rowOffset : directions) {
      for (int colOffset : directions) {
        if (piece.type() == PieceType.MAN) {
          if ((piece.owner() == Player.RED &amp;&amp; rowOffset &gt; 0)
              || (piece.owner() == Player.BLACK &amp;&amp; rowOffset &lt; 0)) {
            continue; // Invalid forward direction for man
          }
        }

        Square to = new Square(from.row() + rowOffset, from.col() + colOffset);
        if (to.row() &lt; 0
            || to.row() &gt; 7
            || to.col() &lt; 0
            || to.col() &gt; 7
            || state.board().containsKey(to)) {
          continue; // Off board or destination occupied
        }

        Square jumpedSquare = new Square(from.row() + rowOffset / 2, from.col() + colOffset / 2);
        Piece jumpedPiece = state.board().get(jumpedSquare);
        if (jumpedPiece != null &amp;&amp; jumpedPiece.owner() != piece.owner()) {
          return true; // Found a valid jump
        }
      }
    }
    return false;
  }

  /** Now it checks for further jumps after a capture. */
  private static StateTuple&lt;GameState, MoveResult&gt; performJump(
      GameState state, MoveCommand command, Piece piece, Square jumpedSquare) {
    // Perform the jump and update board
    Map&lt;Square, Piece&gt; newBoard = new HashMap&lt;&gt;(state.board());
    newBoard.remove(command.from());
    newBoard.remove(jumpedSquare);
    newBoard.put(command.to(), piece);
    GameState jumpedState = state.withBoard(newBoard);

    // Check for kinging after the jump
    GameState stateAfterKinging = checkAndKingPiece(jumpedState, command.to());

    // Check for win condition after the capture
    boolean blackWins =
        !stateAfterKinging.board().values().stream().anyMatch(p -&gt; p.owner() == Player.RED);
    boolean redWins =
        !stateAfterKinging.board().values().stream().anyMatch(p -&gt; p.owner() == Player.BLACK);
    if (blackWins || redWins) {
      String winner = blackWins ? "BLACK" : "RED";
      return new StateTuple&lt;&gt;(
          new MoveResult(MoveOutcome.GAME_WON, winner + " wins!"),
          stateAfterKinging.withGameOver().withMessage(winner + " has captured all pieces!"));
    }

    // Check if the same piece can make another jump
    boolean anotherJumpPossible = canPieceJump(stateAfterKinging, command.to());

    if (anotherJumpPossible) {
      // If another jump exists, DO NOT toggle the player.
      // Update the message to prompt for the next jump.
      String msg = "Capture successful. You must jump again with the same piece.";
      return new StateTuple&lt;&gt;(
          new MoveResult(MoveOutcome.CAPTURE_MADE, msg), stateAfterKinging.withMessage(msg));
    } else {
      // No more jumps, so end the turn and toggle the player.
      return new StateTuple&lt;&gt;(
          new MoveResult(MoveOutcome.CAPTURE_MADE, "Capture successful."),
          stateAfterKinging.togglePlayer());
    }
  }

</code></pre>
<h3 id="why-this-functional-approach-is-better"><a class="header" href="#why-this-functional-approach-is-better">Why This Functional Approach is Better</a></h3>
<p>Having seen the complete code, let's reflect on the benefits:</p>
<ul>
<li><strong>Testability</strong>: The <code>GameLogic</code> class is completely pure. It has no side effects and doesn't depend on <code>System.in</code> or <code>System.out</code>. You can test the entire rules engine by simply providing a <code>GameState</code> and a <code>MoveCommand</code> and asserting on the resulting <code>GameState</code> and <code>MoveResult</code>. This is significantly easier than testing code that is tangled with console I/O.</li>
<li><strong>Composability</strong>: The <code>gameLoop</code> in <code>Draughts.java</code> is a beautiful example of composition. It clearly and declaratively lays out the sequence of events for a game turn: <code>display -&gt; read -&gt; process</code>. The <code>flatMap</code> calls hide all the messy details of passing state and results from one step to the next.</li>
<li><strong>Reasoning</strong>: The type signatures tell a story. <code>IO&lt;Either&lt;GameError, MoveCommand&gt;&gt;</code> is far more descriptive than a method that returns a <code>MoveCommand</code> but might throw an exception or return <code>null</code>. It explicitly forces the caller to handle both the success and error cases.</li>
<li><strong>Maintainability</strong>: If you want to change from a command-line interface to a graphical one, you only need to replace <code>BoardDisplay</code> and <code>InputHandler</code>. The entire core <code>GameLogic</code> remains untouched because it's completely decoupled from the presentation layer.</li>
</ul>
<p>This tutorial has only scratched the surface. You could extend this by exploring other constructs from the library, like using <code>Validated</code> to accumulate multiple validation errors or using the <code>Reader</code> monad to inject different sets of game rules.</p>
<p>Java may not have native HKTs, but with <a href="https://higher-kinded-j.github.io/home.html"><strong>Higher-Kinded-J</strong></a>, you can absolutely utilise these powerful and elegant functional patterns to write better, more robust applications.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="an-introduction-to-optics"><a class="header" href="#an-introduction-to-optics">An Introduction to Optics</a></h1>
<p><img src="optics/../images/optics.jpg" alt="optics.jpg" /></p>
<p>As Java developers, we love the safety and predictability of immutable objects, especially with the introduction of records. However, this safety comes at a cost: updating nested immutable data can be a verbose and error-prone nightmare.</p>
<p>Consider a simple nested record structure:</p>
<pre><code class="language-java">record Street(String name, int number) {}
record Address(Street street, String city) {}
record User(String name, Address address) {}e
</code></pre>
<p>How do you update the user's street name? In standard Java, you're forced into a "copy-and-update" cascade:</p>
<pre><code class="language-java">// What most Java developers actually write
public User updateStreetName(User user, String newStreetName) {
    var address = user.address();
    var street = address.street();
    var newStreet = new Street(newStreetName, street.number());
    var newAddress = new Address(newStreet, address.city());
    return new User(user.name(), newAddress);
}
</code></pre>
<p>This is tedious, hard to read, and gets exponentially worse with deeper nesting. What if there was a way to "zoom in" on the data you want to change, update it, and get a new copy of the top-level object back, all in one clean operation?</p>
<p>This is the problem that <strong>Optics</strong> solve.</p>
<h2 id="what-are-optics"><a class="header" href="#what-are-optics">What Are Optics?</a></h2>
<p>At their core, optics are simply <strong>composable, functional getters and setters</strong> for immutable data structures.</p>
<p>Think of an optic as a "zoom lens" for your data. It's a first-class object that represents a path from a whole structure (like <code>User</code>) to a specific part (like the street <code>name</code>). Because it's an object, you can pass it around, compose it with other optics, and use it to perform functional updates.</p>
<h2 id="think-of-optics-like"><a class="header" href="#think-of-optics-like">Think of Optics Like...</a></h2>
<ul>
<li><strong>Lens</strong>: A magnifying glass that focuses on one specific part üîé</li>
<li><strong>Prism</strong>: A tool that splits light, but only works with certain types of light üî¨</li>
<li><strong>Iso</strong>: A universal translator between equivalent languages üîÑ</li>
<li><strong>Traversal</strong>: A spotlight that can illuminate many targets at once üó∫Ô∏è</li>
</ul>
<p>Every optic provides two basic capabilities:</p>
<ol>
<li><strong><code>get</code></strong>: Focus on a structure <code>S</code> and retrieve a part <code>A</code>.</li>
<li><strong><code>set</code></strong>: Focus on a structure <code>S</code>, provide a new part <code>A</code>, and receive a new <code>S</code> with the part updated. This is always an immutable operation ‚Äî&gt; a new copy of <code>S</code> is returned.</li>
</ol>
<p>The real power comes from their <strong>composability</strong>. You can chain optics together to peer deeply into nested structures and perform targeted updates with ease.</p>
<h2 id="the-optics-family-in-higher-kinded-j"><a class="header" href="#the-optics-family-in-higher-kinded-j">The Optics Family in Higher-Kinded-J</a></h2>
<p>The <code>higher-kinded-j</code> library provides the foundation for a rich optics library, primarily focused on three main types. Each is designed to solve a specific kind of data access problem.</p>
<h3 id="1-lens-for-has-a-relationships-"><a class="header" href="#1-lens-for-has-a-relationships-">1. Lens: For "Has-A" Relationships üîé</a></h3>
<p>A <strong>Lens</strong> is the most common optic. It focuses on a single, required piece of data within a larger "product type" (a <code>record</code> or class with fields). It's for data that is guaranteed to exist.</p>
<ul>
<li>
<p><strong>Problem it solves</strong>: Getting and setting a field within an object, especially a deeply nested one.</p>
</li>
<li>
<p><strong>Generated Code</strong>: Annotating a record with <code>@GenerateLenses</code> produces a companion class (e.g., <code>UserLenses</code>) that contains:</p>
<ol>
<li>A <strong>lens</strong> for each field (e.g., <code>UserLenses.address()</code>).</li>
<li>Convenient <strong><code>with*</code> helper methods</strong> for easy updates (e.g., <code>UserLenses.withAddress(...)</code>).</li>
</ol>
</li>
<li>
<p><strong>Example (Deep Update with Lenses)</strong>:</p>
<ul>
<li>To solve our initial problem of updating the user's street name, we compose lenses:</li>
</ul>
</li>
</ul>
<pre><code class="language-java">    // Compose lenses to create a direct path to the nested data
    var userToStreetName = UserLenses.address()
        .andThen(AddressLenses.street())
        .andThen(StreetLenses.name());
  
    // Perform the deep update in a single, readable line
    User updatedUser = userToStreetName.set("New Street", user);
</code></pre>
<ul>
<li>
<p><strong>Example (Shallow Update with <code>with*</code> Helpers)</strong>:</p>
<ul>
<li>For simple, top-level updates, the <code>with*</code> methods are more direct and discoverable.</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// Before: Using the lens directly
User userWithNewName = UserLenses.name().set("Bob", user);

// After: Using the generated helper method
User userWithNewName = UserLenses.withName(user, "Bob");
</code></pre>
<h3 id="2-iso-for-is-equivalent-to-relationships-"><a class="header" href="#2-iso-for-is-equivalent-to-relationships-">2. Iso: For "Is-Equivalent-To" Relationships üîÑ</a></h3>
<p>An <strong>Iso</strong> (Isomorphism) is a special, reversible optic. It represents a lossless, two-way conversion between two types that hold the exact same information. Think of it as a type-safe, composable adapter.</p>
<ul>
<li>
<p><strong>Problem it solves</strong>: Swapping between different representations of the same data, such as a wrapper class and its raw value, or between two structurally different but informationally equivalent records.</p>
</li>
<li>
<p><strong>Example</strong>: Suppose you have a <code>Point</code> record and a <code>Tuple2&lt;Integer, Integer&gt;</code>, which are structurally different but hold the same data.</p>
<pre><code class="language-java">public record Point(int x, int y) {}
</code></pre>
<p>You can define an <code>Iso</code> to convert between them:</p>
<pre><code class="language-java">@GenerateIsos
public static Iso&lt;Point, Tuple2&lt;Integer, Integer&gt;&gt; pointToTuple() {
  return Iso.of(
      point -&gt; Tuple.of(point.x(), point.y()), // get
      tuple -&gt; new Point(tuple._1(), tuple._2())  // reverseGet
  );
}
</code></pre>
<p>This <code>Iso</code> can now be composed with other optics to, for example, create a <code>Lens</code> that goes from a <code>Point</code> directly to its first element inside a <code>Tuple</code> representation.</p>
</li>
</ul>
<h3 id="3-prism-for-is-a-relationships-"><a class="header" href="#3-prism-for-is-a-relationships-">3. Prism: For "Is-A" Relationships üî¨</a></h3>
<p>A <strong>Prism</strong> is like a Lens, but for "sum types" (<code>sealed interface</code> or <code>enum</code>). It focuses on a single, <em>possible case</em> of a type. A Prism's <code>get</code> operation can fail (it returns an <code>Optional</code>), because the data might not be the case you're looking for. Think of it as a type-safe, functional <code>instanceof</code> and cast.</p>
<ul>
<li><strong>Problem it solves</strong>: Safely operating on one variant of a sealed interface.</li>
<li><strong>Example</strong>: Instead of using an <code>if-instanceof</code> chain to handle a specific <code>DomainError</code>:</li>
</ul>
<pre><code class="language-java">// Using a generated Prism for a sealed interface
DomainErrorPrisms.shippingError()
   .getOptional(error) // Safely gets a ShippingError if it matches
   .filter(ShippingError::isRecoverable)
   .ifPresent(this::handleRecovery); // Perform action only if it's the right type
</code></pre>
<h3 id="4-traversal-for-has-many-relationships-"><a class="header" href="#4-traversal-for-has-many-relationships-">4. Traversal: For "Has-Many" Relationships üó∫Ô∏è</a></h3>
<p>A <strong>Traversal</strong> is an optic that can focus on multiple targets at once‚Äîtypically all the items within a collection inside a larger structure.</p>
<ul>
<li>
<p><strong>Problem it solves</strong>: Applying an operation to every element in a <code>List</code>, <code>Set</code>, or other collection that is a field within an object.</p>
</li>
<li>
<p><strong>Example</strong>: To validate a list of promo codes in an order with <code>Validated</code>:</p>
<pre><code class="language-java">@GenerateTraversals
public record OrderData(..., List&lt;String&gt; promoCodes) {}
var codesTraversal = OrderDataTraversals.promoCodes();
// returns Validated&lt;Error, Code&gt;
var validationFunction = (String code) -&gt; validate(code); 

// Use the traversal to apply the function to every code.
// The Applicative for Validated handles the error accumulation automatically.
Validated&lt;Error, OrderData&gt; result = codesTraversal.modifyF(
    validationFunction, orderData, validatedApplicative
);
</code></pre>
</li>
</ul>
<h2 id="advanced-capabilities-profunctor-adaptations"><a class="header" href="#advanced-capabilities-profunctor-adaptations">Advanced Capabilities: Profunctor Adaptations</a></h2>
<p>One of the most powerful features of <code>higher-kinded-j</code> optics is their <strong>profunctor</strong> nature. Every optic can be adapted to work with different source and target types using three key operations:</p>
<ul>
<li><strong><code>contramap</code></strong>: Adapt an optic to work with a different source type</li>
<li><strong><code>map</code></strong>: Transform the result type of an optic</li>
<li><strong><code>dimap</code></strong>: Adapt both source and target types simultaneously</li>
</ul>
<p>This makes optics incredibly flexible for real-world scenarios like API integration, legacy system support, and working with different data representations. For a detailed exploration of these capabilities, see the <a href="optics/profunctor_optics.html">Profunctor Optics Guide</a>.</p>
<h2 id="how-higher-kinded-j-provides-optics"><a class="header" href="#how-higher-kinded-j-provides-optics">How <code>higher-kinded-j</code> Provides Optics</a></h2>
<p>This brings us to the unique advantages <code>higher-kinded-j</code> offers for optics in Java.</p>
<ol>
<li><strong>An Annotation-Driven Workflow</strong>: Manually writing optics is boilerplate. The <code>higher-kinded-j</code> approach automates this. By simply adding an annotation (<code>@GenerateLenses</code>, <code>@GeneratePrisms</code>, etc.) to your data classes, you get fully-functional, type-safe optics for free. This is a massive productivity boost and eliminates a major barrier to using optics in Java.</li>
<li><strong>Higher-Kinded Types for Effectful Updates</strong>: This is the most powerful feature. Because <code>higher-kinded-j</code> provides an HKT abstraction (<code>Kind&lt;F, A&gt;</code>) and type classes like <code>Functor</code> and <code>Applicative</code>, the optics can perform <em>effectful</em> modifications. The <code>modifyF</code> method is generic over an <code>Applicative</code> effect <code>F</code>. This means you can perform an update within the context of any data type that has an <code>Applicative</code> instance:
<ul>
<li>Want to perform an update that might fail? Use <code>Optional</code> or <code>Either</code> as your <code>F</code>.</li>
<li>Want to perform an asynchronous update? Use <code>CompletableFuture</code> as your <code>F</code>.</li>
<li>Want to accumulate validation errors? Use <code>Validated</code> as your <code>F</code>.</li>
</ul>
</li>
<li><strong>Profunctor Adaptability</strong>: Every optic is fundamentally a profunctor, meaning it can be adapted to work with different data types and structures. This provides incredible flexibility for integrating with external systems, handling legacy data formats, and working with strongly-typed wrappers.</li>
</ol>
<h2 id="common-patterns"><a class="header" href="#common-patterns">Common Patterns</a></h2>
<h3 id="when-to-use-with-helpers-vs-manual-lenses"><a class="header" href="#when-to-use-with-helpers-vs-manual-lenses">When to Use <code>with*</code> Helpers vs Manual Lenses</a></h3>
<ul>
<li><strong>Use <code>with*</code> helpers</strong> for simple, top-level field updates</li>
<li><strong>Use composed lenses</strong> for deep updates or when you need to reuse the path</li>
<li><strong>Use manual lens creation</strong> for computed properties or complex transformations</li>
</ul>
<h3 id="decision-guide-1"><a class="header" href="#decision-guide-1">Decision Guide</a></h3>
<ul>
<li><strong>Need to focus on a required field?</strong> ‚Üí <strong>Lens</strong></li>
<li><strong>Need to work with optional variants?</strong> ‚Üí <strong>Prism</strong></li>
<li><strong>Need to convert between equivalent types?</strong> ‚Üí <strong>Iso</strong></li>
<li><strong>Need to operate on collections?</strong> ‚Üí <strong>Traversal</strong></li>
<li><strong>Need to adapt existing optics?</strong> ‚Üí <strong>Profunctor operations</strong></li>
</ul>
<h2 id="common-pitfalls"><a class="header" href="#common-pitfalls">Common Pitfalls</a></h2>
<p><strong>‚ùå Don't do this:</strong></p>
<p>java</p>
<pre><code class="language-java">// Calling get() multiple times is inefficient
var street = employeeToStreet.get(employee);
var newEmployee = employeeToStreet.set(street.toUpperCase(), employee);
</code></pre>
<p><strong>‚úÖ Do this instead:</strong></p>
<p>java</p>
<pre><code class="language-java">// Use modify() for transformations
var newEmployee = employeeToStreet.modify(String::toUpperCase, employee);
</code></pre>
<p>This level of abstraction allows you to write highly reusable and testable business logic that is completely decoupled from the details of state management, asynchrony, or error handling‚Äîa core benefit of functional programming brought to Java by the foundation <code>higher-kinded-j</code> provides.</p>
<hr />
<p><strong>Next:</strong><a href="optics/lenses.html">Lenses: Working with Product Types</a></p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="nested-updates-with-lenses-a-practical-guide"><a class="header" href="#nested-updates-with-lenses-a-practical-guide">Nested Updates with Lenses: A Practical Guide</a></h1>
<h2 id="working-with-product-types"><a class="header" href="#working-with-product-types"><em>Working with Product Types</em></a></h2>
<p><img src="optics/../images/lens2.jpg" alt="lens2.jpg" /></p>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="optics/lenses.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to safely access and update fields in immutable data structures</li>
<li>Using <code>@GenerateLenses</code> to automatically create type-safe field accessors</li>
<li>Composing lenses to navigate deeply nested records</li>
<li>The difference between <code>get</code>, <code>set</code>, and <code>modify</code> operations</li>
<li>Building reusable, composable data access patterns</li>
<li>When to use lenses vs direct field access</li>
</ul>
</div>
</div>
<div id="admonition-example-code" class="admonition admonish-note" role="note" aria-labelledby="admonition-example-code-title">
<div class="admonition-title">
<div id="admonition-example-code-title">
<p>Example Code</p>
</div>
<a class="admonition-anchor-link" href="optics/lenses.html#admonition-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/LensUsageExample.java">LensesExample</a></p>
</div>
</div>
<p>In the introduction to optics, we saw how updating nested immutable data can be verbose and why optics provide a clean, functional solution. We identified the <code>Lens</code> as the primary tool for working with "has-a" relationships, like a field within a record.</p>
<p>This guide provides a complete, step-by-step walkthrough of how to solve the nested update problem using a composable Lens and its generated helper methods.</p>
<hr />
<h2 id="the-scenario-updating-an-employees-address"><a class="header" href="#the-scenario-updating-an-employees-address">The Scenario: Updating an Employee's Address</a></h2>
<p>Let's use a common business scenario involving a deeply nested data structure. Our goal is to update the <code>street</code> of an <code>Employee</code>'s <code>Company``Address</code>.</p>
<p><strong>The Data Model:</strong></p>
<pre><code class="language-java">public record Address(String street, String city) {}
public record Company(String name, Address address) {}
public record Employee(String name, Company company) {}
</code></pre>
<p>Without optics, changing the street requires manually rebuilding the entire <code>Employee</code> object graph. With optics, we can define a direct path to the <code>street</code> and perform the update in a single, declarative line.</p>
<hr />
<h2 id="a-step-by-step-walkthrough"><a class="header" href="#a-step-by-step-walkthrough">A Step-by-Step Walkthrough</a></h2>
<h3 id="step-1-generating-the-lenses"><a class="header" href="#step-1-generating-the-lenses">Step 1: Generating the Lenses</a></h3>
<p>Manually writing <code>Lens</code> implementations is tedious boilerplate. The <code>hkj-optics</code> library automates this with an annotation processor. To begin, we simply annotate our records with <strong><code>@GenerateLenses</code></strong>.</p>
<p>This process creates a companion class for each record (e.g., <code>EmployeeLenses</code>, <code>CompanyLenses</code>) that contains two key features:</p>
<ol>
<li><strong>Lens Factories</strong>: Static methods that create a <code>Lens</code> for each field (e.g., <code>EmployeeLenses.company()</code>).</li>
<li><strong><code>with*</code> Helpers</strong>: Static convenience methods for easy, shallow updates (e.g., <code>EmployeeLenses.withCompany(...)</code>).</li>
</ol>
<pre><code class="language-java">import org.higherkindedj.optics.annotations.GenerateLenses;

@GenerateLenses
public record Address(String street, String city) {}

@GenerateLenses
public record Company(String name, Address address) {}

@GenerateLenses
public record Employee(String name, Company company) {}
</code></pre>
<h3 id="step-2-composing-a-deep-lens"><a class="header" href="#step-2-composing-a-deep-lens">Step 2: Composing a Deep Lens</a></h3>
<p>With the lenses generated, we can now compose them using the <strong><code>andThen</code></strong> method. We'll chain the individual lenses together to create a single, new <code>Lens</code> that represents the complete path from the top-level object (<code>Employee</code>) to the deeply nested field (<code>street</code>).</p>
<p>The result is a new, powerful, and reusable <code>Lens&lt;Employee, String&gt;</code>.</p>
<pre><code class="language-java">// Get the generated lenses
Lens&lt;Employee, Company&gt; employeeToCompany = EmployeeLenses.company();
Lens&lt;Company, Address&gt; companyToAddress = CompanyLenses.address();
Lens&lt;Address, String&gt; addressToStreet = AddressLenses.street();

// Compose them to create a single, deep lens
Lens&lt;Employee, String&gt; employeeToStreet =
    employeeToCompany
        .andThen(companyToAddress)
        .andThen(addressToStreet);
</code></pre>
<h3 id="step-3-performing-updates-with-the-composed-lens"><a class="header" href="#step-3-performing-updates-with-the-composed-lens">Step 3: Performing Updates with the Composed Lens</a></h3>
<p>With our optics generated, we have two primary ways to perform updates.</p>
<h4 id="a-simple-shallow-updates-with-with-helpers"><a class="header" href="#a-simple-shallow-updates-with-with-helpers">A) Simple, Shallow Updates with <code>with*</code> Helpers</a></h4>
<p>For simple updates to a top-level field, the generated <code>with*</code> methods are the most convenient and readable option.</p>
<pre><code class="language-java">// Create an employee instance
var employee = new Employee("Alice", ...);

// Use the generated helper to create an updated copy
var updatedEmployee = EmployeeLenses.withName(employee, "Bob");
</code></pre>
<p>This is a cleaner, more discoverable alternative to using the lens directly (<code>EmployeeLenses.name().set("Bob", employee)</code>).</p>
<h4 id="b-deep-updates-with-a-composed-lens"><a class="header" href="#b-deep-updates-with-a-composed-lens">B) Deep Updates with a Composed Lens</a></h4>
<p>For deep updates into nested structures, the composed lens is the perfect tool. The <code>Lens</code> interface provides two primary methods for this:</p>
<ul>
<li><code>set(newValue, object)</code>: Replaces the focused value with a new one.</li>
<li><code>modify(function, object)</code>: Applies a function to the focused value to compute the new value.</li>
</ul>
<p>Both methods handle the "copy-and-update" cascade for you, returning a completely new top-level object.</p>
<pre><code class="language-java">// Use the composed lens from Step 2
Employee updatedEmployee = employeeToStreet.set("456 Main St", initialEmployee);
</code></pre>
<hr />
<h2 id="when-to-use-with-helpers-vs-manual-lenses-1"><a class="header" href="#when-to-use-with-helpers-vs-manual-lenses-1">When to Use <code>with*</code> Helpers vs Manual Lenses</a></h2>
<p>Understanding when to use each approach will help you write cleaner, more maintainable code:</p>
<h3 id="use-with-helpers-when"><a class="header" href="#use-with-helpers-when">Use <code>with*</code> Helpers When:</a></h3>
<ul>
<li><strong>Simple, top-level field updates</strong> - Direct field replacement on the immediate object</li>
<li><strong>One-off updates</strong> - You don't need to reuse the update logic</li>
<li><strong>API clarity</strong> - You want the most discoverable, IDE-friendly approach</li>
</ul>
<pre><code class="language-java">// Perfect for simple updates
var promotedEmployee = EmployeeLenses.withName(employee, "Senior " + employee.name());
</code></pre>
<h3 id="use-composed-lenses-when"><a class="header" href="#use-composed-lenses-when">Use Composed Lenses When:</a></h3>
<ul>
<li><strong>Deep updates</strong> - Navigating multiple levels of nesting</li>
<li><strong>Reusable paths</strong> - The same update pattern will be used multiple times</li>
<li><strong>Complex transformations</strong> - Using <code>modify()</code> with functions</li>
<li><strong>Conditional updates</strong> - Part of larger optic compositions</li>
</ul>
<pre><code class="language-java">// Ideal for reusable deep updates
Lens&lt;Employee, String&gt; streetLens = employeeToCompany
    .andThen(companyToAddress)
    .andThen(addressToStreet);

// Can be reused across your application
Employee moved = streetLens.set("New Office Street", employee);
Employee uppercased = streetLens.modify(String::toUpperCase, employee);
</code></pre>
<h3 id="use-manual-lens-creation-when"><a class="header" href="#use-manual-lens-creation-when">Use Manual Lens Creation When:</a></h3>
<ul>
<li><strong>Computed properties</strong> - The lens represents derived data</li>
<li><strong>Complex transformations</strong> - Custom getter/setter logic</li>
<li><strong>Legacy integration</strong> - Working with existing APIs</li>
</ul>
<pre><code class="language-java">// For computed or derived properties
Lens&lt;Employee, String&gt; fullAddressLens = Lens.of(
    emp -&gt; emp.company().address().street() + ", " + emp.company().address().city(),
    (emp, fullAddr) -&gt; {
        String[] parts = fullAddr.split(", ");
        return employeeToCompany.andThen(companyToAddress).set(
            new Address(parts[0], parts[1]), emp);
    }
);
</code></pre>
<hr />
<h2 id="common-pitfalls-1"><a class="header" href="#common-pitfalls-1">Common Pitfalls</a></h2>
<h3 id="-dont-do-this"><a class="header" href="#-dont-do-this">‚ùå Don't Do This:</a></h3>
<pre><code class="language-java">// Inefficient: Calling get() multiple times
var currentStreet = employeeToStreet.get(employee);
var newEmployee = employeeToStreet.set(currentStreet.toUpperCase(), employee);

// Verbose: Rebuilding lenses repeatedly
var street1 = EmployeeLenses.company().andThen(CompanyLenses.address()).andThen(AddressLenses.street()).get(emp1);
var street2 = EmployeeLenses.company().andThen(CompanyLenses.address()).andThen(AddressLenses.street()).get(emp2);

// Mixing approaches unnecessarily
var tempCompany = EmployeeLenses.company().get(employee);
var updatedCompany = CompanyLenses.withName(tempCompany, "New Company");
var finalEmployee = EmployeeLenses.withCompany(employee, updatedCompany);
</code></pre>
<h3 id="-do-this-instead"><a class="header" href="#-do-this-instead">‚úÖ Do This Instead:</a></h3>
<pre><code class="language-java">// Efficient: Use modify() for transformations
var newEmployee = employeeToStreet.modify(String::toUpperCase, employee);

// Reusable: Create the lens once, use many times
var streetLens = EmployeeLenses.company().andThen(CompanyLenses.address()).andThen(AddressLenses.street());
var street1 = streetLens.get(emp1);
var street2 = streetLens.get(emp2);

// Consistent: Use one approach for the entire update
var finalEmployee = EmployeeLenses.company()
    .andThen(CompanyLenses.name())
    .set("New Company", employee);
</code></pre>
<hr />
<h2 id="performance-notes-1"><a class="header" href="#performance-notes-1">Performance Notes</a></h2>
<p>Lenses are optimised for immutable updates:</p>
<ul>
<li><strong>Memory efficient</strong>: Only creates new objects along the path that changes</li>
<li><strong>Reusable</strong>: Composed lenses can be stored and reused across your application</li>
<li><strong>Type-safe</strong>: All operations are checked at compile time</li>
<li><strong>Lazy</strong>: Operations are only performed when needed</li>
</ul>
<p><strong>Best Practice</strong>: For frequently used paths, create the composed lens once and store it as a static field:</p>
<pre><code class="language-java">public class EmployeeOptics {
    public static final Lens&lt;Employee, String&gt; STREET = 
        EmployeeLenses.company()
            .andThen(CompanyLenses.address())
            .andThen(AddressLenses.street());
        
    public static final Lens&lt;Employee, String&gt; COMPANY_NAME = 
        EmployeeLenses.company()
            .andThen(CompanyLenses.name());
}
</code></pre>
<hr />
<h2 id="complete-runnable-example"><a class="header" href="#complete-runnable-example">Complete, Runnable Example</a></h2>
<p>The following standalone example puts all these steps together. You can run it to see the output and the immutability in action.</p>
<pre><code class="language-java">package org.higherkindedj.example.lens;

// Imports for the generated classes would be automatically resolved by your IDE
import org.higherkindedj.example.lens.LensUsageExampleLenses.AddressLenses;
import org.higherkindedj.example.lens.LensUsageExampleLenses.CompanyLenses;
import org.higherkindedj.example.lens.LensUsageExampleLenses.EmployeeLenses;
import org.higherkindedj.optics.Lens;
import org.higherkindedj.optics.annotations.GenerateLenses;

public class LensUsageExample {

    // 1. Define a nested, immutable data model.
    @GenerateLenses
    public record Address(String street, String city) {}

    @GenerateLenses
    public record Company(String name, Address address) {}

    @GenerateLenses
    public record Employee(String name, Company company) {}


    public static void main(String[] args) {
        // 2. Create an initial, nested immutable object.
        var initialAddress = new Address("123 Fake St", "Anytown");
        var initialCompany = new Company("Initech Inc.", initialAddress);
        var initialEmployee = new Employee("Alice", initialCompany);

        System.out.println("Original Employee: " + initialEmployee);
        System.out.println("------------------------------------------");


        // --- SCENARIO 1: Simple update with a `with*` helper ---
        System.out.println("--- Scenario 1: Using `with*` Helper ---");
        var employeeWithNewName = EmployeeLenses.withName(initialEmployee, "Bob");
        System.out.println("After `withName`:    " + employeeWithNewName);
        System.out.println("------------------------------------------");

        // --- SCENARIO 2: Deep update with a composed Lens ---
        System.out.println("--- Scenario 2: Using Composed Lens ---");
        Lens&lt;Employee, String&gt; employeeToStreet =
            EmployeeLenses.company()
                .andThen(CompanyLenses.address())
                .andThen(AddressLenses.street());

        // Use `set` to replace a value
        Employee updatedEmployeeSet = employeeToStreet.set("456 Main St", initialEmployee);
        System.out.println("After deep `set`:       " + updatedEmployeeSet);

        // Use `modify` to apply a function
        Employee updatedEmployeeModify = employeeToStreet.modify(String::toUpperCase, initialEmployee);
        System.out.println("After deep `modify`:    " + updatedEmployeeModify);
        System.out.println("Original is unchanged:  " + initialEmployee);
      
        // --- SCENARIO 3: Demonstrating reusability ---
        System.out.println("--- Scenario 3: Reusing Composed Lens ---");
        var employee2 = new Employee("Charlie", new Company("Tech Corp", new Address("789 Oak Ave", "Tech City")));
      
        // Same lens works on different employee instances
        var bothUpdated = List.of(initialEmployee, employee2)
            .stream()
            .map(emp -&gt; employeeToStreet.modify(street -&gt; "Remote: " + street, emp))
            .toList();
          
        System.out.println("Batch updated: " + bothUpdated);
    }
}
</code></pre>
<p><strong>Expected Output:</strong></p>
<pre><code>Original Employee: Employee[name=Alice, company=Company[name=Initech Inc., address=Address[street=123 Fake St, city=Anytown]]]
------------------------------------------
--- Scenario 1: Using `with*` Helper ---
After `withName`:    Employee[name=Bob, company=Company[name=Initech Inc., address=Address[street=123 Fake St, city=Anytown]]]
------------------------------------------
--- Scenario 2: Using Composed Lens ---
After deep `set`:       Employee[name=Alice, company=Company[name=Initech Inc., address=Address[street=456 Main St, city=Anytown]]]
After deep `modify`:    Employee[name=Alice, company=Company[name=Initech Inc., address=Address[street=123 FAKE ST, city=Anytown]]]
Original is unchanged:  Employee[name=Alice, company=Company[name=Initech Inc., address=Address[street=123 Fake St, city=Anytown]]]
------------------------------------------
--- Scenario 3: Reusing Composed Lens ---
Batch updated: [Employee[name=Alice, company=Company[name=Initech Inc., address=Address[street=Remote: 123 Fake St, city=Anytown]]], Employee[name=Charlie, company=Company[name=Tech Corp, address=Address[street=Remote: 789 Oak Ave, city=Tech City]]]]
</code></pre>
<p>As you can see, the generated optics provide a clean, declarative, and type-safe API for working with immutable data, whether your updates are simple and shallow or complex and deep.</p>
<hr />
<h2 id="beyond-the-basics-effectful-updates-with-modifyf"><a class="header" href="#beyond-the-basics-effectful-updates-with-modifyf">Beyond the Basics: Effectful Updates with <code>modifyF</code></a></h2>
<p>While <code>set</code> and <code>modify</code> are for simple, pure updates, the <code>Lens</code> interface also supports effectful operations through <code>modifyF</code>. This method allows you to perform updates within a context like an <code>Optional</code>, <code>Validated</code>, or <code>CompletableFuture</code>.</p>
<p>This means you can use the same <code>employeeToStreet</code> lens to perform a street name update that involves failable validation or an asynchronous API call, making your business logic incredibly reusable and robust.</p>
<pre><code class="language-java">// Example: Street validation that might fail
Function&lt;String, Kind&lt;ValidatedKind.Witness&lt;String&gt;, String&gt;&gt; validateStreet = 
    street -&gt; street.length() &gt; 0 &amp;&amp; street.length() &lt; 100 
        ? VALIDATED.widen(Validated.valid(street))
        : VALIDATED.widen(Validated.invalid("Street name must be between 1 and 100 characters"));

// Use the same lens with effectful validation
Kind&lt;ValidatedKind.Witness&lt;String&gt;, Employee&gt; result = 
    employeeToStreet.modifyF(validateStreet, employee, validatedApplicative);
</code></pre>
<hr />
<p><strong>Previous:</strong><a href="optics/optics_intro.html">An Introduction to Optics</a>
<strong>Next:</strong><a href="optics/prisms.html">Prisms: Working with Sum Types</a></p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="prisms-a-practical-guide"><a class="header" href="#prisms-a-practical-guide">Prisms: A Practical Guide</a></h1>
<h2 id="working-with-sum-types"><a class="header" href="#working-with-sum-types"><em>Working with Sum Types</em></a></h2>
<p><img src="optics/../images/prism.jpeg" alt="prism.jpeg" /></p>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="optics/prisms.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to safely work with sum types and sealed interfaces</li>
<li>Using <code>@GeneratePrisms</code> to create type-safe variant accessors</li>
<li>The difference between <code>getOptional</code> and <code>build</code> operations</li>
<li>Composing prisms with other optics for deep conditional access</li>
<li>Handling optional data extraction without <code>instanceof</code> chains</li>
<li>When to use prisms vs pattern matching vs traditional type checking</li>
</ul>
</div>
</div>
<div id="admonition-example-code" class="admonition admonish-note" role="note" aria-labelledby="admonition-example-code-title">
<div class="admonition-title">
<div id="admonition-example-code-title">
<p>Example Code</p>
</div>
<a class="admonition-anchor-link" href="optics/prisms.html#admonition-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/PrismUsageExample.java">PrismUsageExample</a></p>
</div>
</div>
<p>The previous guide demonstrated how a <strong><code>Lens</code></strong> gives us a powerful, composable way to work with "has-a" relationships‚Äîa field that is guaranteed to exist within a record.</p>
<p>But what happens when the data doesn't have a guaranteed structure? What if a value can be one of <em>several different types</em>? This is the domain of "is-a" relationships, or <strong>sum types</strong>, commonly modeled in Java using <code>sealed interface</code> or <code>enum</code>.</p>
<p>For this, we need a different kind of optic: the <strong>Prism</strong>.</p>
<hr />
<h2 id="the-scenario-working-with-json-like-data"><a class="header" href="#the-scenario-working-with-json-like-data">The Scenario: Working with JSON-like Data</a></h2>
<p>A <code>Lens</code> is like a sniper rifle, targeting a single, known field. A <strong><code>Prism</code></strong> is like a safe-cracker's tool; it attempts to open a specific "lock" (a particular type) and only succeeds if it has the right key.</p>
<p>Consider a common scenario: modeling a JSON structure. A value can be a string, a number, a boolean, or a nested object.</p>
<p><strong>The Data Model:</strong> We can represent this with a <code>sealed interface</code>.</p>
<pre><code class="language-java">import org.higherkindedj.optics.annotations.GeneratePrisms;
import org.higherkindedj.optics.annotations.GenerateLenses;
import java.util.Map;

@GeneratePrisms // Generates Prisms for each case of the sealed interface
public sealed interface JsonValue {}

public record JsonString(String value) implements JsonValue {}
public record JsonNumber(double value) implements JsonValue {}

@GenerateLenses // We can still use Lenses on the product types within the sum type
public record JsonObject(Map&lt;String, JsonValue&gt; fields) implements JsonValue {}
</code></pre>
<p><strong>Our Goal:</strong> We need to safely access and update the <code>value</code> of a <code>JsonString</code> that is deeply nested within another <code>JsonObject</code>. An <code>instanceof</code> and casting approach would be unsafe and verbose. A <code>Lens</code> won't work because a <code>JsonValue</code> might be a <code>JsonNumber</code>, not the <code>JsonObject</code> we expect.</p>
<hr />
<h2 id="think-of-prisms-like"><a class="header" href="#think-of-prisms-like">Think of Prisms Like...</a></h2>
<ul>
<li><strong>A type-safe filter</strong>: Only "lets through" values that match a specific shape</li>
<li><strong>A safe cast</strong>: Like <code>instanceof</code> + cast, but functional and composable</li>
<li><strong>A conditional lens</strong>: Works like a lens, but might return empty if the type doesn't match</li>
<li><strong>A pattern matcher</strong>: Focuses on one specific case of a sum type</li>
</ul>
<hr />
<h2 id="a-step-by-step-walkthrough-1"><a class="header" href="#a-step-by-step-walkthrough-1">A Step-by-Step Walkthrough</a></h2>
<h3 id="step-1-generating-the-prisms"><a class="header" href="#step-1-generating-the-prisms">Step 1: Generating the Prisms</a></h3>
<p>Just as with lenses, we annotate our <code>sealed interface</code> with <strong><code>@GeneratePrisms</code></strong>. This automatically creates a companion class (e.g., <code>JsonValuePrisms</code>) with a <code>Prism</code> for each permitted subtype.</p>
<pre><code class="language-java">// Generated automatically:
// JsonValuePrisms.jsonString() -&gt; Prism&lt;JsonValue, JsonString&gt;
// JsonValuePrisms.jsonNumber() -&gt; Prism&lt;JsonValue, JsonNumber&gt;
// JsonValuePrisms.jsonBoolean() -&gt; Prism&lt;JsonValue, JsonBoolean&gt;
// JsonValuePrisms.jsonObject() -&gt; Prism&lt;JsonValue, JsonObject&gt;
</code></pre>
<h3 id="step-2-the-core-prism-operations"><a class="header" href="#step-2-the-core-prism-operations">Step 2: The Core Prism Operations</a></h3>
<p>A <code>Prism</code> is defined by two unique, failable operations:</p>
<ul>
<li><strong><code>getOptional(source)</code></strong>: Attempts to focus on the target. It returns an <code>Optional</code> which is non-empty only if the <code>source</code> matches the Prism's specific case. This is the safe alternative to an <code>instanceof</code> check and cast.</li>
<li><strong><code>build(value)</code></strong>: Constructs the top-level type from a part. This is the reverse operation, used to wrap a value back into its specific case (e.g., taking a <code>String</code> and building a <code>JsonString</code>).</li>
</ul>
<pre><code class="language-java">Prism&lt;JsonValue, JsonString&gt; jsonStringPrism = JsonValuePrisms.jsonString();

// --- Using getOptional (the safe "cast") ---
Optional&lt;JsonString&gt; result1 = jsonStringPrism.getOptional(new JsonString("hello")); 
// -&gt; Optional.of(JsonString("hello"))

Optional&lt;JsonString&gt; result2 = jsonStringPrism.getOptional(new JsonNumber(123));   
// -&gt; Optional.empty()

// --- Using build (construct the sum type from a part) ---
JsonValue result3 = jsonStringPrism.build(new JsonString("world")); 
// -&gt; JsonString("world") (as JsonValue)
</code></pre>
<h3 id="step-3-composing-prisms-for-deep-access"><a class="header" href="#step-3-composing-prisms-for-deep-access">Step 3: Composing Prisms for Deep Access</a></h3>
<p>The true power is composing <code>Prism</code>s with other optics. When a composition might fail (any time a <code>Prism</code> is involved), the result is a <code>Traversal</code>. To ensure type-safety during composition, we convert each optic in the chain to a <code>Traversal</code> using <code>.asTraversal()</code>.</p>
<pre><code class="language-java">
// Create all the optics we need
Prism&lt;JsonValue, JsonObject&gt; jsonObjectPrism = JsonValuePrisms.jsonObject();
Prism&lt;JsonValue, JsonString&gt; jsonStringPrism = JsonValuePrisms.jsonString();
Lens&lt;JsonObject, Map&lt;String, JsonValue&gt;&gt; fieldsLens = JsonObjectLenses.fields();


// The composed optic: safely navigate from JsonObject -&gt; user field -&gt; name field -&gt; string value
Traversal&lt;JsonObject, String&gt; userNameTraversal =
    fieldsLens.asTraversal()                      // JsonObject -&gt; Map&lt;String, JsonValue&gt;
        .andThen(mapValue("user"))                // -&gt; JsonValue (if "user" key exists)
        .andThen(jsonObjectPrism.asTraversal())   // -&gt; JsonObject (if it's an object)
        .andThen(fieldsLens.asTraversal())        // -&gt; Map&lt;String, JsonValue&gt;
         .andThen(Traversals.forMap("name"))     // -&gt; JsonValue (if "name" key exists)
        .andThen(jsonStringPrism.asTraversal())   // -&gt; JsonString (if it's a string)
        .andThen(JsonStringLenses.value().asTraversal()); // -&gt; String
</code></pre>
<p>This composed <code>Traversal</code> now represents a safe, deep path that will only succeed if every step in the chain matches.</p>
<hr />
<h2 id="when-to-use-prisms-vs-other-approaches"><a class="header" href="#when-to-use-prisms-vs-other-approaches">When to Use Prisms vs Other Approaches</a></h2>
<h3 id="use-prisms-when"><a class="header" href="#use-prisms-when">Use Prisms When:</a></h3>
<ul>
<li><strong>Type-safe variant handling</strong> - Working with <code>sealed interface</code> or <code>enum</code> cases</li>
<li><strong>Optional data extraction</strong> - You need to safely "try" to get a specific type</li>
<li><strong>Composable type checking</strong> - Building reusable type-safe paths</li>
<li><strong>Functional pattern matching</strong> - Avoiding <code>instanceof</code> chains</li>
</ul>
<pre><code class="language-java">// Perfect for safe type extraction
Optional&lt;String&gt; errorMessage = DomainErrorPrisms.validationError()
    .andThen(ValidationErrorLenses.message())
    .getOptional(someError);
</code></pre>
<h3 id="use-traditional-instanceof-when"><a class="header" href="#use-traditional-instanceof-when">Use Traditional instanceof When:</a></h3>
<ul>
<li><strong>One-off type checks</strong> - Not building reusable logic</li>
<li><strong>Imperative control flow</strong> - You need if/else branching</li>
<li><strong>Performance critical paths</strong> - Minimal abstraction overhead needed</li>
</ul>
<pre><code class="language-java">// Sometimes instanceof is clearer for simple cases
if (jsonValue instanceof JsonString jsonStr) {
    return jsonStr.value().toUpperCase();
}
</code></pre>
<h3 id="use-pattern-matching-when"><a class="header" href="#use-pattern-matching-when">Use Pattern Matching When:</a></h3>
<ul>
<li><strong>Exhaustive case handling</strong> - You need to handle all variants</li>
<li><strong>Complex extraction logic</strong> - Multiple levels of pattern matching</li>
<li><strong>Modern codebases</strong> - Using recent Java features</li>
</ul>
<pre><code class="language-java">// Pattern matching for comprehensive handling
return switch (jsonValue) {
    case JsonString(var str) -&gt; str.toUpperCase();
    case JsonNumber(var num) -&gt; String.valueOf(num);
    case JsonBoolean(var bool) -&gt; String.valueOf(bool);
    case JsonObject(var fields) -&gt; "Object with " + fields.size() + " fields";
};
</code></pre>
<hr />
<h2 id="common-pitfalls-2"><a class="header" href="#common-pitfalls-2">Common Pitfalls</a></h2>
<h3 id="-dont-do-this-1"><a class="header" href="#-dont-do-this-1">‚ùå Don't Do This:</a></h3>
<pre><code class="language-java">// Unsafe: Assuming the cast will succeed
JsonString jsonStr = (JsonString) jsonValue; // Can throw ClassCastException!

// Verbose: Repeated instanceof checks
if (jsonValue instanceof JsonObject obj1) {
    var userValue = obj1.fields().get("user");
    if (userValue instanceof JsonObject obj2) {
        var nameValue = obj2.fields().get("name");
        if (nameValue instanceof JsonString str) {
            return str.value().toUpperCase();
        }
    }
}

// Inefficient: Creating prisms repeatedly
var name1 = JsonValuePrisms.jsonString().getOptional(value1);
var name2 = JsonValuePrisms.jsonString().getOptional(value2);
var name3 = JsonValuePrisms.jsonString().getOptional(value3);
</code></pre>
<h3 id="-do-this-instead-1"><a class="header" href="#-do-this-instead-1">‚úÖ Do This Instead:</a></h3>
<pre><code class="language-java">// Safe: Use prism's getOptional
Optional&lt;JsonString&gt; maybeJsonStr = JsonValuePrisms.jsonString().getOptional(jsonValue);

// Composable: Build reusable safe paths
var userNamePath = JsonValuePrisms.jsonObject()
    .andThen(JsonObjectLenses.fields())
    .andThen(mapValue("user"))
    .andThen(JsonValuePrisms.jsonObject())
    // ... continue composition

// Efficient: Reuse prisms and composed paths
var stringPrism = JsonValuePrisms.jsonString();
var name1 = stringPrism.getOptional(value1);
var name2 = stringPrism.getOptional(value2);
var name3 = stringPrism.getOptional(value3);
</code></pre>
<hr />
<h2 id="performance-notes-2"><a class="header" href="#performance-notes-2">Performance Notes</a></h2>
<p>Prisms are optimised for type safety and composability:</p>
<ul>
<li><strong>Fast type checking</strong>: Prisms use <code>instanceof</code> under the hood, which is optimised by the JVM</li>
<li><strong>Lazy evaluation</strong>: Composed prisms only perform checks when needed</li>
<li><strong>Memory efficient</strong>: No boxing or wrapper allocation for failed matches</li>
<li><strong>Composable</strong>: Complex type-safe paths can be built once and reused</li>
</ul>
<p><strong>Best Practice</strong>: For frequently used prism combinations, create them once and store as constants:</p>
<pre><code class="language-java">public class JsonOptics {
    public static final Prism&lt;JsonValue, JsonString&gt; STRING = 
        JsonValuePrisms.jsonString();
  
    public static final Traversal&lt;JsonValue, String&gt; STRING_VALUE = 
        STRING.andThen(JsonStringLenses.value());
  
    public static final Traversal&lt;JsonObject, String&gt; USER_NAME = 
        fieldsLens.asTraversal()
            .andThen(Traversals.forMap("user"))
            .andThen(JsonValuePrisms.jsonObject().asTraversal())
            .andThen(fieldsLens.asTraversal())
            .andThen(Traversals.forMap("name"))
            .andThen(STRING.asTraversal())
            .andThen(JsonStringLenses.value().asTraversal());
}
</code></pre>
<h2 id="real-world-example-api-response-handling"><a class="header" href="#real-world-example-api-response-handling">Real-World Example: API Response Handling</a></h2>
<p>Here's a practical example of using prisms to handle different API response types safely:</p>
<pre><code class="language-java">@GeneratePrisms
public sealed interface ApiResponse {}
public record SuccessResponse(String data, int statusCode) implements ApiResponse {}
public record ErrorResponse(String message, String errorCode) implements ApiResponse {}
public record TimeoutResponse(long timeoutMs) implements ApiResponse {}

public class ApiHandler {
    // Reusable prisms for different response types
    private static final Prism&lt;ApiResponse, SuccessResponse&gt; SUCCESS = 
        ApiResponsePrisms.successResponse();
    private static final Prism&lt;ApiResponse, ErrorResponse&gt; ERROR = 
        ApiResponsePrisms.errorResponse();
    private static final Prism&lt;ApiResponse, TimeoutResponse&gt; TIMEOUT = 
        ApiResponsePrisms.timeoutResponse();
  
    public String handleResponse(ApiResponse response) {
        // Type-safe extraction and handling
        return SUCCESS.getOptional(response)
            .map(success -&gt; "Success: " + success.data())
            .or(() -&gt; ERROR.getOptional(response)
                .map(error -&gt; "Error " + error.errorCode() + ": " + error.message()))
            .or(() -&gt; TIMEOUT.getOptional(response)
                .map(timeout -&gt; "Request timed out after " + timeout.timeoutMs() + "ms"))
            .orElse("Unknown response type");
    }
  
    // Use prisms for conditional processing
    public boolean isRetryable(ApiResponse response) {
        return ERROR.getOptional(response)
            .map(error -&gt; "RATE_LIMIT".equals(error.errorCode()) || "TEMPORARY".equals(error.errorCode()))
            .or(() -&gt; TIMEOUT.getOptional(response).map(t -&gt; true))
            .orElse(false);
    }
}
</code></pre>
<h2 id="complete-runnable-example-1"><a class="header" href="#complete-runnable-example-1">Complete, Runnable Example</a></h2>
<p>This example puts it all together, showing how to use the composed <code>Traversal</code> to perform a safe update.</p>
<pre><code class="language-java">package org.higherkindedj.example.prism;

import org.higherkindedj.optics.Lens;
import org.higherkindedj.optics.Prism;
import org.higherkindedj.optics.Traversal;
import org.higherkindedj.optics.annotations.GenerateLenses;
import org.higherkindedj.optics.annotations.GeneratePrisms;
import org.higherkindedj.optics.util.Traversals;
import java.util.*;

public class PrismUsageExample {

    // 1. Define the nested data model with sum types.
    @GeneratePrisms
    public sealed interface JsonValue {}
    public record JsonString(String value) implements JsonValue {}
    public record JsonNumber(double value) implements JsonValue {}
  
    @GenerateLenses
    public record JsonObject(Map&lt;String, JsonValue&gt; fields) implements JsonValue {}


    public static void main(String[] args) {
        // 2. Create the initial nested structure.
        var userData = Map.of(
            "user", new JsonObject(Map.of(
                "name", new JsonString("Alice"),
                "age", new JsonNumber(30),
                "active", new JsonBoolean(true)
            )),
            "metadata", new JsonObject(Map.of(
                "version", new JsonString("1.0")
            ))
        );
        var data = new JsonObject(userData);
    
        System.out.println("Original Data: " + data);
        System.out.println("------------------------------------------");


        // 3. Get the generated and manually created optics.
        Prism&lt;JsonValue, JsonObject&gt; jsonObjectPrism = JsonValuePrisms.jsonObject();
        Prism&lt;JsonValue, JsonString&gt; jsonStringPrism = JsonValuePrisms.jsonString();
        Lens&lt;JsonObject, Map&lt;String, JsonValue&gt;&gt; fieldsLens = JsonObjectLenses.fields();
        Lens&lt;JsonString, String&gt; jsonStringValueLens = Lens.of(JsonString::value, (js, s) -&gt; new JsonString(s));
    
        // 4. Demonstrate individual prism operations
        System.out.println("--- Individual Prism Operations ---");
    
        // Safe type extraction
        JsonValue userValue = data.fields().get("user");
        Optional&lt;JsonObject&gt; userObject = jsonObjectPrism.getOptional(userValue);
        System.out.println("User object: " + userObject);
    
        // Attempting to extract wrong type
        JsonValue nameValue = ((JsonObject) userValue).fields().get("name");
        Optional&lt;JsonNumber&gt; nameAsNumber = JsonValuePrisms.jsonNumber().getOptional(nameValue);
        System.out.println("Name as number (should be empty): " + nameAsNumber);
    
        // Building new values
        JsonValue newString = jsonStringPrism.build(new JsonString("Bob"));
        System.out.println("Built new string: " + newString);
        System.out.println("------------------------------------------");
    
        // 5. Compose the full traversal.
        Traversal&lt;JsonObject, String&gt; userToJsonName =
            fieldsLens.asTraversal()
                .andThen(Traversals.forMap("user")) 
                .andThen(jsonObjectPrism.asTraversal())
                .andThen(fieldsLens.asTraversal())
                .andThen(Traversals.forMap("name"))
                .andThen(jsonStringPrism.asTraversal())
                .andThen(jsonStringValueLens.asTraversal());

          // 6. Use the composed traversal to perform safe updates
        JsonObject updatedData = Traversals.modify(userNameTraversal, String::toUpperCase, data);
        System.out.println("After safe `modify`:  " + updatedData);
    
        // 7. Demonstrate that the traversal safely handles missing paths
        var dataWithoutUser = new JsonObject(Map.of("metadata", new JsonString("test")));
        JsonObject safeUpdate = Traversals.modify(userNameTraversal, String::toUpperCase, dataWithoutUser);
        System.out.println("Safe update on missing path: " + safeUpdate);
    
        System.out.println("Original is unchanged: " + data);
        System.out.println("------------------------------------------");
    
        // 8. Demonstrate error-resistant operations
        System.out.println("--- Error-Resistant Operations ---");
    
        // Get all string values safely
        List&lt;String&gt; allStrings = List.of(
            new JsonString("hello"),
            new JsonNumber(42),
            new JsonString("world"),
            new JsonBoolean(true)
        ).stream()
        .map(jsonStringPrism::getOptional)
        .filter(Optional::isPresent)
        .map(Optional::get)
        .map(JsonString::value)
        .toList();
    
        System.out.println("Extracted strings only: " + allStrings);
    }
}
</code></pre>
<p><strong>Expected Output:</strong></p>
<pre><code>Original Data: JsonObject[fields={user=JsonObject[fields={name=JsonString[value=Alice], age=JsonNumber[value=30.0], active=JsonBoolean[value=true]}], metadata=JsonObject[fields={version=JsonString[value=1.0]}]}]
------------------------------------------
--- Individual Prism Operations ---
User object: Optional[JsonObject[fields={name=JsonString[value=Alice], age=JsonNumber[value=30.0], active=JsonBoolean[value=true]}]]
Name as number (should be empty): Optional.empty
Built new string: JsonString[value=Bob]
------------------------------------------
--- Composed Traversal Operations ---
After safe `modify`:  JsonObject[fields={user=JsonObject[fields={name=JsonString[value=ALICE], age=JsonNumber[value=30.0], active=JsonBoolean[value=true]}], metadata=JsonObject[fields={version=JsonString[value=1.0]}]}]
Safe update on missing path: JsonObject[fields={metadata=JsonString[value=test]}]
Original is unchanged: JsonObject[fields={user=JsonObject[fields={name=JsonString[value=Alice], age=JsonNumber[value=30.0], active=JsonBoolean[value=true]}], metadata=JsonObject[fields={version=JsonString[value=1.0]}]}]
------------------------------------------
--- Error-Resistant Operations ---
Extracted strings only: [hello, world]
</code></pre>
<hr />
<h2 id="why-prisms-are-essential"><a class="header" href="#why-prisms-are-essential">Why Prisms are Essential</a></h2>
<p><code>Lens</code> handles the "what" and <code>Prism</code> handles the "what if." Together, they allow you to model and operate on virtually any immutable data structure you can design. Prisms are essential for:</p>
<ul>
<li><strong>Safety</strong>: Eliminating <code>instanceof</code> checks and unsafe casts.</li>
<li><strong>Clarity</strong>: Expressing failable focus in a clean, functional way.</li>
<li><strong>Composability</strong>: Combining checks for different data shapes into a single, reusable optic.</li>
<li><strong>Maintainability</strong>: Creating type-safe paths that won't break when data structures evolve.</li>
</ul>
<p>By adding Prisms to your toolkit, you can write even more robust, declarative, and maintainable code that gracefully handles the complexity of real-world data structures.</p>
<hr />
<p><strong>Previous:</strong><a href="optics/lenses.html">Lenses: Working with Product Types</a>
<strong>Next:</strong><a href="optics/iso.html">Isomorphisms: Data Equivalence</a></p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="isomorphisms-a-practical-guide"><a class="header" href="#isomorphisms-a-practical-guide">Isomorphisms: A Practical Guide</a></h1>
<h2 id="data-equivalence-with-isos"><a class="header" href="#data-equivalence-with-isos"><em>Data Equivalence with Isos</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="optics/iso.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to define lossless, reversible conversions between equivalent types</li>
<li>Creating isomorphisms with <code>Iso.of(get, reverseGet)</code></li>
<li>Using <code>reverse()</code> to flip conversion directions</li>
<li>Step-by-step transformation workflows for data format conversion</li>
<li>Testing round-trip properties to ensure conversion correctness</li>
<li>When to use isos vs direct conversion methods vs manual adapters</li>
</ul>
</div>
</div>
<div id="admonition-example-code" class="admonition admonish-note" role="note" aria-labelledby="admonition-example-code-title">
<div class="admonition-title">
<div id="admonition-example-code-title">
<p>Example Code</p>
</div>
<a class="admonition-anchor-link" href="optics/iso.html#admonition-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/IsoUsageExample.java">IsoUsageExample</a></p>
</div>
</div>
<p>In the previous guides, we explored two essential optics: the <strong><code>Lens</code></strong>, for targeting data that <em>must</em> exist (a "has-a" relationship), and the <strong><code>Prism</code></strong>, for safely targeting data that <em>might</em> exist in a specific shape (an "is-a" relationship).</p>
<p>This leaves one final, fundamental question: what if you have two data types that are different in structure but hold the exact same information? How do you switch between them losslessly? For this, we need our final core optic: the <strong><code>Iso</code></strong>.</p>
<hr />
<h2 id="the-scenario-translating-between-equivalent-types"><a class="header" href="#the-scenario-translating-between-equivalent-types">The Scenario: Translating Between Equivalent Types</a></h2>
<p>An <strong><code>Iso</code></strong> (Isomorphism) is a "two-way street." It's an optic that represents a perfectly reversible, lossless conversion between two equivalent types. Think of it as a <strong>universal translator</strong> üîÑ or a type-safe adapter that you can compose with other optics.</p>
<p>An <code>Iso</code> is the right tool when you need to:</p>
<ul>
<li>Convert a wrapper type to its raw value (e.g., <code>UserId(long id)</code> &lt;-&gt; <code>long</code>).</li>
<li>Handle data encoding and decoding (e.g., <code>byte[]</code> &lt;-&gt; <code>Base64 String</code>).</li>
<li>Bridge two data structures that are informationally identical (e.g., a custom record and a generic tuple).</li>
</ul>
<p>Let's explore that last case. Imagine we have a <code>Point</code> record and want to convert it to a generic <code>Tuple2</code> to use with a library that operates on tuples.</p>
<p><strong>The Data Model:</strong></p>
<pre><code class="language-java">public record Point(int x, int y) {}

public record Tuple2&lt;A, B&gt;(A _1, B _2) {}
</code></pre>
<p>These two records can hold the same information. An <code>Iso</code> is the perfect way to formalize this relationship.</p>
<hr />
<h2 id="think-of-isos-like"><a class="header" href="#think-of-isos-like">Think of Isos Like...</a></h2>
<ul>
<li><strong>A universal translator</strong>: Perfect two-way conversion between equivalent representations</li>
<li><strong>A reversible adapter</strong>: Converts between formats without losing information</li>
<li><strong>A bridge</strong>: Connects two different structures that represent the same data</li>
<li><strong>A currency exchange</strong>: Converts between equivalent values at a 1:1 rate</li>
</ul>
<hr />
<h2 id="a-step-by-step-walkthrough-2"><a class="header" href="#a-step-by-step-walkthrough-2">A Step-by-Step Walkthrough</a></h2>
<h3 id="step-1-defining-an-iso"><a class="header" href="#step-1-defining-an-iso">Step 1: Defining an Iso</a></h3>
<p>Unlike Lenses and Prisms, which are often generated from annotations, Isos are almost always defined manually. This is because the logic for converting between two types is unique to your specific domain.</p>
<p>You create an <code>Iso</code> using the static <code>Iso.of(get, reverseGet)</code> constructor.</p>
<pre><code class="language-java">import org.higherkindedj.optics.Iso;
import org.higherkindedj.hkt.tuple.Tuple;
import org.higherkindedj.hkt.tuple.Tuple2;

public class Converters {
    public static Iso&lt;Point, Tuple2&lt;Integer, Integer&gt;&gt; pointToTuple() {
      return Iso.of(
          // Function to get the Tuple from the Point
          point -&gt; Tuple.of(point.x(), point.y()),
          // Function to get the Point from the Tuple
          tuple -&gt; new Point(tuple._1(), tuple._2())
      );
    }
}
</code></pre>
<h3 id="step-2-the-core-iso-operations"><a class="header" href="#step-2-the-core-iso-operations">Step 2: The Core Iso Operations</a></h3>
<p>An <code>Iso</code> provides two fundamental, lossless operations:</p>
<ul>
<li><strong><code>get(source)</code></strong>: The "forward" conversion (e.g., from <code>Point</code> to <code>Tuple2</code>).</li>
<li><strong><code>reverseGet(target)</code></strong>: The "backward" conversion (e.g., from <code>Tuple2</code> back to <code>Point</code>).</li>
</ul>
<p>Furthermore, every <code>Iso</code> is trivially reversible using the <strong><code>.reverse()</code></strong> method, which returns a new <code>Iso</code> with the "get" and "reverseGet" functions swapped.</p>
<pre><code class="language-java">var pointToTupleIso = Converters.pointToTuple();
var myPoint = new Point(10, 20);

// Forward conversion
Tuple2&lt;Integer, Integer&gt; myTuple = pointToTupleIso.get(myPoint); // -&gt; Tuple2[10, 20]

// Backward conversion using the reversed Iso
Point convertedBack = pointToTupleIso.reverse().get(myTuple); // -&gt; Point[10, 20]

// Demonstrate perfect round-trip
assert myPoint.equals(convertedBack); // Always true for lawful Isos
</code></pre>
<h3 id="step-3-composing-isos-as-a-bridge"><a class="header" href="#step-3-composing-isos-as-a-bridge">Step 3: Composing Isos as a Bridge</a></h3>
<p>The most powerful feature of an <code>Iso</code> is its ability to act as an adapter or "glue" between other optics. Because the conversion is lossless, an <code>Iso</code> preserves the "shape" of the optic it's composed with.</p>
<ul>
<li><code>Iso + Iso = Iso</code></li>
<li><strong><code>Iso + Lens = Lens</code></strong></li>
<li><strong><code>Iso + Prism = Prism</code></strong></li>
<li><strong><code>Iso + Traversal = Traversal</code></strong></li>
</ul>
<p>This second rule is incredibly useful. We can compose our <code>Iso&lt;Point, Tuple2&gt;</code> with a <code>Lens</code> that operates on a <code>Tuple2</code> to create a brand new <code>Lens</code> that operates directly on our <code>Point</code>!</p>
<pre><code class="language-java">// A standard Lens that gets the first element of any Tuple2
Lens&lt;Tuple2&lt;Integer, Integer&gt;, Integer&gt; tupleFirstElementLens = ...;

// The composition: Iso&lt;Point, Tuple2&gt; + Lens&lt;Tuple2, Integer&gt; = Lens&lt;Point, Integer&gt;
Lens&lt;Point, Integer&gt; pointToX = pointToTupleIso.andThen(tupleFirstElementLens);

// We can now use this new Lens to modify the 'x' coordinate of our Point
Point movedPoint = pointToX.modify(x -&gt; x + 5, myPoint); // -&gt; Point[15, 20]
</code></pre>
<p>The <code>Iso</code> acted as a bridge, allowing a generic <code>Lens</code> for tuples to work on our specific <code>Point</code> record.</p>
<hr />
<h2 id="when-to-use-isos-vs-other-approaches"><a class="header" href="#when-to-use-isos-vs-other-approaches">When to Use Isos vs Other Approaches</a></h2>
<h3 id="use-isos-when"><a class="header" href="#use-isos-when">Use Isos When:</a></h3>
<ul>
<li><strong>Data format conversion</strong> - Converting between equivalent representations</li>
<li><strong>Legacy system integration</strong> - Bridging old and new data formats</li>
<li><strong>Library interoperability</strong> - Adapting your types to work with external libraries</li>
<li><strong>Composable adapters</strong> - Building reusable conversion components</li>
</ul>
<pre><code class="language-java">// Perfect for format conversion
Iso&lt;LocalDate, String&gt; dateStringIso = Iso.of(
    date -&gt; date.format(DateTimeFormatter.ISO_LOCAL_DATE),
    dateStr -&gt; LocalDate.parse(dateStr, DateTimeFormatter.ISO_LOCAL_DATE)
);

// Use with any date-focused lens
Lens&lt;Person, String&gt; birthDateStringLens = 
    PersonLenses.birthDate().andThen(dateStringIso);
</code></pre>
<h3 id="use-direct-conversion-methods-when"><a class="header" href="#use-direct-conversion-methods-when">Use Direct Conversion Methods When:</a></h3>
<ul>
<li><strong>One-way conversion</strong> - You don't need the reverse operation</li>
<li><strong>Non-lossless conversion</strong> - Information is lost in the conversion</li>
<li><strong>Performance critical paths</strong> - Minimal abstraction overhead needed</li>
</ul>
<pre><code class="language-java">// Simple one-way conversion
String pointDescription = point.x() + "," + point.y();
</code></pre>
<h3 id="use-manual-adapters-when"><a class="header" href="#use-manual-adapters-when">Use Manual Adapters When:</a></h3>
<ul>
<li><strong>Complex conversion logic</strong> - Multi-step or conditional conversions</li>
<li><strong>Validation required</strong> - Conversion might fail</li>
<li><strong>Side effects needed</strong> - Logging, caching, etc.</li>
</ul>
<pre><code class="language-java">// Complex conversion that might fail
public Optional&lt;Point&gt; parsePoint(String input) {
    try {
        String[] parts = input.split(",");
        return Optional.of(new Point(
            Integer.parseInt(parts[0].trim()),
            Integer.parseInt(parts[1].trim())
        ));
    } catch (Exception e) {
        return Optional.empty();
    }
}
</code></pre>
<hr />
<h2 id="common-pitfalls-3"><a class="header" href="#common-pitfalls-3">Common Pitfalls</a></h2>
<h3 id="-dont-do-this-2"><a class="header" href="#-dont-do-this-2">‚ùå Don't Do This:</a></h3>
<pre><code class="language-java">// Lossy conversion - not a true isomorphism
Iso&lt;Double, Integer&gt; lossyIso = Iso.of(
    d -&gt; d.intValue(),    // Loses decimal precision!
    i -&gt; i.doubleValue()  // Can't recover original value
);

// One-way thinking - forgetting about reverseGet
Iso&lt;Point, String&gt; badPointIso = Iso.of(
    point -&gt; point.x() + "," + point.y(),
    str -&gt; new Point(0, 0)  // Ignores the input!
);

// Creating Isos repeatedly instead of reusing
var iso1 = Iso.of(Point::x, x -&gt; new Point(x, 0));
var iso2 = Iso.of(Point::x, x -&gt; new Point(x, 0));
var iso3 = Iso.of(Point::x, x -&gt; new Point(x, 0));
</code></pre>
<h3 id="-do-this-instead-2"><a class="header" href="#-do-this-instead-2">‚úÖ Do This Instead:</a></h3>
<pre><code class="language-java">// True isomorphism - perfect round-trip
Iso&lt;Point, String&gt; goodPointIso = Iso.of(
    point -&gt; point.x() + "," + point.y(),
    str -&gt; {
        String[] parts = str.split(",");
        return new Point(Integer.parseInt(parts[0]), Integer.parseInt(parts[1]));
    }
);

// Test your isomorphisms
public static &lt;A, B&gt; void testIsomorphism(Iso&lt;A, B&gt; iso, A original) {
    B converted = iso.get(original);
    A roundTrip = iso.reverse().get(converted);
    assert original.equals(roundTrip) : "Iso failed round-trip test";
}

// Reuse Isos as constants
public static final Iso&lt;Point, Tuple2&lt;Integer, Integer&gt;&gt; POINT_TO_TUPLE = 
    Iso.of(
        point -&gt; Tuple.of(point.x(), point.y()),
        tuple -&gt; new Point(tuple._1(), tuple._2())
    );
</code></pre>
<hr />
<h2 id="performance-notes-3"><a class="header" href="#performance-notes-3">Performance Notes</a></h2>
<p>Isos are designed for efficient, lossless conversion:</p>
<ul>
<li><strong>Zero overhead composition</strong>: Multiple Iso compositions are fused into single operations</li>
<li><strong>Lazy evaluation</strong>: Conversions only happen when needed</li>
<li><strong>Type safety</strong>: All conversions are checked at compile time</li>
<li><strong>Reusable</strong>: Isos can be stored and reused across your application</li>
</ul>
<p><strong>Best Practice</strong>: For frequently used conversions, create Isos as constants and test them:</p>
<pre><code class="language-java">public class DataIsos {
    public static final Iso&lt;UserId, Long&gt; USER_ID_LONG = 
        Iso.of(UserId::value, UserId::new);
    
    public static final Iso&lt;Money, BigDecimal&gt; MONEY_DECIMAL = 
        Iso.of(Money::amount, Money::new);
    
    // Test your isos
    static {
        testIsomorphism(USER_ID_LONG, new UserId(12345L));
        testIsomorphism(MONEY_DECIMAL, new Money(new BigDecimal("99.99")));
    }
  
    private static &lt;A, B&gt; void testIsomorphism(Iso&lt;A, B&gt; iso, A original) {
        B converted = iso.get(original);
        A roundTrip = iso.reverse().get(converted);
        if (!original.equals(roundTrip)) {
            throw new AssertionError("Iso failed round-trip test: " + original + " -&gt; " + converted + " -&gt; " + roundTrip);
        }
    }
}
</code></pre>
<hr />
<h2 id="real-world-examples"><a class="header" href="#real-world-examples">Real-World Examples</a></h2>
<h3 id="1-api-data-transformation"><a class="header" href="#1-api-data-transformation">1. API Data Transformation</a></h3>
<pre><code class="language-java">// Internal model
public record Customer(String name, String email, LocalDate birthDate) {}

// External API model
public record CustomerDto(String fullName, String emailAddress, String birthDateString) {}

public class CustomerIsos {
    public static final Iso&lt;Customer, CustomerDto&gt; CUSTOMER_DTO = Iso.of(
        // Convert to DTO
        customer -&gt; new CustomerDto(
            customer.name(),
            customer.email(),
            customer.birthDate().format(DateTimeFormatter.ISO_LOCAL_DATE)
        ),
        // Convert from DTO
        dto -&gt; new Customer(
            dto.fullName(),
            dto.emailAddress(),
            LocalDate.parse(dto.birthDateString(), DateTimeFormatter.ISO_LOCAL_DATE)
        )
    );
  
    // Now any Customer lens can work with DTOs
    public static final Lens&lt;CustomerDto, String&gt; DTO_NAME = 
        CUSTOMER_DTO.reverse().andThen(CustomerLenses.name()).andThen(CUSTOMER_DTO);
}
</code></pre>
<h3 id="2-configuration-format-conversion"><a class="header" href="#2-configuration-format-conversion">2. Configuration Format Conversion</a></h3>
<pre><code class="language-java">// Different configuration representations
public record DatabaseConfig(String host, int port, String database) {}
public record ConnectionString(String value) {}

public class ConfigIsos {
    public static final Iso&lt;DatabaseConfig, ConnectionString&gt; DB_CONNECTION = Iso.of(
        // To connection string
        config -&gt; new ConnectionString(
            "jdbc:postgresql://" + config.host() + ":" + config.port() + "/" + config.database()
        ),
        // From connection string
        conn -&gt; {
            // Simple parser for this example
            String url = conn.value();
            String[] parts = url.replace("jdbc:postgresql://", "").split("[:/]");
            return new DatabaseConfig(parts[0], Integer.parseInt(parts[1]), parts[2]);
        }
    );
  
    // Use with existing configuration lenses
    public static final Lens&lt;DatabaseConfig, String&gt; CONNECTION_STRING_HOST = 
        DB_CONNECTION.andThen(
            Lens.of(
                cs -&gt; cs.value().split("//")[1].split(":")[0],
                (cs, host) -&gt; new ConnectionString(cs.value().replaceFirst("//[^:]+:", "//" + host + ":"))
            )
        ).andThen(DB_CONNECTION.reverse());
}
</code></pre>
<h3 id="3-wrapper-type-integration"><a class="header" href="#3-wrapper-type-integration">3. Wrapper Type Integration</a></h3>
<pre><code class="language-java">// Strongly-typed wrappers
public record ProductId(UUID value) {}
public record CategoryId(UUID value) {}

public class WrapperIsos {
    public static final Iso&lt;ProductId, UUID&gt; PRODUCT_ID_UUID = 
        Iso.of(ProductId::value, ProductId::new);
  
    public static final Iso&lt;CategoryId, UUID&gt; CATEGORY_ID_UUID = 
        Iso.of(CategoryId::value, CategoryId::new);
  
    // Use with any UUID-based operations
    public static String formatProductId(ProductId id) {
        return PRODUCT_ID_UUID
            .andThen(Iso.of(UUID::toString, UUID::fromString))
            .get(id);
    }
}
</code></pre>
<h2 id="complete-runnable-example-2"><a class="header" href="#complete-runnable-example-2">Complete, Runnable Example</a></h2>
<p>This example puts all the steps together to show both direct conversion and composition.</p>
<pre><code class="language-java">public class IsoUsageExample {

    @GenerateLenses
    public record Point(int x, int y) {}

    @GenerateLenses
    public record Circle(Point centre, int radius) {}

    public static class Converters {
        @GenerateIsos
        public static Iso&lt;Point, Tuple2&lt;Integer, Integer&gt;&gt; pointToTuple() {
            return Iso.of(
                    point -&gt; Tuple.of(point.x(), point.y()),
                    tuple -&gt; new Point(tuple._1(), tuple._2()));
        }

        // Additional useful Isos
        public static final Iso&lt;Point, String&gt; POINT_STRING = Iso.of(
                point -&gt; point.x() + "," + point.y(),
                str -&gt; {
                    String[] parts = str.split(",");
                    return new Point(Integer.parseInt(parts[0]), Integer.parseInt(parts[1]));
                }
        );
    }

    // Test helper
    private static &lt;A, B&gt; void testRoundTrip(Iso&lt;A, B&gt; iso, A original, String description) {
        B converted = iso.get(original);
        A roundTrip = iso.reverse().get(converted);
        System.out.println(description + ":");
        System.out.println("  Original:  " + original);
        System.out.println("  Converted: " + converted);
        System.out.println("  Round-trip: " + roundTrip);
        System.out.println("  Success: " + original.equals(roundTrip));
        System.out.println();
    }

    public static void main(String[] args) {
        // 1. Define a point and circle.
        var myPoint = new Point(10, 20);
        var myCircle = new Circle(myPoint, 5);

        System.out.println("=== ISO USAGE EXAMPLE ===");
        System.out.println("Original Point: " + myPoint);
        System.out.println("Original Circle: " + myCircle);
        System.out.println("------------------------------------------");

        // 2. Get the generated Iso.
        var pointToTupleIso = ConvertersIsos.pointToTuple;

        // --- SCENARIO 1: Direct conversions and round-trip testing ---
        System.out.println("--- Scenario 1: Direct Conversions ---");
        testRoundTrip(pointToTupleIso, myPoint, "Point to Tuple conversion");
        testRoundTrip(Converters.POINT_STRING, myPoint, "Point to String conversion");

        // --- SCENARIO 2: Using reverse() ---
        System.out.println("--- Scenario 2: Reverse Operations ---");
        var tupleToPointIso = pointToTupleIso.reverse();
        var myTuple = Tuple.of(30, 40);
        Point pointFromTuple = tupleToPointIso.get(myTuple);
        System.out.println("Tuple: " + myTuple + " -&gt; Point: " + pointFromTuple);
        System.out.println();

        // --- SCENARIO 3: Composition with lenses ---
        System.out.println("--- Scenario 3: Composition with Lenses ---");

        // Create a lens manually that works with Point directly
        Lens&lt;Point, Integer&gt; pointToXLens = Lens.of(
                Point::x,
                (point, newX) -&gt; new Point(newX, point.y())
        );

        // Use the lens
        Point movedPoint = pointToXLens.modify(x -&gt; x + 5, myPoint);
        System.out.println("Original point: " + myPoint);
        System.out.println("After moving X by 5: " + movedPoint);
        System.out.println();

        // --- SCENARIO 4: Demonstrating Iso composition ---
        System.out.println("--- Scenario 4: Iso Composition ---");

        // Show how the Iso can be used to convert and work with tuples
        Tuple2&lt;Integer, Integer&gt; tupleRepresentation = pointToTupleIso.get(myPoint);
        System.out.println("Point as tuple: " + tupleRepresentation);

        // Modify the tuple using tuple operations
        Lens&lt;Tuple2&lt;Integer, Integer&gt;, Integer&gt; tupleFirstLens = Tuple2Lenses._1();
        Tuple2&lt;Integer, Integer&gt; modifiedTuple = tupleFirstLens.modify(x -&gt; x * 2, tupleRepresentation);

        // Convert back to Point
        Point modifiedPoint = pointToTupleIso.reverse().get(modifiedTuple);
        System.out.println("Modified tuple: " + modifiedTuple);
        System.out.println("Back to point: " + modifiedPoint);
        System.out.println();

        // --- SCENARIO 5: String format conversions ---
        System.out.println("--- Scenario 5: String Format Conversions ---");

        String pointAsString = Converters.POINT_STRING.get(myPoint);
        System.out.println("Point as string: " + pointAsString);

        Point recoveredFromString = Converters.POINT_STRING.reverse().get(pointAsString);
        System.out.println("Recovered from string: " + recoveredFromString);
        System.out.println("Perfect round-trip: " + myPoint.equals(recoveredFromString));

        // --- SCENARIO 6: Working with Circle centre through Iso ---
        System.out.println("--- Scenario 6: Circle Centre Manipulation ---");

        // Get the centre as a tuple, modify it, and put it back
        Point originalCentre = myCircle.centre();
        Tuple2&lt;Integer, Integer&gt; centreAsTuple = pointToTupleIso.get(originalCentre);
        Tuple2&lt;Integer, Integer&gt; shiftedCentre = Tuple.of(centreAsTuple._1() + 10, centreAsTuple._2() + 10);
        Point newCentre = pointToTupleIso.reverse().get(shiftedCentre);
        Circle newCircle = CircleLenses.centre().set(newCentre, myCircle);

        System.out.println("Original circle: " + myCircle);
        System.out.println("Centre as tuple: " + centreAsTuple);
        System.out.println("Shifted centre tuple: " + shiftedCentre);
        System.out.println("New circle: " + newCircle);
    }
</code></pre>
<p><strong>Expected Output:</strong></p>
<pre><code>=== ISO USAGE EXAMPLE ===
Original Point: Point[x=10, y=20]
Original Circle: Circle[centre=Point[x=10, y=20], radius=5]
------------------------------------------
--- Scenario 1: Direct Conversions ---
Point to Tuple conversion:
  Original:  Point[x=10, y=20]
  Converted: Tuple2[_1=10, _2=20]
  Round-trip: Point[x=10, y=20]
  Success: true

Point to String conversion:
  Original:  Point[x=10, y=20]
  Converted: 10,20
  Round-trip: Point[x=10, y=20]
  Success: true

--- Scenario 2: Reverse Operations ---
Tuple: Tuple2[_1=30, _2=40] -&gt; Point: Point[x=30, y=40]

--- Scenario 3: Working with Different Representations ---
Original point: Point[x=10, y=20]
After moving X by 5: Point[x=15, y=20]

--- Scenario 4: Conversion Workflows ---
Point as tuple: Tuple2[_1=10, _2=20]
Modified tuple: Tuple2[_1=20, _2=20]
Back to point: Point[x=20, y=20]

--- Scenario 5: String Format Conversions ---
Point as string: 10,20
Recovered from string: Point[x=10, y=20]
Perfect round-trip: true

--- Scenario 6: Circle Centre Manipulation ---
Original circle: Circle[centre=Point[x=10, y=20], radius=5]
Centre as tuple: Tuple2[_1=10, _2=20]
Shifted centre tuple: Tuple2[_1=20, _2=30]
New circle: Circle[centre=Point[x=20, y=30], radius=5]
</code></pre>
<hr />
<h2 id="why-isos-are-a-powerful-bridge"><a class="header" href="#why-isos-are-a-powerful-bridge">Why Isos are a Powerful Bridge</a></h2>
<p><code>Lens</code>, <code>Prism</code>, and <code>Iso</code> form a powerful trio for modelling any data operation. An <code>Iso</code> is the essential bridge that enables you to:</p>
<ul>
<li><strong>Work with the Best Representation</strong>: Convert data to the most suitable format for each operation, then convert back when needed.</li>
<li><strong>Enable Library Integration</strong>: Adapt your internal data types to work seamlessly with external libraries without changing your core domain model.</li>
<li><strong>Maintain Type Safety</strong>: All conversions are checked at compile time, eliminating runtime conversion errors.</li>
<li><strong>Build Reusable Converters</strong>: Create tested, reusable conversion components that can be used throughout your application.</li>
</ul>
<p>The step-by-step conversion approach shown in the examples is the most practical way to use Isos in real applications, providing clear, maintainable code that leverages the strengths of different data representations.</p>
<hr />
<p><strong>Previous:</strong><a href="optics/prisms.html">Prisms: Working with Sum Types</a>
<strong>Next:</strong><a href="optics/traversals.html">Traversals: Handling Bulk Updates</a></p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="traversals-practical-guide"><a class="header" href="#traversals-practical-guide">Traversals: Practical Guide</a></h1>
<h2 id="handling-bulk-updates"><a class="header" href="#handling-bulk-updates"><em>Handling Bulk Updates</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="optics/traversals.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to perform bulk operations on collections within immutable structures</li>
<li>Using <code>@GenerateTraversals</code> for automatic collection optics</li>
<li>Composing traversals with lenses and prisms for deep bulk updates</li>
<li>The <code>Traversals.modify()</code> and <code>Traversals.getAll()</code> utility methods</li>
<li>Understanding zero-or-more target semantics</li>
<li>When to use traversals vs streams vs manual loops for collection processing</li>
</ul>
</div>
</div>
<div id="admonition-example-code" class="admonition admonish-note" role="note" aria-labelledby="admonition-example-code-title">
<div class="admonition-title">
<div id="admonition-example-code-title">
<p>Example Code</p>
</div>
<a class="admonition-anchor-link" href="optics/traversals.html#admonition-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/TraversalUsageExample.java">TraversalUsageExample</a></p>
</div>
</div>
<p>So far, our journey through optics has shown us how to handle singular focus:</p>
<ul>
<li>A <strong><code>Lens</code></strong> targets a part that <em>must</em> exist.</li>
<li>A <strong><code>Prism</code></strong> targets a part that <em>might</em> exist in one specific shape.</li>
<li>An <strong><code>Iso</code></strong> provides a two-way bridge between <em>equivalent</em> types.</li>
</ul>
<p>But what about operating on <em>many</em> items at once? How do we apply a single change to every element in a nested list? For this, we need the most general and powerful optic in our toolkit: the <strong>Traversal</strong>.</p>
<h2 id="the-scenario-updating-an-entire-league-"><a class="header" href="#the-scenario-updating-an-entire-league-">The Scenario: Updating an Entire League üó∫Ô∏è</a></h2>
<p>A <code>Traversal</code> is a functional "search-and-replace." It gives you a single tool to focus on zero or more items within a larger structure, allowing you to <code>get</code>, <code>set</code>, or <code>modify</code> all of them in one go.</p>
<p>This makes it the perfect optic for working with collections. Consider this data model of a sports league:</p>
<p><strong>The Data Model:</strong></p>
<pre><code class="language-java">public record Player(String name, int score) {}
public record Team(String name, List&lt;Player&gt; players) {}
public record League(String name, List&lt;Team&gt; teams) {}
</code></pre>
<p><strong>Our Goal:</strong> We need to give every single player in the entire league 5 bonus points. The traditional approach involves nested loops or streams, forcing us to manually reconstruct each immutable object along the way.</p>
<pre><code class="language-java">// Manual, verbose bulk update
List&lt;Team&gt; newTeams = league.teams().stream()
    .map(team -&gt; {
        List&lt;Player&gt; newPlayers = team.players().stream()
            .map(player -&gt; new Player(player.name(), player.score() + 5))
            .collect(Collectors.toList());
        return new Team(team.name(), newPlayers);
    })
    .collect(Collectors.toList());
League updatedLeague = new League(league.name(), newTeams);
</code></pre>
<p>This code is deeply nested and mixes the <em>what</em> (add 5 to a score) with the <em>how</em> (looping, collecting, and reconstructing). A <code>Traversal</code> lets us abstract away the "how" completely.</p>
<h2 id="think-of-traversals-like"><a class="header" href="#think-of-traversals-like">Think of Traversals Like...</a></h2>
<ul>
<li><strong>A spotlight</strong>: Illuminates many targets at once within a structure</li>
<li><strong>A search-and-replace tool</strong>: Finds all matching items and transforms them</li>
<li><strong>A bulk editor</strong>: Applies the same operation to multiple items efficiently</li>
<li><strong>A magnifying glass array</strong>: Like a lens, but for zero-to-many targets instead of exactly one</li>
</ul>
<h2 id="a-step-by-step-walkthrough-3"><a class="header" href="#a-step-by-step-walkthrough-3">A Step-by-Step Walkthrough</a></h2>
<h3 id="step-1-generating-traversals"><a class="header" href="#step-1-generating-traversals">Step 1: Generating Traversals</a></h3>
<p>The library provides a rich set of tools for creating <code>Traversal</code> instances, found in the <strong><code>Traversals</code></strong> utility class and through annotations.</p>
<ul>
<li><strong><code>@GenerateTraversals</code></strong>: Annotating a record will automatically generate a <code>Traversal</code> for any <code>Iterable</code> field (like <code>List</code> or <code>Set</code>).</li>
<li><strong><code>Traversals.forList()</code></strong>: A static helper that creates a traversal for the elements of a <code>List</code>.</li>
<li><strong><code>Traversals.forMap(key)</code></strong>: A static helper that creates a traversal focusing on the value for a specific key in a <code>Map</code>.</li>
</ul>
<pre><code class="language-java">import org.higherkindedj.optics.annotations.GenerateTraversals;
import java.util.List;

// We also add @GenerateLenses to get access to player fields
@GenerateLenses
public record Player(String name, int score) {}

@GenerateLenses
@GenerateTraversals // Traversal for List&lt;Player&gt;
public record Team(String name, List&lt;Player&gt; players) {}

@GenerateLenses
@GenerateTraversals // Traversal for List&lt;Team&gt;
public record League(String name, List&lt;Team&gt; teams) {}
</code></pre>
<h3 id="step-2-composing-a-deep-traversal"><a class="header" href="#step-2-composing-a-deep-traversal">Step 2: Composing a Deep Traversal</a></h3>
<p>Just like other optics, <code>Traversal</code>s can be composed with <code>andThen</code>. We can chain them together to create a single, deep traversal from the <code>League</code> all the way down to each player's <code>score</code>.</p>
<pre><code class="language-java">// Get generated optics
Traversal&lt;League, Team&gt; leagueToTeams = LeagueTraversals.teams();
Traversal&lt;Team, Player&gt; teamToPlayers = TeamTraversals.players();
Lens&lt;Player, Integer&gt; playerToScore = PlayerLenses.score();

// Compose them to create a single, deep traversal.
Traversal&lt;League, Integer&gt; leagueToAllPlayerScores =
    leagueToTeams
        .andThen(teamToPlayers)
        .andThen(playerToScore.asTraversal()); // Convert the final Lens
</code></pre>
<p>The result is a single <code>Traversal&lt;League, Integer&gt;</code> that declaratively represents the path to all player scores.</p>
<h3 id="step-3-using-the-traversal-with-helper-methods"><a class="header" href="#step-3-using-the-traversal-with-helper-methods">Step 3: Using the Traversal with Helper Methods</a></h3>
<p>The <code>Traversals</code> utility class provides convenient helper methods to perform the most common operations.</p>
<ul>
<li><strong><code>Traversals.modify(traversal, function, source)</code></strong>: Applies a pure function to all targets of a traversal.</li>
</ul>
<pre><code class="language-java">  // Use the composed traversal to add 5 bonus points to every score.
  League updatedLeague = Traversals.modify(leagueToAllPlayerScores, score -&gt; score + 5, league);
</code></pre>
<ul>
<li><strong><code>Traversals.getAll(traversal, source)</code></strong>: Extracts all targets of a traversal into a <code>List</code>.</li>
</ul>
<pre><code class="language-java">  // Get a flat list of all player scores in the league.
  List&lt;Integer&gt; allScores = Traversals.getAll(leagueToAllPlayerScores, league);
  // Result: [100, 90, 110, 120]
</code></pre>
<h2 id="when-to-use-traversals-vs-other-approaches"><a class="header" href="#when-to-use-traversals-vs-other-approaches">When to Use Traversals vs Other Approaches</a></h2>
<h3 id="use-traversals-when"><a class="header" href="#use-traversals-when">Use Traversals When:</a></h3>
<ul>
<li><strong>Bulk operations on nested collections</strong> - Applying the same operation to many items</li>
<li><strong>Type-safe collection manipulation</strong> - Working with collections inside immutable structures</li>
<li><strong>Reusable bulk logic</strong> - Creating operations that can be applied across different instances</li>
<li><strong>Effectful operations</strong> - Using <code>modifyF</code> for operations that might fail or have side effects</li>
</ul>
<pre><code class="language-java">// Perfect for bulk updates with type safety
Traversal&lt;Company, String&gt; allEmails = CompanyTraversals.employees()
    .andThen(EmployeeTraversals.contacts())
    .andThen(ContactLenses.email().asTraversal());

Company withNormalisedEmails = Traversals.modify(allEmails, String::toLowerCase, company);
</code></pre>
<h3 id="use-streams-when"><a class="header" href="#use-streams-when">Use Streams When:</a></h3>
<ul>
<li><strong>Complex transformations</strong> - Multiple operations that don't map cleanly to traversals</li>
<li><strong>Filtering and collecting</strong> - You need to change the collection structure</li>
<li><strong>Performance critical paths</strong> - Minimal abstraction overhead needed</li>
</ul>
<pre><code class="language-java">// Better with streams for complex logic
List&lt;String&gt; activePlayerNames = league.teams().stream()
    .flatMap(team -&gt; team.players().stream())
    .filter(player -&gt; player.score() &gt; 50)
    .map(Player::name)
    .sorted()
    .collect(toList());
</code></pre>
<h3 id="use-manual-loops-when"><a class="header" href="#use-manual-loops-when">Use Manual Loops When:</a></h3>
<ul>
<li><strong>Early termination needed</strong> - You might want to stop processing early</li>
<li><strong>Complex control flow</strong> - Multiple conditions and branches</li>
<li><strong>Imperative mindset</strong> - The operation is inherently procedural</li>
</ul>
<pre><code class="language-java">// Sometimes a loop is clearest
for (Team team : league.teams()) {
    for (Player player : team.players()) {
        if (player.score() &lt; 0) {
            throw new IllegalStateException("Negative score found: " + player);
        }
    }
}
</code></pre>
<hr />
<h2 id="common-pitfalls-4"><a class="header" href="#common-pitfalls-4">Common Pitfalls</a></h2>
<h3 id="-dont-do-this-3"><a class="header" href="#-dont-do-this-3">‚ùå Don't Do This:</a></h3>
<pre><code class="language-java">// Inefficient: Creating traversals repeatedly
teams.forEach(team -&gt; {
    var traversal = TeamTraversals.players().andThen(PlayerLenses.score().asTraversal());
    Traversals.modify(traversal, score -&gt; score + 1, team);
});

// Over-engineering: Using traversals for simple cases
Traversal&lt;Player, String&gt; playerName = PlayerLenses.name().asTraversal();
String name = Traversals.getAll(playerName, player).get(0); // Just use player.name()!

// Type confusion: Forgetting that traversals work on zero-or-more targets
League emptyLeague = new League("Empty", List.of());
List&lt;Integer&gt; scores = Traversals.getAll(leagueToAllPlayerScores, emptyLeague); // Returns empty list
</code></pre>
<h3 id="-do-this-instead-3"><a class="header" href="#-do-this-instead-3">‚úÖ Do This Instead:</a></h3>
<pre><code class="language-java">// Efficient: Create traversals once, use many times
var scoreTraversal = LeagueTraversals.teams()
    .andThen(TeamTraversals.players())
    .andThen(PlayerLenses.score().asTraversal());

League bonusLeague = Traversals.modify(scoreTraversal, score -&gt; score + 5, league);
League doubledLeague = Traversals.modify(scoreTraversal, score -&gt; score * 2, league);

// Right tool for the job: Use direct access for single items
String playerName = player.name(); // Simple and clear

// Defensive: Handle empty collections gracefully  
List&lt;Integer&gt; allScores = Traversals.getAll(scoreTraversal, league);
OptionalDouble average = allScores.stream().mapToInt(Integer::intValue).average();
</code></pre>
<hr />
<h2 id="performance-notes-4"><a class="header" href="#performance-notes-4">Performance Notes</a></h2>
<p>Traversals are optimised for immutable updates:</p>
<ul>
<li><strong>Memory efficient</strong>: Only creates new objects along the path that changes</li>
<li><strong>Lazy evaluation</strong>: Stops early if no changes are needed</li>
<li><strong>Batch operations</strong>: <code>modifyF</code> processes all targets in a single pass</li>
<li><strong>Structural sharing</strong>: Unchanged parts of the data structure are reused</li>
</ul>
<p><strong>Best Practice</strong>: For frequently used traversal combinations, create them once and store as constants:</p>
<pre><code class="language-java">public class LeagueOptics {
    public static final Traversal&lt;League, Integer&gt; ALL_PLAYER_SCORES = 
        LeagueTraversals.teams()
            .andThen(TeamTraversals.players())
            .andThen(PlayerLenses.score().asTraversal());
      
    public static final Traversal&lt;League, String&gt; ALL_PLAYER_NAMES = 
        LeagueTraversals.teams()
            .andThen(TeamTraversals.players())
            .andThen(PlayerLenses.name().asTraversal());
}
</code></pre>
<hr />
<h2 id="common-patterns-1"><a class="header" href="#common-patterns-1">Common Patterns</a></h2>
<h3 id="validation-with-error-accumulation"><a class="header" href="#validation-with-error-accumulation">Validation with Error Accumulation</a></h3>
<pre><code class="language-java">// Validate all email addresses in a user list
Traversal&lt;Company, String&gt; allEmails = CompanyTraversals.employees()
    .andThen(EmployeeTraversals.contactInfo())
    .andThen(ContactInfoLenses.email().asTraversal());

Function&lt;String, Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, String&gt;&gt; validateEmail = 
    email -&gt; email.contains("@") 
        ? VALIDATED.widen(Validated.valid(email))
        : VALIDATED.widen(Validated.invalid(List.of("Invalid email: " + email)));

Validated&lt;List&lt;String&gt;, Company&gt; result = VALIDATED.narrow(
    allEmails.modifyF(validateEmail, company, validatedApplicative)
);
</code></pre>
<h3 id="conditional-updates"><a class="header" href="#conditional-updates">Conditional Updates</a></h3>
<pre><code class="language-java">// Give bonus points only to high-performing players
Function&lt;Integer, Integer&gt; conditionalBonus = score -&gt; 
    score &gt;= 80 ? score + 10 : score;

League bonusLeague = Traversals.modify(
    LeagueOptics.ALL_PLAYER_SCORES, 
    conditionalBonus, 
    league
);
</code></pre>
<h3 id="data-transformation"><a class="header" href="#data-transformation">Data Transformation</a></h3>
<pre><code class="language-java">// Normalise all player names to title case
Function&lt;String, String&gt; titleCase = name -&gt; 
    Arrays.stream(name.toLowerCase().split(" "))
        .map(word -&gt; word.substring(0, 1).toUpperCase() + word.substring(1))
        .collect(joining(" "));

League normalisedLeague = Traversals.modify(
    LeagueOptics.ALL_PLAYER_NAMES,
    titleCase,
    league
);
</code></pre>
<h3 id="asynchronous-operations"><a class="header" href="#asynchronous-operations">Asynchronous Operations</a></h3>
<pre><code class="language-java">// Fetch additional player statistics asynchronously
Function&lt;Integer, CompletableFuture&lt;Integer&gt;&gt; fetchBonusPoints = 
    playerId -&gt; statsService.getBonusPoints(playerId);

CompletableFuture&lt;League&gt; enrichedLeague = CF.narrow(
    LeagueOptics.ALL_PLAYER_SCORES.modifyF(
        score -&gt; CF.widen(fetchBonusPoints.apply(score)),
        league,
        CompletableFutureMonad.INSTANCE
    )
);
</code></pre>
<hr />
<h2 id="real-world-example-configuration-validation"><a class="header" href="#real-world-example-configuration-validation">Real-World Example: Configuration Validation</a></h2>
<pre><code class="language-java">// Configuration model
@GenerateLenses
@GenerateTraversals
public record ServerConfig(String name, List&lt;DatabaseConfig&gt; databases) {}

@GenerateLenses  
public record DatabaseConfig(String host, int port, String name) {}

// Validation traversal
public class ConfigValidation {
    private static final Traversal&lt;ServerConfig, Integer&gt; ALL_DB_PORTS = 
        ServerConfigTraversals.databases()
            .andThen(DatabaseConfigLenses.port().asTraversal());
  
    public static Validated&lt;List&lt;String&gt;, ServerConfig&gt; validateConfig(ServerConfig config) {
        Function&lt;Integer, Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Integer&gt;&gt; validatePort = 
            port -&gt; {
                if (port &gt;= 1024 &amp;&amp; port &lt;= 65535) {
                    return VALIDATED.widen(Validated.valid(port));
                } else {
                    return VALIDATED.widen(Validated.invalid(
                        List.of("Port " + port + " is out of valid range (1024-65535)")
                    ));
                }
            };
  
        return VALIDATED.narrow(
            ALL_DB_PORTS.modifyF(
                validatePort, 
                config, 
                ValidatedMonad.instance(Semigroups.list())
            )
        );
    }
}
</code></pre>
<h2 id="complete-runnable-example-3"><a class="header" href="#complete-runnable-example-3">Complete, Runnable Example</a></h2>
<p>This example demonstrates how to use the <code>with*</code> helpers for a targeted update and how to use a composed <code>Traversal</code> with the new utility methods for bulk operations.</p>
<pre><code class="language-java">package org.higherkindedj.example.optics;

import java.util.ArrayList;
import java.util.List;
import org.higherkindedj.optics.Lens;
import org.higherkindedj.optics.Traversal;
import org.higherkindedj.optics.annotations.GenerateLenses;
import org.higherkindedj.optics.annotations.GenerateTraversals;
import org.higherkindedj.optics.util.Traversals;

public class TraversalUsageExample {

    @GenerateLenses
    public record Player(String name, int score) {}
  
    @GenerateLenses
    @GenerateTraversals
    public record Team(String name, List&lt;Player&gt; players) {}
  
    @GenerateLenses
    @GenerateTraversals
    public record League(String name, List&lt;Team&gt; teams) {}
  
    public static void main(String[] args) {
        var team1 = new Team("Team Alpha", List.of(
            new Player("Alice", 100), 
            new Player("Bob", 90)
        ));
        var team2 = new Team("Team Bravo", List.of(
            new Player("Charlie", 110), 
            new Player("Diana", 120)
        ));
        var league = new League("Pro League", List.of(team1, team2));
  
        System.out.println("=== TRAVERSAL USAGE EXAMPLE ===");
        System.out.println("Original League: " + league);
        System.out.println("------------------------------------------");
  
        // --- SCENARIO 1: Using `with*` helpers for a targeted, shallow update ---
        System.out.println("--- Scenario 1: Shallow Update with `with*` Helpers ---");
        var teamToUpdate = league.teams().get(0);
        var updatedTeam = TeamLenses.withName(teamToUpdate, "Team Omega");
        var newTeamsList = new ArrayList&lt;&gt;(league.teams());
        newTeamsList.set(0, updatedTeam);
        var leagueWithUpdatedTeam = LeagueLenses.withTeams(league, newTeamsList);
  
        System.out.println("After updating one team's name:");
        System.out.println(leagueWithUpdatedTeam);
        System.out.println("------------------------------------------");
  
        // --- SCENARIO 2: Using composed Traversals for deep, bulk updates ---
        System.out.println("--- Scenario 2: Bulk Updates with Composed Traversals ---");
    
        // Create the composed traversal
        Traversal&lt;League, Integer&gt; leagueToAllPlayerScores =
            LeagueTraversals.teams()
                .andThen(TeamTraversals.players())
                .andThen(PlayerLenses.score().asTraversal());
  
        // Use the `modify` helper to add 5 bonus points to every score.
        League updatedLeague = Traversals.modify(leagueToAllPlayerScores, score -&gt; score + 5, league);
        System.out.println("After adding 5 bonus points to all players:");
        System.out.println(updatedLeague);
        System.out.println();
    
        // --- SCENARIO 3: Extracting data with `getAll` ---
        System.out.println("--- Scenario 3: Data Extraction ---");
    
        List&lt;Integer&gt; allScores = Traversals.getAll(leagueToAllPlayerScores, league);
        System.out.println("All player scores: " + allScores);
        System.out.println("Total players: " + allScores.size());
        System.out.println("Average score: " + allScores.stream().mapToInt(Integer::intValue).average().orElse(0.0));
        System.out.println();
    
        // --- SCENARIO 4: Conditional updates ---
        System.out.println("--- Scenario 4: Conditional Updates ---");
    
        // Give bonus points only to players with scores &gt;= 100
        League bonusLeague = Traversals.modify(
            leagueToAllPlayerScores, 
            score -&gt; score &gt;= 100 ? score + 20 : score, 
            league
        );
        System.out.println("After conditional bonus (20 points for scores &gt;= 100):");
        System.out.println(bonusLeague);
        System.out.println();
    
        // --- SCENARIO 5: Multiple traversals ---
        System.out.println("--- Scenario 5: Multiple Traversals ---");
    
        // Create a traversal for player names
        Traversal&lt;League, String&gt; leagueToAllPlayerNames =
            LeagueTraversals.teams()
                .andThen(TeamTraversals.players())
                .andThen(PlayerLenses.name().asTraversal());
    
        // Normalise all names to uppercase
        League upperCaseLeague = Traversals.modify(leagueToAllPlayerNames, String::toUpperCase, league);
        System.out.println("After converting all names to uppercase:");
        System.out.println(upperCaseLeague);
        System.out.println();
    
        // --- SCENARIO 6: Working with empty collections ---
        System.out.println("--- Scenario 6: Empty Collections ---");
    
        League emptyLeague = new League("Empty League", List.of());
        List&lt;Integer&gt; emptyScores = Traversals.getAll(leagueToAllPlayerScores, emptyLeague);
        League emptyAfterUpdate = Traversals.modify(leagueToAllPlayerScores, score -&gt; score + 100, emptyLeague);
    
        System.out.println("Empty league: " + emptyLeague);
        System.out.println("Scores from empty league: " + emptyScores);
        System.out.println("Empty league after update: " + emptyAfterUpdate);
    
        System.out.println("------------------------------------------");
        System.out.println("Original league unchanged: " + league);
    }
}
</code></pre>
<p><strong>Expected Output:</strong></p>
<pre><code>=== TRAVERSAL USAGE EXAMPLE ===
Original League: League[name=Pro League, teams=[Team[name=Team Alpha, players=[Player[name=Alice, score=100], Player[name=Bob, score=90]]], Team[name=Team Bravo, players=[Player[name=Charlie, score=110], Player[name=Diana, score=120]]]]]
------------------------------------------
--- Scenario 1: Shallow Update with `with*` Helpers ---
After updating one team's name:
League[name=Pro League, teams=[Team[name=Team Omega, players=[Player[name=Alice, score=100], Player[name=Bob, score=90]]], Team[name=Team Bravo, players=[Player[name=Charlie, score=110], Player[name=Diana, score=120]]]]]
------------------------------------------
--- Scenario 2: Bulk Updates with Composed Traversals ---
After adding 5 bonus points to all players:
League[name=Pro League, teams=[Team[name=Team Alpha, players=[Player[name=Alice, score=105], Player[name=Bob, score=95]]], Team[name=Team Bravo, players=[Player[name=Charlie, score=115], Player[name=Diana, score=125]]]]]

--- Scenario 3: Data Extraction ---
All player scores: [100, 90, 110, 120]
Total players: 4
Average score: 105.0

--- Scenario 4: Conditional Updates ---
After conditional bonus (20 points for scores &gt;= 100):
League[name=Pro League, teams=[Team[name=Team Alpha, players=[Player[name=Alice, score=120], Player[name=Bob, score=90]]], Team[name=Team Bravo, players=[Player[name=Charlie, score=130], Player[name=Diana, score=140]]]]]

--- Scenario 5: Multiple Traversals ---
After converting all names to uppercase:
League[name=Pro League, teams=[Team[name=Team Alpha, players=[Player[name=ALICE, score=100], Player[name=BOB, score=90]]], Team[name=Team Bravo, players=[Player[name=CHARLIE, score=110], Player[name=DIANA, score=120]]]]]

--- Scenario 6: Working with Empty Collections ---
Empty league: League[name=Empty League, teams=[]]
Scores from empty league: []
Empty league after update: League[name=Empty League, teams=[]]
------------------------------------------
Original league unchanged: League[name=Pro League, teams=[Team[name=Team Alpha, players=[Player[name=Alice, score=100], Player[name=Bob, score=90]]], Team[name=Team Bravo, players=[Player[name=Charlie, score=110], Player[name=Diana, score=120]]]]]
</code></pre>
<hr />
<h2 id="unifying-the-concepts"><a class="header" href="#unifying-the-concepts">Unifying the Concepts</a></h2>
<p>A <code>Traversal</code> is the most general of the core optics. In fact, all other optics can be seen as specialised <code>Traversal</code>s:</p>
<ul>
<li>A <code>Lens</code> is just a <code>Traversal</code> that always focuses on <strong>exactly one</strong> item.</li>
<li>A <code>Prism</code> is just a <code>Traversal</code> that focuses on <strong>zero or one</strong> item.</li>
<li>An <code>Iso</code> is just a <code>Traversal</code> that focuses on <strong>exactly one</strong> item and is reversible.</li>
</ul>
<p>This is the reason they can all be composed together so seamlessly. By mastering <code>Traversal</code>, you complete your understanding of the core optics family, enabling you to build powerful, declarative, and safe data transformations that work efficiently across any number of targets.</p>
<hr />
<p><strong>Previous:</strong><a href="optics/iso.html">Isomorphisms: Data Equivalence</a>
<strong>Next:</strong><a href="optics/profunctor_optics.html">Profunctor Optics: Advanced Data Transformation</a></p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="profunctor-optics-advanced-data-transformation"><a class="header" href="#profunctor-optics-advanced-data-transformation">Profunctor Optics: Advanced Data Transformation</a></h1>
<h2 id="adapting-optics-to-different-data-types"><a class="header" href="#adapting-optics-to-different-data-types"><em>Adapting Optics to Different Data Types</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="optics/profunctor_optics.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to adapt existing optics to work with different data types</li>
<li>Using <code>contramap</code> to change source types and <code>map</code> to change target types</li>
<li>Combining both adaptations with <code>dimap</code> for complete format conversion</li>
<li>Creating reusable adapter patterns for API integration</li>
<li>Working with type-safe wrapper classes and legacy system integration</li>
<li>When to use profunctor adaptations vs creating new optics from scratch</li>
</ul>
</div>
</div>
<div id="admonition-example-code" class="admonition admonish-note" role="note" aria-labelledby="admonition-example-code-title">
<div class="admonition-title">
<div id="admonition-example-code-title">
<p>Example Code</p>
</div>
<a class="admonition-anchor-link" href="optics/profunctor_optics.html#admonition-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/profunctor/OpticProfunctorExample.java">OpticProfunctorExample</a></p>
</div>
</div>
<p>In the previous optics guides, we explored how to work with data structures directly using <code>Lens</code>, <code>Prism</code>, <code>Iso</code>, and <code>Traversal</code>. But what happens when you need to use an optic designed for one data type with a completely different data structure? What if you want to adapt an existing optic to work with new input or output formats?</p>
<p>This is where the <strong>profunctor</strong> nature of optics becomes invaluable. Every optic in higher-kinded-j is fundamentally a profunctor, which means it can be adapted to work with different source and target types using powerful transformation operations.</p>
<hr />
<h2 id="the-challenge-type-mismatch-in-real-systems"><a class="header" href="#the-challenge-type-mismatch-in-real-systems">The Challenge: Type Mismatch in Real Systems</a></h2>
<p>In real-world applications, you frequently encounter situations where:</p>
<ul>
<li><strong>Legacy Integration</strong>: You have optics designed for old data structures but need to work with new ones</li>
<li><strong>API Adaptation</strong>: External APIs use different field names or data formats than your internal models</li>
<li><strong>Type Safety</strong>: You want to work with strongly-typed wrapper classes but reuse optics designed for raw values</li>
<li><strong>Data Migration</strong>: You're transitioning between data formats and need optics that work with both</li>
</ul>
<p>Consider this scenario: you have a well-tested <code>Lens</code> that operates on a <code>Person</code> record, but you need to use it with an <code>Employee</code> record that contains a <code>Person</code> as a nested field. Rather than rewriting the lens, you can <strong>adapt</strong> it.</p>
<h2 id="think-of-profunctor-adaptations-like"><a class="header" href="#think-of-profunctor-adaptations-like">Think of Profunctor Adaptations Like...</a></h2>
<ul>
<li><strong>Universal adapters</strong>: Like electrical plug adapters that make devices work in different countries</li>
<li><strong>Translation layers</strong>: Converting between different "languages" of data representation</li>
<li><strong>Lens filters</strong>: Modifying what the optic sees (input) and what it produces (output)</li>
<li><strong>Pipeline adapters</strong>: Connecting optics that weren't originally designed to work together</li>
</ul>
<h2 id="the-three-profunctor-operations"><a class="header" href="#the-three-profunctor-operations">The Three Profunctor Operations</a></h2>
<p>Every optic provides three powerful adaptation methods that mirror the core profunctor operations:</p>
<h3 id="1-contramap-adapting-the-source-type"><a class="header" href="#1-contramap-adapting-the-source-type">1. <strong><code>contramap</code></strong>: Adapting the Source Type</a></h3>
<p>The <code>contramap</code> operation allows you to adapt an optic to work with a different source type by providing a function that converts from the new source to the original source.</p>
<p><strong>Use Case</strong>: You have a <code>Lens&lt;Person, String&gt;</code> for getting a person's first name, but you want to use it with <code>Employee</code> objects.</p>
<pre><code class="language-java">// Original lens: Person -&gt; String (first name)
Lens&lt;Person, String&gt; firstNameLens = PersonLenses.firstName();

// Adapt it to work with Employee by providing the conversion
Lens&lt;Employee, String&gt; employeeFirstNameLens = 
    firstNameLens.contramap(employee -&gt; employee.personalInfo());

// Now you can use the adapted lens directly on Employee objects
Employee employee = new Employee(123, new Person("Alice", "Johnson", ...), "Engineering");
String firstName = employeeFirstNameLens.get(employee); // "Alice"
</code></pre>
<h3 id="2-map-adapting-the-target-type"><a class="header" href="#2-map-adapting-the-target-type">2. <strong><code>map</code></strong>: Adapting the Target Type</a></h3>
<p>The <code>map</code> operation adapts an optic to work with a different target type by providing a function that converts from the original target to the new target.</p>
<p><strong>Use Case</strong>: You have a <code>Lens&lt;Person, LocalDate&gt;</code> for birth dates, but you want to work with formatted strings instead.</p>
<pre><code class="language-java">// Original lens: Person -&gt; LocalDate
Lens&lt;Person, LocalDate&gt; birthDateLens = PersonLenses.birthDate();

// Adapt it to work with formatted strings
Lens&lt;Person, String&gt; birthDateStringLens = 
    birthDateLens.map(date -&gt; date.format(DateTimeFormatter.ISO_LOCAL_DATE));

// The adapted lens now returns strings
Person person = new Person("Bob", "Smith", LocalDate.of(1985, 12, 25), ...);
String dateString = birthDateStringLens.get(person); // "1985-12-25"
</code></pre>
<h3 id="3-dimap-adapting-both-source-and-target-types"><a class="header" href="#3-dimap-adapting-both-source-and-target-types">3. <strong><code>dimap</code></strong>: Adapting Both Source and Target Types</a></h3>
<p>The <code>dimap</code> operation is the most powerful‚Äîit adapts both the source and target types simultaneously. This is perfect for converting between completely different data representations.</p>
<p><strong>Use Case</strong>: You have optics designed for internal <code>Person</code> objects but need to work with external <code>PersonDto</code> objects that use different field structures.</p>
<pre><code class="language-java">// Original traversal: Person -&gt; String (hobbies)
Traversal&lt;Person, String&gt; hobbiesTraversal = PersonTraversals.hobbies();

// Adapt it to work with PersonDto (different source) and call them "interests" (different context)
Traversal&lt;PersonDto, String&gt; interestsTraversal = 
    hobbiesTraversal.dimap(
        // Convert PersonDto to Person
        dto -&gt; new Person(
            dto.fullName().split(" ")[0],
            dto.fullName().split(" ")[1], 
            LocalDate.parse(dto.birthDateString()),
            dto.interests()
        ),
        // Convert Person back to PersonDto  
        person -&gt; new PersonDto(
            person.firstName() + " " + person.lastName(),
            person.birthDate().format(DateTimeFormatter.ISO_LOCAL_DATE),
            person.hobbies()
        )
    );
</code></pre>
<hr />
<h2 id="decision-guide-when-to-use-each-operation"><a class="header" href="#decision-guide-when-to-use-each-operation">Decision Guide: When to Use Each Operation</a></h2>
<h3 id="use-contramap-when"><a class="header" href="#use-contramap-when">Use <code>contramap</code> When:</a></h3>
<ul>
<li><strong>Different source type, same target</strong> - Existing optic works perfectly, just need different input</li>
<li><strong>Extracting nested data</strong> - Your new type contains the old type as a field</li>
<li><strong>Wrapper type handling</strong> - Working with strongly-typed wrappers around base types</li>
</ul>
<p>java</p>
<pre><code class="language-java">// Perfect for extracting nested data
Lens&lt;Order, String&gt; customerNameLens = 
    OrderLenses.customer().contramap(invoice -&gt; invoice.order());
</code></pre>
<h3 id="use-map-when"><a class="header" href="#use-map-when">Use <code>map</code> When:</a></h3>
<ul>
<li><strong>Same source, different target format</strong> - You want to transform the output</li>
<li><strong>Data presentation</strong> - Converting raw data to display formats</li>
<li><strong>Type strengthening</strong> - Wrapping raw values in type-safe containers</li>
</ul>
<p>java</p>
<pre><code class="language-java">// Perfect for presentation formatting
Lens&lt;Product, String&gt; formattedPriceLens = 
    ProductLenses.price().map(price -&gt; "¬£" + price.setScale(2));
</code></pre>
<h3 id="use-dimap-when"><a class="header" href="#use-dimap-when">Use <code>dimap</code> When:</a></h3>
<ul>
<li><strong>Complete format conversion</strong> - Both input and output need transformation</li>
<li><strong>API integration</strong> - External systems use completely different data structures</li>
<li><strong>Legacy system support</strong> - Bridging between old and new data formats</li>
<li><strong>Data migration</strong> - Supporting multiple data representations simultaneously</li>
</ul>
<p>java</p>
<pre><code class="language-java">// Perfect for API integration
Traversal&lt;ApiUserDto, String&gt; apiRolesTraversal = 
    UserTraversals.roles().dimap(
        dto -&gt; convertApiDtoToUser(dto),
        user -&gt; convertUserToApiDto(user)
    );
</code></pre>
<hr />
<h2 id="common-pitfalls-5"><a class="header" href="#common-pitfalls-5">Common Pitfalls</a></h2>
<h3 id="-dont-do-this-4"><a class="header" href="#-dont-do-this-4">‚ùå Don't Do This:</a></h3>
<pre><code class="language-java">// Creating adapters inline repeatedly
var lens1 = PersonLenses.firstName().contramap(emp -&gt; emp.person());
var lens2 = PersonLenses.firstName().contramap(emp -&gt; emp.person());
var lens3 = PersonLenses.firstName().contramap(emp -&gt; emp.person());

// Over-adapting simple cases
Lens&lt;Person, String&gt; nameUpper = PersonLenses.firstName()
    .map(String::toUpperCase)
    .map(s -&gt; s.trim())
    .map(s -&gt; s.replace(" ", "_")); // Just write one function!

// Forgetting null safety in conversions
Lens&lt;EmployeeDto, String&gt; unsafeLens = PersonLenses.firstName()
    .contramap(dto -&gt; dto.person()); // What if dto.person() is null?

// Complex conversions without error handling
Traversal&lt;String, LocalDate&gt; fragileParser = 
    Iso.of(LocalDate::toString, LocalDate::parse).asTraversal()
    .contramap(complexString -&gt; extractDatePart(complexString)); // Might throw!
</code></pre>
<h3 id="-do-this-instead-4"><a class="header" href="#-do-this-instead-4">‚úÖ Do This Instead:</a></h3>
<pre><code class="language-java">// Create adapters once, reuse everywhere
public static final Lens&lt;Employee, String&gt; EMPLOYEE_FIRST_NAME = 
    PersonLenses.firstName().contramap(Employee::personalInfo);

// Combine transformations efficiently
Function&lt;String, String&gt; normalise = name -&gt; 
    name.toUpperCase().trim().replace(" ", "_");
Lens&lt;Person, String&gt; normalisedNameLens = PersonLenses.firstName().map(normalise);

// Handle null safety explicitly
Lens&lt;EmployeeDto, Optional&lt;String&gt;&gt; safeNameLens = PersonLenses.firstName()
    .contramap((EmployeeDto dto) -&gt; Optional.ofNullable(dto.person()))
    .map(Optional::of);

// Use safe conversions with proper error handling
Function&lt;String, Either&lt;String, LocalDate&gt;&gt; safeParse = str -&gt; {
    try {
        return Either.right(LocalDate.parse(extractDatePart(str)));
    } catch (Exception e) {
        return Either.left("Invalid date: " + str);
    }
};
</code></pre>
<hr />
<h2 id="performance-notes-5"><a class="header" href="#performance-notes-5">Performance Notes</a></h2>
<p>Profunctor adaptations are designed for efficiency:</p>
<ul>
<li><strong>Automatic fusion</strong>: Multiple <code>contramap</code> or <code>map</code> operations are automatically combined</li>
<li><strong>Lazy evaluation</strong>: Conversions only happen when the optic is actually used</li>
<li><strong>No boxing overhead</strong>: Simple transformations are inlined by the JVM</li>
<li><strong>Reusable adapters</strong>: Create once, use many times without additional overhead</li>
</ul>
<p><strong>Best Practice</strong>: Create adapted optics as constants and reuse them:</p>
<pre><code class="language-java">public class OpticAdapters {
    // Create once, use everywhere
    public static final Lens&lt;Employee, String&gt; FIRST_NAME = 
        PersonLenses.firstName().contramap(Employee::personalInfo);
  
    public static final Lens&lt;Employee, String&gt; FORMATTED_BIRTH_DATE = 
        PersonLenses.birthDate()
            .contramap(Employee::personalInfo)
            .map(date -&gt; date.format(DateTimeFormatter.DD_MM_YYYY));
      
    public static final Traversal&lt;CompanyDto, String&gt; EMPLOYEE_EMAILS = 
        CompanyTraversals.employees()
            .contramap((CompanyDto dto) -&gt; convertDtoToCompany(dto))
            .andThen(EmployeeTraversals.contacts())
            .andThen(ContactLenses.email().asTraversal());
}
</code></pre>
<hr />
<h2 id="real-world-example-api-integration"><a class="header" href="#real-world-example-api-integration">Real-World Example: API Integration</a></h2>
<p>Let's explore a comprehensive example where you need to integrate with an external API that uses different field names and data structures than your internal models.</p>
<p><strong>The Scenario</strong>: Your internal system uses <code>Employee</code> records, but the external API expects <code>EmployeeDto</code> objects with different field names:</p>
<pre><code class="language-java">// Internal model
@GenerateLenses
@GenerateTraversals
public record Employee(int id, Person personalInfo, String department) {}

@GenerateLenses
@GenerateTraversals  
public record Person(String firstName, String lastName, LocalDate birthDate, List&lt;String&gt; skills) {}

// External API model  
@GenerateLenses
public record EmployeeDto(int employeeId, PersonDto person, String dept) {}

@GenerateLenses
public record PersonDto(String fullName, String birthDateString, List&lt;String&gt; expertise) {}
</code></pre>
<p><strong>The Solution</strong>: Create an adapter that converts between these formats while reusing your existing optics:</p>
<pre><code class="language-java">public class ApiIntegration {
  
    // Conversion utilities
    private static Employee dtoToEmployee(EmployeeDto dto) {
        PersonDto personDto = dto.person();
        String[] nameParts = personDto.fullName().split(" ", 2);
        Person person = new Person(
            nameParts[0],
            nameParts.length &gt; 1 ? nameParts[1] : "",
            LocalDate.parse(personDto.birthDateString()),
            personDto.expertise()
        );
        return new Employee(dto.employeeId(), person, dto.dept());
    }
  
    private static EmployeeDto employeeToDto(Employee employee) {
        Person person = employee.personalInfo();
        PersonDto personDto = new PersonDto(
            person.firstName() + " " + person.lastName(),
            person.birthDate().toString(),
            person.skills()
        );
        return new EmployeeDto(employee.id(), personDto, employee.department());
    }
  
    // Adapted optics for API integration
    public static final Lens&lt;EmployeeDto, String&gt; API_EMPLOYEE_DEPARTMENT = 
        EmployeeLenses.department().dimap(
            ApiIntegration::dtoToEmployee,
            ApiIntegration::employeeToDto
        );
  
    public static final Lens&lt;EmployeeDto, String&gt; API_EMPLOYEE_FIRST_NAME = 
        EmployeeLenses.personalInfo()
            .andThen(PersonLenses.firstName())
            .dimap(
                ApiIntegration::dtoToEmployee,
                ApiIntegration::employeeToDto
            );
  
    public static final Traversal&lt;EmployeeDto, String&gt; API_EMPLOYEE_SKILLS = 
        EmployeeTraversals.personalInfo()
            .andThen(PersonTraversals.skills())
            .dimap(
                ApiIntegration::dtoToEmployee,
                ApiIntegration::employeeToDto
            );
  
    // Use the adapters seamlessly with external data
    public void processApiData(EmployeeDto externalEmployee) {
        // Update department using existing business logic
        EmployeeDto promoted = API_EMPLOYEE_DEPARTMENT.modify(
            dept -&gt; "Senior " + dept, 
            externalEmployee
        );
    
        // Normalise skills using existing traversal logic
        EmployeeDto normalisedSkills = Traversals.modify(
            API_EMPLOYEE_SKILLS,
            skill -&gt; skill.toLowerCase().trim(),
            externalEmployee
        );
    
        sendToApi(promoted);
        sendToApi(normalisedSkills);
    }
}
</code></pre>
<hr />
<h2 id="working-with-type-safe-wrappers"><a class="header" href="#working-with-type-safe-wrappers">Working with Type-Safe Wrappers</a></h2>
<p>Another powerful use case is adapting optics to work with strongly-typed wrapper classes while maintaining type safety.</p>
<p><strong>The Challenge</strong>: You want to use string manipulation functions on wrapper types:</p>
<pre><code class="language-java">// Strongly-typed wrappers
public record UserId(String value) {}
public record UserName(String value) {}
public record Email(String value) {}

@GenerateLenses
public record User(UserId id, UserName name, Email email, LocalDate createdAt) {}
</code></pre>
<p><strong>The Solution</strong>: Create adapted lenses that unwrap and rewrap values:</p>
<pre><code class="language-java">public class WrapperAdapters {
  
    // Generic wrapper lens creator
    public static &lt;W&gt; Lens&lt;W, String&gt; stringWrapperLens(
        Function&lt;W, String&gt; unwrap,
        Function&lt;String, W&gt; wrap
    ) {
        return Lens.of(unwrap, (wrapper, newValue) -&gt; wrap.apply(newValue));
    }
  
    // Specific wrapper lenses
    public static final Lens&lt;UserId, String&gt; USER_ID_STRING = 
        stringWrapperLens(UserId::value, UserId::new);
      
    public static final Lens&lt;UserName, String&gt; USER_NAME_STRING = 
        stringWrapperLens(UserName::value, UserName::new);
      
    public static final Lens&lt;Email, String&gt; EMAIL_STRING = 
        stringWrapperLens(Email::value, Email::new);
  
    // Composed lenses for User operations
    public static final Lens&lt;User, String&gt; USER_NAME_VALUE = 
        UserLenses.name().andThen(USER_NAME_STRING);
      
    public static final Lens&lt;User, String&gt; USER_EMAIL_VALUE = 
        UserLenses.email().andThen(EMAIL_STRING);
  
    // Usage examples
    public User normaliseUser(User user) {
        return USER_NAME_VALUE.modify(name -&gt; 
            Arrays.stream(name.toLowerCase().split(" "))
                .map(word -&gt; Character.toUpperCase(word.charAt(0)) + word.substring(1))
                .collect(joining(" ")),
            user
        );
    }
  
    public User updateEmailDomain(User user, String newDomain) {
        return USER_EMAIL_VALUE.modify(email -&gt; {
            String localPart = email.substring(0, email.indexOf('@'));
            return localPart + "@" + newDomain;
        }, user);
    }
}
</code></pre>
<hr />
<h2 id="migration-patterns"><a class="header" href="#migration-patterns">Migration Patterns</a></h2>
<p>Profunctor adaptations are particularly valuable during system migrations:</p>
<h3 id="legacy-system-integration"><a class="header" href="#legacy-system-integration">Legacy System Integration</a></h3>
<pre><code class="language-java">// You have optics for PersonV1, but data is now PersonV2
public record PersonV1(String name, int age) {}

@GenerateLenses
public record PersonV2(String firstName, String lastName, LocalDate birthDate) {}

public class MigrationAdapters {
  
    // Convert between versions
    private static PersonV1 v2ToV1(PersonV2 v2) {
        return new PersonV1(
            v2.firstName() + " " + v2.lastName(),
            Period.between(v2.birthDate(), LocalDate.now()).getYears()
        );
    }
  
    private static PersonV2 v1ToV2(PersonV1 v1) {
        String[] nameParts = v1.name().split(" ", 2);
        return new PersonV2(
            nameParts[0],
            nameParts.length &gt; 1 ? nameParts[1] : "",
            LocalDate.now().minusYears(v1.age())
        );
    }
  
    // Existing V1 optics work with V2 data
    public static final Lens&lt;PersonV2, String&gt; V2_NAME_FROM_V1_LENS = 
        // Assume we have a V1 name lens
        Lens.of(PersonV1::name, (p1, name) -&gt; new PersonV1(name, p1.age()))
            .dimap(MigrationAdapters::v2ToV1, MigrationAdapters::v1ToV2);
}
</code></pre>
<h3 id="database-schema-evolution"><a class="header" href="#database-schema-evolution">Database Schema Evolution</a></h3>
<pre><code class="language-java">// Old database entity
public record CustomerEntityV1(Long id, String name, String email) {}

// New database entity  
@GenerateLenses
public record CustomerEntityV2(Long id, String firstName, String lastName, String emailAddress, boolean active) {}

public class SchemaAdapters {
  
    // Adapter for name field
    public static final Lens&lt;CustomerEntityV2, String&gt; FULL_NAME_ADAPTER = 
        Lens.of(CustomerEntityV1::name, (v1, name) -&gt; new CustomerEntityV1(v1.id(), name, v1.email()))
            .dimap(
                // V2 -&gt; V1 conversion
                v2 -&gt; new CustomerEntityV1(v2.id(), v2.firstName() + " " + v2.lastName(), v2.emailAddress()),
                // V1 -&gt; V2 conversion  
                v1 -&gt; {
                    String[] parts = v1.name().split(" ", 2);
                    return new CustomerEntityV2(
                        v1.id(),
                        parts[0],
                        parts.length &gt; 1 ? parts[1] : "",
                        v1.email(),
                        true // Default active status
                    );
                }
            );
}
</code></pre>
<hr />
<h2 id="complete-runnable-example-4"><a class="header" href="#complete-runnable-example-4">Complete, Runnable Example</a></h2>
<p>This comprehensive example demonstrates all three profunctor operations in a realistic scenario:</p>
<pre><code class="language-java">package org.higherkindedj.example.optics.profunctor;

import org.higherkindedj.optics.Lens;
import org.higherkindedj.optics.Traversal;
import org.higherkindedj.optics.annotations.GenerateLenses;
import org.higherkindedj.optics.annotations.GenerateTraversals;
import org.higherkindedj.optics.util.Traversals;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.List;
import java.util.Optional;

public class OpticProfunctorExample {

    // Internal data model
    @GenerateLenses
    @GenerateTraversals
    public record Person(String firstName, String lastName, LocalDate birthDate, List&lt;String&gt; hobbies) {}
  
    @GenerateLenses
    public record Employee(int id, Person personalInfo, String department) {}
  
    // External API model
    @GenerateLenses
    public record PersonDto(String fullName, String birthDateString, List&lt;String&gt; interests) {}
  
    @GenerateLenses  
    public record EmployeeDto(int employeeId, PersonDto person, String dept) {}
  
    // Type-safe wrapper
    public record UserId(long value) {}
  
    @GenerateLenses
    public record UserProfile(UserId id, String displayName, boolean active) {}

    public static void main(String[] args) {
        System.out.println("=== PROFUNCTOR OPTICS EXAMPLE ===");
      
        // Test data
        var person = new Person("Alice", "Johnson", 
            LocalDate.of(1985, 6, 15), 
            List.of("reading", "cycling", "photography"));
        var employee = new Employee(123, person, "Engineering");
      
        // --- SCENARIO 1: contramap - Adapt source type ---
        System.out.println("--- Scenario 1: contramap (Source Adaptation) ---");
      
        // Original lens works on Person, adapt it for Employee
        Lens&lt;Person, String&gt; firstNameLens = PersonLenses.firstName();
        Lens&lt;Employee, String&gt; employeeFirstNameLens = 
            firstNameLens.contramap(Employee::personalInfo);
      
        String name = employeeFirstNameLens.get(employee);
        Employee renamedEmployee = employeeFirstNameLens.set("Alicia", employee);
      
        System.out.println("Original employee: " + employee);
        System.out.println("Extracted name: " + name);
        System.out.println("Renamed employee: " + renamedEmployee);
        System.out.println();
      
        // --- SCENARIO 2: map - Adapt target type ---
        System.out.println("--- Scenario 2: map (Target Adaptation) ---");
      
        // Original lens returns LocalDate, adapt it to return formatted string
        Lens&lt;Person, LocalDate&gt; birthDateLens = PersonLenses.birthDate();
        Lens&lt;Person, String&gt; birthDateStringLens = 
            birthDateLens.map(date -&gt; date.format(DateTimeFormatter.ISO_LOCAL_DATE));
      
        String formattedDate = birthDateStringLens.get(person);
        // Note: set operation would need to parse the string back to LocalDate
        System.out.println("Person: " + person);
        System.out.println("Formatted birth date: " + formattedDate);
        System.out.println();
      
        // --- SCENARIO 3: dimap - Adapt both source and target ---
        System.out.println("--- Scenario 3: dimap (Both Source and Target Adaptation) ---");
      
        // Convert between internal Person and external PersonDto
        Traversal&lt;Person, String&gt; hobbiesTraversal = PersonTraversals.hobbies();
        Traversal&lt;PersonDto, String&gt; interestsTraversal = hobbiesTraversal.dimap(
            // PersonDto -&gt; Person
            dto -&gt; {
                String[] nameParts = dto.fullName().split(" ", 2);
                return new Person(
                    nameParts[0],
                    nameParts.length &gt; 1 ? nameParts[1] : "",
                    LocalDate.parse(dto.birthDateString()),
                    dto.interests()
                );
            },
            // Person -&gt; PersonDto  
            p -&gt; new PersonDto(
                p.firstName() + " " + p.lastName(),
                p.birthDate().toString(),
                p.hobbies()
            )
        );
      
        var personDto = new PersonDto("Bob Smith", "1990-03-20", 
            List.of("gaming", "cooking", "travel"));
      
        List&lt;String&gt; extractedInterests = Traversals.getAll(interestsTraversal, personDto);
        PersonDto updatedDto = Traversals.modify(interestsTraversal, 
            interest -&gt; interest.toUpperCase(), personDto);
      
        System.out.println("Original DTO: " + personDto);
        System.out.println("Extracted interests: " + extractedInterests);
        System.out.println("Updated DTO: " + updatedDto);
        System.out.println();
      
        // --- SCENARIO 4: Working with wrapper types ---
        System.out.println("--- Scenario 4: Wrapper Type Integration ---");
      
        // Create a lens that works directly with the wrapped value
        Lens&lt;UserId, Long&gt; userIdValueLens = Lens.of(UserId::value, (id, newValue) -&gt; new UserId(newValue));
        Lens&lt;UserProfile, Long&gt; profileIdValueLens = 
            UserProfileLenses.id().andThen(userIdValueLens);
      
        var userProfile = new UserProfile(new UserId(456L), "Alice J.", true);
      
        Long idValue = profileIdValueLens.get(userProfile);
        UserProfile updatedProfile = profileIdValueLens.modify(id -&gt; id + 1000, userProfile);
      
        System.out.println("Original profile: " + userProfile);
        System.out.println("Extracted ID value: " + idValue);
        System.out.println("Updated profile: " + updatedProfile);
        System.out.println();
      
        // --- SCENARIO 5: Chaining adaptations ---
        System.out.println("--- Scenario 5: Chaining Adaptations ---");
      
        // Chain multiple adaptations: Employee -&gt; Person -&gt; String (formatted)
        Lens&lt;Employee, String&gt; formattedEmployeeName = 
            PersonLenses.firstName()
                .contramap(Employee::personalInfo)  // Employee -&gt; Person
                .map(name -&gt; "Mr/Ms. " + name.toUpperCase()); // String -&gt; Formatted String
      
        String formalName = formattedEmployeeName.get(employee);
        Employee formalEmployee = formattedEmployeeName.set("Mr/Ms. ROBERT", employee);
      
        System.out.println("Original employee: " + employee);
        System.out.println("Formal name: " + formalName);
        System.out.println("Employee with formal name: " + formalEmployee);
        System.out.println();
      
        // --- SCENARIO 6: Safe adaptations with Optional ---
        System.out.println("--- Scenario 6: Safe Adaptations ---");
      
        // Handle potentially null fields safely
        Lens&lt;Optional&lt;Person&gt;, Optional&lt;String&gt;&gt; safeNameLens = 
            PersonLenses.firstName()
                .map(Optional::of)
                .contramap(optPerson -&gt; optPerson.orElse(new Person("", "", LocalDate.now(), List.of())));
      
        Optional&lt;Person&gt; maybePerson = Optional.of(person);
        Optional&lt;Person&gt; emptyPerson = Optional.empty();
      
        Optional&lt;String&gt; safeName1 = safeNameLens.get(maybePerson);
        Optional&lt;String&gt; safeName2 = safeNameLens.get(emptyPerson);
      
        System.out.println("Safe name from present person: " + safeName1);
        System.out.println("Safe name from empty person: " + safeName2);
    }
}
</code></pre>
<p><strong>Expected Output:</strong></p>
<pre><code>=== PROFUNCTOR OPTICS EXAMPLE ===
--- Scenario 1: contramap (Source Adaptation) ---
Original employee: Employee[id=123, personalInfo=Person[firstName=Alice, lastName=Johnson, birthDate=1985-06-15, hobbies=[reading, cycling, photography]], department=Engineering]
Extracted name: Alice
Renamed employee: Employee[id=123, personalInfo=Person[firstName=Alicia, lastName=Johnson, birthDate=1985-06-15, hobbies=[reading, cycling, photography]], department=Engineering]

--- Scenario 2: map (Target Adaptation) ---
Person: Person[firstName=Alice, lastName=Johnson, birthDate=1985-06-15, hobbies=[reading, cycling, photography]]
Formatted birth date: 1985-06-15

--- Scenario 3: dimap (Both Source and Target Adaptation) ---
Original DTO: PersonDto[fullName=Bob Smith, birthDateString=1990-03-20, interests=[gaming, cooking, travel]]
Extracted interests: [gaming, cooking, travel]
Updated DTO: PersonDto[fullName=Bob Smith, birthDateString=1990-03-20, interests=[GAMING, COOKING, TRAVEL]]

--- Scenario 4: Wrapper Type Integration ---
Original profile: UserProfile[id=UserId[value=456], displayName=Alice J., active=true]
Extracted ID value: 456
Updated profile: UserProfile[id=UserId[value=1456], displayName=Alice J., active=true]

--- Scenario 5: Chaining Adaptations ---
Original employee: Employee[id=123, personalInfo=Person[firstName=Alice, lastName=Johnson, birthDate=1985-06-15, hobbies=[reading, cycling, photography]], department=Engineering]
Formal name: Mr/Ms. ALICE
Employee with formal name: Employee[id=123, personalInfo=Person[firstName=ROBERT, lastName=Johnson, birthDate=1985-06-15, hobbies=[reading, cycling, photography]], department=Engineering]

--- Scenario 6: Safe Adaptations ---
Safe name from present person: Optional[Alice]
Safe name from empty person: Optional[]
</code></pre>
<hr />
<h2 id="integration-with-existing-optics"><a class="header" href="#integration-with-existing-optics">Integration with Existing Optics</a></h2>
<p>Profunctor adaptations work seamlessly with all the optic types and features you've already learned:</p>
<h3 id="with-effectful-updates"><a class="header" href="#with-effectful-updates">With Effectful Updates</a></h3>
<pre><code class="language-java">// Original effectful lens
Lens&lt;Person, String&gt; emailLens = PersonLenses.email();

// Adapt it for Employee and use with validation
Lens&lt;Employee, String&gt; employeeEmailLens = emailLens.contramap(Employee::personalInfo);

// Use with effectful validation as normal
Kind&lt;ValidatedKind.Witness&lt;String&gt;, Employee&gt; result = 
    employeeEmailLens.modifyF(this::validateEmail, employee, validatedApplicative);
</code></pre>
<h3 id="with-deep-composition"><a class="header" href="#with-deep-composition">With Deep Composition</a></h3>
<pre><code class="language-java">// Compose adapted optics just like regular optics
Traversal&lt;EmployeeDto, String&gt; deepPath = 
    apiAdapter.asTraversal()
        .andThen(PersonTraversals.hobbies())
        .andThen(stringProcessor);
</code></pre>
<p>This profunctor capability makes higher-kinded-j optics incredibly flexible and reusable, allowing you to adapt existing, well-tested optics to work with new data formats and requirements without rewriting your core business logic.</p>
<hr />
<p><strong>Previous:</strong><a href="optics/traversals.html">Traversals: Handling Bulk Updates</a>
<strong>Next:</strong><a href="optics/composing_optics.html">Capstone Example: Deep Validation</a></p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="capstone-example"><a class="header" href="#capstone-example">Capstone Example:</a></h1>
<h2 id="composing-optics-for-deep-validation"><a class="header" href="#composing-optics-for-deep-validation"><em>Composing Optics for Deep Validation</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="optics/composing_optics.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to compose multiple optic types into powerful processing pipelines</li>
<li>Building type-safe validation workflows with error accumulation</li>
<li>Using <code>asTraversal()</code> to ensure safe optic composition</li>
<li>Creating reusable validation paths with effectful operations</li>
<li>Understanding when composition is superior to manual validation logic</li>
<li>Advanced patterns for multi-level and conditional validation scenarios</li>
</ul>
</div>
</div>
<div id="admonition-example-code" class="admonition admonish-note" role="note" aria-labelledby="admonition-example-code-title">
<div class="admonition-title">
<div id="admonition-example-code-title">
<p>Example Code</p>
</div>
<a class="admonition-anchor-link" href="optics/composing_optics.html#admonition-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/ValidatedTraversalExample.java">ValidatedTraversalExample</a></p>
</div>
</div>
<p>In the previous guides, we explored each core optic‚Äî<code>Lens</code>, <code>Prism</code>, <code>Iso</code> and <code>Traversal</code>‚Äîas individual tools. We've seen how they provide focused, reusable, and composable access to immutable data.</p>
<p>Now, it's time to put it all together.</p>
<p>This guide showcases the true power of the optics approach by composing multiple different optics to solve a single, complex, real-world problem: performing deep, effectful validation on a nested data structure.</p>
<hr />
<h2 id="the-scenario-validating-user-permissions"><a class="header" href="#the-scenario-validating-user-permissions">The Scenario: Validating User Permissions</a></h2>
<p>Imagine a data model for a form that can be filled out by either a registered <code>User</code> or a <code>Guest</code>. Our goal is to validate that every <code>Permission</code> held by a <code>User</code> has a valid name.</p>
<p>This single task requires us to:</p>
<ol>
<li>Focus on the form's <code>principal</code> field (<strong>a job for a Lens</strong>).</li>
<li>Safely "select" the <code>User</code> case, ignoring any <code>Guest</code>s (<strong>a job for a Prism</strong>).</li>
<li>Operate on every <code>Permission</code> in the user's list (<strong>a job for a Traversal</strong>).</li>
</ol>
<hr />
<h2 id="think-of-this-composition-like"><a class="header" href="#think-of-this-composition-like">Think of This Composition Like...</a></h2>
<ul>
<li><strong>A telescope with multiple lenses</strong>: Each optic focuses deeper into the data structure</li>
<li><strong>A manufacturing pipeline</strong>: Each stage processes and refines the data further</li>
<li><strong>A filter chain</strong>: Data flows through multiple filters, each handling a specific concern</li>
<li><strong>A surgical procedure</strong>: Precise, layered operations that work together for a complex outcome</li>
</ul>
<hr />
<h3 id="1-the-data-model"><a class="header" href="#1-the-data-model">1. The Data Model</a></h3>
<p>Here is the nested data structure, annotated to generate all the optics we will need.</p>
<pre><code class="language-java">import org.higherkindedj.optics.annotations.GenerateLenses;
import org.higherkindedj.optics.annotations.GeneratePrisms;
import org.higherkindedj.optics.annotations.GenerateTraversals;
import java.util.List;

@GenerateLenses
public record Permission(String name) {}

@GeneratePrisms
public sealed interface Principal {}

@GenerateLenses
@GenerateTraversals
public record User(String username, List&lt;Permission&gt; permissions) implements Principal {}

public record Guest() implements Principal {}

@GenerateLenses
public record Form(int formId, Principal principal) {}
</code></pre>
<h3 id="2-the-validation-logic"><a class="header" href="#2-the-validation-logic">2. The Validation Logic</a></h3>
<p>Our validation function will take a permission name (<code>String</code>) and return a <code>Validated&lt;String, String&gt;</code>. The <code>Validated</code> applicative functor will automatically handle accumulating any errors found.</p>
<pre><code class="language-java">import org.higherkindedj.hkt.Kind;
import org.higherkindedj.hkt.validated.Validated;
import org.higherkindedj.hkt.validated.ValidatedKind;
import static org.higherkindedj.hkt.validated.ValidatedKindHelper.VALIDATED;
import java.util.Set;

private static final Set&lt;String&gt; VALID_PERMISSIONS = Set.of("PERM_READ", "PERM_WRITE", "PERM_DELETE");

public static Kind&lt;ValidatedKind.Witness&lt;String&gt;, String&gt; validatePermissionName(String name) {
    if (VALID_PERMISSIONS.contains(name)) {
        return VALIDATED.widen(Validated.valid(name));
    } else {
        return VALIDATED.widen(Validated.invalid("Invalid permission: " + name));
    }
}
</code></pre>
<h3 id="3-understanding-the-composition-strategy"><a class="header" href="#3-understanding-the-composition-strategy">3. Understanding the Composition Strategy</a></h3>
<p>Before diving into the code, let's understand why we need each type of optic and how they work together:</p>
<p><strong>Why a Lens for <code>principal</code>?</strong></p>
<ul>
<li>The <code>principal</code> field always exists in a <code>Form</code></li>
<li>We need guaranteed access to focus on this field</li>
<li>A <code>Lens</code> provides exactly this: reliable access to required data</li>
</ul>
<p><strong>Why a Prism for <code>User</code>?</strong></p>
<ul>
<li>The <code>principal</code> could be either a <code>User</code> or a <code>Guest</code></li>
<li>We only want to validate <code>User</code> permissions, ignoring <code>Guest</code>s</li>
<li>A <code>Prism</code> provides safe, optional access to specific sum type cases</li>
</ul>
<p><strong>Why a Traversal for <code>permissions</code>?</strong></p>
<ul>
<li>We need to validate <em>every</em> permission in the list</li>
<li>We want to accumulate <em>all</em> validation errors, not stop at the first one</li>
<li>A <code>Traversal</code> provides bulk operations over collections</li>
</ul>
<p><strong>Why convert everything to <code>Traversal</code>?</strong></p>
<ul>
<li><code>Traversal</code> is the most general optic type</li>
<li>It can represent zero-or-more targets (perfect for our "might be empty" scenario)</li>
<li>All other optics can be converted to <code>Traversal</code> for seamless composition</li>
</ul>
<h3 id="4-composing-the-master-optic"><a class="header" href="#4-composing-the-master-optic">4. Composing the Master Optic</a></h3>
<p>Now for the main event. We will compose our generated optics to create a single <code>Traversal</code> that declaratively represents the path from a <code>Form</code> all the way down to each permission <code>name</code>. While the new <code>with*</code> helpers are great for simple, shallow updates, a deep and conditional update like this requires composition.</p>
<p>To ensure type-safety across different optic types, we convert each <code>Lens</code> and <code>Prism</code> in the chain to a <code>Traversal</code> using the <code>.asTraversal()</code> method.</p>
<pre><code class="language-java">import org.higherkindedj.optics.Lens;
import org.higherkindedj.optics.Prism;
import org.higherkindedj.optics.Traversal;

// Get the individual generated optics
Lens&lt;Form, Principal&gt; formPrincipalLens = FormLenses.principal();
Prism&lt;Principal, User&gt; principalUserPrism = PrincipalPrisms.user();
Traversal&lt;User, Permission&gt; userPermissionsTraversal = UserTraversals.permissions();
Lens&lt;Permission, String&gt; permissionNameLens = PermissionLenses.name();

// Compose them into a single, deep Traversal
Traversal&lt;Form, String&gt; formToPermissionNameTraversal =
    formPrincipalLens.asTraversal()
        .andThen(principalUserPrism.asTraversal())
        .andThen(userPermissionsTraversal)
        .andThen(permissionNameLens.asTraversal());
</code></pre>
<p>This single <code>formToPermissionNameTraversal</code> object now encapsulates the entire complex path.</p>
<hr />
<h2 id="when-to-use-optic-composition-vs-other-approaches"><a class="header" href="#when-to-use-optic-composition-vs-other-approaches">When to Use Optic Composition vs Other Approaches</a></h2>
<h3 id="use-optic-composition-when"><a class="header" href="#use-optic-composition-when">Use Optic Composition When:</a></h3>
<ul>
<li><strong>Complex nested validation</strong> - Multiple levels of data structure with conditional logic</li>
<li><strong>Reusable validation paths</strong> - The same validation logic applies to multiple scenarios</li>
<li><strong>Type-safe bulk operations</strong> - You need to ensure compile-time safety for collection operations</li>
<li><strong>Error accumulation</strong> - You want to collect all errors, not stop at the first failure</li>
</ul>
<pre><code class="language-java">// Perfect for reusable, complex validation
Traversal&lt;Company, String&gt; allEmployeeEmails = 
    CompanyTraversals.departments()
        .andThen(DepartmentTraversals.employees())
        .andThen(EmployeePrisms.active().asTraversal())  // Only active employees
        .andThen(EmployeeLenses.email().asTraversal());

// Use across multiple validation scenarios
Validated&lt;List&lt;String&gt;, Company&gt; result1 = validateEmails(company1);
Validated&lt;List&lt;String&gt;, Company&gt; result2 = validateEmails(company2);
</code></pre>
<h3 id="use-direct-validation-when"><a class="header" href="#use-direct-validation-when">Use Direct Validation When:</a></h3>
<ul>
<li><strong>Simple, flat structures</strong> - No deep nesting or conditional access needed</li>
<li><strong>One-off validation</strong> - Logic won't be reused elsewhere</li>
<li><strong>Performance critical</strong> - Minimal abstraction overhead required</li>
</ul>
<pre><code class="language-java">// Simple validation doesn't need optics
public Validated&lt;String, User&gt; validateUser(User user) {
    if (user.username().length() &lt; 3) {
        return Validated.invalid("Username too short");
    }
    return Validated.valid(user);
}
</code></pre>
<h3 id="use-stream-processing-when"><a class="header" href="#use-stream-processing-when">Use Stream Processing When:</a></h3>
<ul>
<li><strong>Complex transformations</strong> - Multiple operations that don't map to optic patterns</li>
<li><strong>Aggregation logic</strong> - Computing statistics or summaries</li>
<li><strong>Filtering and collecting</strong> - Changing the structure of collections</li>
</ul>
<pre><code class="language-java">// Better with streams for aggregation
Map&lt;String, Long&gt; permissionCounts = forms.stream()
    .map(Form::principal)
    .filter(User.class::isInstance)
    .map(User.class::cast)
    .flatMap(user -&gt; user.permissions().stream())
    .collect(groupingBy(Permission::name, counting()));
</code></pre>
<hr />
<h2 id="common-pitfalls-6"><a class="header" href="#common-pitfalls-6">Common Pitfalls</a></h2>
<h3 id="-dont-do-this-5"><a class="header" href="#-dont-do-this-5">‚ùå Don't Do This:</a></h3>
<pre><code class="language-java">// Over-composing simple cases
Traversal&lt;Form, Integer&gt; formIdTraversal = FormLenses.formId().asTraversal();
// Just use: form.formId()

// Forgetting error accumulation setup
// This won't accumulate errors properly without the right Applicative
var badResult = traversal.modifyF(validatePermissionName, form, /* wrong applicative */);

// Creating complex compositions inline
var inlineResult = FormLenses.principal().asTraversal()
    .andThen(PrincipalPrisms.user().asTraversal())
    .andThen(UserTraversals.permissions())
    .andThen(PermissionLenses.name().asTraversal())
    .modifyF(validatePermissionName, form, applicative); // Hard to read and reuse

// Ignoring the path semantics
// This tries to validate ALL strings, not just permission names
Traversal&lt;Form, String&gt; badTraversal = /* any string traversal */;
</code></pre>
<h3 id="-do-this-instead-5"><a class="header" href="#-do-this-instead-5">‚úÖ Do This Instead:</a></h3>
<pre><code class="language-java">// Use direct access for simple cases
int formId = form.formId(); // Clear and direct

// Set up error accumulation properly
Applicative&lt;ValidatedKind.Witness&lt;String&gt;&gt; validatedApplicative =
    ValidatedMonad.instance(Semigroups.string("; "));

// Create reusable, well-named compositions
public static final Traversal&lt;Form, String&gt; FORM_TO_PERMISSION_NAMES =
    FormLenses.principal().asTraversal()
        .andThen(PrincipalPrisms.user().asTraversal())
        .andThen(UserTraversals.permissions())
        .andThen(PermissionLenses.name().asTraversal());

// Use the well-named traversal
var result = FORM_TO_PERMISSION_NAMES.modifyF(validatePermissionName, form, validatedApplicative);

// Be specific about what you're validating
// This traversal has clear semantics: Form -&gt; User permissions -&gt; permission names
</code></pre>
<hr />
<h2 id="performance-notes-6"><a class="header" href="#performance-notes-6">Performance Notes</a></h2>
<p>Optic composition is designed for efficiency:</p>
<ul>
<li><strong>Lazy evaluation</strong>: Only processes data when actually used</li>
<li><strong>Structural sharing</strong>: Unchanged parts of data structures are reused</li>
<li><strong>Single-pass processing</strong>: <code>modifyF</code> traverses the structure only once</li>
<li><strong>Memory efficient</strong>: Only creates new objects for changed data</li>
<li><strong>Compile-time optimization</strong>: Complex compositions are optimized by the JVM</li>
</ul>
<p><strong>Best Practice</strong>: Create composed optics as constants for reuse:</p>
<pre><code class="language-java">public class ValidationOptics {
    // Reusable validation paths
    public static final Traversal&lt;Form, String&gt; USER_PERMISSION_NAMES =
        FormLenses.principal().asTraversal()
            .andThen(PrincipalPrisms.user().asTraversal())
            .andThen(UserTraversals.permissions())
            .andThen(PermissionLenses.name().asTraversal());
  
    public static final Traversal&lt;Company, String&gt; EMPLOYEE_EMAILS =
        CompanyTraversals.employees()
            .andThen(EmployeeLenses.contactInfo().asTraversal())
            .andThen(ContactInfoLenses.email().asTraversal());
  
    // Helper methods for common validations
    public static Validated&lt;List&lt;String&gt;, Form&gt; validatePermissions(Form form) {
        return VALIDATED.narrow(USER_PERMISSION_NAMES.modifyF(
            ValidationOptics::validatePermissionName,
            form,
            getValidatedApplicative()
        ));
    }
}
</code></pre>
<hr />
<h2 id="advanced-composition-patterns"><a class="header" href="#advanced-composition-patterns">Advanced Composition Patterns</a></h2>
<h3 id="1-multi-level-validation"><a class="header" href="#1-multi-level-validation">1. Multi-Level Validation</a></h3>
<pre><code class="language-java">// Validate both user data AND permissions in one pass
public static Validated&lt;List&lt;String&gt;, Form&gt; validateFormCompletely(Form form) {
    // First validate user basic info
    var userValidation = FormLenses.principal().asTraversal()
        .andThen(PrincipalPrisms.user().asTraversal())
        .andThen(UserLenses.username().asTraversal())
        .modifyF(ValidationOptics::validateUsername, form, getValidatedApplicative());
  
    // Then validate permissions
    var permissionValidation = FORM_TO_PERMISSION_NAMES
        .modifyF(ValidationOptics::validatePermissionName, form, getValidatedApplicative());
  
    // Combine both validations
    return VALIDATED.narrow(getValidatedApplicative().map2(
        userValidation,
        permissionValidation,
        (validForm1, validForm2) -&gt; validForm2 // Return the final form
    ));
}
</code></pre>
<h3 id="2-conditional-validation-paths"><a class="header" href="#2-conditional-validation-paths">2. Conditional Validation Paths</a></h3>
<pre><code class="language-java">// Different validation rules for different user types
public static final Traversal&lt;Form, String&gt; ADMIN_USER_PERMISSIONS =
    FormLenses.principal().asTraversal()
        .andThen(PrincipalPrisms.user().asTraversal())
        .andThen(UserPrisms.adminUser().asTraversal())  // Only admin users
        .andThen(AdminUserTraversals.permissions())
        .andThen(PermissionLenses.name().asTraversal());

public static final Traversal&lt;Form, String&gt; REGULAR_USER_PERMISSIONS =
    FormLenses.principal().asTraversal()
        .andThen(PrincipalPrisms.user().asTraversal())
        .andThen(UserPrisms.regularUser().asTraversal())  // Only regular users
        .andThen(RegularUserTraversals.permissions())
        .andThen(PermissionLenses.name().asTraversal());
</code></pre>
<h3 id="3-cross-field-validation"><a class="header" href="#3-cross-field-validation">3. Cross-Field Validation</a></h3>
<pre><code class="language-java">// Validate that permissions are appropriate for user role
public static Validated&lt;List&lt;String&gt;, Form&gt; validatePermissionsForRole(Form form) {
    return FormLenses.principal().asTraversal()
        .andThen(PrincipalPrisms.user().asTraversal())
        .modifyF(user -&gt; {
            // Custom validation that checks both role and permissions
            Set&lt;String&gt; allowedPerms = getAllowedPermissionsForRole(user.role());
            List&lt;String&gt; errors = user.permissions().stream()
                .map(Permission::name)
                .filter(perm -&gt; !allowedPerms.contains(perm))
                .map(perm -&gt; "Permission '" + perm + "' not allowed for role " + user.role())
                .toList();
          
            return errors.isEmpty() 
                ? VALIDATED.widen(Validated.valid(user))
                : VALIDATED.widen(Validated.invalid(String.join("; ", errors)));
        }, form, getValidatedApplicative());
}
</code></pre>
<hr />
<h2 id="complete-runnable-example-5"><a class="header" href="#complete-runnable-example-5">Complete, Runnable Example</a></h2>
<p>With our composed <code>Traversal</code>, we can now use <code>modifyF</code> to run our validation logic. The <code>Traversal</code> handles the navigation and filtering, while the <code>Validated</code> applicative (created with a <code>Semigroup</code> for joining error strings) handles the effects and error accumulation.</p>
<pre><code class="language-java">package org.higherkindedj.example.optics;

import static org.higherkindedj.hkt.validated.ValidatedKindHelper.VALIDATED;

import java.util.List;
import java.util.Set;
import org.higherkindedj.hkt.Applicative;
import org.higherkindedj.hkt.Kind;
import org.higherkindedj.hkt.Semigroups;
import org.higherkindedj.hkt.validated.Validated;
import org.higherkindedj.hkt.validated.ValidatedKind;
import org.higherkindedj.hkt.validated.ValidatedMonad;
import org.higherkindedj.optics.Lens;
import org.higherkindedj.optics.Prism;
import org.higherkindedj.optics.Traversal;
import org.higherkindedj.optics.annotations.GenerateLenses;
import org.higherkindedj.optics.annotations.GeneratePrisms;
import org.higherkindedj.optics.annotations.GenerateTraversals;

public class ValidatedTraversalExample {

    // --- Data Model ---
    @GenerateLenses
    public record Permission(String name) {}

    @GeneratePrisms
    public sealed interface Principal {}

    @GenerateLenses
    @GenerateTraversals
    public record User(String username, List&lt;Permission&gt; permissions) implements Principal {}

    public record Guest() implements Principal {}

    @GenerateLenses
    public record Form(int formId, Principal principal) {}

    // --- Validation Logic ---
    private static final Set&lt;String&gt; VALID_PERMISSIONS = Set.of("PERM_READ", "PERM_WRITE", "PERM_DELETE");

    public static Kind&lt;ValidatedKind.Witness&lt;String&gt;, String&gt; validatePermissionName(String name) {
        if (VALID_PERMISSIONS.contains(name)) {
            return VALIDATED.widen(Validated.valid(name));
        } else {
            return VALIDATED.widen(Validated.invalid("Invalid permission: " + name));
        }
    }

    // --- Reusable Optic Compositions ---
    public static final Traversal&lt;Form, String&gt; FORM_TO_PERMISSION_NAMES =
            FormLenses.principal().asTraversal()
                    .andThen(PrincipalPrisms.user().asTraversal())
                    .andThen(UserTraversals.permissions())
                    .andThen(PermissionLenses.name().asTraversal());

    // --- Helper Methods ---
    private static Applicative&lt;ValidatedKind.Witness&lt;String&gt;&gt; getValidatedApplicative() {
        return ValidatedMonad.instance(Semigroups.string("; "));
    }

    public static Validated&lt;String, Form&gt; validateFormPermissions(Form form) {
        Kind&lt;ValidatedKind.Witness&lt;String&gt;, Form&gt; result =
                FORM_TO_PERMISSION_NAMES.modifyF(
                        ValidatedTraversalExample::validatePermissionName,
                        form,
                        getValidatedApplicative()
                );
        return VALIDATED.narrow(result);
    }

    public static void main(String[] args) {
        System.out.println("=== OPTIC COMPOSITION VALIDATION EXAMPLE ===");
        System.out.println();

        // --- SCENARIO 1: Form with valid permissions ---
        System.out.println("--- Scenario 1: Valid Permissions ---");
        var validUser = new User("alice", List.of(
                new Permission("PERM_READ"),
                new Permission("PERM_WRITE")
        ));
        var validForm = new Form(1, validUser);

        System.out.println("Input: " + validForm);
        Validated&lt;String, Form&gt; validResult = validateFormPermissions(validForm);
        System.out.println("Result: " + validResult);
        System.out.println();

        // --- SCENARIO 2: Form with multiple invalid permissions ---
        System.out.println("--- Scenario 2: Multiple Invalid Permissions ---");
        var invalidUser = new User("charlie", List.of(
                new Permission("PERM_EXECUTE"),  // Invalid
                new Permission("PERM_WRITE"),    // Valid
                new Permission("PERM_SUDO"),     // Invalid
                new Permission("PERM_READ")      // Valid
        ));
        var multipleInvalidForm = new Form(3, invalidUser);

        System.out.println("Input: " + multipleInvalidForm);
        Validated&lt;String, Form&gt; invalidResult = validateFormPermissions(multipleInvalidForm);
        System.out.println("Result (errors accumulated): " + invalidResult);
        System.out.println();

        // --- SCENARIO 3: Form with Guest principal (no targets for traversal) ---
        System.out.println("--- Scenario 3: Guest Principal (No Validation Targets) ---");
        var guestForm = new Form(4, new Guest());

        System.out.println("Input: " + guestForm);
        Validated&lt;String, Form&gt; guestResult = validateFormPermissions(guestForm);
        System.out.println("Result (path does not match): " + guestResult);
        System.out.println();

        // --- SCENARIO 4: Form with empty permissions list ---
        System.out.println("--- Scenario 4: Empty Permissions List ---");
        var emptyPermissionsUser = new User("diana", List.of());
        var emptyPermissionsForm = new Form(5, emptyPermissionsUser);

        System.out.println("Input: " + emptyPermissionsForm);
        Validated&lt;String, Form&gt; emptyResult = validateFormPermissions(emptyPermissionsForm);
        System.out.println("Result (empty list): " + emptyResult);
        System.out.println();

        // --- SCENARIO 5: Demonstrating optic reusability ---
        System.out.println("--- Scenario 5: Optic Reusability ---");

        List&lt;Form&gt; formsToValidate = List.of(validForm, multipleInvalidForm, guestForm);

        System.out.println("Batch validation results:");
        formsToValidate.forEach(form -&gt; {
            Validated&lt;String, Form&gt; result = validateFormPermissions(form);
            String status = result.isValid() ? "‚úì VALID" : "‚úó INVALID";
            System.out.println("  Form " + form.formId() + ": " + status);
            if (result.isInvalid()) {
                // Fix: Use getError() instead of getInvalid()
                System.out.println("    Errors: " + result.getError());
            }
        });
        System.out.println();

        // --- SCENARIO 6: Alternative validation with different error accumulation ---
        System.out.println("--- Scenario 6: Different Error Accumulation Strategy ---");

        // Use list-based error accumulation instead of string concatenation
        Applicative&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;&gt; listApplicative =
                ValidatedMonad.instance(Semigroups.list());

        // Fix: Create a proper function for list validation
        java.util.function.Function&lt;String, Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, String&gt;&gt; listValidation =
                name -&gt; VALID_PERMISSIONS.contains(name)
                        ? VALIDATED.widen(Validated.valid(name))
                        : VALIDATED.widen(Validated.invalid(List.of("Invalid permission: " + name)));

        Kind&lt;ValidatedKind.Witness&lt;List&lt;String&gt;&gt;, Form&gt; listResult =
                FORM_TO_PERMISSION_NAMES.modifyF(listValidation, multipleInvalidForm, listApplicative);

        System.out.println("Input: " + multipleInvalidForm);
        System.out.println("Result with list accumulation: " + VALIDATED.narrow(listResult));
    }
}
</code></pre>
<p><strong>Expected Output:</strong></p>
<pre><code>=== OPTIC COMPOSITION VALIDATION EXAMPLE ===

--- Scenario 1: Valid Permissions ---
Input: Form[formId=1, principal=User[username=alice, permissions=[Permission[name=PERM_READ], Permission[name=PERM_WRITE]]]]
Result: Valid(Form[formId=1, principal=User[username=alice, permissions=[Permission[name=PERM_READ], Permission[name=PERM_WRITE]]]])

--- Scenario 2: Multiple Invalid Permissions ---
Input: Form[formId=3, principal=User[username=charlie, permissions=[Permission[name=PERM_EXECUTE], Permission[name=PERM_WRITE], Permission[name=PERM_SUDO], Permission[name=PERM_READ]]]]
Result (errors accumulated): Invalid(Invalid permission: PERM_EXECUTE; Invalid permission: PERM_SUDO)

--- Scenario 3: Guest Principal (No Validation Targets) ---
Input: Form[formId=4, principal=Guest[]]
Result (path does not match): Valid(Form[formId=4, principal=Guest[]])

--- Scenario 4: Empty Permissions List ---
Input: Form[formId=5, principal=User[username=diana, permissions=[]]]
Result (empty list): Valid(Form[formId=5, principal=User[username=diana, permissions=[]]])

--- Scenario 5: Optic Reusability ---
Batch validation results:
  Form 1: ‚úì VALID
  Form 3: ‚úó INVALID
    Errors: Invalid permission: PERM_EXECUTE; Invalid permission: PERM_SUDO
  Form 4: ‚úì VALID

--- Scenario 6: Different Error Accumulation Strategy ---
Input: Form[formId=3, principal=User[username=charlie, permissions=[Permission[name=PERM_EXECUTE], Permission[name=PERM_WRITE], Permission[name=PERM_SUDO], Permission[name=PERM_READ]]]]
Result with list accumulation: Invalid([Invalid permission: PERM_EXECUTE, Invalid permission: PERM_SUDO])
</code></pre>
<p>This shows how our single, composed optic correctly handled all cases: it accumulated multiple failures into a single <code>Invalid</code> result, and it correctly did nothing (resulting in a <code>Valid</code> state) when the path did not match. This is the power of composing simple, reusable optics to solve complex problems in a safe, declarative, and boilerplate-free way.</p>
<hr />
<h2 id="why-this-approach-is-powerful"><a class="header" href="#why-this-approach-is-powerful">Why This Approach is Powerful</a></h2>
<p>This capstone example demonstrates several key advantages of the optics approach:</p>
<h3 id="declarative-composition"><a class="header" href="#declarative-composition"><strong>Declarative Composition</strong></a></h3>
<p>The <code>formToPermissionNameTraversal</code> reads like a clear path specification: "From a Form, go to the principal, if it's a User, then to each permission, then to each name." This is self-documenting code.</p>
<h3 id="type-safety"><a class="header" href="#type-safety"><strong>Type Safety</strong></a></h3>
<p>Every step in the composition is checked at compile time. It's impossible to accidentally apply permission validation to Guest data or to skip the User filtering step.</p>
<h3 id="automatic-error-accumulation"><a class="header" href="#automatic-error-accumulation"><strong>Automatic Error Accumulation</strong></a></h3>
<p>The <code>Validated</code> applicative automatically collects all validation errors without us having to write any error-handling boilerplate. We get comprehensive validation reports for free.</p>
<h3 id="reusability"><a class="header" href="#reusability"><strong>Reusability</strong></a></h3>
<p>The same composed optic can be used for validation, data extraction, transformation, or any other operation. We write the path once and reuse it everywhere.</p>
<h3 id="composability"><a class="header" href="#composability"><strong>Composability</strong></a></h3>
<p>Each individual optic (Lens, Prism, Traversal) can be tested and reasoned about independently, then composed to create more complex behaviour.</p>
<h3 id="graceful-handling-of-edge-cases"><a class="header" href="#graceful-handling-of-edge-cases"><strong>Graceful Handling of Edge Cases</strong></a></h3>
<p>The composition automatically handles empty collections, missing data, and type mismatches without special case code.</p>
<p>By mastering optic composition, you gain a powerful tool for building robust, maintainable data processing pipelines that are both expressive and efficient.</p>
<hr />
<p><strong>Previous:</strong><a href="optics/profunctor_optics.html">Profunctor Optics: Advanced Data Transformation</a>
<strong>Next:</strong><a href="optics/optics_examples.html">Optics Examples</a></p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="optics---basic-usage-examples"><a class="header" href="#optics---basic-usage-examples">Optics - Basic Usage Examples</a></h1>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="optics/optics_examples.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>Practical application patterns for optics across diverse problem domains</li>
<li>Building configuration processors, data validators, and API adapters with optics</li>
<li>Creating reusable optic libraries tailored to your specific business needs</li>
<li>Performance optimization techniques and benchmarking for complex optic compositions</li>
<li>Testing strategies for optic-based data processing pipelines</li>
<li>Decision frameworks for choosing the right optic combinations for real-world scenarios</li>
<li>Common anti-patterns to avoid and best practices for maintainable optic code</li>
</ul>
</div>
</div>
<div id="admonition-example-code" class="admonition admonish-note" role="note" aria-labelledby="admonition-example-code-title">
<div class="admonition-title">
<div id="admonition-example-code-title">
<p>Example Code</p>
</div>
<a class="admonition-anchor-link" href="optics/optics_examples.html#admonition-example-code"></a>
</div>
<div>
<p>This document provides a brief summary of the example classes found in the  <code>org.higherkindedj.example.optics</code> package in the <a href="https://github.com/higher-kinded-j/higher-kinded-j/tree/main/hkj-examples/src/main/java/org/higherkindedj/example/optics">HKJ-Examples</a>.</p>
</div>
</div>
<p>These examples showcase how to use the code generation features (<code>@GenerateLenses</code>, <code>@GeneratePrisms</code>, <code>@GenerateTraversals</code>) and the resulting optics to work with immutable data structures in a clean and powerful way.</p>
<h2 id="lensusageexamplejava"><a class="header" href="#lensusageexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/tree/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/LensUsageExample.java">LensUsageExample.java</a></a></h2>
<p>This example is the primary introduction to <strong>Lenses</strong>. It demonstrates how to automatically generate <code>Lens</code> optics for immutable records and then compose them to read and update deeply nested fields.</p>
<ul>
<li><strong>Key Concept</strong>: A <code>Lens</code> provides a focus on a single field within a product type (like a record or class).</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Defining a nested data model (<code>League</code>, <code>Team</code>, <code>Player</code>).</li>
<li>Using <code>@GenerateLenses</code> on records to trigger code generation.</li>
<li>Accessing generated Lenses (e.g., <code>LeagueLenses.teams()</code>).</li>
<li>Composing Lenses with <code>andThen()</code> to create a path to a deeply nested field.</li>
<li>Using <code>get()</code> to read a value and <code>set()</code> to perform an immutable update.</li>
</ul>
</li>
</ul>
<pre><code class="language-java">// Composing lenses to focus from League -&gt; Team -&gt; name
Lens&lt;League, String&gt; leagueToTeamName = LeagueLenses.teams().andThen(TeamLenses.name());

// Use the composed lens to get and set a value
String teamName = leagueToTeamName.get(league);
League updatedLeague = leagueToTeamName.set("New Team Name").apply(league);
</code></pre>
<h2 id="prismusageexamplejava"><a class="header" href="#prismusageexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/tree/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/PrismUsageExample.java">PrismUsageExample.java</a></a></h2>
<p>This example introduces <strong>Prisms</strong>. It shows how to generate optics for a sealed interface (a sum type) and use the resulting <code>Prism</code> to focus on a specific implementation of that interface.</p>
<ul>
<li><strong>Key Concept</strong>: A <code>Prism</code> provides a focus on a specific case within a sum type (like a sealed interface or enum). It succeeds if the object is an instance of that case.</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Defining a <code>sealed interface</code> (<code>Shape</code>) with different implementations (<code>Rectangle</code>, <code>Circle</code>).</li>
<li>Using <code>@GeneratePrisms</code> on the sealed interface.</li>
<li>Using the generated <code>Prism</code> to safely "get" an instance of a specific subtype.</li>
<li>Using <code>modify()</code> to apply a function only if the object is of the target type.</li>
</ul>
</li>
</ul>
<pre><code class="language-java">  // Get the generated prism for the Rectangle case
  Prism&lt;Shape, Rectangle&gt; rectanglePrism = ShapePrisms.rectangle();
  
  // Safely attempt to modify a shape, which only works if it's a Rectangle
  Optional&lt;Shape&gt; maybeUpdated = rectanglePrism.modify(r -&gt; new Rectangle(r.width() + 10, r.height()))
                                    .apply(new Rectangle(5, 10)); // Returns Optional[Rectangle[width=15, height=10]]
  
  Optional&lt;Shape&gt; maybeNotUpdated = rectanglePrism.modify(...)
                                       .apply(new Circle(20.0)); // Returns Optional.empty
</code></pre>
<h2 id="traversalusageexamplejava"><a class="header" href="#traversalusageexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/tree/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/TraversalUsageExample.java">TraversalUsageExample.java</a></a></h2>
<p>This example showcases the power of composing <strong>Traversals</strong> and <strong>Lenses</strong> to perform bulk updates on items within nested collections.</p>
<ul>
<li><strong>Key Concept</strong>: A <code>Traversal</code> provides a focus on zero or more elements, such as all items in a <code>List</code> or all values in a <code>Map</code>.</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Using <code>@GenerateTraversals</code> to create optics for fields that are collections (<code>List&lt;Team&gt;</code>, <code>List&lt;Player&gt;</code>).</li>
<li>Composing a <code>Traversal</code> with another <code>Traversal</code> and a <code>Lens</code> to create a single optic that focuses on a field within every element of a nested collection.</li>
<li>Using <code>modifyF()</code> with the <code>Id</code> monad to perform a pure, bulk update (e.g., adding bonus points to every player's score).</li>
</ul>
</li>
</ul>
<pre><code class="language-java">  // Compose a path from League -&gt; each Team -&gt; each Player -&gt; score
  Traversal&lt;League, Integer&gt; leagueToAllPlayerScores =
      LeagueTraversals.teams()
          .andThen(TeamTraversals.players())
          .andThen(PlayerLenses.score());
  
  // Use the composed traversal to add 5 to every player's score
  var updatedLeague = IdKindHelper.ID.narrow(
      leagueToAllPlayerScores.modifyF(
          score -&gt; Id.of(score + 5), league, IdentityMonad.instance()
      )
  ).value();
</code></pre>
<h2 id="validatedtraversalexamplejava"><a class="header" href="#validatedtraversalexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/tree/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/ValidatedTraversalExample.java">ValidatedTraversalExample.java</a></a></h2>
<p>This example demonstrates a more advanced use case for <strong>Traversals</strong> where the goal is to validate multiple fields on a single object and accumulate all errors.</p>
<ul>
<li><strong>Key Concept</strong>: A <code>Traversal</code> can focus on multiple fields <em>of the same type</em> within a single object.</li>
<li><strong>Demonstrates</strong>:
<ul>
<li>Defining a <code>RegistrationForm</code> with several <code>String</code> fields.</li>
<li>Using <code>@GenerateTraversals</code> with a custom <code>name</code> parameter to create a single <code>Traversal</code> that groups multiple fields (<code>name</code>, <code>email</code>, <code>password</code>).</li>
<li>Using this traversal with <code>Validated</code> to run a validation function on each field.</li>
<li>Because <code>Validated</code> has an <code>Applicative</code> that accumulates errors, the end result is a <code>Validated</code> object containing either the original form or a list of all validation failures.</li>
</ul>
</li>
</ul>
<h2 id="opticprofunctorexamplejava"><a class="header" href="#opticprofunctorexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/tree/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/profunctor/OpticProfunctorExample.java">OpticProfunctorExample.java</a></a></h2>
<p>This comprehensive example demonstrates the <strong>profunctor</strong> capabilities of optics, showing how to adapt existing optics to work with different data types and structures.</p>
<ul>
<li>
<p><strong>Key Concept</strong>: Every optic is a profunctor, meaning it can be adapted using <code>contramap</code>, <code>map</code>, and <code>dimap</code> operations to work with different source and target types.</p>
</li>
<li>
<p><strong>Demonstrates</strong>:</p>
<ul>
<li><strong>Contramap-style adaptation</strong>: Using an existing <code>Person</code> lens with <code>Employee</code> objects by providing a conversion function.</li>
<li><strong>Map-style adaptation</strong>: Transforming the target type of a lens (e.g., <code>LocalDate</code> to formatted <code>String</code>).</li>
<li><strong>Dimap-style adaptation</strong>: Converting between completely different data representations (e.g., internal models vs external DTOs).</li>
<li><strong>API Integration</strong>: Creating adapters for external API formats whilst reusing internal optics.</li>
<li><strong>Type-safe wrappers</strong>: Working with strongly-typed wrapper classes efficiently.</li>
</ul>
<pre><code class="language-java">// Adapt a Person lens to work with Employee objects
Lens&lt;Person, String&gt; firstNameLens = PersonLenses.firstName();
Lens&lt;Employee, String&gt; employeeFirstNameLens = 
    firstNameLens.contramap(employee -&gt; employee.personalInfo());

// Adapt a lens to work with different target types
Lens&lt;Person, LocalDate&gt; birthDateLens = PersonLenses.birthDate();
Lens&lt;Person, String&gt; birthDateStringLens = 
    birthDateLens.map(date -&gt; date.format(DateTimeFormatter.ISO_LOCAL_DATE));
</code></pre>
</li>
</ul>
<h2 id="traversal-examples"><a class="header" href="#traversal-examples">Traversal Examples</a></h2>
<p>These examples focus on using generated traversals for specific collection and container types, often demonstrating "effectful" traversals where each operation can succeed or fail.</p>
<h3 id="listtraversalexamplejava"><a class="header" href="#listtraversalexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/tree/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/traversal/list/ListTraversalExample.java">ListTraversalExample.java</a></a></h3>
<ul>
<li><strong>Demonstrates</strong>: Traversing a <code>List&lt;String&gt;</code> field.</li>
<li><strong>Scenario</strong>: A <code>Project</code> has a list of team members. The traversal is used with a <code>lookupUser</code> function that returns a <code>Validated</code> type. This allows validating every member in the list. If any lookup fails, the entire operation results in an <code>Invalid</code>.</li>
</ul>
<h3 id="arraytraversalexamplejava"><a class="header" href="#arraytraversalexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/tree/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/traversal/array/ArrayTraversalExample.java">ArrayTraversalExample.java</a></a></h3>
<ul>
<li><strong>Demonstrates</strong>: Traversing an <code>Integer[]</code> field.</li>
<li><strong>Scenario</strong>: A <code>Survey</code> has an array of answers. The traversal is used with a validation function to ensure every answer is within a valid range (1-5), accumulating errors with <code>Validated</code>.</li>
</ul>
<h3 id="settraversalexamplejava"><a class="header" href="#settraversalexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/tree/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/traversal/set/SetTraversalExample.java">SetTraversalExample.java</a></a></h3>
<ul>
<li><strong>Demonstrates</strong>: Traversing a <code>Set&lt;String&gt;</code> field.</li>
<li><strong>Scenario</strong>: A <code>UserGroup</code> has a set of member emails. The traversal validates that every email in the set has a valid format (<code>contains "@"</code>).</li>
</ul>
<h3 id="mapvaluetraversalexamplejava"><a class="header" href="#mapvaluetraversalexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/tree/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/traversal/map/MapValueTraversalExample.java">MapValueTraversalExample.java</a></a></h3>
<ul>
<li><strong>Demonstrates</strong>: Traversing the <em>values</em> of a <code>Map&lt;String, Boolean&gt;</code> field.</li>
<li><strong>Scenario</strong>: A <code>FeatureToggles</code> record holds a map of flags. The traversal focuses on every <code>Boolean</code> value in the map, allowing for a bulk update to disable all features at once.</li>
</ul>
<h3 id="eithertraversalexamplejava"><a class="header" href="#eithertraversalexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/tree/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/traversal/either/EitherTraversalExample.java">EitherTraversalExample.java</a></a></h3>
<ul>
<li><strong>Demonstrates</strong>: Traversing an <code>Either&lt;String, Integer&gt;</code> field.</li>
<li><strong>Scenario</strong>: A <code>Computation</code> can result in a success (<code>Right</code>) or failure (<code>Left</code>). The traversal shows that <code>modifyF</code> only affects the value if the <code>Either</code> is a <code>Right</code>, leaving a <code>Left</code> untouched.</li>
</ul>
<h3 id="maybetraversalexamplejava"><a class="header" href="#maybetraversalexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/tree/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/traversal/maybe/MaybeTraversalExample.java">MaybeTraversalExample.java</a></a></h3>
<ul>
<li><strong>Demonstrates</strong>: Traversing a <code>Maybe&lt;String&gt;</code> field.</li>
<li><strong>Scenario</strong>: A <code>Configuration</code> has an optional <code>proxyHost</code>. The traversal shows that an operation is only applied if the <code>Maybe</code> is a <code>Just</code>, leaving a <code>Nothing</code> untouched, which is analogous to the <code>Either</code> example.</li>
</ul>
<h3 id="optionaltraversalexamplejava"><a class="header" href="#optionaltraversalexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/tree/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/traversal/optional/OptionalTraversalExample.java">OptionalTraversalExample.java</a></a></h3>
<ul>
<li><strong>Demonstrates</strong>: Traversing a <code>java.util.Optional&lt;String&gt;</code> field.</li>
<li><strong>Scenario</strong>: A <code>User</code> record has an optional <code>middleName</code>. The traversal is used to apply a function (like <code>toUpperCase</code>) to the middle name only if it is present. This shows how to work with standard Java types in a functional way.</li>
</ul>
<h3 id="trytraversalexamplejava"><a class="header" href="#trytraversalexamplejava"><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/traversal/trymonad/TryTraversalExample.java">TryTraversalExample.java</a></a></h3>
<ul>
<li><strong>Demonstrates</strong>: Traversing a <code>Try&lt;Integer&gt;</code> field.</li>
<li><strong>Scenario</strong>: A <code>NetworkRequest</code> record holds the result of an operation that could have thrown an exception, wrapped in a <code>Try</code>. The traversal allows modification of the value only if the <code>Try</code> is a <code>Success</code>, leaving a <code>Failure</code> (containing an exception) unchanged.</li>
</ul>
<p><strong>Previous:</strong><a href="optics/composing_optics.html">Profunctor Optics: Advanced Data Transformation</a>
<strong>Next:</strong><a href="optics/auditing_complex_data_example.html">Auditing Complex Data: The Power of Optics</a></p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="auditing-complex-data-with-optics"><a class="header" href="#auditing-complex-data-with-optics">Auditing Complex Data with Optics</a></h1>
<h2 id="a-real-world-deep-dive-the-power-of-optics"><a class="header" href="#a-real-world-deep-dive-the-power-of-optics"><em>A Real-World Deep Dive</em>: The Power of Optics</a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="optics/auditing_complex_data_example.html#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>Solving complex, real-world data processing challenges with optics</li>
<li>Building conditional filtering and transformation pipelines</li>
<li>Combining all four core optic types in a single, powerful composition</li>
<li>Creating declarative, type-safe alternatives to nested loops and type casting</li>
<li>Advanced patterns like safe decoding, profunctor adaptations, and audit trails</li>
<li>When optic composition provides superior solutions to imperative approaches</li>
</ul>
</div>
</div>
<p>In modern software, we often work with complex, nested data structures. Performing a seemingly simple task‚Äîlike "find and decode all production database passwords"‚Äîcan lead to messy, error-prone code with nested loops, <code>if</code> statements, and manual type casting.</p>
<p>This tutorial demonstrates how to solve a sophisticated, real-world problem elegantly using the full power of <strong>higher-kinded-j optics</strong>. We'll build a single, declarative, type-safe optic that performs a deep, conditional data transformation.</p>
<div id="admonition-example-code" class="admonition admonish-note" role="note" aria-labelledby="admonition-example-code-title">
<div class="admonition-title">
<div id="admonition-example-code-title">
<p>Example Code</p>
</div>
<a class="admonition-anchor-link" href="optics/auditing_complex_data_example.html#admonition-example-code"></a>
</div>
<div>
<p>All the example code for this tutorial can be found in the  `org.higherkindedj.example package in the <a href="https://github.com/higher-kinded-j/higher-kinded-j/tree/main/hkj-examples/src/main/java/org/higherkindedj/example/configaudit">Config Audit example</a>.</p>
<p>Other examples of using Optics can be found here.
<a href="https://github.com/higher-kinded-j/higher-kinded-j/tree/main/hkj-examples/src/main/java/org/higherkindedj/example/optics">Optics examples</a>.</p>
</div>
</div>
<hr />
<h2 id="-the-challenge-a-conditional-config-audit"><a class="header" href="#-the-challenge-a-conditional-config-audit">üéØ The Challenge: A Conditional Config Audit</a></h2>
<p>Imagine you're responsible for auditing application configurations. Your task is:</p>
<blockquote>
<p>Find every encrypted database password, but <strong>only</strong> for applications deployed to the <strong>Google Cloud Platform (<code>gcp</code>)</strong> that are running in the <strong><code>live</code> environment</strong>. For each password found, <strong>decode it from Base64</strong> into a raw <code>byte[]</code> for an audit service.</p>
</blockquote>
<p>This single sentence implies several operations:</p>
<ol>
<li><strong>Deep Traversal</strong>: Navigate from a top-level config object down into a list of settings.</li>
<li><strong>Filtering</strong>: Select only settings of a specific type (<code>EncryptedValue</code>).</li>
<li><strong>Conditional Logic</strong>: Apply this logic <em>only</em> if the top-level config meets specific criteria (<code>gcp</code> and <code>live</code>).</li>
<li><strong>Data Transformation</strong>: Decode the Base64 string into another type (<code>byte[]</code>).</li>
</ol>
<p>Doing this imperatively is a recipe for complexity. Let's build it with optics instead.</p>
<hr />
<h2 id="think-of-this-problem-like"><a class="header" href="#think-of-this-problem-like">Think of This Problem Like...</a></h2>
<ul>
<li><strong>A treasure hunt with conditional maps</strong>: Only certain maps (GCP/Live configs) contain the treasures (encrypted passwords)</li>
<li><strong>A selective mining operation</strong>: Drill down only into the right geological formations (config types) to extract specific minerals (encrypted data)</li>
<li><strong>A security scanner with filters</strong>: Only scan certain types of systems (matching deployment criteria) for specific vulnerabilities (encrypted values)</li>
<li><strong>A data archaeology expedition</strong>: Excavate only specific sites (qualified configs) to uncover particular artifacts (encoded passwords)</li>
</ul>
<hr />
<h2 id="-the-four-tools-for-the-job"><a class="header" href="#-the-four-tools-for-the-job">üõ†Ô∏è The Four Tools for the Job</a></h2>
<p>Our solution will compose the four primary optic types, each solving a specific part of the problem.</p>
<h3 id="1-lens-the-magnifying-glass-"><a class="header" href="#1-lens-the-magnifying-glass-">1. <strong>Lens</strong>: The Magnifying Glass üîé</a></h3>
<p>A <code>Lens</code> provides focused access to a field within a product type (like a Java <code>record</code>). We'll use lenses to look inside our configuration objects.</p>
<ul>
<li><code>AppConfigLenses.settings()</code>: Zooms from an <code>AppConfig</code> to its <code>List&lt;Setting&gt;</code>.</li>
<li><code>SettingLenses.value()</code>: Zooms from a <code>Setting</code> to its <code>SettingValue</code>.</li>
</ul>
<h3 id="2-iso-the-universal-translator-"><a class="header" href="#2-iso-the-universal-translator-">2. <strong>Iso</strong>: The Universal Translator üîÑ</a></h3>
<p>An <code>Iso</code> (Isomorphism) defines a lossless, two-way conversion between two types. It's perfect for handling different representations of the same data.</p>
<ul>
<li><code>DeploymentTarget &lt;-&gt; String</code>: We model our deployment target as a structured record but recognise it's isomorphic to a raw string like <code>"gcp|live"</code>. An <code>Iso</code> lets us switch between these representations.</li>
<li><code>String &lt;-&gt; byte[]</code>: Base64 is just an encoded representation of a byte array. An <code>Iso</code> is the perfect tool for handling this encoding and decoding.</li>
</ul>
<h3 id="3-prism-the-safe-filter-"><a class="header" href="#3-prism-the-safe-filter-">3. <strong>Prism</strong>: The Safe Filter üî¨</a></h3>
<p>A <code>Prism</code> provides focused access to a specific case within a sum type (like a <code>sealed interface</code>). It lets us safely attempt to "zoom in" on one variant, failing gracefully if the data is of a different kind.</p>
<ul>
<li><code>SettingValuePrisms.encryptedValue()</code>: This is our key filter. It will look at a <code>SettingValue</code> and only succeed if it's the <code>EncryptedValue</code> variant.</li>
</ul>
<h3 id="4-traversal-the-bulk-operator-"><a class="header" href="#4-traversal-the-bulk-operator-">4. <strong>Traversal</strong>: The Bulk Operator üó∫Ô∏è</a></h3>
<p>A <code>Traversal</code> lets us operate on zero or more targets within a larger structure. It's the ideal optic for working with collections.</p>
<ul>
<li><code>AppConfigTraversals.settings()</code>: This generated optic gives us a single tool to go from an <code>AppConfig</code> to every <code>Setting</code> inside its list.</li>
</ul>
<hr />
<h2 id="when-to-use-this-approach-vs-alternatives"><a class="header" href="#when-to-use-this-approach-vs-alternatives">When to Use This Approach vs Alternatives</a></h2>
<h3 id="use-optic-composition-when-1"><a class="header" href="#use-optic-composition-when-1">Use Optic Composition When:</a></h3>
<ul>
<li><strong>Complex conditional filtering</strong> - Multiple levels of filtering based on different criteria</li>
<li><strong>Reusable audit logic</strong> - The same audit pattern applies to different config types</li>
<li><strong>Type-safe data extraction</strong> - Ensuring compile-time safety for complex transformations</li>
<li><strong>Declarative data processing</strong> - Building self-documenting processing pipelines</li>
</ul>
<pre><code class="language-java">
// Perfect for reusable, conditional audit logic Traversal&lt;ServerConfig, byte[]&gt; sensitiveDataAuditor = ServerConfigTraversals.environments() .andThen(EnvironmentPrisms.production().asTraversal()) .andThen(EnvironmentTraversals.credentials()) .andThen(CredentialPrisms.encrypted().asTraversal()) .andThen(EncryptedCredentialIsos.base64ToBytes.asTraversal());

</code></pre>
<h3 id="use-stream-processing-when-1"><a class="header" href="#use-stream-processing-when-1">Use Stream Processing When:</a></h3>
<ul>
<li><strong>Simple filtering</strong> - Basic collection operations without complex nesting</li>
<li><strong>Performance critical paths</strong> - Minimal abstraction overhead needed</li>
<li><strong>Aggregation logic</strong> - Computing statistics or summaries</li>
</ul>
<pre><code class="language-java">
// Better with streams for simple collection processing List&lt;String&gt; allConfigNames = configs.stream() .map(AppConfig::name) .filter(name -&gt; name.startsWith("prod-")) .collect(toList());

</code></pre>
<h3 id="use-manual-iteration-when"><a class="header" href="#use-manual-iteration-when">Use Manual Iteration When:</a></h3>
<ul>
<li><strong>Early termination</strong> - You might want to stop processing on first match</li>
<li><strong>Complex business logic</strong> - Multiple conditions and branches that don't map cleanly</li>
<li><strong>Legacy integration</strong> - Working with existing imperative codebases</li>
</ul>
<pre><code class="language-java">
// Sometimes manual loops are clearest for complex logic for (AppConfig config : configs) { if (shouldAudit(config) &amp;&amp; hasEncryptedData(config)) { auditResults.add(performDetailedAudit(config)); if (auditResults.size() &gt;= MAX\_AUDITS) break; } }

</code></pre>
<hr />
<h2 id="common-pitfalls-7"><a class="header" href="#common-pitfalls-7">Common Pitfalls</a></h2>
<h3 id="-dont-do-this-6"><a class="header" href="#-dont-do-this-6">‚ùå Don't Do This:</a></h3>
<pre><code class="language-java">
// Over-engineering simple cases Traversal&lt;String, String&gt; stringIdentity = Iso.of(s -&gt; s, s -&gt; s).asTraversal(); // Just use the string directly!

// Creating complex compositions inline var passwords = AppConfigLenses.settings().asTraversal() .andThen(SettingLenses.value().asTraversal()) .andThen(SettingValuePrisms.encryptedValue().asTraversal()) // ... 10 more lines of composition .getAll(config); // Hard to understand and reuse

// Ignoring error handling in transformations Iso&lt;String, byte[]&gt; unsafeBase64 = Iso.of( Base64.getDecoder()::decode,  // Can throw IllegalArgumentException! Base64.getEncoder()::encodeToString );

// Forgetting to test round-trip properties // No verification that encode(decode(x)) == x

</code></pre>
<h3 id="-do-this-instead-6"><a class="header" href="#-do-this-instead-6">‚úÖ Do This Instead:</a></h3>
<pre><code class="language-java">
// Use appropriate tools for simple cases String configName = config.name(); // Direct access is fine

// Create well-named, reusable compositions public static final Traversal&lt;AppConfig, byte[]&gt; GCP\_LIVE\_ENCRYPTED\_PASSWORDS = gcpLiveOnlyPrism.asTraversal() .andThen(AppConfigTraversals.settings()) .andThen(SettingLenses.value().asTraversal()) .andThen(SettingValuePrisms.encryptedValue().asTraversal()) .andThen(EncryptedValueLenses.base64Value().asTraversal()) .andThen(EncryptedValueIsos.base64.asTraversal());

// Handle errors gracefully Prism&lt;String, byte[]&gt; safeBase64Prism = Prism.of( str -&gt; { try { return Optional.of(Base64.getDecoder().decode(str)); } catch (IllegalArgumentException e) { return Optional.empty(); } }, bytes -&gt; Base64.getEncoder().encodeToString(bytes) );

// Test your compositions @Test public void testBase64RoundTrip() { String original = "test data"; String encoded = Base64.getEncoder().encodeToString(original.getBytes()); byte[] decoded = EncryptedValueIsos.base64.get(encoded); String roundTrip = new String(decoded); assertEquals(original, roundTrip); }

</code></pre>
<hr />
<h2 id="performance-notes-7"><a class="header" href="#performance-notes-7">Performance Notes</a></h2>
<p>Optic compositions are optimised for complex data processing:</p>
<ul>
<li><strong>Lazy evaluation</strong>: Complex filters only run when data actually matches</li>
<li><strong>Single-pass processing</strong>: Compositions traverse data structures only once</li>
<li><strong>Memory efficient</strong>: Only creates new objects for actual transformations</li>
<li><strong>Compile-time optimisation</strong>: Complex optic chains are inlined by the JVM</li>
<li><strong>Structural sharing</strong>: Unchanged parts of data structures are reused</li>
</ul>
<p><strong>Best Practice</strong>: Profile your specific use case and compare with stream-based alternatives:</p>
<pre><code class="language-java">
public class AuditPerformance { // For frequent auditing, create optics once and reuse 
    private static final Traversal&lt;AppConfig, byte[]&gt; AUDIT_TRAVERSAL = createAuditTraversal();

    @Benchmark
    public List&lt;byte[]&gt; opticBasedAudit(List&lt;AppConfig&gt; configs) {
        return configs.stream()
            .flatMap(config -&gt; Traversals.getAll(AUDIT_TRAVERSAL, config).stream())
            .collect(toList());
    }
  
    @Benchmark  
    public List&lt;byte[]&gt; streamBasedAudit(List&lt;AppConfig&gt; configs) {
        return configs.stream()
            .filter(this::isGcpLive)
            .flatMap(config -&gt; config.settings().stream())
            .map(Setting::value)
            .filter(EncryptedValue.class::isInstance)
            .map(EncryptedValue.class::cast)
            .map(encrypted -&gt; Base64.getDecoder().decode(encrypted.base64Value()))
            .collect(toList());
    }

}
</code></pre>
<h2 id="-composing-the-solution"><a class="header" href="#-composing-the-solution">‚ú® Composing the Solution</a></h2>
<p>Here's how we chain these optics together. To create the most robust and general-purpose optic (a <code>Traversal</code>), we convert each part of our chain into a <code>Traversal</code> using <code>.asTraversal()</code> before composing it. This ensures type-safety and clarity throughout the process.</p>
<p>The final composed optic has the type <code>Traversal&lt;AppConfig, byte[]&gt;</code> and reads like a declarative path: <strong><code>AppConfig -&gt; (Filter for GCP/Live) -&gt; each Setting -&gt; its Value -&gt; (Filter for Encrypted) -&gt; the inner String -&gt; the raw bytes</code></strong></p>
<pre><code class="language-java">// Inside ConfigAuditExample.java

// A. First, create a Prism to act as our top-level filter.
Prism&lt;AppConfig, AppConfig&gt; gcpLiveOnlyPrism = Prism.of(
    config -&gt; {
        String rawTarget = DeploymentTarget.toRawString().get(config.target());
        return "gcp|live".equals(rawTarget) ? Optional.of(config) : Optional.empty();
    },
    config -&gt; config // The 'build' function is just identity
);

// B. Define the main traversal path to get to the data we want to audit.
Traversal&lt;AppConfig, byte[]&gt; auditTraversal =
    AppConfigTraversals.settings()                             // Traversal&lt;AppConfig, Setting&gt;
        .andThen(SettingLenses.value().asTraversal())        // Traversal&lt;AppConfig, SettingValue&gt;
        .andThen(SettingValuePrisms.encryptedValue().asTraversal()) // Traversal&lt;AppConfig, EncryptedValue&gt;
        .andThen(EncryptedValueLenses.base64Value().asTraversal())  // Traversal&lt;AppConfig, String&gt;
        .andThen(EncryptedValueIsos.base64.asTraversal());   // Traversal&lt;AppConfig, byte[]&gt;

// C. Combine the filter and the main traversal into the final optic.
Traversal&lt;AppConfig, byte[]&gt; finalAuditor = gcpLiveOnlyPrism.asTraversal().andThen(auditTraversal);

// D. Using the final optic is now trivial.
// We call a static helper method from our Traversals utility class.
List&lt;byte[]&gt; passwords = Traversals.getAll(finalAuditor, someConfig);
</code></pre>
<p>When we call <code>Traversals.getAll(finalAuditor, config)</code>, it performs the entire, complex operation and returns a simple <code>List&lt;byte[]&gt;</code> containing only the data we care about.</p>
<hr />
<h2 id="-why-this-is-a-powerful-approach"><a class="header" href="#-why-this-is-a-powerful-approach">üöÄ Why This is a Powerful Approach</a></h2>
<ul>
<li><strong>Declarative &amp; Readable</strong>: The optic chain describes <em>what</em> data to get, not <em>how</em> to loop and check for it. The logic reads like a path, making it self-documenting.</li>
<li><strong>Composable &amp; Reusable</strong>: Every optic, and every composition, is a reusable component. We could reuse <code>gcpLiveOnlyPrism</code> for other tasks, or swap out the final <code>base64</code> Iso to perform a different transformation.</li>
<li><strong>Type-Safe</strong>: The entire operation is checked by the Java compiler. It's impossible to, for example, try to decode a <code>StringValue</code> as if it were encrypted. A mismatch in the optic chain results in a compile-time error, not a runtime <code>ClassCastException</code>.</li>
<li><strong>Architectural Purity</strong>: By having all optics share a common abstract parent (<code>Optic</code>), the library provides universal, lawful composition while allowing for specialised, efficient implementations.</li>
<li><strong>Testable</strong>: Each component can be tested independently, and the composition can be tested as a whole.</li>
</ul>
<hr />
<h2 id="-taking-it-further"><a class="header" href="#-taking-it-further">üß† Taking It Further</a></h2>
<p>This example is just the beginning. Here are some ideas for extending this solution into a real-world application:</p>
<h3 id="1-safe-decoding-with-validated"><a class="header" href="#1-safe-decoding-with-validated">1. <strong>Safe Decoding with <code>Validated</code></strong></a></h3>
<p>The <code>Base64.getDecoder().decode()</code> can throw an <code>IllegalArgumentException</code>. Instead of an <code>Iso</code>, create an <code>AffineTraversal</code> (an optional <code>Prism</code>) that returns a <code>Validated&lt;String, byte[]&gt;</code>, separating successes from failures gracefully.</p>
<pre><code class="language-java">public static final Prism&lt;String, byte[]&gt; SAFE_BASE64_PRISM = Prism.of(
    encoded -&gt; {
        try {
            return Optional.of(Base64.getDecoder().decode(encoded));
        } catch (IllegalArgumentException e) {
            return Optional.empty();
        }
    },
    bytes -&gt; Base64.getEncoder().encodeToString(bytes)
);

// Use in a traversal that accumulates both successes and failures
public static AuditResult auditWithErrorReporting(AppConfig config) {
    var validatedApplicative = ValidatedMonad.instance(Semigroups.list());
  
    Traversal&lt;AppConfig, String&gt; base64Strings = /* ... path to base64 strings ... */;
  
    Validated&lt;List&lt;String&gt;, List&lt;byte[]&gt;&gt; result = VALIDATED.narrow(
        base64Strings.modifyF(
            encoded -&gt; SAFE_BASE64_PRISM.getOptional(encoded)
                .map(bytes -&gt; VALIDATED.widen(Validated.valid(bytes)))
                .orElse(VALIDATED.widen(Validated.invalid(List.of("Invalid base64: " + encoded)))),
            config,
            validatedApplicative
        )
    );
  
    return new AuditResult(result);
}
</code></pre>
<h3 id="2-data-migration-with-modify"><a class="header" href="#2-data-migration-with-modify">2. <strong>Data Migration with <code>modify</code></strong></a></h3>
<p>What if you need to re-encrypt all passwords with a new algorithm? The same <code>finalAuditor</code> optic can be used with a modify function from the <code>Traversals</code> utility class. You'd write a function <code>byte[] -&gt; byte[]</code> and apply it:</p>
<pre><code class="language-java">// A function that re-encrypts the raw password bytes
Function&lt;byte[], byte[]&gt; reEncryptFunction = oldBytes -&gt; newCipher.encrypt(oldBytes);

// Use the *exact same optic* to update the config in-place
AppConfig updatedConfig = Traversals.modify(finalAuditor, reEncryptFunction, originalConfig);
</code></pre>
<h3 id="3-profunctor-adaptations-for-legacy-systems"><a class="header" href="#3-profunctor-adaptations-for-legacy-systems">3. <strong>Profunctor Adaptations for Legacy Systems</strong></a></h3>
<p>Suppose your audit service expects a different data format‚Äîperhaps it works with <code>ConfigDto</code> objects instead of <code>AppConfig</code>. Rather than rewriting your carefully crafted optic, you can adapt it using profunctor operations:</p>
<pre><code class="language-java">// Adapt the auditor to work with legacy DTO format
Traversal&lt;ConfigDto, byte[]&gt; legacyAuditor = finalAuditor.contramap(dto -&gt; convertToAppConfig(dto));

// Or adapt both input and output formats simultaneously
Traversal&lt;ConfigDto, AuditRecord&gt; fullyAdaptedAuditor = finalAuditor.dimap(
    dto -&gt; convertToAppConfig(dto),           // Convert input format
    bytes -&gt; new AuditRecord(bytes, timestamp()) // Convert output format
);
</code></pre>
<p>This profunctor capability means your core business logic (the auditing path) remains unchanged whilst adapting to different system interfaces‚Äîa powerful example of the <a href="optics/profunctor_optics.html">Profunctor Optics</a> capabilities.</p>
<h3 id="4-more-complex-filters"><a class="header" href="#4-more-complex-filters">4. <strong>More Complex Filters</strong></a></h3>
<p>Create an optic that filters for deployments on <em>either</em><code>gcp</code> or <code>aws</code> but <em>only</em> in the <code>live</code> environment. The composable nature of optics makes building up these complex predicate queries straightforward.</p>
<pre><code class="language-java">// Multi-cloud live environment filter
Prism&lt;AppConfig, AppConfig&gt; cloudLiveOnlyPrism = Prism.of(
    config -&gt; {
        String rawTarget = DeploymentTarget.toRawString().get(config.target());
        boolean isLiveCloud = rawTarget.equals("gcp|live") || 
                             rawTarget.equals("aws|live") || 
                             rawTarget.equals("azure|live");
        return isLiveCloud ? Optional.of(config) : Optional.empty();
    },
    config -&gt; config
);

// Environment-specific processing
public static final Map&lt;String, Traversal&lt;AppConfig, byte[]&gt;&gt; ENVIRONMENT_AUDITORS = Map.of(
    "development", devEnvironmentPrism.asTraversal().andThen(auditTraversal),
    "staging", stagingEnvironmentPrism.asTraversal().andThen(auditTraversal),
    "production", cloudLiveOnlyPrism.asTraversal().andThen(auditTraversal)
);

public static List&lt;byte[]&gt; auditForEnvironment(String environment, AppConfig config) {
    return ENVIRONMENT_AUDITORS.getOrDefault(environment, Traversal.empty())
        .getAll(config);
}
</code></pre>
<h3 id="5-configuration-validation"><a class="header" href="#5-configuration-validation">5. <strong>Configuration Validation</strong></a></h3>
<p>Use the same optics to validate your configuration. You could compose a traversal that finds all <code>IntValue</code> settings with the key <code>"server.port"</code> and use <code>.getAll()</code> to check if their values are within a valid range (e.g., &gt; 1024).</p>
<pre><code class="language-java">public static final Traversal&lt;AppConfig, Integer&gt; SERVER_PORTS = 
    AppConfigTraversals.settings()
        .andThen(settingWithKey("server.port"))
        .andThen(SettingLenses.value().asTraversal())
        .andThen(SettingValuePrisms.intValue().asTraversal())
        .andThen(IntValueLenses.value().asTraversal());

public static List&lt;String&gt; validatePorts(AppConfig config) {
    return Traversals.getAll(SERVER_PORTS, config).stream()
        .filter(port -&gt; port &lt;= 1024 || port &gt; 65535)
        .map(port -&gt; "Invalid port: " + port + " (must be 1024-65535)")
        .collect(toList());
}
</code></pre>
<h3 id="6-audit-trail-generation"><a class="header" href="#6-audit-trail-generation">6. <strong>Audit Trail Generation</strong></a></h3>
<p>Extend the auditor to generate comprehensive audit trails:</p>
<pre><code class="language-java">public record AuditEntry(String configName, String settingKey, String encryptedValue, 
                        Instant auditTime, String auditorId) {}

public static final Traversal&lt;AppConfig, AuditEntry&gt; AUDIT_TRAIL_GENERATOR =
    gcpLiveOnlyPrism.asTraversal()
        .andThen(AppConfigTraversals.settings())
        .andThen(settingFilter)
        .andThen(auditEntryMapper);

// Generate complete audit report
public static AuditReport generateAuditReport(List&lt;AppConfig&gt; configs, String auditorId) {
    List&lt;AuditEntry&gt; entries = configs.stream()
        .flatMap(config -&gt; Traversals.getAll(AUDIT_TRAIL_GENERATOR, config).stream())
        .collect(toList());
  
    return new AuditReport(entries, Instant.now(), auditorId);
}
</code></pre>
<p>This combination of composability, type safety, and profunctor adaptability makes higher-kinded-j optics incredibly powerful for real-world data processing scenarios, particularly in enterprise environments where data formats, security requirements, and compliance needs are constantly evolving.</p>
<hr />
<p><strong>Previous:</strong><a href="optics/optics_examples.html">Optics Examples</a></p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="a-blog-on-types-and-functional-patterns"><a class="header" href="#a-blog-on-types-and-functional-patterns">A Blog on Types and Functional Patterns</a></h1>
<p>Here is a blog series providing some background reading that you may find interesting while learning some of the techniques used in Higher-Kinded-J.</p>
<p>This is a web series that brewed some of the ideas that kicked off Higher-Kinded-J</p>
<ul>
<li><a href="https://blog.scottlogic.com/2025/01/20/algebraic-data-types-with-java.html">Algebraic Data Types and Pattern Matching with Java</a></li>
</ul>
<p>In this post we explore the power of Algebraic Data Types(ADT) with Pattern Matching in Java. We look at how they help us model complex business domains and how using them together gives improvements on the traditional Visitor Pattern.</p>
<ul>
<li><a href="http://blog.scottlogic.com/2025/02/17/variance-in-java-and-scala.html">Variance in Generics, Phantom and Existential types with Java and Scala</a></li>
</ul>
<p>In this post we look at Variance in Generics and how it is handled in Java and Scala. We consider use-site and declaration-site approaches and the trade offs of erasure. Finally we take a look at Phantom and Existential types and how they can enhance the capabilities of the type system when it comes to modelling.</p>
<ul>
<li><a href="https://blog.scottlogic.com/2025/03/05/intersection-and-union-types-with-java-and-scala.html">Intersection and Union types with Java and Scala</a></li>
</ul>
<p>In this post we will see how Intersection types help us better model type constraints promoting reuse and how Union types increase code flexibility. We will compare and contrast approaches and how to use in the latest Java and Scala.</p>
<ul>
<li><a href="https://blog.scottlogic.com/2025/03/31/functors-monads-with-java-and-scala.html">Functors and Monads with Java and Scala</a></li>
</ul>
<p>Learn about how Functors and Monads provide patterns to write cleaner, more composable, and robust code that helps us deal with operations like handling nulls, managing errors and sequencing asynchronous actions.</p>
<ul>
<li><a href="https://blog.scottlogic.com/2025/04/11/higher-kinded-types-with-java-and-scala.html">Higher Kinded Types with Java and Scala</a></li>
</ul>
<p>In this post we will see how Higher Kinded Types types can help increase the flexibility of our code and reduce duplication.</p>
<ul>
<li><a href="https://blog.scottlogic.com/2025/05/02/recursion-thunks-trampolines-with-java-and-scala.html">Recursion, Thunks and Trampolines with Java and Scala</a></li>
</ul>
<p>In this post we will see how Thunks and Trampolines can help solve problems by converting deep stack-based recursion into heap-based iteration helping to prevent StackOverflowErrors</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="contributing-to-java-hkt-simulation"><a class="header" href="#contributing-to-java-hkt-simulation">Contributing to Java HKT Simulation</a></h1>
<p>First off, thank you for considering contributing! This project is a simulation to explore Higher-Kinded Types in Java, and contributions are welcome.</p>
<p>This document provides guidelines for contributing to this project.</p>
<h2 id="code-of-conduct"><a class="header" href="#code-of-conduct">Code of Conduct</a></h2>
<p>This project and everyone participating in it is governed by the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a>. By participating, you are expected to uphold this code. Please report unacceptable behavior to simulation.hkt@gmail.com.</p>
<h2 id="how-can-i-contribute"><a class="header" href="#how-can-i-contribute">How Can I Contribute?</a></h2>
<h3 id="reporting-bugs"><a class="header" href="#reporting-bugs">Reporting Bugs</a></h3>
<ul>
<li>Ensure the bug was not already reported by searching on GitHub under <a href="https://github.com/higher-kinded-j/higher-kinded-j/issues">Issues</a>.</li>
<li>If you're unable to find an open issue addressing the problem, <a href="https://github.com/higher-kinded-j/higher-kinded-j/issues/new">open a new one</a>. Be sure to include a <strong>title and clear description</strong>, as much relevant information as possible, and a <strong>code sample or an executable test case</strong> demonstrating the expected behavior that is not occurring.</li>
<li>Use the "Bug Report" issue template if available.</li>
</ul>
<h3 id="suggesting-enhancements"><a class="header" href="#suggesting-enhancements">Suggesting Enhancements</a></h3>
<ul>
<li>Open a new issue to discuss your enhancement suggestion. Please provide details about the motivation and potential implementation.</li>
<li>Use the "Feature Request" issue template if available.</li>
</ul>
<h3 id="your-first-code-contribution"><a class="header" href="#your-first-code-contribution">Your First Code Contribution</a></h3>
<p>Unsure where to begin contributing? You can start by looking through <code>good first issue</code> or <code>help wanted</code> issues (you can add these labels yourself to issues you think fit).</p>
<h3 id="pull-requests"><a class="header" href="#pull-requests">Pull Requests</a></h3>
<ol>
<li><strong>Fork the repository</strong> on GitHub.</li>
<li><strong>Clone your fork</strong> locally: <code>git clone git@github.com:higher-kinded-j/higher-kinded-j.git</code></li>
<li><strong>Create a new branch</strong> for your changes: <code>git checkout -b name-of-your-feature-or-fix</code></li>
<li><strong>Make your changes.</strong> Ensure you adhere to standard Java coding conventions.</li>
<li><strong>Add tests</strong> for your changes. This is important!</li>
<li><strong>Run the tests:</strong> Make sure the full test suite passes using <code>./gradlew test</code>.</li>
<li><strong>Build the project:</strong> Ensure the project builds without errors using <code>./gradlew build</code>.</li>
<li><strong>Commit your changes:</strong> Use clear and descriptive commit messages. <code>git commit -am 'Add some feature'</code></li>
<li><strong>Push to your fork:</strong> <code>git push origin name-of-your-feature-or-fix</code></li>
<li><strong>Open a Pull Request</strong> against the <code>main</code> branch of the original repository.</li>
<li><strong>Describe your changes</strong> in the Pull Request description. Link to any relevant issues (e.g., "Closes #123").</li>
<li>Ensure the <strong>GitHub Actions CI checks pass</strong>.</li>
</ol>
<h2 id="development-setup"><a class="header" href="#development-setup">Development Setup</a></h2>
<ul>
<li>You need a Java Development Kit (JDK), version <strong>24</strong> or later.</li>
<li>This project uses Gradle. You can use the included Gradle Wrapper (<code>gradlew</code>) to build and test.
<ul>
<li>Build the project: <code>./gradlew build</code></li>
<li>Run tests: <code>./gradlew test</code></li>
<li>Generate JaCoCo coverage reports: <code>./gradlew test jacocoTestReport</code> (HTML report at <code>build/reports/jacoco/test/html/index.html</code>)</li>
</ul>
</li>
</ul>
<h2 id="coding-style"><a class="header" href="#coding-style">Coding Style</a></h2>
<p>Please follow the <a href="https://google.github.io/styleguide/javaguide.html"><strong>Google Java Style Guide</strong></a>. Keep code simple, readable, and well-tested. Consistent formatting is encouraged.</p>
<p>Thank you for contributing!</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="contributor-covenant-code-of-conduct"><a class="header" href="#contributor-covenant-code-of-conduct">Contributor Covenant Code of Conduct</a></h1>
<h2 id="our-pledge"><a class="header" href="#our-pledge">Our Pledge</a></h2>
<p>We as members, contributors, and leaders pledge to make participation in our
community a harassment-free experience for everyone, regardless of age, body
size, visible or invisible disability, ethnicity, sex characteristics, gender
identity and expression, level of experience, education, socio-economic status,
nationality, personal appearance, race, religion, or sexual identity
and orientation.</p>
<p>We pledge to act and interact in ways that contribute to an open, welcoming,
diverse, inclusive, and healthy community.</p>
<h2 id="our-standards"><a class="header" href="#our-standards">Our Standards</a></h2>
<p>Examples of behavior that contributes to a positive environment for our
community include:</p>
<ul>
<li>Demonstrating empathy and kindness toward other people</li>
<li>Being respectful of differing opinions, viewpoints, and experiences</li>
<li>Giving and gracefully accepting constructive feedback</li>
<li>Accepting responsibility and apologizing to those affected by our mistakes,
and learning from the experience</li>
<li>Focusing on what is best not just for us as individuals, but for the
overall community</li>
</ul>
<p>Examples of unacceptable behavior include:</p>
<ul>
<li>The use of sexualized language or imagery, and sexual attention or
advances of any kind</li>
<li>Trolling, insulting or derogatory comments, and personal or political attacks</li>
<li>Public or private harassment</li>
<li>Publishing others' private information, such as a physical or email
address, without their explicit permission</li>
<li>Other conduct which could reasonably be considered inappropriate in a
professional setting</li>
</ul>
<h2 id="enforcement-responsibilities"><a class="header" href="#enforcement-responsibilities">Enforcement Responsibilities</a></h2>
<p>Community leaders are responsible for clarifying and enforcing our standards of
acceptable behavior and will take appropriate and fair corrective action in
response to any behavior that they deem inappropriate, threatening, offensive,
or harmful.</p>
<p>Community leaders have the right and responsibility to remove, edit, or reject
comments, commits, code, wiki edits, issues, and other contributions that are
not aligned to this Code of Conduct, and will communicate reasons for moderation
decisions when appropriate.</p>
<h2 id="scope"><a class="header" href="#scope">Scope</a></h2>
<p>This Code of Conduct applies within all community spaces, and also applies when
an individual is officially representing the community in public spaces.
Examples of representing our community include using an official e-mail address,
posting via an official social media account, or acting as an appointed
representative at an online or offline event.</p>
<h2 id="enforcement"><a class="header" href="#enforcement">Enforcement</a></h2>
<p>Instances of abusive, harassing, or otherwise unacceptable behavior may be
reported to the community leaders responsible for enforcement at
simulation.hkt@gmail.com.
All complaints will be reviewed and investigated promptly and fairly.</p>
<p>All community leaders are obligated to respect the privacy and security of the
reporter of any incident.</p>
<h2 id="enforcement-guidelines"><a class="header" href="#enforcement-guidelines">Enforcement Guidelines</a></h2>
<p>Community leaders will follow these Community Impact Guidelines in determining
the consequences for any action they deem in violation of this Code of Conduct:</p>
<h3 id="1-correction"><a class="header" href="#1-correction">1. Correction</a></h3>
<p><strong>Community Impact</strong>: Use of inappropriate language or other behavior deemed
unprofessional or unwelcome in the community.</p>
<p><strong>Consequence</strong>: A private, written warning from community leaders, providing
clarity around the nature of the violation and an explanation of why the
behavior was inappropriate. A public apology may be requested.</p>
<h3 id="2-warning"><a class="header" href="#2-warning">2. Warning</a></h3>
<p><strong>Community Impact</strong>: A violation through a single incident or series
of actions.</p>
<p><strong>Consequence</strong>: A warning with consequences for continued behavior. No
interaction with the people involved, including unsolicited interaction with
those enforcing the Code of Conduct, for a specified period of time. This
includes avoiding interactions in community spaces as well as external channels
like social media. Violating these terms may lead to a temporary or
permanent ban.</p>
<h3 id="3-temporary-ban"><a class="header" href="#3-temporary-ban">3. Temporary Ban</a></h3>
<p><strong>Community Impact</strong>: A serious violation of community standards, including
sustained inappropriate behavior.</p>
<p><strong>Consequence</strong>: A temporary ban from any sort of interaction or public
communication with the community for a specified period of time. No public or
private interaction with the people involved, including unsolicited interaction
with those enforcing the Code of Conduct, is allowed during this period.
Violating these terms may lead to a permanent ban.</p>
<h3 id="4-permanent-ban"><a class="header" href="#4-permanent-ban">4. Permanent Ban</a></h3>
<p><strong>Community Impact</strong>: Demonstrating a pattern of violation of community
standards, including sustained inappropriate behavior, harassment of an
individual, or aggression toward or disparagement of classes of individuals.</p>
<p><strong>Consequence</strong>: A permanent ban from any sort of public interaction within
the community.</p>
<h2 id="attribution"><a class="header" href="#attribution">Attribution</a></h2>
<p>This Code of Conduct is adapted from the <a href="https://www.contributor-covenant.org">Contributor Covenant</a>,
version 2.1, available at
<a href="https://www.contributor-covenant.org/version/2/1/code_of_conduct.html">https://www.contributor-covenant.org/version/2/1/code_of_conduct.html</a>.</p>
<p>Community Impact Guidelines were inspired by <a href="https://github.com/mozilla/diversity">Mozilla's code of conduct
enforcement ladder</a>.</p>
<p>For answers to common questions about this code of conduct, see the FAQ at
<a href="https://www.contributor-covenant.org/faq">https://www.contributor-covenant.org/faq</a>. Translations are available at
<a href="https://www.contributor-covenant.org/translations">https://www.contributor-covenant.org/translations</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<p>MIT License</p>
<p>Copyright (c) 2025 Magnus Smith</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
