<!DOCTYPE HTML>
<html lang="en" class="latte sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Database Records with JOOQ - Higher-Kinded-J: Composable Effects and Advanced Optics for Java</title>


        <!-- Custom HTML head -->


            <meta name="description" content="The most comprehensive functional programming library for Java. Unify error handling, optional values, and immutable data navigation with the Effect Path API and Focus DSL. Features advanced optics with code generation for Java records, filtered traversals, indexed optics, and seamless Spring Boot integration.">


        <meta name="keywords" content="Higher-Kinded Types, Higher-Kinded-J, HKT, Java, Optics, Lens, Prism, Traversal, Iso, Affine, Focus DSL, Effect Path API, Functional Programming, Monad, Functor, Applicative, EitherPath, MaybePath, TryPath, ValidationPath, Java Records, Sealed Interface, Error Handling, Immutable Data">
        
        <meta property="og:title" content="Database Records with JOOQ - Higher-Kinded-J: Composable Effects and Advanced Optics for Java">
            <meta property="og:description" content="The most comprehensive functional programming library for Java. Unify error handling, optional values, and immutable data navigation with the Effect Path API and Focus DSL. Features advanced optics with code generation for Java records, filtered traversals, indexed optics, and seamless Spring Boot integration.">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://higher-kinded-j.github.io/">
        <meta property="og:image" content="https://higher-kinded-j.github.io/preview.png">
        <meta property="og:image:width" content="1200">
        <meta property="og:image:height" content="630">
        <meta property="og:site_name" content="Higher-Kinded-J Documentation">
        <meta property="og:locale" content="en_GB">
        
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="Database Records with JOOQ - Higher-Kinded-J: Composable Effects and Advanced Optics for Java">
        <meta name="twitter:description" content="Unifying Composable Effects and Advanced Optics for Java. Effect Path API, Focus DSL, and the most comprehensive optics implementation in the Java ecosystem.">
        <meta name="twitter:image" content="https://higher-kinded-j.github.io/preview.png">
        <meta name="twitter:image:alt" content="Higher-Kinded-J: Composable Effects and Advanced Optics for Java">
        <meta name="description" content="The most comprehensive functional programming library for Java. Unify error handling, optional values, and immutable data navigation with the Effect Path API and Focus DSL. Features advanced optics with code generation for Java records, filtered traversals, indexed optics, and seamless Spring Boot integration.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">
        <meta name="google-site-verification" content="X-xsiAq2cKMLOzh9dexUrX8Onx2h_YMUFgp5lHHUwSg" />
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././mdbook-admonish.css">
        <link rel="stylesheet" href=".././theme/catppuccin.css">
        <link rel="stylesheet" href=".././theme/catppuccin-admonish.css">
        <link rel="stylesheet" href=".././theme/catppuccin-alerts.css">
        <link rel="stylesheet" href=".././theme/additional-hkj.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "latte";
            const default_dark_theme = "macchiato";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('latte')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="latte">Latte</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="frappe">Frappé</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="macchiato">Macchiato</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mocha">Mocha</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        <div class="version-selector-container">
                            <select id="version-selector" class="version-selector" aria-label="Select documentation version" title="Select documentation version">
                                <option value="">Loading versions...</option>
                            </select>
                        </div>
                    </div>

                    <h1 class="menu-title">Higher-Kinded-J: Composable Effects and Advanced Optics for Java</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/higher-kinded-j/higher-kinded-j" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/higher-kinded-j/higher-kinded-j/edit/main/hkj-book/src/optics/copy_strategies.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="database-records-with-jooq"><a class="header" href="#database-records-with-jooq">Database Records with JOOQ</a></h1>
<h2 id="copy-strategies-for-builder-based-types"><a class="header" href="#copy-strategies-for-builder-based-types"><em>Copy Strategies for Builder-Based Types</em></a></h2>
<blockquote>
<p>"First, solve the problem. Then, write the code."
-- John Johnson</p>
</blockquote>
<p>Johnson's advice is deceptively simple, yet it cuts to the heart of what we're doing here. The <em>problem</em> isn't "how do I update a field in a JOOQ record." The problem is: "how do I express my domain transformations clearly while respecting immutability?" Builders solve immutability; optics solve composition. Together, they let us solve the real problem first (describing what our business logic does) and then write concise code that does exactly that.</p>
<p>When we use <code>@ViaBuilder</code>, we're encoding our understanding of the problem (this type uses a builder pattern) so the processor can generate code that lets us focus on business logic rather than mechanical copying.</p>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How <code>@ViaBuilder</code> creates lenses for builder-pattern types</li>
<li>Working with JOOQ-generated immutable POJOs</li>
<li>When to use each copy strategy annotation</li>
<li>Building a complete database-to-domain transformation layer</li>
</ul>
</div>
</div>
<hr />
<h2 id="the-jooq-pattern"><a class="header" href="#the-jooq-pattern">The JOOQ Pattern</a></h2>
<p>JOOQ generates immutable record classes with a fluent builder pattern. If we're using JOOQ for database access, we've seen code like this:</p>
<pre><code class="language-java">// JOOQ-generated record
CustomerRecord customer = ctx.newRecord(CUSTOMER);
customer.setName("Alice");
customer.setEmail("alice@example.com");
customer.setCreatedAt(LocalDateTime.now());

// To "update" a field immutably, we use the builder
CustomerRecord updated = customer.into(CustomerRecord.class)
    .with(CUSTOMER.NAME, "Alicia");
</code></pre>
<p>Or with JOOQ's immutable POJO generation:</p>
<pre><code class="language-java">// Generated immutable POJO with builder
@Immutable
public class Customer {
    private final String name;
    private final String email;
    private final BigDecimal creditLimit;

    public Builder toBuilder() { ... }

    public static class Builder {
        public Builder name(String name) { ... }
        public Builder email(String email) { ... }
        public Builder creditLimit(BigDecimal limit) { ... }
        public Customer build() { ... }
    }
}
</code></pre>
<p>This builder pattern is everywhere: Lombok's <code>@Builder</code>, Immutables, AutoValue, Protocol Buffers, and hand-written immutable classes. But <code>@ImportOptics</code> cannot auto-detect it because there is no standard naming convention the processor can rely on.</p>
<p><strong>This is where <code>@ViaBuilder</code> comes in.</strong></p>
<hr />
<h2 id="our-first-builder-lens"><a class="header" href="#our-first-builder-lens">Our First Builder Lens</a></h2>
<p>Let's create optics for a JOOQ-style customer record:</p>
<pre><code class="language-java">// The external type (imagine JOOQ generated this)
public class Customer {
    private final Long id;
    private final String name;
    private final String email;
    private final BigDecimal creditLimit;

    public Long id() { return id; }
    public String name() { return name; }
    public String email() { return email; }
    public BigDecimal creditLimit() { return creditLimit; }

    public Builder toBuilder() {
        return new Builder()
            .id(id).name(name).email(email).creditLimit(creditLimit);
    }

    public static class Builder {
        private Long id;
        private String name;
        private String email;
        private BigDecimal creditLimit;

        public Builder id(Long id) { this.id = id; return this; }
        public Builder name(String name) { this.name = name; return this; }
        public Builder email(String email) { this.email = email; return this; }
        public Builder creditLimit(BigDecimal limit) {
            this.creditLimit = limit; return this;
        }
        public Customer build() { return new Customer(id, name, email, creditLimit); }
    }
}
</code></pre>
<p>The spec interface tells the processor how to use this builder:</p>
<pre><code class="language-java">@ImportOptics
public interface CustomerOptics extends OpticsSpec&lt;Customer&gt; {

    @ViaBuilder
    Lens&lt;Customer, Long&gt; id();

    @ViaBuilder
    Lens&lt;Customer, String&gt; name();

    @ViaBuilder
    Lens&lt;Customer, String&gt; email();

    @ViaBuilder
    Lens&lt;Customer, BigDecimal&gt; creditLimit();
}
</code></pre>
<p>The <code>@ViaBuilder</code> annotation with no parameters uses sensible defaults:</p>
<ul>
<li><strong>getter</strong>: method name matches the optic name (<code>name()</code> for the <code>name</code> lens)</li>
<li><strong>toBuilder</strong>: <code>"toBuilder"</code></li>
<li><strong>setter</strong>: method name matches the optic name on the builder</li>
<li><strong>build</strong>: <code>"build"</code></li>
</ul>
<p>The processor generates:</p>
<pre><code class="language-java">public final class CustomerOptics {

    public static Lens&lt;Customer, String&gt; name() {
        return Lens.of(
            customer -&gt; customer.name(),
            (customer, newName) -&gt; customer.toBuilder()
                .name(newName)
                .build()
        );
    }

    // ... similar for id, email, creditLimit
}
</code></pre>
<p>Now we can update customer records functionally:</p>
<pre><code class="language-java">// Apply a loyalty discount
Customer discounted = CustomerOptics.creditLimit()
    .modify(limit -&gt; limit.multiply(BigDecimal.valueOf(1.1)), customer);

// Update email
Customer updated = CustomerOptics.email()
    .set("newemail@example.com", customer);
</code></pre>
<hr />
<h2 id="handling-non-standard-naming"><a class="header" href="#handling-non-standard-naming">Handling Non-Standard Naming</a></h2>
<p>Not all builders follow the same conventions. JOOQ's own conventions sometimes differ, and libraries like Lombok allow customisation. The <code>@ViaBuilder</code> annotation handles this:</p>
<pre><code class="language-java">// Lombok with @Builder(toBuilder = true, setterPrefix = "with")
@Builder(toBuilder = true, setterPrefix = "with")
public class Order {
    private final String orderId;
    private final List&lt;LineItem&gt; items;
    private final OrderStatus status;

    // Lombok generates:
    // - getOrderId(), getItems(), getStatus() (standard getters)
    // - toBuilder() returning OrderBuilder
    // - OrderBuilder.withOrderId(), withItems(), withStatus()
    // - OrderBuilder.build()
}
</code></pre>
<pre><code class="language-java">@ImportOptics
public interface OrderOptics extends OpticsSpec&lt;Order&gt; {

    @ViaBuilder(getter = "getOrderId", setter = "withOrderId")
    Lens&lt;Order, String&gt; orderId();

    @ViaBuilder(getter = "getItems", setter = "withItems")
    Lens&lt;Order, List&lt;LineItem&gt;&gt; items();

    @ViaBuilder(getter = "getStatus", setter = "withStatus")
    Lens&lt;Order, OrderStatus&gt; status();

    // Traversal into items - traversal type is auto-detected from List&lt;LineItem&gt;
    @ThroughField(field = "items")
    Traversal&lt;Order, LineItem&gt; eachItem();
}
</code></pre>
<h3 id="throughfield-auto-detection"><a class="header" href="#throughfield-auto-detection">@ThroughField Auto-Detection</a></h3>
<p>The <code>@ThroughField</code> annotation creates traversals that compose a lens to a container field with a standard traversal for that container type. <strong>The processor automatically detects which traversal to use based on the field's type.</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Field Type</th><th>Auto-Detected Traversal</th></tr></thead><tbody>
<tr><td><code>List&lt;A&gt;</code></td><td><code>Traversals.forList()</code></td></tr>
<tr><td><code>Set&lt;A&gt;</code></td><td><code>Traversals.forSet()</code></td></tr>
<tr><td><code>Optional&lt;A&gt;</code></td><td><code>Traversals.forOptional()</code></td></tr>
<tr><td><code>A[]</code></td><td><code>Traversals.forArray()</code></td></tr>
<tr><td><code>Map&lt;K, V&gt;</code></td><td><code>Traversals.forMapValues()</code></td></tr>
</tbody></table>
</div>
<p><strong>Subtypes are supported.</strong> If your field is <code>ArrayList&lt;String&gt;</code>, <code>HashSet&lt;Integer&gt;</code>, or <code>HashMap&lt;String, BigDecimal&gt;</code>, the processor correctly detects the parent container type:</p>
<pre><code class="language-java">// This class uses concrete collection types
public class Order {
    private final ArrayList&lt;LineItem&gt; items;  // ArrayList, not List
    public ArrayList&lt;LineItem&gt; getItems() { return items; }
    // ...
}

@ImportOptics
public interface OrderOptics extends OpticsSpec&lt;Order&gt; {
    @ViaBuilder(getter = "getItems", setter = "withItems")
    Lens&lt;Order, ArrayList&lt;LineItem&gt;&gt; items();

    // Auto-detects ArrayList as List, uses Traversals.forList()
    @ThroughField(field = "items")
    Traversal&lt;Order, LineItem&gt; eachItem();
}
</code></pre>
<p><strong>When explicit traversal is needed:</strong> If you have a custom container type that doesn't extend <code>List</code>, <code>Set</code>, <code>Map</code>, or <code>Optional</code>, you can specify the traversal explicitly:</p>
<pre><code class="language-java">@ThroughField(
    field = "entries",
    traversal = "com.example.CustomTraversals.forMyContainer()"
)
Traversal&lt;MyType, Entry&gt; eachEntry();
</code></pre>
<p>We can customise any part of the builder interaction:</p>
<pre><code class="language-java">@ViaBuilder(
    getter = "getName",           // How to get the current value
    toBuilder = "newBuilder",     // How to get a builder (some use "builder()")
    setter = "setName",           // How to set on the builder
    build = "create"              // How to build (some use "finish()")
)
Lens&lt;LegacyType, String&gt; name();
</code></pre>
<hr />
<h2 id="a-real-workflow-order-processing"><a class="header" href="#a-real-workflow-order-processing">A Real Workflow: Order Processing</a></h2>
<p>Let's build a complete order processing pipeline using JOOQ-style records:</p>
<pre><code class="language-java">// Domain types (imagine JOOQ generated these)
public class Order {
    public String orderId() { ... }
    public Customer customer() { ... }
    public List&lt;LineItem&gt; items() { ... }
    public OrderStatus status() { ... }
    public LocalDateTime createdAt() { ... }
    public Builder toBuilder() { ... }
}

public class LineItem {
    public String productId() { ... }
    public int quantity() { ... }
    public BigDecimal unitPrice() { ... }
    public Builder toBuilder() { ... }
}
</code></pre>
<pre><code class="language-java">// Spec interfaces
@ImportOptics
public interface OrderOptics extends OpticsSpec&lt;Order&gt; {

    @ViaBuilder Lens&lt;Order, String&gt; orderId();
    @ViaBuilder Lens&lt;Order, Customer&gt; customer();
    @ViaBuilder Lens&lt;Order, List&lt;LineItem&gt;&gt; items();
    @ViaBuilder Lens&lt;Order, OrderStatus&gt; status();
    @ViaBuilder Lens&lt;Order, LocalDateTime&gt; createdAt();

    @ThroughField(field = "items")
    Traversal&lt;Order, LineItem&gt; eachItem();
}

@ImportOptics
public interface LineItemOptics extends OpticsSpec&lt;LineItem&gt; {

    @ViaBuilder Lens&lt;LineItem, String&gt; productId();
    @ViaBuilder Lens&lt;LineItem, Integer&gt; quantity();
    @ViaBuilder Lens&lt;LineItem, BigDecimal&gt; unitPrice();
}
</code></pre>
<p>Now we build the order processing service:</p>
<pre><code class="language-java">public class OrderService {

    /**
     * Calculate the total value of an order.
     */
    public BigDecimal calculateTotal(Order order) {
        return OrderOptics.eachItem()
            .toListOf(order)
            .stream()
            .map(item -&gt; LineItemOptics.unitPrice().get(item)
                .multiply(BigDecimal.valueOf(LineItemOptics.quantity().get(item))))
            .reduce(BigDecimal.ZERO, BigDecimal::add);
    }

    /**
     * Apply a percentage discount to all items.
     */
    public Order applyDiscount(Order order, BigDecimal discountPercent) {
        BigDecimal multiplier = BigDecimal.ONE.subtract(
            discountPercent.divide(BigDecimal.valueOf(100))
        );

        return OrderOptics.eachItem()
            .andThen(LineItemOptics.unitPrice())
            .modify(price -&gt; price.multiply(multiplier), order);
    }

    /**
     * Update the customer's credit limit based on order history.
     */
    public Order updateCustomerCredit(Order order, BigDecimal newLimit) {
        return OrderOptics.customer()
            .andThen(CustomerOptics.creditLimit())
            .set(newLimit, order);
    }

    /**
     * Mark order as shipped and record timestamp.
     */
    public Order shipOrder(Order order) {
        return OrderOptics.status().set(OrderStatus.SHIPPED,
            OrderOptics.createdAt().set(LocalDateTime.now(), order)
        );
    }

    /**
     * Increase quantity for a specific product.
     */
    public Order increaseQuantity(Order order, String productId, int additionalQty) {
        return OrderOptics.eachItem()
            .filter(item -&gt; LineItemOptics.productId().get(item).equals(productId))
            .andThen(LineItemOptics.quantity())
            .modify(qty -&gt; qty + additionalQty, order);
    }
}
</code></pre>
<p>Every method is a composition of optics. The business logic is clear and the immutable updates are handled automatically.</p>
<hr />
<h2 id="working-with-jooq-result-sets"><a class="header" href="#working-with-jooq-result-sets">Working with JOOQ Result Sets</a></h2>
<p>JOOQ's <code>Result&lt;R&gt;</code> type implements <code>List&lt;R&gt;</code>, so we do not need a spec interface at all. Just use the standard list traversal:</p>
<pre><code class="language-java">// Fetch customers from database
Result&lt;CustomerRecord&gt; customers = ctx
    .selectFrom(CUSTOMER)
    .where(CUSTOMER.ACTIVE.isTrue())
    .fetch();

// Result implements List, so Traversals.list() works directly
Traversal&lt;Result&lt;CustomerRecord&gt;, CustomerRecord&gt; eachCustomer =
    Traversals.list();

// Apply credit increase to all customers
Result&lt;CustomerRecord&gt; updated = eachCustomer
    .andThen(CustomerOptics.creditLimit())
    .modify(limit -&gt; limit.multiply(BigDecimal.valueOf(1.05)), customers);
</code></pre>
<p>This is a key insight: <strong>not every external type needs a spec interface</strong>. When the type already implements a standard interface (<code>List</code>, <code>Map</code>, <code>Optional</code>), the existing traversals work perfectly.</p>
<hr />
<h2 id="beyond-builders-other-copy-strategies"><a class="header" href="#beyond-builders-other-copy-strategies">Beyond Builders: Other Copy Strategies</a></h2>
<p>While <code>@ViaBuilder</code> handles the most common case, some types need different approaches:</p>
<h3 id="wither---for-types-with-withx-methods"><a class="header" href="#wither---for-types-with-withx-methods">@Wither - For Types with withX() Methods</a></h3>
<p>JDK types like <code>LocalDate</code> and many immutable libraries use the wither pattern:</p>
<pre><code class="language-java">@ImportOptics
public interface LocalDateOptics extends OpticsSpec&lt;LocalDate&gt; {

    @Wither(value = "withYear", getter = "getYear")
    Lens&lt;LocalDate, Integer&gt; year();

    @Wither(value = "withMonth", getter = "getMonthValue")
    Lens&lt;LocalDate, Integer&gt; month();

    @Wither(value = "withDayOfMonth", getter = "getDayOfMonth")
    Lens&lt;LocalDate, Integer&gt; day();
}
</code></pre>
<h3 id="viaconstructor---for-constructor-only-types"><a class="header" href="#viaconstructor---for-constructor-only-types">@ViaConstructor - For Constructor-Only Types</a></h3>
<p>Some immutable types have no builder or withers, just a constructor:</p>
<pre><code class="language-java">// Simple immutable type
public class Point {
    private final int x, y;
    public Point(int x, int y) { this.x = x; this.y = y; }
    public int x() { return x; }
    public int y() { return y; }
}
</code></pre>
<pre><code class="language-java">@ImportOptics
public interface PointOptics extends OpticsSpec&lt;Point&gt; {

    @ViaConstructor(parameterOrder = {"x", "y"})
    Lens&lt;Point, Integer&gt; x();

    @ViaConstructor(parameterOrder = {"x", "y"})
    Lens&lt;Point, Integer&gt; y();
}
</code></pre>
<p>The <code>parameterOrder</code> tells the processor which getters to call and in what order to pass them to the constructor.</p>
<h3 id="viacopyandset---for-copy-constructor--setter-types"><a class="header" href="#viacopyandset---for-copy-constructor--setter-types">@ViaCopyAndSet - For Copy Constructor + Setter Types</a></h3>
<p>Legacy types sometimes have a copy constructor and setters:</p>
<pre><code class="language-java">public class Config {
    public Config(Config other) { /* copy fields */ }
    public void setHost(String host) { this.host = host; }
}
</code></pre>
<pre><code class="language-java">@ImportOptics
public interface ConfigOptics extends OpticsSpec&lt;Config&gt; {

    @ViaCopyAndSet(setter = "setHost")
    Lens&lt;Config, String&gt; host();
}
</code></pre>
<div id="admonition-lens-law-caution" class="admonition admonish-warning" role="note" aria-labelledby="admonition-lens-law-caution-title">
<div class="admonition-title">
<div id="admonition-lens-law-caution-title">
<p>Lens Law Caution</p>
</div>
<a class="admonition-anchor-link" href="#admonition-lens-law-caution"></a>
</div>
<div>
<p><code>@ViaCopyAndSet</code> creates mutable intermediate objects. Ensure the copy constructor truly copies all fields, or modifications may affect the original.</p>
</div>
</div>
<hr />
<h2 id="taking-it-further-focus-dsl-bridging"><a class="header" href="#taking-it-further-focus-dsl-bridging">Taking It Further: Focus DSL Bridging</a></h2>
<p>When our local domain records reference external types (JOOQ records, Immutables values, etc.), we can <strong>bridge</strong> Focus DSL navigation into those types using spec interface optics:</p>
<pre><code class="language-java">// Focus for local navigation, spec optics for external types
Lens&lt;Company, String&gt; hqCity = CompanyFocus.headquarters().toLens()
    .andThen(AddressOptics.city());

// Now we get IDE autocomplete through the entire chain
String city = hqCity.get(company);
Company relocated = hqCity.set("New York", company);
</code></pre>
<p>The <code>.toLens()</code> method converts a Focus path into a composable optic, which we can then chain with spec interface optics for external types.</p>
<p><strong>For a complete guide</strong> including Immutables integration, deep traversals across boundaries, and domain service patterns, see <strong><a href="focus_external_bridging.html">Focus DSL with External Libraries</a></strong>.</p>
<hr />
<h2 id="choosing-the-right-strategy"><a class="header" href="#choosing-the-right-strategy">Choosing the Right Strategy</a></h2>
<pre><code>              ┌─────────────────────────────────────────────┐
              │     Which copy strategy should I use?       │
              └─────────────────────────────────────────────┘
                                   │
                                   ▼
               ┌───────────────────────────────────────┐
               │ Does it have toBuilder().build()?    │
               └───────────────────────────────────────┘
                      │ YES                    │ NO
                      ▼                        ▼
            ┌──────────────────┐    ┌───────────────────────┐
            │   @ViaBuilder    │    │ Does it have withX()? │
            │                  │    └───────────────────────┘
            │ JOOQ, Lombok,    │           │ YES       │ NO
            │ Immutables,      │           ▼           ▼
            │ AutoValue        │    ┌──────────┐  ┌─────────────────────┐
            └──────────────────┘    │ @Wither  │  │ Does it have an     │
                                    │          │  │ all-args constructor?│
                                    │LocalDate,│  └─────────────────────┘
                                    │java.time │       │ YES       │ NO
                                    └──────────┘       ▼           ▼
                                             ┌───────────────┐ ┌──────────────┐
                                             │@ViaConstructor│ │@ViaCopyAndSet│
                                             │               │ │              │
                                             │ Simple value  │ │ Legacy types │
                                             │ objects       │ │ with setters │
                                             └───────────────┘ └──────────────┘
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Type Pattern</th><th>Annotation</th><th>Example Types</th></tr></thead><tbody>
<tr><td>Has <code>toBuilder().field(x).build()</code></td><td><code>@ViaBuilder</code></td><td>JOOQ POJOs, Lombok @Builder, Immutables</td></tr>
<tr><td>Has <code>withField(x)</code> methods</td><td><code>@Wither</code></td><td>java.time, Guava Immutables</td></tr>
<tr><td>Has all-args constructor only</td><td><code>@ViaConstructor</code></td><td>Simple value objects</td></tr>
<tr><td>Has copy constructor + setters</td><td><code>@ViaCopyAndSet</code></td><td>Legacy mutable types</td></tr>
<tr><td>Implements List/Map/Optional</td><td>None needed</td><td>JOOQ Result, standard collections</td></tr>
</tbody></table>
</div>
<p>Start with <code>@ViaBuilder</code> as it is the most common pattern. Fall back to others when the type does not fit.</p>
<hr />
<h2 id="quick-reference"><a class="header" href="#quick-reference">Quick Reference</a></h2>
<div id="admonition-viabuilder-parameters" class="admonition admonish-tip" role="note" aria-labelledby="admonition-viabuilder-parameters-title">
<div class="admonition-title">
<div id="admonition-viabuilder-parameters-title">
<p>@ViaBuilder Parameters</p>
</div>
<a class="admonition-anchor-link" href="#admonition-viabuilder-parameters"></a>
</div>
<div>
<pre><code class="language-java">@ViaBuilder(
    getter = "getName",      // Default: optic method name
    toBuilder = "toBuilder", // Default: "toBuilder"
    setter = "name",         // Default: optic method name
    build = "build"          // Default: "build"
)
</code></pre>
</div>
</div>
<div id="admonition-wither-parameters" class="admonition admonish-tip" role="note" aria-labelledby="admonition-wither-parameters-title">
<div class="admonition-title">
<div id="admonition-wither-parameters-title">
<p>@Wither Parameters</p>
</div>
<a class="admonition-anchor-link" href="#admonition-wither-parameters"></a>
</div>
<div>
<pre><code class="language-java">@Wither(
    value = "withName",      // Required: wither method name
    getter = "getName"       // Default: optic method name
)
</code></pre>
</div>
</div>
<div id="admonition-viaconstructor-parameters" class="admonition admonish-tip" role="note" aria-labelledby="admonition-viaconstructor-parameters-title">
<div class="admonition-title">
<div id="admonition-viaconstructor-parameters-title">
<p>@ViaConstructor Parameters</p>
</div>
<a class="admonition-anchor-link" href="#admonition-viaconstructor-parameters"></a>
</div>
<div>
<pre><code class="language-java">@ViaConstructor(
    parameterOrder = {"x", "y", "z"}  // Effectively required: constructor parameter order
)
</code></pre>
<p><strong>Note:</strong> While <code>parameterOrder</code> has a default empty value in the annotation definition, you must provide it for the processor to generate working code. Omitting it results in a runtime <code>UnsupportedOperationException</code>. Future versions may support auto-detection of constructor parameters.</p>
</div>
</div>
<div id="admonition-throughfield-parameters" class="admonition admonish-tip" role="note" aria-labelledby="admonition-throughfield-parameters-title">
<div class="admonition-title">
<div id="admonition-throughfield-parameters-title">
<p>@ThroughField Parameters</p>
</div>
<a class="admonition-anchor-link" href="#admonition-throughfield-parameters"></a>
</div>
<div>
<pre><code class="language-java">@ThroughField(
    field = "items",                  // Required: name of the container field
    traversal = ""                    // Optional: auto-detected from field type
)
</code></pre>
<p><strong>Auto-detection:</strong> The <code>traversal</code> parameter is automatically determined based on the field's type:</p>
<ul>
<li><code>List&lt;A&gt;</code> (including <code>ArrayList</code>, <code>LinkedList</code>, etc.) → <code>Traversals.forList()</code></li>
<li><code>Set&lt;A&gt;</code> (including <code>HashSet</code>, <code>TreeSet</code>, etc.) → <code>Traversals.forSet()</code></li>
<li><code>Optional&lt;A&gt;</code> → <code>Traversals.forOptional()</code></li>
<li><code>A[]</code> → <code>Traversals.forArray()</code></li>
<li><code>Map&lt;K, V&gt;</code> (including <code>HashMap</code>, <code>TreeMap</code>, etc.) → <code>Traversals.forMapValues()</code></li>
</ul>
</div>
</div>
<hr />
<div id="admonition-key-takeaways" class="admonition admonish-info" role="note" aria-labelledby="admonition-key-takeaways-title">
<div class="admonition-title">
<div id="admonition-key-takeaways-title">
<p>Key Takeaways</p>
</div>
<a class="admonition-anchor-link" href="#admonition-key-takeaways"></a>
</div>
<div>
<ul>
<li><code>@ViaBuilder</code> is your go-to for JOOQ, Lombok, and most immutable types</li>
<li><code>@ThroughField</code> auto-detects traversals for <code>List</code>, <code>Set</code>, <code>Optional</code>, arrays, and <code>Map</code> fields (including subtypes)</li>
<li>JOOQ's <code>Result&lt;R&gt;</code> implements <code>List</code> - use standard traversals directly</li>
<li>Match the copy strategy to the type's API - builder, wither, constructor, or copy+set</li>
<li>Compose optics freely across different strategies - they all produce standard <code>Lens</code> instances</li>
</ul>
</div>
</div>
<hr />
<h2 id="making-your-jooq-integration-even-better"><a class="header" href="#making-your-jooq-integration-even-better">Making Your JOOQ Integration Even Better</a></h2>
<div id="admonition-extending-the-integration" class="admonition admonish-tip" role="note" aria-labelledby="admonition-extending-the-integration-title">
<div class="admonition-title">
<div id="admonition-extending-the-integration-title">
<p>Extending the Integration</p>
</div>
<a class="admonition-anchor-link" href="#admonition-extending-the-integration"></a>
</div>
<div>
<p>Consider these opportunities to enhance your database optics:</p>
<ul>
<li><strong>Generate spec interfaces from JOOQ schema</strong>: Write a build step that generates <code>*Optics</code> interfaces alongside JOOQ's code generation</li>
<li><strong>Batch updates</strong>: Compose traversals for bulk modifications that can be converted back to SQL updates</li>
<li><strong>Audit trails</strong>: Wrap optics with logging to track all field modifications before persistence</li>
<li><strong>Validation pipelines</strong>: Combine with <code>Validated</code> to accumulate all validation errors before database writes</li>
<li><strong>Optimistic locking</strong>: Create optics that automatically handle version field increments</li>
</ul>
</div>
</div>
<hr />
<h2 id="further-reading"><a class="header" href="#further-reading">Further Reading</a></h2>
<p><strong>JOOQ:</strong></p>
<ul>
<li><a href="https://www.jooq.org/">JOOQ Official Site</a> - Type-safe SQL in Java</li>
<li><a href="https://www.jooq.org/doc/latest/manual/code-generation/codegen-pojos/">JOOQ Immutables Integration</a> - Generating immutable POJOs</li>
<li><a href="https://www.jooq.org/doc/latest/manual/sql-execution/fetching/record-vs-pojo/">JOOQ Record Patterns</a> - Records vs POJOs</li>
</ul>
<p><strong>Builder Pattern Libraries:</strong></p>
<ul>
<li><a href="https://projectlombok.org/">Lombok</a> - <code>@Builder</code>, <code>@Value</code>, and more</li>
<li><a href="https://immutables.github.io/">Immutables</a> - Annotation-driven immutable objects</li>
<li><a href="https://github.com/google/auto/tree/main/value">AutoValue</a> - Google's immutable value types</li>
<li><a href="https://protobuf.dev/reference/java/java-generated/">Protocol Buffers</a> - Generated builders for message types</li>
</ul>
<p><strong>Related Higher-Kinded-J Features:</strong></p>
<ul>
<li>Focus DSL Bridging - See <a href="focus_external_bridging.html">next chapter</a></li>
<li>Traversal utilities - Batch operations on collections</li>
<li>Monoid-based aggregation - Combine values across traversals</li>
</ul>
<hr />
<p><strong>Previous:</strong> <a href="optics_spec_interfaces.html">Taming JSON with Jackson</a>
<strong>Next:</strong> <a href="focus_external_bridging.html">Focus DSL with External Libraries</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../optics/optics_spec_interfaces.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../optics/focus_external_bridging.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../optics/optics_spec_interfaces.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../optics/focus_external_bridging.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../version-switcher.js"></script>
        <script src=".././theme/version-switcher.js"></script>
        <script src=".././theme/sidebar-nav-link.js"></script>


    </div>
    </body>
</html>
