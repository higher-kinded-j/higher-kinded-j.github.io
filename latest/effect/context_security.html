<!DOCTYPE HTML>
<html lang="en" class="latte sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>SecurityContext - Higher-Kinded-J: Composable Effects and Advanced Optics for Java</title>


        <!-- Custom HTML head -->


            <meta name="description" content="The most comprehensive functional programming library for Java. Unify error handling, optional values, and immutable data navigation with the Effect Path API and Focus DSL. Features advanced optics with code generation for Java records, filtered traversals, indexed optics, and seamless Spring Boot integration.">


        <meta name="keywords" content="Higher-Kinded Types, Higher-Kinded-J, HKT, Java, Optics, Lens, Prism, Traversal, Iso, Affine, Focus DSL, Effect Path API, Functional Programming, Monad, Functor, Applicative, EitherPath, MaybePath, TryPath, ValidationPath, Java Records, Sealed Interface, Error Handling, Immutable Data">
        
        <meta property="og:title" content="SecurityContext - Higher-Kinded-J: Composable Effects and Advanced Optics for Java">
            <meta property="og:description" content="The most comprehensive functional programming library for Java. Unify error handling, optional values, and immutable data navigation with the Effect Path API and Focus DSL. Features advanced optics with code generation for Java records, filtered traversals, indexed optics, and seamless Spring Boot integration.">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://higher-kinded-j.github.io/">
        <meta property="og:image" content="https://higher-kinded-j.github.io/preview.png">
        <meta property="og:image:width" content="1200">
        <meta property="og:image:height" content="630">
        <meta property="og:site_name" content="Higher-Kinded-J Documentation">
        <meta property="og:locale" content="en_GB">
        
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="SecurityContext - Higher-Kinded-J: Composable Effects and Advanced Optics for Java">
        <meta name="twitter:description" content="Unifying Composable Effects and Advanced Optics for Java. Effect Path API, Focus DSL, and the most comprehensive optics implementation in the Java ecosystem.">
        <meta name="twitter:image" content="https://higher-kinded-j.github.io/preview.png">
        <meta name="twitter:image:alt" content="Higher-Kinded-J: Composable Effects and Advanced Optics for Java">
        <meta name="description" content="The most comprehensive functional programming library for Java. Unify error handling, optional values, and immutable data navigation with the Effect Path API and Focus DSL. Features advanced optics with code generation for Java records, filtered traversals, indexed optics, and seamless Spring Boot integration.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">
        <meta name="google-site-verification" content="X-xsiAq2cKMLOzh9dexUrX8Onx2h_YMUFgp5lHHUwSg" />
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././mdbook-admonish.css">
        <link rel="stylesheet" href=".././theme/catppuccin.css">
        <link rel="stylesheet" href=".././theme/catppuccin-admonish.css">
        <link rel="stylesheet" href=".././theme/catppuccin-alerts.css">
        <link rel="stylesheet" href=".././theme/additional-hkj.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "latte";
            const default_dark_theme = "macchiato";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('latte')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="latte">Latte</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="frappe">Frappé</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="macchiato">Macchiato</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mocha">Mocha</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        <div class="version-selector-container">
                            <select id="version-selector" class="version-selector" aria-label="Select documentation version" title="Select documentation version">
                                <option value="">Loading versions...</option>
                            </select>
                        </div>
                    </div>

                    <h1 class="menu-title">Higher-Kinded-J: Composable Effects and Advanced Optics for Java</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/higher-kinded-j/higher-kinded-j" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/higher-kinded-j/higher-kinded-j/edit/main/hkj-book/src/effect/context_security.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="securitycontext-authentication-and-authorisation-patterns"><a class="header" href="#securitycontext-authentication-and-authorisation-patterns">SecurityContext: Authentication and Authorisation Patterns</a></h1>
<blockquote>
<p><em>"The thing about a shark, it's got lifeless eyes, black eyes, like a doll's eyes. When it comes at you it doesn't seem to be livin'... until he bites you."</em></p>
<p>-- Quint, <em>Jaws</em></p>
</blockquote>
<p>The unauthorised request looks just like any other. Same headers, same format, same endpoint. It doesn't seem malicious, until it's accessing data it shouldn't, performing actions reserved for administrators, or exfiltrating information that will cost you millions. By the time you notice, the damage is done.</p>
<blockquote>
<p><em>"You think when you wake up in the mornin yesterday don't count. But yesterday is all that does count."</em></p>
<p>-- Cormac McCarthy, <em>No Country for Old Men</em></p>
</blockquote>
<p>Yesterday's unvalidated request is today's security incident. Yesterday's missing role check is today's data breach. Security isn't a feature you add later; it's context that must flow through every layer of your application, verified at every boundary, never assumed.</p>
<p><code>SecurityContext</code> provides patterns for propagating authentication state and performing authorisation checks within the scoped context system, ensuring security decisions flow correctly through virtual thread boundaries.</p>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>Propagating authentication state through concurrent operations</li>
<li>Implementing role-based access control with <code>hasRole</code> and <code>requireRole</code></li>
<li>Guarding operations with authorisation checks</li>
<li>Handling unauthenticated and anonymous contexts safely</li>
<li>Propagating authentication tokens to downstream services</li>
<li>Combining security context with request context</li>
</ul>
</div>
</div>
<div id="admonition-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-example-code-title">
<div class="admonition-title">
<div id="admonition-example-code-title">
<p>Example Code</p>
</div>
<a class="admonition-anchor-link" href="#admonition-example-code"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/context/SecurityContextExample.java">SecurityContextExample.java</a> -- Complete security pattern examples</li>
</ul>
</div>
</div>
<hr />
<h2 id="the-securitycontext-utility-class"><a class="header" href="#the-securitycontext-utility-class">The SecurityContext Utility Class</a></h2>
<p><code>SecurityContext</code> provides pre-defined <code>ScopedValue</code> instances for authentication and authorisation:</p>
<pre><code class="language-java">public final class SecurityContext {
    private SecurityContext() {}  // Utility class -- no instantiation

    /**
     * The authenticated principal (user identity).
     * Null if the request is anonymous/unauthenticated.
     * Unbound ScopedValue indicates a configuration error.
     */
    public static final ScopedValue&lt;Principal&gt; PRINCIPAL = ScopedValue.newInstance();

    /**
     * Set of roles granted to the current user.
     * Empty set for anonymous users, never null.
     */
    public static final ScopedValue&lt;Set&lt;String&gt;&gt; ROLES = ScopedValue.newInstance();

    /**
     * Set of fine-grained permissions granted to the current user.
     * For systems that need more granularity than roles.
     */
    public static final ScopedValue&lt;Set&lt;String&gt;&gt; PERMISSIONS = ScopedValue.newInstance();

    /**
     * Authentication token for propagation to downstream services.
     * Typically a JWT or OAuth token.
     */
    public static final ScopedValue&lt;String&gt; AUTH_TOKEN = ScopedValue.newInstance();

    /**
     * Session identifier for audit and tracking.
     */
    public static final ScopedValue&lt;String&gt; SESSION_ID = ScopedValue.newInstance();
}
</code></pre>
<div id="admonition-security-principle-defence-in-depth" class="admonition admonish-warning" role="note" aria-labelledby="admonition-security-principle-defence-in-depth-title">
<div class="admonition-title">
<div id="admonition-security-principle-defence-in-depth-title">
<p>Security Principle: Defence in Depth</p>
</div>
<a class="admonition-anchor-link" href="#admonition-security-principle-defence-in-depth"></a>
</div>
<div>
<p>Never rely solely on context propagation for security. Always:</p>
<ol>
<li>Validate authentication at system boundaries (API gateway, filters)</li>
<li>Check authorisation before sensitive operations</li>
<li>Log security-relevant events with full context</li>
<li>Assume any layer could be bypassed and verify at each level</li>
</ol>
</div>
</div>
<hr />
<h2 id="principal-user-identity"><a class="header" href="#principal-user-identity">Principal: User Identity</a></h2>
<p>The <code>PRINCIPAL</code> represents the authenticated user. It can be:</p>
<ul>
<li><strong>Non-null</strong>: An authenticated user</li>
<li><strong>Null</strong>: An anonymous/unauthenticated user</li>
<li><strong>Unbound</strong>: A configuration error (security context not established)</li>
</ul>
<h3 id="defining-a-principal"><a class="header" href="#defining-a-principal">Defining a Principal</a></h3>
<pre><code class="language-java">/**
 * Simple principal implementation.
 * Extend with additional claims as needed.
 */
public record UserPrincipal(
    String id,
    String username,
    String email,
    Instant authenticatedAt
) implements Principal {

    @Override
    public String getName() {
        return username;
    }
}
</code></pre>
<h3 id="establishing-security-context"><a class="header" href="#establishing-security-context">Establishing Security Context</a></h3>
<p>At your authentication boundary (filter, interceptor):</p>
<pre><code class="language-java">public class SecurityFilter implements Filter {

    private final AuthenticationService authService;

    @Override
    public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain)
            throws IOException, ServletException {

        HttpServletRequest request = (HttpServletRequest) req;

        // Attempt authentication
        AuthResult authResult = authService.authenticate(request);

        // Establish security context
        ScopedValue.where(SecurityContext.PRINCIPAL, authResult.principal())
            .where(SecurityContext.ROLES, authResult.roles())
            .where(SecurityContext.PERMISSIONS, authResult.permissions())
            .where(SecurityContext.AUTH_TOKEN, authResult.token())
            .where(SecurityContext.SESSION_ID, authResult.sessionId())
            .run(() -&gt; {
                try {
                    chain.doFilter(req, res);
                } catch (IOException | ServletException e) {
                    throw new RuntimeException(e);
                }
            });
    }
}

record AuthResult(
    Principal principal,      // null if anonymous
    Set&lt;String&gt; roles,        // empty if anonymous
    Set&lt;String&gt; permissions,  // empty if anonymous
    String token,             // null if anonymous
    String sessionId          // always present for tracking
) {
    static AuthResult anonymous(String sessionId) {
        return new AuthResult(null, Set.of(), Set.of(), null, sessionId);
    }
}
</code></pre>
<hr />
<h2 id="authentication-checks"><a class="header" href="#authentication-checks">Authentication Checks</a></h2>
<h3 id="isauthenticated-query-authentication-state"><a class="header" href="#isauthenticated-query-authentication-state">isAuthenticated: Query Authentication State</a></h3>
<pre><code class="language-java">public final class SecurityContext {
    // ... ScopedValue declarations ...

    /**
     * Check if the current context has an authenticated principal.
     * Returns false for anonymous users (null principal).
     *
     * @return Context that evaluates to true if authenticated
     */
    public static Context&lt;Principal, Boolean&gt; isAuthenticated() {
        return Context.asks(PRINCIPAL, principal -&gt; principal != null);
    }
}

// Usage
public VTask&lt;Response&gt; handleRequest(Request request) {
    boolean authenticated = SecurityContext.isAuthenticated()
        .toVTask()
        .runSafe()
        .getOrElse(false);

    if (authenticated) {
        return handleAuthenticatedRequest(request);
    } else {
        return handleAnonymousRequest(request);
    }
}
</code></pre>
<h3 id="requireauthenticated-enforce-authentication"><a class="header" href="#requireauthenticated-enforce-authentication">requireAuthenticated: Enforce Authentication</a></h3>
<pre><code class="language-java">public final class SecurityContext {
    // ... other methods ...

    /**
     * Require authentication, failing if the user is anonymous.
     *
     * @return Context containing the Principal, or failing with UnauthenticatedException
     */
    public static Context&lt;Principal, Principal&gt; requireAuthenticated() {
        return Context.ask(PRINCIPAL).flatMap(principal -&gt;
            principal != null
                ? Context.succeed(principal)
                : Context.fail(new UnauthenticatedException("Authentication required")));
    }
}

// Usage -- protect an endpoint
public VTask&lt;UserProfile&gt; getMyProfile() {
    return SecurityContext.requireAuthenticated()
        .map(principal -&gt; profileService.getProfile(principal.getName()))
        .toVTask();
}
</code></pre>
<h3 id="principalifpresent-optional-access"><a class="header" href="#principalifpresent-optional-access">principalIfPresent: Optional Access</a></h3>
<pre><code class="language-java">public final class SecurityContext {
    // ... other methods ...

    /**
     * Get the principal if authenticated, or empty Maybe if anonymous.
     * Useful for features that work differently for authenticated vs anonymous users.
     *
     * @return Context containing Maybe of the Principal
     */
    public static Context&lt;Principal, Maybe&lt;Principal&gt;&gt; principalIfPresent() {
        return Context.asks(PRINCIPAL, principal -&gt;
            principal != null ? Maybe.just(principal) : Maybe.nothing());
    }
}

// Usage -- personalised vs generic greeting
public VTask&lt;String&gt; getGreeting() {
    return SecurityContext.principalIfPresent()
        .map(maybePrincipal -&gt; maybePrincipal
            .map(p -&gt; "Welcome back, " + p.getName() + "!")
            .orElse("Welcome, guest!"))
        .toVTask();
}
</code></pre>
<hr />
<h2 id="role-based-access-control"><a class="header" href="#role-based-access-control">Role-Based Access Control</a></h2>
<h3 id="hasrole-query-role-membership"><a class="header" href="#hasrole-query-role-membership">hasRole: Query Role Membership</a></h3>
<pre><code class="language-java">public final class SecurityContext {
    // ... other methods ...

    /**
     * Check if the current user has a specific role.
     * Returns false if user is anonymous or doesn't have the role.
     *
     * @param role The role to check
     * @return Context that evaluates to true if user has the role
     */
    public static Context&lt;Set&lt;String&gt;, Boolean&gt; hasRole(String role) {
        Objects.requireNonNull(role, "role cannot be null");
        return Context.asks(ROLES, roles -&gt; roles.contains(role));
    }

    /**
     * Check if the current user has any of the specified roles.
     *
     * @param roles The roles to check (at least one must match)
     * @return Context that evaluates to true if user has any of the roles
     */
    public static Context&lt;Set&lt;String&gt;, Boolean&gt; hasAnyRole(String... roles) {
        Objects.requireNonNull(roles, "roles cannot be null");
        Set&lt;String&gt; required = Set.of(roles);
        return Context.asks(ROLES, userRoles -&gt;
            userRoles.stream().anyMatch(required::contains));
    }

    /**
     * Check if the current user has all of the specified roles.
     *
     * @param roles The roles to check (all must match)
     * @return Context that evaluates to true if user has all the roles
     */
    public static Context&lt;Set&lt;String&gt;, Boolean&gt; hasAllRoles(String... roles) {
        Objects.requireNonNull(roles, "roles cannot be null");
        Set&lt;String&gt; required = Set.of(roles);
        return Context.asks(ROLES, userRoles -&gt; userRoles.containsAll(required));
    }
}
</code></pre>
<h3 id="using-role-checks-for-conditional-logic"><a class="header" href="#using-role-checks-for-conditional-logic">Using Role Checks for Conditional Logic</a></h3>
<pre><code class="language-java">public VTask&lt;DashboardData&gt; getDashboard() {
    return SecurityContext.hasRole("ADMIN")
        .flatMap(isAdmin -&gt; isAdmin
            ? Context.succeed(getAdminDashboard())
            : Context.succeed(getUserDashboard()))
        .toVTask();
}

public VTask&lt;List&lt;MenuItem&gt;&gt; getMenuItems() {
    return SecurityContext.hasAnyRole("ADMIN", "MANAGER")
        .map(canManage -&gt; {
            List&lt;MenuItem&gt; items = new ArrayList&lt;&gt;();
            items.add(MenuItem.HOME);
            items.add(MenuItem.PROFILE);

            if (canManage) {
                items.add(MenuItem.REPORTS);
                items.add(MenuItem.SETTINGS);
            }

            return items;
        })
        .toVTask();
}
</code></pre>
<h3 id="requirerole-enforce-role-membership"><a class="header" href="#requirerole-enforce-role-membership">requireRole: Enforce Role Membership</a></h3>
<pre><code class="language-java">public final class SecurityContext {
    // ... other methods ...

    /**
     * Require a specific role, failing if the user doesn't have it.
     *
     * @param role The required role
     * @return Context containing Unit on success, or failing with UnauthorisedException
     */
    public static Context&lt;Set&lt;String&gt;, Unit&gt; requireRole(String role) {
        Objects.requireNonNull(role, "role cannot be null");
        return hasRole(role).flatMap(has -&gt; has
            ? Context.succeed(Unit.INSTANCE)
            : Context.fail(new UnauthorisedException("Role required: " + role)));
    }

    /**
     * Require any of the specified roles.
     *
     * @param roles The roles (at least one required)
     * @return Context containing Unit on success, or failing with UnauthorisedException
     */
    public static Context&lt;Set&lt;String&gt;, Unit&gt; requireAnyRole(String... roles) {
        Objects.requireNonNull(roles, "roles cannot be null");
        return hasAnyRole(roles).flatMap(has -&gt; has
            ? Context.succeed(Unit.INSTANCE)
            : Context.fail(new UnauthorisedException(
                "One of these roles required: " + String.join(", ", roles))));
    }

    /**
     * Require all of the specified roles.
     *
     * @param roles The roles (all required)
     * @return Context containing Unit on success, or failing with UnauthorisedException
     */
    public static Context&lt;Set&lt;String&gt;, Unit&gt; requireAllRoles(String... roles) {
        Objects.requireNonNull(roles, "roles cannot be null");
        return hasAllRoles(roles).flatMap(has -&gt; has
            ? Context.succeed(Unit.INSTANCE)
            : Context.fail(new UnauthorisedException(
                "All of these roles required: " + String.join(", ", roles))));
    }
}
</code></pre>
<h3 id="using-requirerole-as-a-guard"><a class="header" href="#using-requirerole-as-a-guard">Using requireRole as a Guard</a></h3>
<pre><code class="language-java">// Pattern: Guard clause at the start of a method
public VTask&lt;Report&gt; generateFinancialReport(ReportRequest request) {
    return SecurityContext.requireRole("FINANCE")
        .flatMap(_ -&gt; Context.succeed(reportService.generate(request)))
        .toVTask();
}

// Pattern: Guard with detailed error
public VTask&lt;Void&gt; deleteUser(String userId) {
    return SecurityContext.requireRole("ADMIN")
        .mapError(e -&gt; new SecurityException(
            "Cannot delete user: " + e.getMessage()))
        .flatMap(_ -&gt; Context.succeed(userService.delete(userId)))
        .toVTask();
}

// Pattern: Multiple guards combined
public VTask&lt;AuditLog&gt; viewAuditLog(String resourceId) {
    return SecurityContext.requireAuthenticated()
        .flatMap(_ -&gt; SecurityContext.requireAnyRole("ADMIN", "AUDITOR"))
        .flatMap(_ -&gt; Context.succeed(auditService.getLog(resourceId)))
        .toVTask();
}
</code></pre>
<hr />
<h2 id="permission-based-access-control"><a class="header" href="#permission-based-access-control">Permission-Based Access Control</a></h2>
<p>For systems needing finer granularity than roles:</p>
<pre><code class="language-java">public final class SecurityContext {
    // ... other methods ...

    /**
     * Check if the current user has a specific permission.
     */
    public static Context&lt;Set&lt;String&gt;, Boolean&gt; hasPermission(String permission) {
        Objects.requireNonNull(permission, "permission cannot be null");
        return Context.asks(PERMISSIONS, perms -&gt; perms.contains(permission));
    }

    /**
     * Require a specific permission.
     */
    public static Context&lt;Set&lt;String&gt;, Unit&gt; requirePermission(String permission) {
        Objects.requireNonNull(permission, "permission cannot be null");
        return hasPermission(permission).flatMap(has -&gt; has
            ? Context.succeed(Unit.INSTANCE)
            : Context.fail(new UnauthorisedException(
                "Permission required: " + permission)));
    }
}

// Usage with fine-grained permissions
public VTask&lt;Document&gt; readDocument(String documentId) {
    return SecurityContext.requirePermission("document:read")
        .flatMap(_ -&gt; Context.succeed(documentService.get(documentId)))
        .toVTask();
}

public VTask&lt;Void&gt; updateDocument(String documentId, DocumentUpdate update) {
    return SecurityContext.requirePermission("document:write")
        .flatMap(_ -&gt; Context.succeed(documentService.update(documentId, update)))
        .toVTask();
}

public VTask&lt;Void&gt; deleteDocument(String documentId) {
    return SecurityContext.requirePermission("document:delete")
        .flatMap(_ -&gt; Context.succeed(documentService.delete(documentId)))
        .toVTask();
}
</code></pre>
<hr />
<h2 id="resource-level-authorisation"><a class="header" href="#resource-level-authorisation">Resource-Level Authorisation</a></h2>
<p>Beyond role/permission checks, you often need to verify access to specific resources:</p>
<pre><code class="language-java">public class DocumentAuthorisation {

    /**
     * Check if the current user can access a specific document.
     */
    public Context&lt;Principal, Boolean&gt; canAccess(Document document) {
        return SecurityContext.principalIfPresent()
            .map(maybePrincipal -&gt; maybePrincipal
                .map(principal -&gt; isOwnerOrShared(principal, document))
                .orElse(document.isPublic()));
    }

    /**
     * Require access to a specific document.
     */
    public Context&lt;Principal, Document&gt; requireAccess(Document document) {
        return canAccess(document).flatMap(allowed -&gt; allowed
            ? Context.succeed(document)
            : Context.fail(new ForbiddenException(
                "Access denied to document: " + document.id())));
    }

    private boolean isOwnerOrShared(Principal principal, Document document) {
        return document.ownerId().equals(principal.getName())
            || document.sharedWith().contains(principal.getName());
    }
}

// Usage
public VTask&lt;Document&gt; getDocument(String documentId) {
    return VTask.delay(() -&gt; documentRepository.findById(documentId))
        .flatMap(document -&gt; documentAuth.requireAccess(document).toVTask());
}
</code></pre>
<hr />
<h2 id="token-propagation-to-downstream-services"><a class="header" href="#token-propagation-to-downstream-services">Token Propagation to Downstream Services</a></h2>
<p>When calling external services, propagate authentication tokens:</p>
<pre><code class="language-java">public class AuthenticatedHttpClient {
    private final HttpClient httpClient;

    /**
     * Make an authenticated HTTP request.
     * Automatically includes the auth token from security context.
     */
    public &lt;T&gt; VTask&lt;T&gt; get(String url, Class&lt;T&gt; responseType) {
        return VTask.delay(() -&gt; {
            HttpRequest.Builder builder = HttpRequest.newBuilder()
                .uri(URI.create(url))
                .GET();

            // Propagate auth token if present
            if (SecurityContext.AUTH_TOKEN.isBound()) {
                String token = SecurityContext.AUTH_TOKEN.get();
                if (token != null) {
                    builder.header("Authorization", "Bearer " + token);
                }
            }

            // Also propagate trace context
            if (RequestContext.TRACE_ID.isBound()) {
                builder.header("X-Trace-ID", RequestContext.TRACE_ID.get());
            }

            HttpResponse&lt;String&gt; response = httpClient.send(
                builder.build(),
                HttpResponse.BodyHandlers.ofString());

            return parseResponse(response, responseType);
        });
    }

    /**
     * Make a request with explicit token override.
     * Useful for service-to-service calls with different credentials.
     */
    public &lt;T&gt; VTask&lt;T&gt; getWithToken(String url, String token, Class&lt;T&gt; responseType) {
        return ScopedValue
            .where(SecurityContext.AUTH_TOKEN, token)
            .call(() -&gt; get(url, responseType).run());
    }
}
</code></pre>
<hr />
<h2 id="security-context-in-concurrent-operations"><a class="header" href="#security-context-in-concurrent-operations">Security Context in Concurrent Operations</a></h2>
<p>Security context propagates to forked virtual threads:</p>
<pre><code class="language-java">public VTask&lt;OrderValidation&gt; validateOrder(Order order) {
    // All forked tasks inherit security context
    return Scope.&lt;ValidationResult&gt;allSucceed()
        .fork(() -&gt; {
            // Has access to PRINCIPAL, ROLES, etc.
            return validateInventory(order);
        })
        .fork(() -&gt; {
            // Also has security context
            return validatePaymentMethod(order);
        })
        .fork(() -&gt; {
            // Security context available here too
            return validateShippingAddress(order);
        })
        .join(OrderValidation::combine)
        .run();
}

private VTask&lt;ValidationResult&gt; validatePaymentMethod(Order order) {
    return VTask.delay(() -&gt; {
        // Can check permissions for payment validation
        Principal principal = SecurityContext.PRINCIPAL.get();
        if (principal == null) {
            return ValidationResult.failure("Authentication required for payment");
        }

        // Verify the payment method belongs to the user
        if (!paymentService.belongsTo(order.paymentMethodId(), principal.getName())) {
            return ValidationResult.failure("Payment method does not belong to user");
        }

        return ValidationResult.success();
    });
}
</code></pre>
<pre><code>┌──────────────────────────────────────────────────────────────────────┐
│              Security Context Propagation in Scope                   │
│                                                                      │
│   Authentication Filter                                              │
│   ┌──────────────────────────────────────────────────────────────┐   │
│   │ ScopedValue.where(PRINCIPAL, user)                           │   │
│   │            .where(ROLES, Set.of("USER", "CUSTOMER"))         │   │
│   │            .where(AUTH_TOKEN, "jwt-token-xyz")               │   │
│   └──────────────────────┬───────────────────────────────────────┘   │
│                          │                                           │
│                          ▼                                           │
│   Order Service                                                      │
│   ┌──────────────────────────────────────────────────────────────┐   │
│   │ Scope.allSucceed()                                           │   │
│   │   │                                                          │   │
│   │   ├── fork(validateInventory)                                │   │
│   │   │      PRINCIPAL = user ✓                                  │   │
│   │   │      ROLES = ["USER","CUSTOMER"] ✓                       │   │
│   │   │                                                          │   │
│   │   ├── fork(validatePayment)                                  │   │
│   │   │      PRINCIPAL = user ✓                                  │   │
│   │   │      AUTH_TOKEN = "jwt-token-xyz" ✓                      │   │
│   │   │                                                          │   │
│   │   └── fork(validateShipping)                                 │   │
│   │          PRINCIPAL = user ✓                                  │   │
│   │          Can call hasRole("CUSTOMER") ✓                      │   │
│   │                                                              │   │
│   └──────────────────────────────────────────────────────────────┘   │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
</code></pre>
<hr />
<h2 id="audit-logging-with-security-context"><a class="header" href="#audit-logging-with-security-context">Audit Logging with Security Context</a></h2>
<p>Log security-relevant events with full context:</p>
<pre><code class="language-java">public class SecurityAuditLogger {
    private static final ContextLogger log = new ContextLogger(SecurityAuditLogger.class);

    public void logAccess(String resource, String action) {
        String principalName = SecurityContext.PRINCIPAL.isBound()
            &amp;&amp; SecurityContext.PRINCIPAL.get() != null
            ? SecurityContext.PRINCIPAL.get().getName()
            : "anonymous";

        String sessionId = SecurityContext.SESSION_ID.isBound()
            ? SecurityContext.SESSION_ID.get()
            : "no-session";

        log.info("AUDIT: user={} session={} action={} resource={}",
            principalName, sessionId, action, resource);
    }

    public void logAccessDenied(String resource, String action, String reason) {
        String principalName = SecurityContext.PRINCIPAL.isBound()
            &amp;&amp; SecurityContext.PRINCIPAL.get() != null
            ? SecurityContext.PRINCIPAL.get().getName()
            : "anonymous";

        log.warn("AUDIT_DENIED: user={} action={} resource={} reason={}",
            principalName, action, resource, reason);
    }

    public void logAuthenticationSuccess(Principal principal) {
        log.info("AUTH_SUCCESS: user={} at={}",
            principal.getName(),
            Instant.now());
    }

    public void logAuthenticationFailure(String attemptedUsername, String reason) {
        log.warn("AUTH_FAILURE: attempted_user={} reason={} at={}",
            attemptedUsername, reason, Instant.now());
    }
}
</code></pre>
<hr />
<h2 id="exception-types"><a class="header" href="#exception-types">Exception Types</a></h2>
<p>Define clear exception types for security failures:</p>
<pre><code class="language-java">/**
 * Base exception for all security-related failures.
 */
public sealed class SecurityException extends RuntimeException
    permits UnauthenticatedException, UnauthorisedException, ForbiddenException {

    public SecurityException(String message) {
        super(message);
    }

    public SecurityException(String message, Throwable cause) {
        super(message, cause);
    }
}

/**
 * Thrown when authentication is required but not present.
 * Maps to HTTP 401 Unauthorized.
 */
public final class UnauthenticatedException extends SecurityException {
    public UnauthenticatedException(String message) {
        super(message);
    }
}

/**
 * Thrown when the user lacks required roles or permissions.
 * Maps to HTTP 403 Forbidden.
 */
public final class UnauthorisedException extends SecurityException {
    public UnauthorisedException(String message) {
        super(message);
    }
}

/**
 * Thrown when access to a specific resource is denied.
 * Maps to HTTP 403 Forbidden.
 */
public final class ForbiddenException extends SecurityException {
    public ForbiddenException(String message) {
        super(message);
    }
}
</code></pre>
<hr />
<h2 id="combining-security-and-request-context"><a class="header" href="#combining-security-and-request-context">Combining Security and Request Context</a></h2>
<p>Security context works alongside request context:</p>
<pre><code class="language-java">public class SecureRequestHandler {
    private static final ContextLogger log = new ContextLogger(SecureRequestHandler.class);
    private final SecurityAuditLogger audit = new SecurityAuditLogger();

    public Response handle(HttpRequest request) {
        // Establish both contexts together
        AuthResult auth = authenticate(request);

        return ScopedValue
            // Request context
            .where(RequestContext.TRACE_ID, request.traceId())
            .where(RequestContext.LOCALE, request.locale())
            .where(RequestContext.REQUEST_TIME, Instant.now())
            // Security context
            .where(SecurityContext.PRINCIPAL, auth.principal())
            .where(SecurityContext.ROLES, auth.roles())
            .where(SecurityContext.AUTH_TOKEN, auth.token())
            .where(SecurityContext.SESSION_ID, auth.sessionId())
            .call(() -&gt; {
                log.info("Handling request");  // Has trace ID
                audit.logAccess(request.path(), request.method());  // Has principal

                try {
                    return processRequest(request);
                } catch (SecurityException e) {
                    audit.logAccessDenied(request.path(), request.method(), e.getMessage());
                    return mapSecurityException(e);
                }
            });
    }

    private Response mapSecurityException(SecurityException e) {
        return switch (e) {
            case UnauthenticatedException _ -&gt; Response.unauthorized();
            case UnauthorisedException _ -&gt; Response.forbidden(e.getMessage());
            case ForbiddenException _ -&gt; Response.forbidden(e.getMessage());
        };
    }
}
</code></pre>
<hr />
<h2 id="testing-security-patterns"><a class="header" href="#testing-security-patterns">Testing Security Patterns</a></h2>
<h3 id="testing-role-checks"><a class="header" href="#testing-role-checks">Testing Role Checks</a></h3>
<pre><code class="language-java">@Test
void shouldAllowAdminAccess() {
    Principal admin = new UserPrincipal("1", "admin", "admin@example.com", Instant.now());

    Boolean result = ScopedValue
        .where(SecurityContext.PRINCIPAL, admin)
        .where(SecurityContext.ROLES, Set.of("ADMIN", "USER"))
        .call(() -&gt; SecurityContext.hasRole("ADMIN").run());

    assertThat(result).isTrue();
}

@Test
void shouldDenyAccessWithoutRole() {
    Principal user = new UserPrincipal("2", "user", "user@example.com", Instant.now());

    Boolean result = ScopedValue
        .where(SecurityContext.PRINCIPAL, user)
        .where(SecurityContext.ROLES, Set.of("USER"))
        .call(() -&gt; SecurityContext.hasRole("ADMIN").run());

    assertThat(result).isFalse();
}

@Test
void shouldThrowWhenRoleRequired() {
    Principal user = new UserPrincipal("2", "user", "user@example.com", Instant.now());

    assertThatThrownBy(() -&gt; ScopedValue
        .where(SecurityContext.PRINCIPAL, user)
        .where(SecurityContext.ROLES, Set.of("USER"))
        .call(() -&gt; SecurityContext.requireRole("ADMIN").run()))
        .isInstanceOf(UnauthorisedException.class)
        .hasMessageContaining("ADMIN");
}
</code></pre>
<h3 id="testing-anonymous-access"><a class="header" href="#testing-anonymous-access">Testing Anonymous Access</a></h3>
<pre><code class="language-java">@Test
void shouldHandleAnonymousUser() {
    Boolean authenticated = ScopedValue
        .where(SecurityContext.PRINCIPAL, (Principal) null)
        .where(SecurityContext.ROLES, Set.of())
        .call(() -&gt; SecurityContext.isAuthenticated().run());

    assertThat(authenticated).isFalse();
}

@Test
void shouldReturnEmptyMaybeForAnonymous() {
    Maybe&lt;Principal&gt; result = ScopedValue
        .where(SecurityContext.PRINCIPAL, (Principal) null)
        .call(() -&gt; SecurityContext.principalIfPresent().run());

    assertThat(result.isNothing()).isTrue();
}
</code></pre>
<hr />
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Returns</th><th>Purpose</th></tr></thead><tbody>
<tr><td><code>isAuthenticated()</code></td><td><code>Context&lt;Principal, Boolean&gt;</code></td><td>Check if user is authenticated</td></tr>
<tr><td><code>requireAuthenticated()</code></td><td><code>Context&lt;Principal, Principal&gt;</code></td><td>Require authentication or fail</td></tr>
<tr><td><code>principalIfPresent()</code></td><td><code>Context&lt;Principal, Maybe&lt;Principal&gt;&gt;</code></td><td>Get principal optionally</td></tr>
<tr><td><code>hasRole(role)</code></td><td><code>Context&lt;Set&lt;String&gt;, Boolean&gt;</code></td><td>Check role membership</td></tr>
<tr><td><code>hasAnyRole(roles...)</code></td><td><code>Context&lt;Set&lt;String&gt;, Boolean&gt;</code></td><td>Check any role matches</td></tr>
<tr><td><code>hasAllRoles(roles...)</code></td><td><code>Context&lt;Set&lt;String&gt;, Boolean&gt;</code></td><td>Check all roles match</td></tr>
<tr><td><code>requireRole(role)</code></td><td><code>Context&lt;Set&lt;String&gt;, Unit&gt;</code></td><td>Require role or fail</td></tr>
<tr><td><code>requireAnyRole(roles...)</code></td><td><code>Context&lt;Set&lt;String&gt;, Unit&gt;</code></td><td>Require any role or fail</td></tr>
<tr><td><code>requireAllRoles(roles...)</code></td><td><code>Context&lt;Set&lt;String&gt;, Unit&gt;</code></td><td>Require all roles or fail</td></tr>
<tr><td><code>hasPermission(perm)</code></td><td><code>Context&lt;Set&lt;String&gt;, Boolean&gt;</code></td><td>Check permission</td></tr>
<tr><td><code>requirePermission(perm)</code></td><td><code>Context&lt;Set&lt;String&gt;, Unit&gt;</code></td><td>Require permission or fail</td></tr>
</tbody></table>
</div><div id="admonition-hands-on-learning" class="admonition admonish-info" role="note" aria-labelledby="admonition-hands-on-learning-title">
<div class="admonition-title">
<div id="admonition-hands-on-learning-title">
<p>Hands-On Learning</p>
</div>
<a class="admonition-anchor-link" href="#admonition-hands-on-learning"></a>
</div>
<div>
<p>Practice security patterns in <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/test/java/org/higherkindedj/tutorial/context/Tutorial04_SecurityPatterns.java">Tutorial 04: Security Patterns</a> (6 exercises, ~25 minutes).</p>
</div>
</div>
<div id="admonition-see-also" class="admonition admonish-tip" role="note" aria-labelledby="admonition-see-also-title">
<div class="admonition-title">
<div id="admonition-see-also-title">
<p>See Also</p>
</div>
<a class="admonition-anchor-link" href="#admonition-see-also"></a>
</div>
<div>
<ul>
<li><a href="../monads/context_scoped.html">Context Effect</a> -- Core Context documentation</li>
<li><a href="context_request.html">RequestContext Patterns</a> -- Request tracing and metadata</li>
<li><a href="context_vs_config.html">Context vs ConfigContext</a> -- When to use each</li>
<li><a href="../monads/vtask_monad.html">VTask</a> -- Virtual thread effect type</li>
</ul>
</div>
</div>
<hr />
<p><strong>Previous:</strong> <a href="context_request.html">RequestContext Patterns</a>
<strong>Next:</strong> <a href="context_vs_config.html">Context vs ConfigContext</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../effect/context_request.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../effect/context_vs_config.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../effect/context_request.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../effect/context_vs_config.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../version-switcher.js"></script>
        <script src=".././theme/version-switcher.js"></script>
        <script src=".././theme/sidebar-nav-link.js"></script>


    </div>
    </body>
</html>
