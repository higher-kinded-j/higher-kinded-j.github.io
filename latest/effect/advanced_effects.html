<!DOCTYPE HTML>
<html lang="en" class="latte sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Advanced Effects - Higher-Kinded-J: Composable Effects and Advanced Optics for Java</title>


        <!-- Custom HTML head -->


            <meta name="description" content="The most comprehensive functional programming library for Java. Unify error handling, optional values, and immutable data navigation with the Effect Path API and Focus DSL. Features advanced optics with code generation for Java records, filtered traversals, indexed optics, and seamless Spring Boot integration.">


        <meta name="keywords" content="Higher-Kinded Types, Higher-Kinded-J, HKT, Java, Optics, Lens, Prism, Traversal, Iso, Affine, Focus DSL, Effect Path API, Functional Programming, Monad, Functor, Applicative, EitherPath, MaybePath, TryPath, ValidationPath, Java Records, Sealed Interface, Error Handling, Immutable Data">
        
        <meta property="og:title" content="Advanced Effects - Higher-Kinded-J: Composable Effects and Advanced Optics for Java">
            <meta property="og:description" content="The most comprehensive functional programming library for Java. Unify error handling, optional values, and immutable data navigation with the Effect Path API and Focus DSL. Features advanced optics with code generation for Java records, filtered traversals, indexed optics, and seamless Spring Boot integration.">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://higher-kinded-j.github.io/">
        <meta property="og:image" content="https://higher-kinded-j.github.io/preview.png">
        <meta property="og:image:width" content="1200">
        <meta property="og:image:height" content="630">
        <meta property="og:site_name" content="Higher-Kinded-J Documentation">
        <meta property="og:locale" content="en_GB">
        
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="Advanced Effects - Higher-Kinded-J: Composable Effects and Advanced Optics for Java">
        <meta name="twitter:description" content="Unifying Composable Effects and Advanced Optics for Java. Effect Path API, Focus DSL, and the most comprehensive optics implementation in the Java ecosystem.">
        <meta name="twitter:image" content="https://higher-kinded-j.github.io/preview.png">
        <meta name="twitter:image:alt" content="Higher-Kinded-J: Composable Effects and Advanced Optics for Java">
        <meta name="description" content="The most comprehensive functional programming library for Java. Unify error handling, optional values, and immutable data navigation with the Effect Path API and Focus DSL. Features advanced optics with code generation for Java records, filtered traversals, indexed optics, and seamless Spring Boot integration.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">
        <meta name="google-site-verification" content="X-xsiAq2cKMLOzh9dexUrX8Onx2h_YMUFgp5lHHUwSg" />
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././mdbook-admonish.css">
        <link rel="stylesheet" href=".././theme/catppuccin.css">
        <link rel="stylesheet" href=".././theme/catppuccin-admonish.css">
        <link rel="stylesheet" href=".././theme/catppuccin-alerts.css">
        <link rel="stylesheet" href=".././theme/additional-hkj.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "latte";
            const default_dark_theme = "macchiato";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('latte')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="latte">Latte</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="frappe">Frappé</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="macchiato">Macchiato</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mocha">Mocha</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        <div class="version-selector-container">
                            <select id="version-selector" class="version-selector" aria-label="Select documentation version" title="Select documentation version">
                                <option value="">Loading versions...</option>
                            </select>
                        </div>
                    </div>

                    <h1 class="menu-title">Higher-Kinded-J: Composable Effects and Advanced Optics for Java</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/higher-kinded-j/higher-kinded-j" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/higher-kinded-j/higher-kinded-j/edit/main/hkj-book/src/effect/advanced_effects.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="advanced-effects"><a class="header" href="#advanced-effects">Advanced Effects</a></h1>
<blockquote>
<p><em>"We are surrounded by huge institutions we can never penetrate... They've
made themselves user-friendly, but they define the tastes to which we conform.
They're rather subtle, subservient tyrannies, but no less sinister for that."</em></p>
<p>— J.G. Ballard</p>
</blockquote>
<p>Ballard was describing the modern landscape of invisible systems: banks,
networks, bureaucracies that shape our choices while remaining opaque. Software
faces the same challenge. Configuration systems, database connections, logging
infrastructure. These are the "institutions" your code must navigate. They're
everywhere, they're necessary, and handling them explicitly at every call site
creates clutter that obscures your actual logic.</p>
<p>This chapter introduces three effect types that model these pervasive concerns:
<strong>Reader</strong> for environment access, <strong>State</strong> for threaded computation state, and
<strong>Writer</strong> for accumulated output. Each represents a different kind of
computational context that you'd otherwise pass explicitly through every
function signature.</p>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li><code>ReaderPath</code> for dependency injection and environment access</li>
<li><code>WithStatePath</code> for computations with mutable state</li>
<li><code>WriterPath</code> for logging and accumulated output</li>
<li>How to compose these effects with other Path types</li>
<li>Patterns for real-world use: configuration, audit trails, and state machines</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code</p>
</div>
<a class="admonition-anchor-link" href="#admonition-see-example-code"></a>
</div>
<div>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/effect/AdvancedEffectsExample.java">AdvancedEffectsExample.java</a> - ReaderPath, WithStatePath, and WriterPath demonstrations</li>
</ul>
</div>
</div>
<div id="admonition-advanced-feature" class="admonition admonish-warning" role="note" aria-labelledby="admonition-advanced-feature-title">
<div class="admonition-title">
<div id="admonition-advanced-feature-title">
<p>Advanced Feature</p>
</div>
<a class="admonition-anchor-link" href="#admonition-advanced-feature"></a>
</div>
<div>
<p>The Reader, State, and Writer Path types are an advanced part of the Effect
Path API. They build on the core Path types covered earlier and require
familiarity with those foundations.</p>
</div>
</div>
<hr />
<h2 id="readerpath-the-environment-you-inherit"><a class="header" href="#readerpath-the-environment-you-inherit">ReaderPath: The Environment You Inherit</a></h2>
<p><code>ReaderPath&lt;R, A&gt;</code> wraps <code>Reader&lt;R, A&gt;</code>, representing a computation that
needs access to an environment of type <code>R</code> to produce a value of type <code>A</code>.</p>
<p>Think of it as <strong>implicit parameter passing</strong>. Instead of threading a
<code>Config</code> or <code>DatabaseConnection</code> through every method signature, you
describe computations that <em>assume</em> the environment exists, then provide
it once at the edge of your system.</p>
<h3 id="why-reader"><a class="header" href="#why-reader">Why Reader?</a></h3>
<p>Consider a typical service method:</p>
<pre><code class="language-java">// Without Reader: environment threaded explicitly
public User getUser(String id, DbConnection db, Config config, Logger log) {
    log.debug("Fetching user: " + id);
    int timeout = config.getTimeout();
    return db.query("SELECT * FROM users WHERE id = ?", id);
}
</code></pre>
<p>Every function in the call chain needs these parameters. The signatures
become cluttered; the actual logic is buried.</p>
<p>With Reader:</p>
<pre><code class="language-java">// With Reader: environment is implicit
public ReaderPath&lt;AppEnv, User&gt; getUser(String id) {
    return ReaderPath.ask()
        .via(env -&gt; {
            env.logger().debug("Fetching user: " + id);
            return ReaderPath.pure(
                env.db().query("SELECT * FROM users WHERE id = ?", id)
            );
        });
}
</code></pre>
<p>The environment is accessed when needed but not passed explicitly. The
method signature shows what it <em>computes</em>, not what it <em>requires</em>.</p>
<h3 id="creation"><a class="header" href="#creation">Creation</a></h3>
<pre><code class="language-java">// Pure value (ignores environment)
ReaderPath&lt;Config, String&gt; pure = ReaderPath.pure("hello");

// Access the environment
ReaderPath&lt;Config, Config&gt; askAll = ReaderPath.ask();

// Project part of the environment
ReaderPath&lt;Config, String&gt; dbUrl = ReaderPath.asks(Config::databaseUrl);

// From a Reader function
ReaderPath&lt;Config, Integer&gt; timeout = ReaderPath.of(config -&gt; config.timeout());
</code></pre>
<h3 id="core-operations"><a class="header" href="#core-operations">Core Operations</a></h3>
<pre><code class="language-java">ReaderPath&lt;Config, String&gt; dbUrl = ReaderPath.asks(Config::databaseUrl);

// Transform
ReaderPath&lt;Config, Integer&gt; urlLength = dbUrl.map(String::length);

// Chain dependent computations
ReaderPath&lt;Config, Connection&gt; connection =
    dbUrl.via(url -&gt; ReaderPath.of(config -&gt;
        DriverManager.getConnection(url, config.username(), config.password())
    ));
</code></pre>
<h3 id="running-a-reader"><a class="header" href="#running-a-reader">Running a Reader</a></h3>
<p>Eventually you must provide the environment:</p>
<pre><code class="language-java">Config config = loadConfig();

ReaderPath&lt;Config, User&gt; userPath = getUser("123");
User user = userPath.run(config);  // Provide environment here
</code></pre>
<p>The Reader executes with the given environment. All <code>ask</code> and <code>asks</code> calls
within the computation receive this environment.</p>
<h3 id="local-environment-modification"><a class="header" href="#local-environment-modification">Local Environment Modification</a></h3>
<p>Sometimes a sub-computation needs a modified environment:</p>
<pre><code class="language-java">ReaderPath&lt;Config, Result&gt; withTestMode =
    computation.local(config -&gt; config.withTestMode(true));
</code></pre>
<p>The inner computation sees the modified environment; the outer computation
is unaffected.</p>
<h3 id="when-to-use-readerpath"><a class="header" href="#when-to-use-readerpath">When to Use ReaderPath</a></h3>
<p><code>ReaderPath</code> is right when:</p>
<ul>
<li>Multiple functions need the same "context" (config, connection, logger)</li>
<li>You want dependency injection without frameworks</li>
<li>Computations should be testable with different environments</li>
<li>You're building a DSL where environment is implicit</li>
</ul>
<p><code>ReaderPath</code> is wrong when:</p>
<ul>
<li>The environment changes during computation: use <code>StatePath</code></li>
<li>You need to accumulate results: use <code>WriterPath</code></li>
<li>The environment is only needed in one place: just pass it directly</li>
</ul>
<h3 id="readerpath-vs-spring-dependency-injection"><a class="header" href="#readerpath-vs-spring-dependency-injection">ReaderPath vs Spring Dependency Injection</a></h3>
<p>If you use Spring Boot, you already have a dependency injection mechanism.
<code>ReaderPath</code> solves a similar problem in a different way. Understanding
where each approach shines helps you choose the right tool.</p>
<div class="table-wrapper"><table><thead><tr><th>Aspect</th><th>Spring DI (<code>@Autowired</code> / constructor)</th><th><code>ReaderPath&lt;R, A&gt;</code></th></tr></thead><tbody>
<tr><td><strong>Provide a dependency</strong></td><td>Container wires it at startup</td><td><code>.run(environment)</code> at the call-site edge</td></tr>
<tr><td><strong>Access a dependency</strong></td><td>Field or constructor parameter</td><td><code>ReaderPath.ask()</code> / <code>ReaderPath.asks(R::field)</code></td></tr>
<tr><td><strong>Scope</strong></td><td>Container-managed (singleton, request, etc.)</td><td>Explicit; the caller decides what to pass</td></tr>
<tr><td><strong>Swapping for tests</strong></td><td><code>@MockBean</code>, <code>@TestConfiguration</code>, or a test profile</td><td>Pass a different environment value</td></tr>
<tr><td><strong>Composition</strong></td><td>Inject service A into service B</td><td><code>readerA.via(a -&gt; readerB)</code> chains readers</td></tr>
<tr><td><strong>Runtime variation</strong></td><td>Profiles, <code>@ConditionalOnProperty</code></td><td><code>reader.local(env -&gt; env.withFeatureFlag(true))</code></td></tr>
</tbody></table>
</div>
<p><strong>When Spring DI is the better fit:</strong></p>
<ul>
<li>Application-scoped singletons (database pools, HTTP clients, caches)</li>
<li>Framework-managed lifecycle (startup, shutdown hooks)</li>
<li>Wiring that is fixed for the lifetime of the application</li>
</ul>
<p><strong>When ReaderPath adds value:</strong></p>
<ul>
<li>Per-request or per-tenant context that varies at runtime (tenant ID,
correlation ID, feature flags, auth principal)</li>
<li>Pure computation pipelines where you want to defer the environment
until the last moment</li>
<li>Testing without a Spring context; just pass a record</li>
</ul>
<p><strong>Example: per-request context</strong></p>
<p>With Spring DI alone, per-request context typically requires a
<code>@RequestScope</code> bean or <code>ThreadLocal</code>. With <code>ReaderPath</code>, the context
flows through the computation explicitly:</p>
<pre><code class="language-java">// Define the request-scoped environment
record RequestEnv(String tenantId, String correlationId, DataSource ds) {}

// Service method: no framework annotations needed
public ReaderPath&lt;RequestEnv, List&lt;Order&gt;&gt; ordersForTenant() {
    return ReaderPath.asks(RequestEnv::tenantId)
        .zipWith(ReaderPath.asks(RequestEnv::ds), (tenantId, ds) -&gt; queryOrders(ds, tenantId));
}

// At the controller edge, provide the environment once
@GetMapping("/orders")
public List&lt;Order&gt; getOrders(HttpServletRequest request) {
    RequestEnv env = new RequestEnv(
        request.getHeader("X-Tenant-Id"),
        request.getHeader("X-Correlation-Id"),
        dataSource
    );
    return ordersForTenant().run(env);
}
</code></pre>
<p>The computation is pure and testable; the environment is assembled once
at the boundary.</p>
<div id="admonition-see-also" class="admonition admonish-tip" role="note" aria-labelledby="admonition-see-also-title">
<div class="admonition-title">
<div id="admonition-see-also-title">
<p>See Also</p>
</div>
<a class="admonition-anchor-link" href="#admonition-see-also"></a>
</div>
<div>
<ul>
<li><a href="../spring/spring_boot_integration.html">Spring Boot Integration</a> - Using Effect Path types as controller return values</li>
<li><a href="../transformers/readert_transformer.html">ReaderT Transformer</a> - The raw transformer behind ReaderPath</li>
</ul>
</div>
</div>
<hr />
<h2 id="statepath-computation-with-memory"><a class="header" href="#statepath-computation-with-memory">StatePath: Computation with Memory</a></h2>
<p><code>StatePath&lt;S, A&gt;</code> wraps <code>State&lt;S, A&gt;</code>, representing a computation that
threads state through a sequence of operations. Each step can read the
current state, produce a value, and update the state for subsequent steps.</p>
<p>Unlike mutable state, <code>StatePath</code> keeps everything pure: the "mutation"
is actually a transformation that produces new state values.</p>
<h3 id="why-state"><a class="header" href="#why-state">Why State?</a></h3>
<p>Consider tracking statistics through a pipeline:</p>
<pre><code class="language-java">// Without State: manual state threading
Stats stats1 = new Stats();
ResultA a = processA(input, stats1);
Stats stats2 = stats1.incrementProcessed();
ResultB b = processB(a, stats2);
Stats stats3 = stats2.incrementProcessed();
// ... and so on
</code></pre>
<p>With State:</p>
<pre><code class="language-java">// With State: automatic threading
StatePath&lt;Stats, ResultC&gt; pipeline =
    StatePath.of(processA(input))
        .via(a -&gt; StatePath.modify(Stats::incrementProcessed)
            .then(() -&gt; StatePath.of(processB(a))))
        .via(b -&gt; StatePath.modify(Stats::incrementProcessed)
            .then(() -&gt; StatePath.of(processC(b))));

Tuple2&lt;Stats, ResultC&gt; result = pipeline.run(Stats.initial());
</code></pre>
<p>The state threads through automatically. Each step can read it, modify it,
or ignore it.</p>
<h3 id="creation-1"><a class="header" href="#creation-1">Creation</a></h3>
<pre><code class="language-java">// Pure value (state unchanged)
StatePath&lt;Counter, String&gt; pure = StatePath.pure("hello");

// Get current state
StatePath&lt;Counter, Counter&gt; current = StatePath.get();

// Set new state (discards old)
StatePath&lt;Counter, Unit&gt; reset = StatePath.set(Counter.zero());

// Modify state
StatePath&lt;Counter, Unit&gt; increment = StatePath.modify(Counter::increment);

// Get and modify in one step
StatePath&lt;Counter, Integer&gt; getAndIncrement =
    StatePath.getAndModify(counter -&gt; {
        int value = counter.value();
        return Tuple.of(counter.increment(), value);
    });
</code></pre>
<h3 id="core-operations-1"><a class="header" href="#core-operations-1">Core Operations</a></h3>
<pre><code class="language-java">StatePath&lt;Counter, Integer&gt; current = StatePath.get().map(Counter::value);

// Chain with state threading
StatePath&lt;Counter, String&gt; counted =
    StatePath.modify(Counter::increment)
        .then(() -&gt; StatePath.get())
        .map(c -&gt; "Count: " + c.value());

// Combine independent state operations
StatePath&lt;Counter, Result&gt; combined =
    operationA.zipWith(operationB, Result::new);
</code></pre>
<h3 id="running-state"><a class="header" href="#running-state">Running State</a></h3>
<pre><code class="language-java">Counter initial = Counter.zero();

StatePath&lt;Counter, String&gt; computation = ...;

// Get both final state and result
Tuple2&lt;Counter, String&gt; both = computation.run(initial);

// Get just the result
String result = computation.eval(initial);

// Get just the final state
Counter finalState = computation.exec(initial);
</code></pre>
<h3 id="when-to-use-statepath"><a class="header" href="#when-to-use-statepath">When to Use StatePath</a></h3>
<p><code>StatePath</code> is right when:</p>
<ul>
<li>You need to accumulate or track information through a computation</li>
<li>Multiple operations must coordinate through shared state</li>
<li>You're implementing state machines or interpreters</li>
<li>You want mutable-like semantics with immutable guarantees</li>
</ul>
<p><code>StatePath</code> is wrong when:</p>
<ul>
<li>State never changes: use <code>ReaderPath</code></li>
<li>You're accumulating a log rather than replacing state: use <code>WriterPath</code></li>
<li>The state is external (database, file): use <code>IOPath</code></li>
</ul>
<hr />
<h2 id="writerpath-accumulating-output"><a class="header" href="#writerpath-accumulating-output">WriterPath: Accumulating Output</a></h2>
<p><code>WriterPath&lt;W, A&gt;</code> wraps <code>Writer&lt;W, A&gt;</code>, representing a computation that
produces both a value and accumulated output. The output (type <code>W</code>) is
combined using a <code>Monoid</code>, allowing automatic aggregation of logs, metrics,
or any combinable data.</p>
<h3 id="why-writer"><a class="header" href="#why-writer">Why Writer?</a></h3>
<p>Consider building an audit trail:</p>
<pre><code class="language-java">// Without Writer: manual log passing
public Tuple2&lt;List&lt;String&gt;, User&gt; createUser(UserInput input, List&lt;String&gt; log) {
    List&lt;String&gt; log2 = append(log, "Validating input");
    Validated validated = validate(input);
    List&lt;String&gt; log3 = append(log2, "Creating user record");
    User user = repository.save(validated);
    List&lt;String&gt; log4 = append(log3, "User created: " + user.id());
    return Tuple.of(log4, user);
}
</code></pre>
<p>With Writer:</p>
<pre><code class="language-java">// With Writer: automatic log accumulation
public WriterPath&lt;List&lt;String&gt;, User&gt; createUser(UserInput input) {
    return WriterPath.tell(List.of("Validating input"))
        .then(() -&gt; WriterPath.pure(validate(input)))
        .via(validated -&gt; WriterPath.tell(List.of("Creating user record"))
            .then(() -&gt; WriterPath.pure(repository.save(validated))))
        .via(user -&gt; WriterPath.tell(List.of("User created: " + user.id()))
            .map(unit -&gt; user));
}
</code></pre>
<p>The log accumulates automatically. No explicit threading required.</p>
<h3 id="creation-2"><a class="header" href="#creation-2">Creation</a></h3>
<pre><code class="language-java">// Pure value (empty log)
WriterPath&lt;List&lt;String&gt;, Integer&gt; pure = WriterPath.pure(42, Monoids.list());

// Write to log (no value)
WriterPath&lt;List&lt;String&gt;, Unit&gt; logged =
    WriterPath.tell(List.of("Something happened"), Monoids.list());

// Create with both value and log
WriterPath&lt;List&lt;String&gt;, User&gt; withLog =
    WriterPath.of(user, List.of("Created user"), Monoids.list());
</code></pre>
<p>The <code>Monoid&lt;W&gt;</code> parameter defines how log entries combine:</p>
<ul>
<li><code>Monoids.list()</code>: concatenate lists</li>
<li><code>Monoids.string()</code>: concatenate strings</li>
<li>Custom monoids for metrics, events, etc.</li>
</ul>
<h3 id="core-operations-2"><a class="header" href="#core-operations-2">Core Operations</a></h3>
<pre><code class="language-java">WriterPath&lt;List&lt;String&gt;, Integer&gt; computation = ...;

// Transform value (log unchanged)
WriterPath&lt;List&lt;String&gt;, String&gt; formatted = computation.map(n -&gt; "Value: " + n);

// Add to log
WriterPath&lt;List&lt;String&gt;, Integer&gt; withExtra =
    computation.tell(List.of("Extra info"));

// Chain with log accumulation
WriterPath&lt;List&lt;String&gt;, Result&gt; pipeline =
    stepOne()
        .via(a -&gt; stepTwo(a))
        .via(b -&gt; stepThree(b));
// Logs from all three steps combine automatically
</code></pre>
<h3 id="running-writer"><a class="header" href="#running-writer">Running Writer</a></h3>
<pre><code class="language-java">WriterPath&lt;List&lt;String&gt;, User&gt; computation = createUser(input);

// Get both log and result
Tuple2&lt;List&lt;String&gt;, User&gt; both = computation.run();

// Get just the result
User user = computation.value();

// Get just the log
List&lt;String&gt; log = computation.written();
</code></pre>
<h3 id="when-to-use-writerpath"><a class="header" href="#when-to-use-writerpath">When to Use WriterPath</a></h3>
<p><code>WriterPath</code> is right when:</p>
<ul>
<li>You're building audit trails or structured logs</li>
<li>Accumulating metrics or statistics</li>
<li>Collecting warnings or diagnostics alongside computation</li>
<li>Any scenario where output should aggregate, not replace</li>
</ul>
<p><code>WriterPath</code> is wrong when:</p>
<ul>
<li>Output should replace previous output: use <code>StatePath</code></li>
<li>You need to read accumulated output mid-computation: use <code>StatePath</code></li>
<li>Output goes to external systems: use <code>IOPath</code></li>
</ul>
<hr />
<h2 id="combining-advanced-effects"><a class="header" href="#combining-advanced-effects">Combining Advanced Effects</a></h2>
<p>These effect types compose with each other and with the core Path types.</p>
<h3 id="reader--either-environment-with-errors"><a class="header" href="#reader--either-environment-with-errors">Reader + Either: Environment with Errors</a></h3>
<pre><code class="language-java">// A computation that needs config and might fail
ReaderPath&lt;Config, EitherPath&lt;Error, User&gt;&gt; getUser(String id) {
    return ReaderPath.asks(Config::database)
        .map(db -&gt; Path.either(db.findUser(id))
            .toEitherPath(() -&gt; new Error.NotFound(id)));
}
</code></pre>
<h3 id="state--writer-state-with-logging"><a class="header" href="#state--writer-state-with-logging">State + Writer: State with Logging</a></h3>
<pre><code class="language-java">// Track state and log what happens
public StatePath&lt;GameState, WriterPath&lt;List&lt;Event&gt;, Move&gt;&gt; makeMove(Position pos) {
    return StatePath.get()
        .via(state -&gt; {
            Move move = calculateMove(state, pos);
            GameState newState = state.apply(move);
            return StatePath.set(newState)
                .map(unit -&gt; WriterPath.of(
                    move,
                    List.of(new Event.MoveMade(pos, move)),
                    Monoids.list()
                ));
        });
}
</code></pre>
<h3 id="patterns-configuration-service"><a class="header" href="#patterns-configuration-service">Patterns: Configuration Service</a></h3>
<pre><code class="language-java">public class ConfigurableService {
    public ReaderPath&lt;ServiceConfig, EitherPath&lt;Error, Result&gt;&gt; process(Request req) {
        return ReaderPath.ask()
            .via(config -&gt; {
                if (!config.isEnabled()) {
                    return ReaderPath.pure(Path.left(new Error.ServiceDisabled()));
                }
                return ReaderPath.pure(
                    Path.tryOf(() -&gt; doProcess(req, config))
                        .toEitherPath(Error.ProcessingFailed::new)
                );
            });
    }
}

// Usage
ServiceConfig config = loadConfig();
EitherPath&lt;Error, Result&gt; result = service.process(request).run(config);
</code></pre>
<h3 id="patterns-audit-trail"><a class="header" href="#patterns-audit-trail">Patterns: Audit Trail</a></h3>
<pre><code class="language-java">public class AuditedRepository {
    public WriterPath&lt;List&lt;AuditEvent&gt;, EitherPath&lt;Error, User&gt;&gt; saveUser(User user) {
        return WriterPath.tell(List.of(new AuditEvent.AttemptSave(user.id())))
            .then(() -&gt; {
                Either&lt;Error, User&gt; result = repository.save(user);
                if (result.isRight()) {
                    return WriterPath.of(
                        Path.right(result.getRight()),
                        List.of(new AuditEvent.SaveSucceeded(user.id())),
                        Monoids.list()
                    );
                } else {
                    return WriterPath.of(
                        Path.left(result.getLeft()),
                        List.of(new AuditEvent.SaveFailed(user.id(), result.getLeft())),
                        Monoids.list()
                    );
                }
            });
    }
}
</code></pre>
<hr />
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Effect Type</th><th>Models</th><th>Key Operations</th><th>Use Case</th></tr></thead><tbody>
<tr><td><code>ReaderPath&lt;R, A&gt;</code></td><td>Environment access</td><td><code>ask</code>, <code>asks</code>, <code>local</code></td><td>Config, DI</td></tr>
<tr><td><code>StatePath&lt;S, A&gt;</code></td><td>Threaded state</td><td><code>get</code>, <code>set</code>, <code>modify</code></td><td>Counters, state machines</td></tr>
<tr><td><code>WriterPath&lt;W, A&gt;</code></td><td>Accumulated output</td><td><code>tell</code>, <code>written</code></td><td>Logging, audit trails</td></tr>
</tbody></table>
</div>
<p>These effects handle the "invisible institutions" of software: the
configuration that's everywhere, the state that threads through, the
logs that accumulate. By making them explicit in the type system, you
gain the same composability and predictability that the core Path types
provide for error handling.</p>
<p>The systems remain subtle and pervasive, but no longer tyrannical.</p>
<div id="admonition-see-also-1" class="admonition admonish-tip" role="note" aria-labelledby="admonition-see-also-1-title">
<div class="admonition-title">
<div id="admonition-see-also-1-title">
<p>See Also</p>
</div>
<a class="admonition-anchor-link" href="#admonition-see-also-1"></a>
</div>
<div>
<ul>
<li><a href="../monads/reader_monad.html">Reader Monad</a> - The underlying type for ReaderPath</li>
<li><a href="../monads/state_monad.html">State Monad</a> - The underlying type for StatePath</li>
<li><a href="../monads/writer_monad.html">Writer Monad</a> - The underlying type for WriterPath</li>
<li><a href="../transformers/transformers.html">Monad Transformers</a> - Combining multiple effects</li>
</ul>
</div>
</div>
<hr />
<p><strong>Previous:</strong> <a href="compiler_errors.html">Common Compiler Errors</a>
<strong>Next:</strong> <a href="effect_contexts.html">Effect Contexts</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../effect/compiler_errors.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../effect/effect_contexts.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../effect/compiler_errors.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../effect/effect_contexts.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../version-switcher.js"></script>
        <script src=".././theme/version-switcher.js"></script>
        <script src=".././theme/sidebar-nav-link.js"></script>


    </div>
    </body>
</html>
