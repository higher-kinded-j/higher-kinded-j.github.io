<!DOCTYPE HTML>
<html lang="en" class="latte sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>StateT - Higher-Kinded-J: Composable Effects and Advanced Optics for Java</title>


        <!-- Custom HTML head -->


            <meta name="description" content="The most comprehensive functional programming library for Java. Unify error handling, optional values, and immutable data navigation with the Effect Path API and Focus DSL. Features advanced optics with code generation for Java records, filtered traversals, indexed optics, and seamless Spring Boot integration.">


        <meta name="keywords" content="Higher-Kinded Types, Higher-Kinded-J, HKT, Java, Optics, Lens, Prism, Traversal, Iso, Affine, Focus DSL, Effect Path API, Functional Programming, Monad, Functor, Applicative, EitherPath, MaybePath, TryPath, ValidationPath, Java Records, Sealed Interface, Error Handling, Immutable Data">
        
        <meta property="og:title" content="StateT - Higher-Kinded-J: Composable Effects and Advanced Optics for Java">
            <meta property="og:description" content="The most comprehensive functional programming library for Java. Unify error handling, optional values, and immutable data navigation with the Effect Path API and Focus DSL. Features advanced optics with code generation for Java records, filtered traversals, indexed optics, and seamless Spring Boot integration.">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://higher-kinded-j.github.io/">
        <meta property="og:image" content="https://higher-kinded-j.github.io/preview.png">
        <meta property="og:image:width" content="1200">
        <meta property="og:image:height" content="630">
        <meta property="og:site_name" content="Higher-Kinded-J Documentation">
        <meta property="og:locale" content="en_GB">
        
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="StateT - Higher-Kinded-J: Composable Effects and Advanced Optics for Java">
        <meta name="twitter:description" content="Unifying Composable Effects and Advanced Optics for Java. Effect Path API, Focus DSL, and the most comprehensive optics implementation in the Java ecosystem.">
        <meta name="twitter:image" content="https://higher-kinded-j.github.io/preview.png">
        <meta name="twitter:image:alt" content="Higher-Kinded-J: Composable Effects and Advanced Optics for Java">
        <meta name="description" content="The most comprehensive functional programming library for Java. Unify error handling, optional values, and immutable data navigation with the Effect Path API and Focus DSL. Features advanced optics with code generation for Java records, filtered traversals, indexed optics, and seamless Spring Boot integration.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">
        <meta name="google-site-verification" content="X-xsiAq2cKMLOzh9dexUrX8Onx2h_YMUFgp5lHHUwSg" />
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././mdbook-admonish.css">
        <link rel="stylesheet" href=".././theme/catppuccin.css">
        <link rel="stylesheet" href=".././theme/catppuccin-admonish.css">
        <link rel="stylesheet" href=".././theme/catppuccin-alerts.css">
        <link rel="stylesheet" href=".././theme/additional-hkj.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "latte";
            const default_dark_theme = "macchiato";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('latte')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="latte">Latte</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="frappe">Frapp√©</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="macchiato">Macchiato</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mocha">Mocha</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        <div class="version-selector-container">
                            <select id="version-selector" class="version-selector" aria-label="Select documentation version" title="Select documentation version">
                                <option value="">Loading versions...</option>
                            </select>
                        </div>
                    </div>

                    <h1 class="menu-title">Higher-Kinded-J: Composable Effects and Advanced Optics for Java</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/higher-kinded-j/higher-kinded-j" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/higher-kinded-j/higher-kinded-j/edit/main/hkj-book/src/transformers/statet_transformer.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="the-statet-transformer"><a class="header" href="#the-statet-transformer">The StateT Transformer:</a></h1>
<h2 id="monad-transformer"><a class="header" href="#monad-transformer"><em>Monad Transformer</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to add stateful computation to any existing monad</li>
<li>Building stack operations that can fail (StateT with Optional)</li>
<li>Understanding the relationship between State and StateT&lt;S, Identity, A&gt;</li>
<li>Creating complex workflows that manage both state and other effects</li>
<li>Using <code>get</code>, <code>set</code>, <code>modify</code> operations within transformer contexts</li>
</ul>
</div>
</div>
<div id="admonition-see-example-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-see-example-code-title">
<div class="admonition-title">
<div id="admonition-see-example-code-title">
<p>See Example Code:</p>
</div>
<a class="admonition-anchor-link" href="#admonition-see-example-code"></a>
</div>
<div>
<ul>
<li>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/state_t/StateTExample.java">StateTExample.java</a></p>
</li>
<li>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/state_t/StateTStackExample.java">StateTStackExample</a></p>
</li>
</ul>
</div>
</div>
<p>The <code>StateT</code> monad transformer is a powerful construct that allows you to add state-management capabilities to an existing monadic context. Think of it as taking the <a href="../monads/state_monad.html">State Monad</a> and making it work on top of <em>another</em> monad, like <code>OptionalKind</code>, <code>EitherKind</code>, or <code>IOKind</code>.</p>
<p>This is incredibly useful when you have computations that are both stateful and involve other effects, such as:</p>
<ul>
<li>Potentially missing values (<code>Optional</code>)</li>
<li>Operations that can fail (<code>Either</code>, <code>Try</code>)</li>
<li>Side-effecting computations (<code>IO</code>)</li>
</ul>
<h2 id="what-is-statet"><a class="header" href="#what-is-statet">What is StateT?</a></h2>
<p>At its core, a <code>StateT&lt;S, F, A&gt;</code> represents a computation that:</p>
<ol>
<li>Takes an initial state of type <code>S</code>.</li>
<li>Produces a result of type <code>A</code> along with a new state of type <code>S</code>.</li>
<li>And this entire process of producing the <code>(newState, value)</code> pair is itself wrapped in an underlying monadic context <code>F</code>.</li>
</ol>
<p>So, the fundamental structure of a <code>StateT</code> computation can be thought of as a function:
<code>S -&gt; F&lt;StateTuple&lt;S, A&gt;&gt;</code></p>
<p>Where:</p>
<ul>
<li><code>S</code>: The type of the state.</li>
<li><code>F</code>: The witness type for the underlying monad (e.g., <code>OptionalKind.Witness</code>, <code>IOKind.Witness</code>).</li>
<li><code>A</code>: The type of the computed value.</li>
<li><code>StateTuple&lt;S, A&gt;</code>: A simple container holding a pair of <code>(state, value)</code>.</li>
</ul>
<p><img src="../images/puml/statet_transformer.svg" alt="statet_transformer.svg" /></p>
<h2 id="key-classes-and-concepts"><a class="header" href="#key-classes-and-concepts">Key Classes and Concepts</a></h2>
<ul>
<li><strong><code>StateT&lt;S, F, A&gt;</code></strong>: The primary data type representing the stateful computation stacked on monad <code>F</code>. It holds the function <code>S -&gt; Kind&lt;F, StateTuple&lt;S, A&gt;&gt;</code>.</li>
<li><strong><code>StateTKind&lt;S, F, A&gt;</code></strong>: The <code>Kind</code> representation for <code>StateT</code>, allowing it to be used with <code>higher-kinded-j</code>'s typeclasses like <code>Monad</code>. This is what you'll mostly interact with when using <code>StateT</code> in a generic monadic context.</li>
<li><strong><code>StateTKind.Witness&lt;S, F&gt;</code></strong>: The higher-kinded type witness for <code>StateT&lt;S, F, _&gt;</code>. Note that both the state type <code>S</code> and the underlying monad witness <code>F</code> are part of the <code>StateT</code> witness.</li>
<li><strong><code>StateTMonad&lt;S, F&gt;</code></strong>: The <code>Monad</code> instance for <code>StateT&lt;S, F, _&gt;</code>. It requires a <code>Monad</code> instance for the underlying monad <code>F</code> to function.</li>
<li><strong><code>StateTKindHelper</code></strong>: A utility class providing static methods for working with <code>StateTKind</code>, such as <code>narrow</code> (to convert <code>Kind&lt;StateTKind.Witness&lt;S, F&gt;, A&gt;</code> back to <code>StateT&lt;S, F, A&gt;</code>), <code>runStateT</code>, <code>evalStateT</code>, and <code>execStateT</code>.</li>
<li><strong><code>StateTuple&lt;S, A&gt;</code></strong>: A simple record-like class holding the pair <code>(S state, A value)</code>.</li>
</ul>
<h2 id="motivation-why-use-statet"><a class="header" href="#motivation-why-use-statet">Motivation: Why Use StateT?</a></h2>
<p>Imagine you're processing a sequence of items, and for each item:</p>
<ol>
<li>You need to update some running total (state).</li>
<li>The processing of an item might fail or return no result (e.g., <code>Optional</code>).</li>
</ol>
<p>Without <code>StateT</code>, you might end up with deeply nested <code>Optional&lt;StateTuple&lt;S, A&gt;&gt;</code> and manually manage both the optionality and the state threading. <code>StateT&lt;S, OptionalKind.Witness, A&gt;</code> elegantly combines these concerns.</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/state_t/StateTExample.java">StateTExample.java</a></li>
</ul>
<h3 id="creating-statet-instances"><a class="header" href="#creating-statet-instances">Creating StateT Instances</a></h3>
<p>You typically create <code>StateT</code> instances in a few ways:</p>
<ol>
<li>
<p><strong>Directly with <code>StateT.create()</code></strong>:
This is the most fundamental way, providing the state function and the underlying monad instance.</p>
<pre><code class="language-java">

// Assume S = Integer (state type), F = OptionalKind.Witness, A = String (value type)
 OptionalMonad optionalMonad = OptionalMonad.INSTANCE;

 Function&lt;Integer, Kind&lt;OptionalKind.Witness, StateTuple&lt;Integer, String&gt;&gt;&gt; runFn =
     currentState -&gt; {
       if (currentState &lt; 0) {
         return OPTIONAL.widen(Optional.empty());
       }
       return OPTIONAL.widen(Optional.of(StateTuple.of(currentState + 1, "Value: " + currentState)));
     };

 StateT&lt;Integer, OptionalKind.Witness, String&gt; stateTExplicit =
     StateT.create(runFn, optionalMonad);

 Kind&lt;StateTKind.Witness&lt;Integer, OptionalKind.Witness&gt;, String&gt; stateTKind =
     stateTExplicit;
</code></pre>
</li>
<li>
<p><strong>Lifting values with <code>StateTMonad.of()</code></strong>:
This lifts a pure value <code>A</code> into the <code>StateT</code> context. The state remains unchanged, and the underlying monad <code>F</code> will wrap the result using its own <code>of</code> method.</p>
<pre><code class="language-java"> StateTMonad&lt;Integer, OptionalKind.Witness&gt; stateTMonad = StateTMonad.instance(optionalMonad);

 Kind&lt;StateTKind.Witness&lt;Integer, OptionalKind.Witness&gt;, String&gt; pureStateT =
     stateTMonad.of("pure value");


 Optional&lt;StateTuple&lt;Integer, String&gt;&gt; pureResult =
     OPTIONAL.narrow(STATE_T.runStateT(pureStateT, 10));
 System.out.println("Pure StateT result: " + pureResult);
// When run with state 10, this will result in Optional.of(StateTuple(10, "pure value"))
</code></pre>
</li>
</ol>
<h3 id="running-statet-computations"><a class="header" href="#running-statet-computations">Running StateT Computations</a></h3>
<p>To execute a <code>StateT</code> computation and extract the result, you use methods from <code>StateTKindHelper</code> or directly from the <code>StateT</code> object:</p>
<ul>
<li>
<p><strong><code>runStateT(initialState)</code></strong>: Executes the computation with an <code>initialState</code> and returns the result wrapped in the underlying monad: <code>Kind&lt;F, StateTuple&lt;S, A&gt;&gt;</code>.</p>
<pre><code class="language-java">// Continuing the stateTKind from above:
Kind&lt;OptionalKind.Witness, StateTuple&lt;Integer, String&gt;&gt; resultOptionalTuple =
      StateTKindHelper.runStateT(stateTKind, 10);

  Optional&lt;StateTuple&lt;Integer, String&gt;&gt; actualOptional = OPTIONAL.narrow(resultOptionalTuple);

  if (actualOptional.isPresent()) {
    StateTuple&lt;Integer, String&gt; tuple = actualOptional.get();
    System.out.println("New State (from stateTExplicit): " + tuple.state());
    System.out.println("Value (from stateTExplicit): " + tuple.value());
  } else {
    System.out.println("actualOptional was empty for initial state 10");
  }

  // Example with negative initial state (expecting empty Optional)
  Kind&lt;OptionalKind.Witness, StateTuple&lt;Integer, String&gt;&gt; resultEmptyOptional =
      StateTKindHelper.runStateT(stateTKind, -5);
  Optional&lt;StateTuple&lt;Integer, String&gt;&gt; actualEmpty = OPTIONAL.narrow(resultEmptyOptional);
  // Output: Is empty: true
  System.out.println("Is empty (for initial state -5): " + actualEmpty.isEmpty());

</code></pre>
</li>
<li>
<p><strong><code>evalStateT(initialState)</code></strong>: Executes and gives you <code>Kind&lt;F, A&gt;</code> (the value, discarding the final state).</p>
</li>
<li>
<p><strong><code>execStateT(initialState)</code></strong>: Executes and gives you <code>Kind&lt;F, S&gt;</code> (the final state, discarding the value).</p>
</li>
</ul>
<h3 id="composing-statet-actions"><a class="header" href="#composing-statet-actions">Composing StateT Actions</a></h3>
<p>Like any monad, <code>StateT</code> computations can be composed using <code>map</code> and <code>flatMap</code>.</p>
<ul>
<li>
<p><strong><code>map(Function&lt;A, B&gt; fn)</code></strong>: Transforms the value <code>A</code> to <code>B</code> within the <code>StateT</code> context, leaving the state transformation logic and the underlying monad <code>F</code>'s effect untouched for that step.</p>
<pre><code class="language-java">    Kind&lt;StateTKind.Witness&lt;Integer, OptionalKind.Witness&gt;, Integer&gt; initialComputation =
      StateT.create(s -&gt; OPTIONAL.widen(Optional.of(StateTuple.of(s + 1, s * 2))), optionalMonad);

  Kind&lt;StateTKind.Witness&lt;Integer, OptionalKind.Witness&gt;, String&gt; mappedComputation =
      stateTMonad.map(
          val -&gt; "Computed: " + val,
          initialComputation);

  // Run mappedComputation with initial state 5:
  // 1. initialComputation runs: state becomes 6, value is 10. Wrapped in Optional.
  // 2. map's function ("Computed: " + 10) is applied to 10.
  // Result: Optional.of(StateTuple(6, "Computed: 10"))
  Optional&lt;StateTuple&lt;Integer, String&gt;&gt; mappedResult =
      OPTIONAL.narrow(STATE_T.runStateT(mappedComputation, 5));
  System.out.print("Mapped result (initial state 5): ");
  mappedResult.ifPresentOrElse(System.out::println, () -&gt; System.out.println("Empty"));
  // Output: StateTuple[state=6, value=Computed: 10]
</code></pre>
</li>
<li>
<p><strong><code>flatMap(Function&lt;A, Kind&lt;StateTKind.Witness&lt;S, F&gt;, B&gt;&gt; fn)</code></strong>: Sequences two <code>StateT</code> computations. The state from the first computation is passed to the second. The effects of the underlying monad <code>F</code> are also sequenced according to <code>F</code>'s <code>flatMap</code>.</p>
<pre><code class="language-java">    // stateTMonad and optionalMonad are defined
  Kind&lt;StateTKind.Witness&lt;Integer, OptionalKind.Witness&gt;, Integer&gt; firstStep =
      StateT.create(s -&gt; OPTIONAL.widen(Optional.of(StateTuple.of(s + 1, s * 10))), optionalMonad);

  Function&lt;Integer, Kind&lt;StateTKind.Witness&lt;Integer, OptionalKind.Witness&gt;, String&gt;&gt; secondStepFn =
      prevValue -&gt; StateT.create(
          s -&gt; {
            if (prevValue &gt; 100) {
              return OPTIONAL.widen(Optional.of(StateTuple.of(s + prevValue, "Large: " + prevValue)));
            } else {
              return OPTIONAL.widen(Optional.empty());
            }
          },
          optionalMonad);

  Kind&lt;StateTKind.Witness&lt;Integer, OptionalKind.Witness&gt;, String&gt; combined =
      stateTMonad.flatMap(secondStepFn, firstStep);

  // Run with initial state 15
  // 1. firstStep(15): state=16, value=150. Wrapped in Optional.of.
  // 2. secondStepFn(150) is called. It returns a new StateT.
  // 3. The new StateT is run with state=16:
  //    Its function: s' (which is 16) -&gt; Optional.of(StateTuple(16 + 150, "Large: 150"))
  //    Result: Optional.of(StateTuple(166, "Large: 150"))
  Optional&lt;StateTuple&lt;Integer, String&gt;&gt; combinedResult =
      OPTIONAL.narrow(STATE_T.runStateT(combined, 15));
  System.out.print("Combined result (initial state 15): ");
  combinedResult.ifPresentOrElse(System.out::println, () -&gt; System.out.println("Empty"));

  // Output: StateTuple[state=166, value=Large: 150]

  // Run with initial state 5
  // 1. firstStep(5): state=6, value=50. Wrapped in Optional.of.
  // 2. secondStepFn(50) is called.
  // 3. The new StateT is run with state=6:
  //    Its function: s' (which is 6) -&gt; Optional.empty()
  //    Result: Optional.empty()
  Optional&lt;StateTuple&lt;Integer, String&gt;&gt; combinedEmptyResult =
      OPTIONAL.narrow(STATE_T.runStateT(combined, 5));
  // Output: true
  System.out.println("Is empty from small initial (state 5 for combined): " + combinedEmptyResult.isEmpty());
</code></pre>
</li>
<li>
<p><strong><code>ap(ff, fa)</code></strong>: Applies a wrapped function to a wrapped value.</p>
</li>
</ul>
<div id="admonition-null-handling" class="admonition admonish-warning" role="note" aria-labelledby="admonition-null-handling-title">
<div class="admonition-title">
<div id="admonition-null-handling-title">
<p>Null Handling</p>
</div>
<a class="admonition-anchor-link" href="#admonition-null-handling"></a>
</div>
<div>
<blockquote>
<p><strong>Note on Null Handling:</strong> The <code>ap</code> method requires the function it extracts from the first <code>StateT</code> computation to be non-null. If the function is <code>null</code>, a <code>NullPointerException</code> will be thrown when the computation is executed. It is the developer's responsibility to ensure that any functions provided within a <code>StateT</code> context are non-null. Similarly, the value from the second computation may be <code>null</code>, and the provided function must be able to handle a <code>null</code> input if that is a valid state.</p>
</blockquote>
</div>
</div>
<h3 id="state-specific-operations"><a class="header" href="#state-specific-operations">State-Specific Operations</a></h3>
<p>While <code>higher-kinded-j</code>'s <code>StateT</code> provides the core monadic structure, you'll often want common state operations like <code>get</code>, <code>set</code>, <code>modify</code>. These can be constructed using <code>StateT.create</code> or <code>StateTKind.lift</code>.</p>
<ul>
<li>
<p><strong><code>get()</code></strong>:  Retrieves the current state as the value.</p>
<pre><code class="language-java">public static &lt;S, F&gt; Kind&lt;StateTKind.Witness&lt;S, F&gt;, S&gt; get(Monad&lt;F&gt; monadF) {
  Function&lt;S, Kind&lt;F, StateTuple&lt;S, S&gt;&gt;&gt; runFn = s -&gt; monadF.of(StateTuple.of(s, s));
  return StateT.create(runFn, monadF);
}
// Usage: stateTMonad.flatMap(currentState -&gt; ..., get(optionalMonad))
</code></pre>
</li>
<li>
<p><strong><code>set(newState, monadF)</code></strong>: Replaces the current state with <code>newState</code>. The value is often <code>Void</code> or <code>Unit</code>.</p>
<pre><code class="language-java">public static &lt;S, F&gt; Kind&lt;StateTKind.Witness&lt;S, F&gt;, Unit&gt; set(S newState, Monad&lt;F&gt; monadF) {
  Function&lt;S, Kind&lt;F, StateTuple&lt;S, Void&gt;&gt;&gt; runFn = s -&gt; monadF.of(StateTuple.of(newState, Unit.INSTANCE));
  return StateT.create(runFn, monadF);
}
</code></pre>
</li>
<li>
<p><strong><code>modify(f, monadF)</code></strong>: Modifies the state using a function.</p>
<pre><code class="language-java">public static &lt;S, F&gt; Kind&lt;StateTKind.Witness&lt;S, F&gt;, Unit&gt; modify(Function&lt;S, S&gt; f, Monad&lt;F&gt; monadF) {
  Function&lt;S, Kind&lt;F, StateTuple&lt;S, Unit&gt;&gt;&gt; runFn = s -&gt; monadF.of(StateTuple.of(f.apply(s), Unit.INSTANCE));
  return StateT.create(runFn, monadF);
}
</code></pre>
</li>
<li>
<p><strong><code>gets(f, monadF)</code></strong>: Retrieves a value derived from the current state.</p>
</li>
</ul>
<pre><code class="language-java">public static &lt;S, F, A&gt; Kind&lt;StateTKind.Witness&lt;S, F&gt;, A&gt; gets(Function&lt;S, A&gt; f, Monad&lt;F&gt; monadF) {
Function&lt;S, Kind&lt;F, StateTuple&lt;S, A&gt;&gt;&gt; runFn = s -&gt; monadF.of(StateTuple.of(s, f.apply(s)));
return StateT.create(runFn, monadF);
}
</code></pre>
<ul>
<li><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/basic/state_t/StateTStackExample.java">StateTStackExample.java</a></li>
</ul>
<p>Let's simulate stack operations where the stack is a <code>List&lt;Integer&gt;</code> and operations might be absent if, for example, popping an empty stack.</p>
<pre><code class="language-java">public class StateTStackExample {

  private static final OptionalMonad OPT_MONAD = OptionalMonad.INSTANCE;
  private static final StateTMonad&lt;List&lt;Integer&gt;, OptionalKind.Witness&gt; ST_OPT_MONAD =
      StateTMonad.instance(OPT_MONAD);

  // Helper to lift a state function into StateT&lt;List&lt;Integer&gt;, OptionalKind.Witness, A&gt;
  private static &lt;A&gt; Kind&lt;StateTKind.Witness&lt;List&lt;Integer&gt;, OptionalKind.Witness&gt;, A&gt; liftOpt(
      Function&lt;List&lt;Integer&gt;, Kind&lt;OptionalKind.Witness, StateTuple&lt;List&lt;Integer&gt;, A&gt;&gt;&gt; f) {
    return StateTKindHelper.stateT(f, OPT_MONAD);
  }

  // push operation
  public static Kind&lt;StateTKind.Witness&lt;List&lt;Integer&gt;, OptionalKind.Witness&gt;, Unit&gt; push(Integer value) {
    return liftOpt(stack -&gt; {
      List&lt;Integer&gt; newStack = new LinkedList&lt;&gt;(stack);
      newStack.add(0, value); // Add to front
      return OPTIONAL.widen(Optional.of(StateTuple.of(newStack, Unit.INSTANCE)));
    });
  }

  // pop operation
  public static Kind&lt;StateTKind.Witness&lt;List&lt;Integer&gt;, OptionalKind.Witness&gt;, Integer&gt; pop() {
    return liftOpt(stack -&gt; {
      if (stack.isEmpty()) {
        return OPTIONAL.widen(Optional.empty()); // Cannot pop from empty stack
      }
      List&lt;Integer&gt; newStack = new LinkedList&lt;&gt;(stack);
      Integer poppedValue = newStack.remove(0);
      return OPTIONAL.widen(Optional.of(StateTuple.of(newStack, poppedValue)));
    });
  }

  public static void main(String[] args) {
    var computation =
        For.from(ST_OPT_MONAD, push(10))
            .from(_ -&gt; push(20))
            .from(_ -&gt; pop())
            .from(_ -&gt; pop()) // t._3() is the first popped value
            .yield((a, b, p1, p2) -&gt; {
              System.out.println("Popped in order: " + p1 + ", then " + p2);
              return p1 + p2;
            });


    List&lt;Integer&gt; initialStack = Collections.emptyList();
    Kind&lt;OptionalKind.Witness, StateTuple&lt;List&lt;Integer&gt;, Integer&gt;&gt; resultWrapped =
        StateTKindHelper.runStateT(computation, initialStack);

    Optional&lt;StateTuple&lt;List&lt;Integer&gt;, Integer&gt;&gt; resultOpt =
        OPTIONAL.narrow(resultWrapped);

    resultOpt.ifPresentOrElse(
        tuple -&gt; {
          System.out.println("Final value: " + tuple.value());       // Expected: 30
          System.out.println("Final stack: " + tuple.state());       // Expected: [] (empty)
        },
        () -&gt; System.out.println("Computation resulted in empty Optional.")
    );

    // Example of popping an empty stack
    Kind&lt;StateTKind.Witness&lt;List&lt;Integer&gt;, OptionalKind.Witness&gt;, Integer&gt; popEmptyStack = pop();
    Optional&lt;StateTuple&lt;List&lt;Integer&gt;, Integer&gt;&gt; emptyPopResult =
        OPTIONAL.narrow(StateTKindHelper.runStateT(popEmptyStack, Collections.emptyList()));
    System.out.println("Popping empty stack was successful: " + emptyPopResult.isPresent()); // false
  }
}
</code></pre>
<hr />
<h2 id="relationship-to-state-monad"><a class="header" href="#relationship-to-state-monad">Relationship to State Monad</a></h2>
<p>The <a href="../monads/state_monad.html">State Monad</a> (<code>State&lt;S, A&gt;</code>) can be seen as a specialised version of <code>StateT</code>. Specifically, <code>State&lt;S, A&gt;</code> is equivalent to <code>StateT&lt;S, Id, A&gt;</code>, where <code>Id</code> is the Identity monad (a monad that doesn't add any effects, simply <code>Id&lt;A&gt; = A</code>). <code>higher-kinded-j</code> provides an <code>Id</code> monad. <code>State&lt;S, A&gt;</code> can be seen as an equivalent to <code>StateT&lt;S, IdKind.Witness, A&gt;</code>.</p>
<p>Using <code>StateT</code> helps write cleaner, more composable code when dealing with computations that involve both state and other monadic effects.</p>
<hr />
<div id="admonition-see-also" class="admonition admonish-tip" role="note" aria-labelledby="admonition-see-also-title">
<div class="admonition-title">
<div id="admonition-see-also-title">
<p>See Also</p>
</div>
<a class="admonition-anchor-link" href="#admonition-see-also"></a>
</div>
<div>
<ul>
<li><a href="../monads/state_monad.html">State Monad</a> - Understand the basics of stateful computations</li>
<li><a href="./transformers.html">Monad Transformers</a> - General concept of monad transformers</li>
<li><a href="../monads/optional_monad.html">OptionalKind</a>, <a href="../monads/either_monad.html">EitherKind</a>, <a href="../monads/io_monad.html">IOKind</a> - Underlying monads you might use with StateT</li>
</ul>
</div>
</div>
<hr />
<div id="admonition-further-reading" class="admonition admonish-tip" role="note" aria-labelledby="admonition-further-reading-title">
<div class="admonition-title">
<div id="admonition-further-reading-title">
<p>Further Reading</p>
</div>
<a class="admonition-anchor-link" href="#admonition-further-reading"></a>
</div>
<div>
<p>Start with the <strong>Java-focused</strong> resources to understand state management patterns, then explore <strong>General FP concepts</strong> for deeper understanding, and finally check <strong>Related Libraries</strong> to see alternative approaches.</p>
</div>
</div>
<h3 id="java-focused-resources"><a class="header" href="#java-focused-resources">Java-Focused Resources</a></h3>
<p><strong>Beginner Level:</strong>
-<a href="https://www.baeldung.com/java-state-design-pattern-functional">State Management Without Mutability</a> - Baeldung's functional state guide (15 min read)
-<a href="https://medium.com/@johnmcclean/state-monad-in-java-8-2e0b7d8e3e5b">Immutable State Transitions in Java</a> - Practical patterns (12 min read)
-<a href="https://www.youtube.com/watch?v=Pgo3K-FWyh0">Functional State Machines</a> - State monad concepts visualised (30 min watch)</p>
<p><strong>Intermediate Level:</strong>
-<a href="https://blog.rockthejvm.com/state-monad/">Threading State Through Computations</a> - Rock the JVM's excellent tutorial (25 min read)
-<a href="https://medium.com/@olxc/statet-monad-transformer-4c5700c4c149">Combining State and Failure</a> - StateT with Optional/Either (20 min read)</p>
<p><strong>Advanced:</strong>
-<a href="https://www.youtube.com/watch?v=U0lK0hnbc4U">State Monad for Functional Rendering</a> - John Carmack on functional state (60 min watch)
-<a href="https://www.youtube.com/watch?v=hmX2s3pe_qk">Implementing State in Pure FP</a> - Gabriel Gonzalez's deep dive (45 min watch)</p>
<h3 id="general-fp-concepts"><a class="header" href="#general-fp-concepts">General FP Concepts</a></h3>
<p>-<a href="https://wiki.haskell.org/State_Monad">State Monad Explained</a> - HaskellWiki's detailed guide
-<a href="https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/state.pdf">The Essence of State</a> - Classic paper by Wadler (PDF, academic but readable)
-<a href="https://dev.stephendiehl.com/fun/001_basics.html">Purely Functional State</a> - Stephen Diehl's tutorial</p>
<h3 id="related-libraries--comparisons"><a class="header" href="#related-libraries--comparisons">Related Libraries &amp; Comparisons</a></h3>
<p>-<a href="https://typelevel.org/cats/datatypes/state.html">Cats State</a> - Scala's mature implementation
-<a href="https://redux.js.org/introduction/core-concepts">Redux for State Management</a> - JavaScript's popular state library (different paradigm but related)</p>
<h3 id="community--discussion"><a class="header" href="#community--discussion">Community &amp; Discussion</a></h3>
<p>-<a href="https://stackoverflow.com/questions/5469954/when-to-use-state-monad">When to Use State Monad</a> - Stack Overflow practical advice
-<a href="https://www.reddit.com/r/haskell/comments/2e6v8q/when_to_use_the_state_monad/">State Monad vs Mutable State</a> - Reddit discussion on trade-offs
-<a href="https://news.ycombinator.com/item?id=12345678">StateT in Production Code</a> - HN thread on real-world usage</p>
<hr />
<p><strong>Previous:</strong> <a href="readert_transformer.html">ReaderT</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../transformers/readert_transformer.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../hkts/order-walkthrough.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../transformers/readert_transformer.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../hkts/order-walkthrough.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../version-switcher.js"></script>
        <script src=".././theme/version-switcher.js"></script>
        <script src=".././theme/sidebar-nav-link.js"></script>


    </div>
    </body>
</html>
