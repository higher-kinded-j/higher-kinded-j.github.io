<!DOCTYPE HTML>
<html lang="en" class="latte sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Lenses - Higher-Kinded-J: Composable Effects and Advanced Optics for Java</title>


        <!-- Custom HTML head -->


            <meta name="description" content="The most comprehensive functional programming library for Java. Unify error handling, optional values, and immutable data navigation with the Effect Path API and Focus DSL. Features advanced optics with code generation for Java records, filtered traversals, indexed optics, and seamless Spring Boot integration.">


        <meta name="keywords" content="Higher-Kinded Types, Higher-Kinded-J, HKT, Java, Optics, Lens, Prism, Traversal, Iso, Affine, Focus DSL, Effect Path API, Functional Programming, Monad, Functor, Applicative, EitherPath, MaybePath, TryPath, ValidationPath, Java Records, Sealed Interface, Error Handling, Immutable Data">
        
        <meta property="og:title" content="Lenses - Higher-Kinded-J: Composable Effects and Advanced Optics for Java">
            <meta property="og:description" content="The most comprehensive functional programming library for Java. Unify error handling, optional values, and immutable data navigation with the Effect Path API and Focus DSL. Features advanced optics with code generation for Java records, filtered traversals, indexed optics, and seamless Spring Boot integration.">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://higher-kinded-j.github.io/">
        <meta property="og:image" content="https://higher-kinded-j.github.io/preview.png">
        <meta property="og:image:width" content="1200">
        <meta property="og:image:height" content="630">
        <meta property="og:site_name" content="Higher-Kinded-J Documentation">
        <meta property="og:locale" content="en_GB">
        
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="Lenses - Higher-Kinded-J: Composable Effects and Advanced Optics for Java">
        <meta name="twitter:description" content="Unifying Composable Effects and Advanced Optics for Java. Effect Path API, Focus DSL, and the most comprehensive optics implementation in the Java ecosystem.">
        <meta name="twitter:image" content="https://higher-kinded-j.github.io/preview.png">
        <meta name="twitter:image:alt" content="Higher-Kinded-J: Composable Effects and Advanced Optics for Java">
        <meta name="description" content="The most comprehensive functional programming library for Java. Unify error handling, optional values, and immutable data navigation with the Effect Path API and Focus DSL. Features advanced optics with code generation for Java records, filtered traversals, indexed optics, and seamless Spring Boot integration.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">
        <meta name="google-site-verification" content="X-xsiAq2cKMLOzh9dexUrX8Onx2h_YMUFgp5lHHUwSg" />
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././mdbook-admonish.css">
        <link rel="stylesheet" href=".././theme/catppuccin.css">
        <link rel="stylesheet" href=".././theme/catppuccin-admonish.css">
        <link rel="stylesheet" href=".././theme/catppuccin-alerts.css">
        <link rel="stylesheet" href=".././theme/additional-hkj.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "latte";
            const default_dark_theme = "macchiato";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('latte')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="latte">Latte</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="frappe">Frapp√©</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="macchiato">Macchiato</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mocha">Mocha</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        <div class="version-selector-container">
                            <select id="version-selector" class="version-selector" aria-label="Select documentation version" title="Select documentation version">
                                <option value="">Loading versions...</option>
                            </select>
                        </div>
                    </div>

                    <h1 class="menu-title">Higher-Kinded-J: Composable Effects and Advanced Optics for Java</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/higher-kinded-j/higher-kinded-j" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/higher-kinded-j/higher-kinded-j/edit/main/hkj-book/src/optics/lenses.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="nested-updates-with-lenses-a-practical-guide"><a class="header" href="#nested-updates-with-lenses-a-practical-guide">Nested Updates with Lenses: A Practical Guide</a></h1>
<h2 id="working-with-product-types"><a class="header" href="#working-with-product-types"><em>Working with Product Types</em></a></h2>
<p><img src="../images/lens2.jpg" alt="Visual representation of a lens focusing on a single field within nested immutable data structures" /></p>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to safely access and update fields in immutable data structures</li>
<li>Using <code>@GenerateLenses</code> to automatically create type-safe field accessors</li>
<li>Composing lenses to navigate deeply nested records</li>
<li>The difference between <code>get</code>, <code>set</code>, and <code>modify</code> operations</li>
<li>Building reusable, composable data access patterns</li>
<li>When to use lenses vs direct field access</li>
</ul>
</div>
</div>
<div id="admonition-hands-on-practice" class="admonition admonish-note" role="note" aria-labelledby="admonition-hands-on-practice-title">
<div class="admonition-title">
<div id="admonition-hands-on-practice-title">
<p>Hands On Practice</p>
</div>
<a class="admonition-anchor-link" href="#admonition-hands-on-practice"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/test/java/org/higherkindedj/tutorial/optics/Tutorial01_LensBasics.java">Tutorial01_LensBasics.java</a> | <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/test/java/org/higherkindedj/tutorial/optics/Tutorial07_GeneratedOptics.java">Tutorial07_GeneratedOptics.java</a></p>
</div>
</div>
<div id="admonition-example-code" class="admonition admonish-note" role="note" aria-labelledby="admonition-example-code-title">
<div class="admonition-title">
<div id="admonition-example-code-title">
<p>Example Code</p>
</div>
<a class="admonition-anchor-link" href="#admonition-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/LensUsageExample.java">LensesExample</a></p>
</div>
</div>
<p>In the introduction to optics, we saw how updating nested immutable data can be verbose and why optics provide a clean, functional solution. We identified the <code>Lens</code> as the primary tool for working with "has-a" relationships, like a field within a record.</p>
<p>This guide provides a complete, step-by-step walkthrough of how to solve the nested update problem using a composable Lens and its generated helper methods.</p>
<hr />
<h2 id="the-scenario-updating-an-employees-address"><a class="header" href="#the-scenario-updating-an-employees-address">The Scenario: Updating an Employee's Address</a></h2>
<p>Let's use a common business scenario involving a deeply nested data structure. Our goal is to update the <code>street</code> of an <code>Employee</code>'s <code>Company``Address</code>.</p>
<p><strong>The Data Model:</strong></p>
<pre><code class="language-java">public record Address(String street, String city) {}
public record Company(String name, Address address) {}
public record Employee(String name, Company company) {}
</code></pre>
<p>Without optics, changing the street requires manually rebuilding the entire <code>Employee</code> object graph. With optics, we can define a direct path to the <code>street</code> and perform the update in a single, declarative line.</p>
<hr />
<h2 id="a-step-by-step-walkthrough"><a class="header" href="#a-step-by-step-walkthrough">A Step-by-Step Walkthrough</a></h2>
<h3 id="step-1-generating-the-lenses"><a class="header" href="#step-1-generating-the-lenses">Step 1: Generating the Lenses</a></h3>
<p>Manually writing <code>Lens</code> implementations is tedious boilerplate. The <code>hkj-optics</code> library automates this with an annotation processor. To begin, we simply annotate our records with <strong><code>@GenerateLenses</code></strong>.</p>
<p>This process creates a companion class for each record (e.g., <code>EmployeeLenses</code>, <code>CompanyLenses</code>) that contains two key features:</p>
<ol>
<li><strong>Lens Factories</strong>: Static methods that create a <code>Lens</code> for each field (e.g., <code>EmployeeLenses.company()</code>).</li>
<li><strong><code>with*</code> Helpers</strong>: Static convenience methods for easy, shallow updates (e.g., <code>EmployeeLenses.withCompany(...)</code>).</li>
</ol>
<pre><code class="language-java">import org.higherkindedj.optics.annotations.GenerateLenses;

@GenerateLenses
public record Address(String street, String city) {}

@GenerateLenses
public record Company(String name, Address address) {}

@GenerateLenses
public record Employee(String name, Company company) {}
</code></pre>
<h4 id="customising-the-generated-package"><a class="header" href="#customising-the-generated-package">Customising the Generated Package</a></h4>
<p>By default, generated classes are placed in the same package as the annotated record. You can specify a different package using the <code>targetPackage</code> attribute to avoid name collisions or to organise generated code separately:</p>
<pre><code class="language-java">// Generated class will be placed in org.example.generated.optics
@GenerateLenses(targetPackage = "org.example.generated.optics")
public record Address(String street, String city) {}
</code></pre>
<p>This is particularly useful when:</p>
<ul>
<li>Multiple records in different packages share the same name</li>
<li>You want to keep generated code separate from source code</li>
<li>You need to control the visibility of generated classes</li>
</ul>
<h3 id="step-2-composing-a-deep-lens"><a class="header" href="#step-2-composing-a-deep-lens">Step 2: Composing a Deep Lens</a></h3>
<p>With the lenses generated, we can now compose them using the <strong><code>andThen</code></strong> method. We'll chain the individual lenses together to create a single, new <code>Lens</code> that represents the complete path from the top-level object (<code>Employee</code>) to the deeply nested field (<code>street</code>).</p>
<p>The result is a new, powerful, and reusable <code>Lens&lt;Employee, String&gt;</code>.</p>
<pre><code class="language-java">// Get the generated lenses
Lens&lt;Employee, Company&gt; employeeToCompany = EmployeeLenses.company();
Lens&lt;Company, Address&gt; companyToAddress = CompanyLenses.address();
Lens&lt;Address, String&gt; addressToStreet = AddressLenses.street();

// Compose them to create a single, deep lens
Lens&lt;Employee, String&gt; employeeToStreet =
    employeeToCompany
        .andThen(companyToAddress)
        .andThen(addressToStreet);
</code></pre>
<h3 id="step-3-performing-updates-with-the-composed-lens"><a class="header" href="#step-3-performing-updates-with-the-composed-lens">Step 3: Performing Updates with the Composed Lens</a></h3>
<p>With our optics generated, we have two primary ways to perform updates.</p>
<h4 id="a-simple-shallow-updates-with-with-helpers"><a class="header" href="#a-simple-shallow-updates-with-with-helpers">A) Simple, Shallow Updates with <code>with*</code> Helpers</a></h4>
<p>For simple updates to a top-level field, the generated <code>with*</code> methods are the most convenient and readable option.</p>
<pre><code class="language-java">// Create an employee instance
var employee = new Employee("Alice", ...);

// Use the generated helper to create an updated copy
var updatedEmployee = EmployeeLenses.withName(employee, "Bob");
</code></pre>
<p>This is a cleaner, more discoverable alternative to using the lens directly (<code>EmployeeLenses.name().set("Bob", employee)</code>).</p>
<h4 id="b-deep-updates-with-a-composed-lens"><a class="header" href="#b-deep-updates-with-a-composed-lens">B) Deep Updates with a Composed Lens</a></h4>
<p>For deep updates into nested structures, the composed lens is the perfect tool. The <code>Lens</code> interface provides two primary methods for this:</p>
<ul>
<li><code>set(newValue, object)</code>: Replaces the focused value with a new one.</li>
<li><code>modify(function, object)</code>: Applies a function to the focused value to compute the new value.</li>
</ul>
<p>Both methods handle the "copy-and-update" cascade for you, returning a completely new top-level object.</p>
<pre><code class="language-java">// Use the composed lens from Step 2
Employee updatedEmployee = employeeToStreet.set("456 Main St", initialEmployee);
</code></pre>
<hr />
<h2 id="when-to-use-with-helpers-vs-manual-lenses"><a class="header" href="#when-to-use-with-helpers-vs-manual-lenses">When to Use <code>with*</code> Helpers vs Manual Lenses</a></h2>
<p>Understanding when to use each approach will help you write cleaner, more maintainable code:</p>
<h3 id="use-with-helpers-when"><a class="header" href="#use-with-helpers-when">Use <code>with*</code> Helpers When:</a></h3>
<ul>
<li><strong>Simple, top-level field updates</strong> - Direct field replacement on the immediate object</li>
<li><strong>One-off updates</strong> - You don't need to reuse the update logic</li>
<li><strong>API clarity</strong> - You want the most discoverable, IDE-friendly approach</li>
</ul>
<pre><code class="language-java">// Perfect for simple updates
var promotedEmployee = EmployeeLenses.withName(employee, "Senior " + employee.name());
</code></pre>
<h3 id="use-composed-lenses-when"><a class="header" href="#use-composed-lenses-when">Use Composed Lenses When:</a></h3>
<ul>
<li><strong>Deep updates</strong> - Navigating multiple levels of nesting</li>
<li><strong>Reusable paths</strong> - The same update pattern will be used multiple times</li>
<li><strong>Complex transformations</strong> - Using <code>modify()</code> with functions</li>
<li><strong>Conditional updates</strong> - Part of larger optic compositions</li>
</ul>
<pre><code class="language-java">// Ideal for reusable deep updates
Lens&lt;Employee, String&gt; streetLens = employeeToCompany
    .andThen(companyToAddress)
    .andThen(addressToStreet);

// Can be reused across your application
Employee moved = streetLens.set("New Office Street", employee);
Employee uppercased = streetLens.modify(String::toUpperCase, employee);
</code></pre>
<div id="admonition-cross-optic-composition" class="admonition admonish-tip" role="note" aria-labelledby="admonition-cross-optic-composition-title">
<div class="admonition-title">
<div id="admonition-cross-optic-composition-title">
<p>Cross-Optic Composition</p>
</div>
<a class="admonition-anchor-link" href="#admonition-cross-optic-composition"></a>
</div>
<div>
<p>Lenses can also compose with other optic types. When you compose a <code>Lens</code> with a <code>Prism</code>, you get a <code>Traversal</code>:</p>
<pre><code class="language-java">// Lens &gt;&gt;&gt; Prism = Traversal
record User(Optional&lt;Settings&gt; settings) {}
Lens&lt;User, Optional&lt;Settings&gt;&gt; settingsLens = UserLenses.settings();
Prism&lt;Optional&lt;Settings&gt;, Settings&gt; somePrism = Prisms.some();

Traversal&lt;User, Settings&gt; userSettings = settingsLens.andThen(somePrism);
</code></pre>
<p>See <a href="composition_rules.html">Composition Rules</a> for the complete reference on how different optics compose.</p>
</div>
</div>
<h3 id="use-manual-lens-creation-when"><a class="header" href="#use-manual-lens-creation-when">Use Manual Lens Creation When:</a></h3>
<ul>
<li><strong>Computed properties</strong> - The lens represents derived data</li>
<li><strong>Complex transformations</strong> - Custom getter/setter logic</li>
<li><strong>Legacy integration</strong> - Working with existing APIs</li>
</ul>
<pre><code class="language-java">// For computed or derived properties
Lens&lt;Employee, String&gt; fullAddressLens = Lens.of(
    emp -&gt; emp.company().address().street() + ", " + emp.company().address().city(),
    (emp, fullAddr) -&gt; {
        String[] parts = fullAddr.split(", ");
        return employeeToCompany.andThen(companyToAddress).set(
            new Address(parts[0], parts[1]), emp);
    }
);
</code></pre>
<hr />
<h2 id="common-pitfalls"><a class="header" href="#common-pitfalls">Common Pitfalls</a></h2>
<h3 id="dont-do-this"><a class="header" href="#dont-do-this">Don't Do This:</a></h3>
<pre><code class="language-java">// Inefficient: Calling get() multiple times
var currentStreet = employeeToStreet.get(employee);
var newEmployee = employeeToStreet.set(currentStreet.toUpperCase(), employee);

// Verbose: Rebuilding lenses repeatedly
var street1 = EmployeeLenses.company().andThen(CompanyLenses.address()).andThen(AddressLenses.street()).get(emp1);
var street2 = EmployeeLenses.company().andThen(CompanyLenses.address()).andThen(AddressLenses.street()).get(emp2);

// Mixing approaches unnecessarily
var tempCompany = EmployeeLenses.company().get(employee);
var updatedCompany = CompanyLenses.withName(tempCompany, "New Company");
var finalEmployee = EmployeeLenses.withCompany(employee, updatedCompany);
</code></pre>
<h3 id="do-this-instead"><a class="header" href="#do-this-instead">Do This Instead:</a></h3>
<pre><code class="language-java">// Efficient: Use modify() for transformations
var newEmployee = employeeToStreet.modify(String::toUpperCase, employee);

// Reusable: Create the lens once, use many times
var streetLens = EmployeeLenses.company().andThen(CompanyLenses.address()).andThen(AddressLenses.street());
var street1 = streetLens.get(emp1);
var street2 = streetLens.get(emp2);

// Consistent: Use one approach for the entire update
var finalEmployee = EmployeeLenses.company()
    .andThen(CompanyLenses.name())
    .set("New Company", employee);
</code></pre>
<hr />
<h2 id="performance-notes"><a class="header" href="#performance-notes">Performance Notes</a></h2>
<p>Lenses are optimised for immutable updates:</p>
<ul>
<li><strong>Memory efficient</strong>: Only creates new objects along the path that changes</li>
<li><strong>Reusable</strong>: Composed lenses can be stored and reused across your application</li>
<li><strong>Type-safe</strong>: All operations are checked at compile time</li>
<li><strong>Lazy</strong>: Operations are only performed when needed</li>
</ul>
<p><strong>Best Practice</strong>: For frequently used paths, create the composed lens once and store it as a static field:</p>
<pre><code class="language-java">public class EmployeeOptics {
    public static final Lens&lt;Employee, String&gt; STREET = 
        EmployeeLenses.company()
            .andThen(CompanyLenses.address())
            .andThen(AddressLenses.street());
        
    public static final Lens&lt;Employee, String&gt; COMPANY_NAME = 
        EmployeeLenses.company()
            .andThen(CompanyLenses.name());
}
</code></pre>
<hr />
<h2 id="complete-runnable-example"><a class="header" href="#complete-runnable-example">Complete, Runnable Example</a></h2>
<p>The following standalone example puts all these steps together. You can run it to see the output and the immutability in action.</p>
<pre><code class="language-java">package org.higherkindedj.example.lens;

// Imports for the generated classes would be automatically resolved by your IDE
import org.higherkindedj.example.lens.LensUsageExampleLenses.AddressLenses;
import org.higherkindedj.example.lens.LensUsageExampleLenses.CompanyLenses;
import org.higherkindedj.example.lens.LensUsageExampleLenses.EmployeeLenses;
import org.higherkindedj.optics.Lens;
import org.higherkindedj.optics.annotations.GenerateLenses;

public class LensUsageExample {

    // 1. Define a nested, immutable data model.
    @GenerateLenses
    public record Address(String street, String city) {}

    @GenerateLenses
    public record Company(String name, Address address) {}

    @GenerateLenses
    public record Employee(String name, Company company) {}


    public static void main(String[] args) {
        // 2. Create an initial, nested immutable object.
        var initialAddress = new Address("123 Fake St", "Anytown");
        var initialCompany = new Company("Initech Inc.", initialAddress);
        var initialEmployee = new Employee("Alice", initialCompany);

        System.out.println("Original Employee: " + initialEmployee);
        System.out.println("------------------------------------------");


        // --- SCENARIO 1: Simple update with a `with*` helper ---
        System.out.println("--- Scenario 1: Using `with*` Helper ---");
        var employeeWithNewName = EmployeeLenses.withName(initialEmployee, "Bob");
        System.out.println("After `withName`:    " + employeeWithNewName);
        System.out.println("------------------------------------------");

        // --- SCENARIO 2: Deep update with a composed Lens ---
        System.out.println("--- Scenario 2: Using Composed Lens ---");
        Lens&lt;Employee, String&gt; employeeToStreet =
            EmployeeLenses.company()
                .andThen(CompanyLenses.address())
                .andThen(AddressLenses.street());

        // Use `set` to replace a value
        Employee updatedEmployeeSet = employeeToStreet.set("456 Main St", initialEmployee);
        System.out.println("After deep `set`:       " + updatedEmployeeSet);

        // Use `modify` to apply a function
        Employee updatedEmployeeModify = employeeToStreet.modify(String::toUpperCase, initialEmployee);
        System.out.println("After deep `modify`:    " + updatedEmployeeModify);
        System.out.println("Original is unchanged:  " + initialEmployee);
      
        // --- SCENARIO 3: Demonstrating reusability ---
        System.out.println("--- Scenario 3: Reusing Composed Lens ---");
        var employee2 = new Employee("Charlie", new Company("Tech Corp", new Address("789 Oak Ave", "Tech City")));
      
        // Same lens works on different employee instances
        var bothUpdated = List.of(initialEmployee, employee2)
            .stream()
            .map(emp -&gt; employeeToStreet.modify(street -&gt; "Remote: " + street, emp))
            .toList();
          
        System.out.println("Batch updated: " + bothUpdated);
    }
}
</code></pre>
<p><strong>Expected Output:</strong></p>
<pre><code>Original Employee: Employee[name=Alice, company=Company[name=Initech Inc., address=Address[street=123 Fake St, city=Anytown]]]
------------------------------------------
--- Scenario 1: Using `with*` Helper ---
After `withName`:    Employee[name=Bob, company=Company[name=Initech Inc., address=Address[street=123 Fake St, city=Anytown]]]
------------------------------------------
--- Scenario 2: Using Composed Lens ---
After deep `set`:       Employee[name=Alice, company=Company[name=Initech Inc., address=Address[street=456 Main St, city=Anytown]]]
After deep `modify`:    Employee[name=Alice, company=Company[name=Initech Inc., address=Address[street=123 FAKE ST, city=Anytown]]]
Original is unchanged:  Employee[name=Alice, company=Company[name=Initech Inc., address=Address[street=123 Fake St, city=Anytown]]]
------------------------------------------
--- Scenario 3: Reusing Composed Lens ---
Batch updated: [Employee[name=Alice, company=Company[name=Initech Inc., address=Address[street=Remote: 123 Fake St, city=Anytown]]], Employee[name=Charlie, company=Company[name=Tech Corp, address=Address[street=Remote: 789 Oak Ave, city=Tech City]]]]
</code></pre>
<p>As you can see, the generated optics provide a clean, declarative, and type-safe API for working with immutable data, whether your updates are simple and shallow or complex and deep.</p>
<hr />
<h2 id="beyond-the-basics-effectful-updates-with-modifyf"><a class="header" href="#beyond-the-basics-effectful-updates-with-modifyf">Beyond the Basics: Effectful Updates with <code>modifyF</code></a></h2>
<p>While <code>set</code> and <code>modify</code> are for simple, pure updates, the <code>Lens</code> interface also supports effectful operations through <code>modifyF</code>. This method allows you to perform updates within a context like an <code>Optional</code>, <code>Validated</code>, or <code>CompletableFuture</code>.</p>
<p>This means you can use the same <code>employeeToStreet</code> lens to perform a street name update that involves failable validation or an asynchronous API call, making your business logic incredibly reusable and robust.</p>
<pre><code class="language-java">// Example: Street validation that might fail
Function&lt;String, Kind&lt;ValidatedKind.Witness&lt;String&gt;, String&gt;&gt; validateStreet = 
    street -&gt; street.length() &gt; 0 &amp;&amp; street.length() &lt; 100 
        ? VALIDATED.widen(Validated.valid(street))
        : VALIDATED.widen(Validated.invalid("Street name must be between 1 and 100 characters"));

// Use the same lens with effectful validation
Kind&lt;ValidatedKind.Witness&lt;String&gt;, Employee&gt; result =
    employeeToStreet.modifyF(validateStreet, employee, validatedApplicative);
</code></pre>
<div id="admonition-for-comprehension-integration" class="admonition admonish-tip" role="note" aria-labelledby="admonition-for-comprehension-integration-title">
<div class="admonition-title">
<div id="admonition-for-comprehension-integration-title">
<p>For Comprehension Integration</p>
</div>
<a class="admonition-anchor-link" href="#admonition-for-comprehension-integration"></a>
</div>
<div>
<p>Lenses integrate with For comprehensions in two ways:</p>
<ul>
<li>Use <code>focus()</code> within a For comprehension to extract values via lens-like accessors. See <a href="../functional/for_comprehension.html#extracting-values-with-focus">For Comprehensions: Extracting Values with focus()</a>.</li>
<li>Use <code>ForState</code> for stateful lens operations that thread updates through a workflow. See <a href="../functional/for_comprehension.html#stateful-updates-with-forstate">For Comprehensions: Stateful Updates with ForState</a>.</li>
</ul>
</div>
</div>
<div id="admonition-coupled-fields" class="admonition admonish-warning" role="note" aria-labelledby="admonition-coupled-fields-title">
<div class="admonition-title">
<div id="admonition-coupled-fields-title">
<p>Coupled Fields</p>
</div>
<a class="admonition-anchor-link" href="#admonition-coupled-fields"></a>
</div>
<div>
<p>When record fields share an invariant (e.g., <code>lo &lt;= hi</code> in a <code>Range</code>), sequential lens updates can fail due to invalid intermediate states. Use <code>Lens.paired</code> to update coupled fields atomically. See <a href="coupled_fields.html">Coupled Fields</a> for details.</p>
</div>
</div>
<div id="admonition-hands-on-learning" class="admonition admonish-info" role="note" aria-labelledby="admonition-hands-on-learning-title">
<div class="admonition-title">
<div id="admonition-hands-on-learning-title">
<p>Hands-On Learning</p>
</div>
<a class="admonition-anchor-link" href="#admonition-hands-on-learning"></a>
</div>
<div>
<p>Practice lens basics in <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/test/java/org/higherkindedj/tutorial/optics/Tutorial01_LensBasics.java">Tutorial 01: Lens Basics</a> (7 exercises, ~10 minutes) and generated optics in <a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/test/java/org/higherkindedj/tutorial/optics/Tutorial07_GeneratedOptics.java">Tutorial 07: Generated Optics</a> (7 exercises, ~10 minutes).</p>
</div>
</div>
<hr />
<p><strong>Previous:</strong> <a href="optics_intro.html">An Introduction to Optics</a>
<strong>Next:</strong> <a href="prisms.html">Prisms: Working with Sum Types</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../optics/optics_intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../optics/prisms.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../optics/optics_intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../optics/prisms.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../version-switcher.js"></script>
        <script src=".././theme/version-switcher.js"></script>
        <script src=".././theme/sidebar-nav-link.js"></script>


    </div>
    </body>
</html>
