<!DOCTYPE HTML>
<html lang="en" class="latte sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Isomorphisms - Higher-Kinded Types and Optics for Java</title>


        <!-- Custom HTML head -->


            <meta name="description" content="Explore Higher-Kinded Types (HKTs) and Optcs in Java with the Higher-Kinded-J library. Learn about Functors, Applicatives, Monads, Transformers, practical functional patterns, and how to write cleaner, more composable Java code for your projects using Optics.">


        <meta name="keywords" content="Higher-Kinded Types, Higher-Kinded-J, Higher-Kinded Java, Higher Kinded Java, HKT, Java, Optics, Lens, Prism, Traversal, Iso, Functional Programming, Monad, Functor, Applicative, Transformer, Monoid, Traverse, higherkindedj">
        
        <meta property="og:title" content="Isomorphisms - Higher-Kinded Types and Optics for Java"> 
            <meta property="og:description" content="Explore Higher-Kinded Types (HKTs) and Optcs in Java with the Higher-Kinded-J library. Learn about Functors, Applicatives, Monads, Transformers, practical functional patterns, and how to write cleaner, more composable Java code for your projects using Optics.">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://higher-kinded-j.github.io/"> 
        
        <meta property="og:image" content="https://higher-kinded-j.github.io/preview.png" />
        <meta property="og:site_name" content="Higher-Kinded-J Documentation" />
        
        
        <meta name="twitter:card" content="summary_large_image" /> <meta name="twitter:title" content="Isomorphisms - Higher-Kinded Types and Optics for Java - Higher-Kinded-J" />
        <meta name="twitter:description" content="Bringing Higher-Kinded Types and Optics to Java functional patterns" />
        <meta name="twitter:image" content="https://higher-kinded-j.github.io/preview.png" />
        <meta name="description" content="Explore Higher-Kinded Types (HKTs) and Optcs in Java with the Higher-Kinded-J library. Learn about Functors, Applicatives, Monads, Transformers, practical functional patterns, and how to write cleaner, more composable Java code for your projects using Optics.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">
        <meta name="google-site-verification" content="X-xsiAq2cKMLOzh9dexUrX8Onx2h_YMUFgp5lHHUwSg" />
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././mdbook-admonish.css">
        <link rel="stylesheet" href=".././theme/catppuccin.css">
        <link rel="stylesheet" href=".././theme/catppuccin-admonish.css">
        <link rel="stylesheet" href=".././theme/catppuccin-alerts.css">
        <link rel="stylesheet" href=".././theme/additional-hkj.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "latte";
            const default_dark_theme = "macchiato";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('latte')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="latte">Latte</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="frappe">Frapp√©</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="macchiato">Macchiato</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mocha">Mocha</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Higher-Kinded Types and Optics for Java</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/higher-kinded-j/higher-kinded-j" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/higher-kinded-j/higher-kinded-j/edit/main/hkj-book/src/optics/iso.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="isomorphisms-a-practical-guide"><a class="header" href="#isomorphisms-a-practical-guide">Isomorphisms: A Practical Guide</a></h1>
<h2 id="data-equivalence-with-isos"><a class="header" href="#data-equivalence-with-isos"><em>Data Equivalence with Isos</em></a></h2>
<div id="admonition-what-youll-learn" class="admonition admonish-info" role="note" aria-labelledby="admonition-what-youll-learn-title">
<div class="admonition-title">
<div id="admonition-what-youll-learn-title">
<p>What You'll Learn</p>
</div>
<a class="admonition-anchor-link" href="#admonition-what-youll-learn"></a>
</div>
<div>
<ul>
<li>How to define lossless, reversible conversions between equivalent types</li>
<li>Creating isomorphisms with <code>Iso.of(get, reverseGet)</code></li>
<li>Using <code>reverse()</code> to flip conversion directions</li>
<li>Step-by-step transformation workflows for data format conversion</li>
<li>Testing round-trip properties to ensure conversion correctness</li>
<li>When to use isos vs direct conversion methods vs manual adapters</li>
</ul>
</div>
</div>
<div id="admonition-example-code" class="admonition admonish-note" role="note" aria-labelledby="admonition-example-code-title">
<div class="admonition-title">
<div id="admonition-example-code-title">
<p>Example Code</p>
</div>
<a class="admonition-anchor-link" href="#admonition-example-code"></a>
</div>
<div>
<p><a href="https://github.com/higher-kinded-j/higher-kinded-j/blob/main/hkj-examples/src/main/java/org/higherkindedj/example/optics/IsoUsageExample.java">IsoUsageExample</a></p>
</div>
</div>
<p>In the previous guides, we explored two essential optics: the <strong><code>Lens</code></strong>, for targeting data that <em>must</em> exist (a "has-a" relationship), and the <strong><code>Prism</code></strong>, for safely targeting data that <em>might</em> exist in a specific shape (an "is-a" relationship).</p>
<p>This leaves one final, fundamental question: what if you have two data types that are different in structure but hold the exact same information? How do you switch between them losslessly? For this, we need our final core optic: the <strong><code>Iso</code></strong>.</p>
<hr />
<h2 id="the-scenario-translating-between-equivalent-types"><a class="header" href="#the-scenario-translating-between-equivalent-types">The Scenario: Translating Between Equivalent Types</a></h2>
<p>An <strong><code>Iso</code></strong> (Isomorphism) is a "two-way street." It's an optic that represents a perfectly reversible, lossless conversion between two equivalent types. Think of it as a <strong>universal translator</strong> üîÑ or a type-safe adapter that you can compose with other optics.</p>
<p>An <code>Iso</code> is the right tool when you need to:</p>
<ul>
<li>Convert a wrapper type to its raw value (e.g., <code>UserId(long id)</code> &lt;-&gt; <code>long</code>).</li>
<li>Handle data encoding and decoding (e.g., <code>byte[]</code> &lt;-&gt; <code>Base64 String</code>).</li>
<li>Bridge two data structures that are informationally identical (e.g., a custom record and a generic tuple).</li>
</ul>
<p>Let's explore that last case. Imagine we have a <code>Point</code> record and want to convert it to a generic <code>Tuple2</code> to use with a library that operates on tuples.</p>
<p><strong>The Data Model:</strong></p>
<pre><code class="language-java">public record Point(int x, int y) {}

public record Tuple2&lt;A, B&gt;(A _1, B _2) {}
</code></pre>
<p>These two records can hold the same information. An <code>Iso</code> is the perfect way to formalize this relationship.</p>
<hr />
<h2 id="think-of-isos-like"><a class="header" href="#think-of-isos-like">Think of Isos Like...</a></h2>
<ul>
<li><strong>A universal translator</strong>: Perfect two-way conversion between equivalent representations</li>
<li><strong>A reversible adapter</strong>: Converts between formats without losing information</li>
<li><strong>A bridge</strong>: Connects two different structures that represent the same data</li>
<li><strong>A currency exchange</strong>: Converts between equivalent values at a 1:1 rate</li>
</ul>
<hr />
<h2 id="a-step-by-step-walkthrough"><a class="header" href="#a-step-by-step-walkthrough">A Step-by-Step Walkthrough</a></h2>
<h3 id="step-1-defining-an-iso"><a class="header" href="#step-1-defining-an-iso">Step 1: Defining an Iso</a></h3>
<p>Unlike Lenses and Prisms, which are often generated from annotations, Isos are almost always defined manually. This is because the logic for converting between two types is unique to your specific domain.</p>
<p>You create an <code>Iso</code> using the static <code>Iso.of(get, reverseGet)</code> constructor.</p>
<pre><code class="language-java">import org.higherkindedj.optics.Iso;
import org.higherkindedj.hkt.tuple.Tuple;
import org.higherkindedj.hkt.tuple.Tuple2;

public class Converters {
    public static Iso&lt;Point, Tuple2&lt;Integer, Integer&gt;&gt; pointToTuple() {
      return Iso.of(
          // Function to get the Tuple from the Point
          point -&gt; Tuple.of(point.x(), point.y()),
          // Function to get the Point from the Tuple
          tuple -&gt; new Point(tuple._1(), tuple._2())
      );
    }
}
</code></pre>
<h3 id="step-2-the-core-iso-operations"><a class="header" href="#step-2-the-core-iso-operations">Step 2: The Core Iso Operations</a></h3>
<p>An <code>Iso</code> provides two fundamental, lossless operations:</p>
<ul>
<li><strong><code>get(source)</code></strong>: The "forward" conversion (e.g., from <code>Point</code> to <code>Tuple2</code>).</li>
<li><strong><code>reverseGet(target)</code></strong>: The "backward" conversion (e.g., from <code>Tuple2</code> back to <code>Point</code>).</li>
</ul>
<p>Furthermore, every <code>Iso</code> is trivially reversible using the <strong><code>.reverse()</code></strong> method, which returns a new <code>Iso</code> with the "get" and "reverseGet" functions swapped.</p>
<pre><code class="language-java">var pointToTupleIso = Converters.pointToTuple();
var myPoint = new Point(10, 20);

// Forward conversion
Tuple2&lt;Integer, Integer&gt; myTuple = pointToTupleIso.get(myPoint); // -&gt; Tuple2[10, 20]

// Backward conversion using the reversed Iso
Point convertedBack = pointToTupleIso.reverse().get(myTuple); // -&gt; Point[10, 20]

// Demonstrate perfect round-trip
assert myPoint.equals(convertedBack); // Always true for lawful Isos
</code></pre>
<h3 id="step-3-composing-isos-as-a-bridge"><a class="header" href="#step-3-composing-isos-as-a-bridge">Step 3: Composing Isos as a Bridge</a></h3>
<p>The most powerful feature of an <code>Iso</code> is its ability to act as an adapter or "glue" between other optics. Because the conversion is lossless, an <code>Iso</code> preserves the "shape" of the optic it's composed with.</p>
<ul>
<li><code>Iso + Iso = Iso</code></li>
<li><strong><code>Iso + Lens = Lens</code></strong></li>
<li><strong><code>Iso + Prism = Prism</code></strong></li>
<li><strong><code>Iso + Traversal = Traversal</code></strong></li>
</ul>
<p>This second rule is incredibly useful. We can compose our <code>Iso&lt;Point, Tuple2&gt;</code> with a <code>Lens</code> that operates on a <code>Tuple2</code> to create a brand new <code>Lens</code> that operates directly on our <code>Point</code>!</p>
<pre><code class="language-java">// A standard Lens that gets the first element of any Tuple2
Lens&lt;Tuple2&lt;Integer, Integer&gt;, Integer&gt; tupleFirstElementLens = ...;

// The composition: Iso&lt;Point, Tuple2&gt; + Lens&lt;Tuple2, Integer&gt; = Lens&lt;Point, Integer&gt;
Lens&lt;Point, Integer&gt; pointToX = pointToTupleIso.andThen(tupleFirstElementLens);

// We can now use this new Lens to modify the 'x' coordinate of our Point
Point movedPoint = pointToX.modify(x -&gt; x + 5, myPoint); // -&gt; Point[15, 20]
</code></pre>
<p>The <code>Iso</code> acted as a bridge, allowing a generic <code>Lens</code> for tuples to work on our specific <code>Point</code> record.</p>
<hr />
<h2 id="when-to-use-isos-vs-other-approaches"><a class="header" href="#when-to-use-isos-vs-other-approaches">When to Use Isos vs Other Approaches</a></h2>
<h3 id="use-isos-when"><a class="header" href="#use-isos-when">Use Isos When:</a></h3>
<ul>
<li><strong>Data format conversion</strong> - Converting between equivalent representations</li>
<li><strong>Legacy system integration</strong> - Bridging old and new data formats</li>
<li><strong>Library interoperability</strong> - Adapting your types to work with external libraries</li>
<li><strong>Composable adapters</strong> - Building reusable conversion components</li>
</ul>
<pre><code class="language-java">// Perfect for format conversion
Iso&lt;LocalDate, String&gt; dateStringIso = Iso.of(
    date -&gt; date.format(DateTimeFormatter.ISO_LOCAL_DATE),
    dateStr -&gt; LocalDate.parse(dateStr, DateTimeFormatter.ISO_LOCAL_DATE)
);

// Use with any date-focused lens
Lens&lt;Person, String&gt; birthDateStringLens = 
    PersonLenses.birthDate().andThen(dateStringIso);
</code></pre>
<h3 id="use-direct-conversion-methods-when"><a class="header" href="#use-direct-conversion-methods-when">Use Direct Conversion Methods When:</a></h3>
<ul>
<li><strong>One-way conversion</strong> - You don't need the reverse operation</li>
<li><strong>Non-lossless conversion</strong> - Information is lost in the conversion</li>
<li><strong>Performance critical paths</strong> - Minimal abstraction overhead needed</li>
</ul>
<pre><code class="language-java">// Simple one-way conversion
String pointDescription = point.x() + "," + point.y();
</code></pre>
<h3 id="use-manual-adapters-when"><a class="header" href="#use-manual-adapters-when">Use Manual Adapters When:</a></h3>
<ul>
<li><strong>Complex conversion logic</strong> - Multi-step or conditional conversions</li>
<li><strong>Validation required</strong> - Conversion might fail</li>
<li><strong>Side effects needed</strong> - Logging, caching, etc.</li>
</ul>
<pre><code class="language-java">// Complex conversion that might fail
public Optional&lt;Point&gt; parsePoint(String input) {
    try {
        String[] parts = input.split(",");
        return Optional.of(new Point(
            Integer.parseInt(parts[0].trim()),
            Integer.parseInt(parts[1].trim())
        ));
    } catch (Exception e) {
        return Optional.empty();
    }
}
</code></pre>
<hr />
<h2 id="common-pitfalls"><a class="header" href="#common-pitfalls">Common Pitfalls</a></h2>
<h3 id="-dont-do-this"><a class="header" href="#-dont-do-this">‚ùå Don't Do This:</a></h3>
<pre><code class="language-java">// Lossy conversion - not a true isomorphism
Iso&lt;Double, Integer&gt; lossyIso = Iso.of(
    d -&gt; d.intValue(),    // Loses decimal precision!
    i -&gt; i.doubleValue()  // Can't recover original value
);

// One-way thinking - forgetting about reverseGet
Iso&lt;Point, String&gt; badPointIso = Iso.of(
    point -&gt; point.x() + "," + point.y(),
    str -&gt; new Point(0, 0)  // Ignores the input!
);

// Creating Isos repeatedly instead of reusing
var iso1 = Iso.of(Point::x, x -&gt; new Point(x, 0));
var iso2 = Iso.of(Point::x, x -&gt; new Point(x, 0));
var iso3 = Iso.of(Point::x, x -&gt; new Point(x, 0));
</code></pre>
<h3 id="-do-this-instead"><a class="header" href="#-do-this-instead">‚úÖ Do This Instead:</a></h3>
<pre><code class="language-java">// True isomorphism - perfect round-trip
Iso&lt;Point, String&gt; goodPointIso = Iso.of(
    point -&gt; point.x() + "," + point.y(),
    str -&gt; {
        String[] parts = str.split(",");
        return new Point(Integer.parseInt(parts[0]), Integer.parseInt(parts[1]));
    }
);

// Test your isomorphisms
public static &lt;A, B&gt; void testIsomorphism(Iso&lt;A, B&gt; iso, A original) {
    B converted = iso.get(original);
    A roundTrip = iso.reverse().get(converted);
    assert original.equals(roundTrip) : "Iso failed round-trip test";
}

// Reuse Isos as constants
public static final Iso&lt;Point, Tuple2&lt;Integer, Integer&gt;&gt; POINT_TO_TUPLE = 
    Iso.of(
        point -&gt; Tuple.of(point.x(), point.y()),
        tuple -&gt; new Point(tuple._1(), tuple._2())
    );
</code></pre>
<hr />
<h2 id="performance-notes"><a class="header" href="#performance-notes">Performance Notes</a></h2>
<p>Isos are designed for efficient, lossless conversion:</p>
<ul>
<li><strong>Zero overhead composition</strong>: Multiple Iso compositions are fused into single operations</li>
<li><strong>Lazy evaluation</strong>: Conversions only happen when needed</li>
<li><strong>Type safety</strong>: All conversions are checked at compile time</li>
<li><strong>Reusable</strong>: Isos can be stored and reused across your application</li>
</ul>
<p><strong>Best Practice</strong>: For frequently used conversions, create Isos as constants and test them:</p>
<pre><code class="language-java">public class DataIsos {
    public static final Iso&lt;UserId, Long&gt; USER_ID_LONG = 
        Iso.of(UserId::value, UserId::new);
    
    public static final Iso&lt;Money, BigDecimal&gt; MONEY_DECIMAL = 
        Iso.of(Money::amount, Money::new);
    
    // Test your isos
    static {
        testIsomorphism(USER_ID_LONG, new UserId(12345L));
        testIsomorphism(MONEY_DECIMAL, new Money(new BigDecimal("99.99")));
    }
  
    private static &lt;A, B&gt; void testIsomorphism(Iso&lt;A, B&gt; iso, A original) {
        B converted = iso.get(original);
        A roundTrip = iso.reverse().get(converted);
        if (!original.equals(roundTrip)) {
            throw new AssertionError("Iso failed round-trip test: " + original + " -&gt; " + converted + " -&gt; " + roundTrip);
        }
    }
}
</code></pre>
<hr />
<h2 id="real-world-examples"><a class="header" href="#real-world-examples">Real-World Examples</a></h2>
<h3 id="1-api-data-transformation"><a class="header" href="#1-api-data-transformation">1. API Data Transformation</a></h3>
<pre><code class="language-java">// Internal model
public record Customer(String name, String email, LocalDate birthDate) {}

// External API model
public record CustomerDto(String fullName, String emailAddress, String birthDateString) {}

public class CustomerIsos {
    public static final Iso&lt;Customer, CustomerDto&gt; CUSTOMER_DTO = Iso.of(
        // Convert to DTO
        customer -&gt; new CustomerDto(
            customer.name(),
            customer.email(),
            customer.birthDate().format(DateTimeFormatter.ISO_LOCAL_DATE)
        ),
        // Convert from DTO
        dto -&gt; new Customer(
            dto.fullName(),
            dto.emailAddress(),
            LocalDate.parse(dto.birthDateString(), DateTimeFormatter.ISO_LOCAL_DATE)
        )
    );
  
    // Now any Customer lens can work with DTOs
    public static final Lens&lt;CustomerDto, String&gt; DTO_NAME = 
        CUSTOMER_DTO.reverse().andThen(CustomerLenses.name()).andThen(CUSTOMER_DTO);
}
</code></pre>
<h3 id="2-configuration-format-conversion"><a class="header" href="#2-configuration-format-conversion">2. Configuration Format Conversion</a></h3>
<pre><code class="language-java">// Different configuration representations
public record DatabaseConfig(String host, int port, String database) {}
public record ConnectionString(String value) {}

public class ConfigIsos {
    public static final Iso&lt;DatabaseConfig, ConnectionString&gt; DB_CONNECTION = Iso.of(
        // To connection string
        config -&gt; new ConnectionString(
            "jdbc:postgresql://" + config.host() + ":" + config.port() + "/" + config.database()
        ),
        // From connection string
        conn -&gt; {
            // Simple parser for this example
            String url = conn.value();
            String[] parts = url.replace("jdbc:postgresql://", "").split("[:/]");
            return new DatabaseConfig(parts[0], Integer.parseInt(parts[1]), parts[2]);
        }
    );
  
    // Use with existing configuration lenses
    public static final Lens&lt;DatabaseConfig, String&gt; CONNECTION_STRING_HOST = 
        DB_CONNECTION.andThen(
            Lens.of(
                cs -&gt; cs.value().split("//")[1].split(":")[0],
                (cs, host) -&gt; new ConnectionString(cs.value().replaceFirst("//[^:]+:", "//" + host + ":"))
            )
        ).andThen(DB_CONNECTION.reverse());
}
</code></pre>
<h3 id="3-wrapper-type-integration"><a class="header" href="#3-wrapper-type-integration">3. Wrapper Type Integration</a></h3>
<pre><code class="language-java">// Strongly-typed wrappers
public record ProductId(UUID value) {}
public record CategoryId(UUID value) {}

public class WrapperIsos {
    public static final Iso&lt;ProductId, UUID&gt; PRODUCT_ID_UUID = 
        Iso.of(ProductId::value, ProductId::new);
  
    public static final Iso&lt;CategoryId, UUID&gt; CATEGORY_ID_UUID = 
        Iso.of(CategoryId::value, CategoryId::new);
  
    // Use with any UUID-based operations
    public static String formatProductId(ProductId id) {
        return PRODUCT_ID_UUID
            .andThen(Iso.of(UUID::toString, UUID::fromString))
            .get(id);
    }
}
</code></pre>
<h2 id="complete-runnable-example"><a class="header" href="#complete-runnable-example">Complete, Runnable Example</a></h2>
<p>This example puts all the steps together to show both direct conversion and composition.</p>
<pre><code class="language-java">public class IsoUsageExample {

    @GenerateLenses
    public record Point(int x, int y) {}

    @GenerateLenses
    public record Circle(Point centre, int radius) {}

    public static class Converters {
        @GenerateIsos
        public static Iso&lt;Point, Tuple2&lt;Integer, Integer&gt;&gt; pointToTuple() {
            return Iso.of(
                    point -&gt; Tuple.of(point.x(), point.y()),
                    tuple -&gt; new Point(tuple._1(), tuple._2()));
        }

        // Additional useful Isos
        public static final Iso&lt;Point, String&gt; POINT_STRING = Iso.of(
                point -&gt; point.x() + "," + point.y(),
                str -&gt; {
                    String[] parts = str.split(",");
                    return new Point(Integer.parseInt(parts[0]), Integer.parseInt(parts[1]));
                }
        );
    }

    // Test helper
    private static &lt;A, B&gt; void testRoundTrip(Iso&lt;A, B&gt; iso, A original, String description) {
        B converted = iso.get(original);
        A roundTrip = iso.reverse().get(converted);
        System.out.println(description + ":");
        System.out.println("  Original:  " + original);
        System.out.println("  Converted: " + converted);
        System.out.println("  Round-trip: " + roundTrip);
        System.out.println("  Success: " + original.equals(roundTrip));
        System.out.println();
    }

    public static void main(String[] args) {
        // 1. Define a point and circle.
        var myPoint = new Point(10, 20);
        var myCircle = new Circle(myPoint, 5);

        System.out.println("=== ISO USAGE EXAMPLE ===");
        System.out.println("Original Point: " + myPoint);
        System.out.println("Original Circle: " + myCircle);
        System.out.println("------------------------------------------");

        // 2. Get the generated Iso.
        var pointToTupleIso = ConvertersIsos.pointToTuple;

        // --- SCENARIO 1: Direct conversions and round-trip testing ---
        System.out.println("--- Scenario 1: Direct Conversions ---");
        testRoundTrip(pointToTupleIso, myPoint, "Point to Tuple conversion");
        testRoundTrip(Converters.POINT_STRING, myPoint, "Point to String conversion");

        // --- SCENARIO 2: Using reverse() ---
        System.out.println("--- Scenario 2: Reverse Operations ---");
        var tupleToPointIso = pointToTupleIso.reverse();
        var myTuple = Tuple.of(30, 40);
        Point pointFromTuple = tupleToPointIso.get(myTuple);
        System.out.println("Tuple: " + myTuple + " -&gt; Point: " + pointFromTuple);
        System.out.println();

        // --- SCENARIO 3: Composition with lenses ---
        System.out.println("--- Scenario 3: Composition with Lenses ---");

        // Create a lens manually that works with Point directly
        Lens&lt;Point, Integer&gt; pointToXLens = Lens.of(
                Point::x,
                (point, newX) -&gt; new Point(newX, point.y())
        );

        // Use the lens
        Point movedPoint = pointToXLens.modify(x -&gt; x + 5, myPoint);
        System.out.println("Original point: " + myPoint);
        System.out.println("After moving X by 5: " + movedPoint);
        System.out.println();

        // --- SCENARIO 4: Demonstrating Iso composition ---
        System.out.println("--- Scenario 4: Iso Composition ---");

        // Show how the Iso can be used to convert and work with tuples
        Tuple2&lt;Integer, Integer&gt; tupleRepresentation = pointToTupleIso.get(myPoint);
        System.out.println("Point as tuple: " + tupleRepresentation);

        // Modify the tuple using tuple operations
        Lens&lt;Tuple2&lt;Integer, Integer&gt;, Integer&gt; tupleFirstLens = Tuple2Lenses._1();
        Tuple2&lt;Integer, Integer&gt; modifiedTuple = tupleFirstLens.modify(x -&gt; x * 2, tupleRepresentation);

        // Convert back to Point
        Point modifiedPoint = pointToTupleIso.reverse().get(modifiedTuple);
        System.out.println("Modified tuple: " + modifiedTuple);
        System.out.println("Back to point: " + modifiedPoint);
        System.out.println();

        // --- SCENARIO 5: String format conversions ---
        System.out.println("--- Scenario 5: String Format Conversions ---");

        String pointAsString = Converters.POINT_STRING.get(myPoint);
        System.out.println("Point as string: " + pointAsString);

        Point recoveredFromString = Converters.POINT_STRING.reverse().get(pointAsString);
        System.out.println("Recovered from string: " + recoveredFromString);
        System.out.println("Perfect round-trip: " + myPoint.equals(recoveredFromString));

        // --- SCENARIO 6: Working with Circle centre through Iso ---
        System.out.println("--- Scenario 6: Circle Centre Manipulation ---");

        // Get the centre as a tuple, modify it, and put it back
        Point originalCentre = myCircle.centre();
        Tuple2&lt;Integer, Integer&gt; centreAsTuple = pointToTupleIso.get(originalCentre);
        Tuple2&lt;Integer, Integer&gt; shiftedCentre = Tuple.of(centreAsTuple._1() + 10, centreAsTuple._2() + 10);
        Point newCentre = pointToTupleIso.reverse().get(shiftedCentre);
        Circle newCircle = CircleLenses.centre().set(newCentre, myCircle);

        System.out.println("Original circle: " + myCircle);
        System.out.println("Centre as tuple: " + centreAsTuple);
        System.out.println("Shifted centre tuple: " + shiftedCentre);
        System.out.println("New circle: " + newCircle);
    }
</code></pre>
<p><strong>Expected Output:</strong></p>
<pre><code>=== ISO USAGE EXAMPLE ===
Original Point: Point[x=10, y=20]
Original Circle: Circle[centre=Point[x=10, y=20], radius=5]
------------------------------------------
--- Scenario 1: Direct Conversions ---
Point to Tuple conversion:
  Original:  Point[x=10, y=20]
  Converted: Tuple2[_1=10, _2=20]
  Round-trip: Point[x=10, y=20]
  Success: true

Point to String conversion:
  Original:  Point[x=10, y=20]
  Converted: 10,20
  Round-trip: Point[x=10, y=20]
  Success: true

--- Scenario 2: Reverse Operations ---
Tuple: Tuple2[_1=30, _2=40] -&gt; Point: Point[x=30, y=40]

--- Scenario 3: Working with Different Representations ---
Original point: Point[x=10, y=20]
After moving X by 5: Point[x=15, y=20]

--- Scenario 4: Conversion Workflows ---
Point as tuple: Tuple2[_1=10, _2=20]
Modified tuple: Tuple2[_1=20, _2=20]
Back to point: Point[x=20, y=20]

--- Scenario 5: String Format Conversions ---
Point as string: 10,20
Recovered from string: Point[x=10, y=20]
Perfect round-trip: true

--- Scenario 6: Circle Centre Manipulation ---
Original circle: Circle[centre=Point[x=10, y=20], radius=5]
Centre as tuple: Tuple2[_1=10, _2=20]
Shifted centre tuple: Tuple2[_1=20, _2=30]
New circle: Circle[centre=Point[x=20, y=30], radius=5]
</code></pre>
<hr />
<h2 id="why-isos-are-a-powerful-bridge"><a class="header" href="#why-isos-are-a-powerful-bridge">Why Isos are a Powerful Bridge</a></h2>
<p><code>Lens</code>, <code>Prism</code>, and <code>Iso</code> form a powerful trio for modelling any data operation. An <code>Iso</code> is the essential bridge that enables you to:</p>
<ul>
<li><strong>Work with the Best Representation</strong>: Convert data to the most suitable format for each operation, then convert back when needed.</li>
<li><strong>Enable Library Integration</strong>: Adapt your internal data types to work seamlessly with external libraries without changing your core domain model.</li>
<li><strong>Maintain Type Safety</strong>: All conversions are checked at compile time, eliminating runtime conversion errors.</li>
<li><strong>Build Reusable Converters</strong>: Create tested, reusable conversion components that can be used throughout your application.</li>
</ul>
<p>The step-by-step conversion approach shown in the examples is the most practical way to use Isos in real applications, providing clear, maintainable code that leverages the strengths of different data representations.</p>
<hr />
<p><strong>Previous:</strong><a href="prisms.html">Prisms: Working with Sum Types</a>
<strong>Next:</strong><a href="traversals.html">Traversals: Handling Bulk Updates</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../optics/prisms.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../optics/traversals.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../optics/prisms.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../optics/traversals.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
